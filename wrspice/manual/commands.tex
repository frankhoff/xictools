\chapter{{\WRspice} Commands}
\label{commands}

% spCommands.hlp:commands 011721

When a line is entered, it is interpreted as one of several things. 
First, it may be an alias, in which case the line is replaced with the
result after alias substitution, and the line is re-parsed.  Second,
it may be the name of a codeblock, which is a user-defined command
obtained from a script file, in which case the codeblock is executed. 
Third, it may be a pre-defined command, in which case it is executed. 
Fourth, it may be an assignment statement, which consists of a vector
name, an `{\vt =}' symbol, and an expression, in which case it is
executed as if it were preceded by the word ``{\vt let}''.  Fifth, it
may be the name of a circuit file, in which case it is loaded as if
with a {\cb source} command, or it may be the name of a command script
-- {\WRspice} searches the current {\et sourcepath} (search path) for
the file and executes it when it is found.  The effect of this is
identical to the effect of ``{\vt source} {\it file}'', except that
the variables {\et argc} and {\et argv} are set.  Finally, it may be a
UNIX command, in which case if the variable {\et unixcom} is set, it
is executed as though it were typed to the operating system shell.


The following table lists all built-in commands understood by
{\WRspice}.

\begin{longtable}{|l|l|}\hline
\multicolumn{2}{|c|}{\bf Control Structures}\\ \hline
\cb cdump & Dump control structures for debugging\\ \hline
\hline
\multicolumn{2}{|c|}{\bf String Comparison and Global Return Value}\\ \hline
\cb strcmp & Compare strings\\ \hline
\cb strcicmp & Compare strings, case insensitive\\ \hline
\cb strprefix & Check if string is prefix of another\\ \hline
\cb strciprefix & Check if string is prefix of another, case insensitive\\ \hline
\cb retval & Set the global return value\\ \hline
\hline
\multicolumn{2}{|c|}{\bf User Interface Setup Commands}\\ \hline
\cb mapkey & Create keyboard mapping\\ \hline
\cb setcase & Check/set case sensitivity for name classes\\ \hline
\cb setfont & Set graphical interface fonts\\ \hline
\cb setrdb & Set X resources\\ \hline
\cb tbupdate & Save tool window configuration\\ \hline
\cb wrupdate & Download/install program updates\\ \hline
\hline
\multicolumn{2}{|c|}{\bf Shell Commands}\\ \hline
\cb alias & Create alias\\ \hline
\cb cd & Change directory\\ \hline
\cb echo & Print string\\ \hline
\cb echof & Print string to file\\ \hline
\cb history & Print command history\\ \hline
\cb pause & Pause script execution\\ \hline
\cb pwd & Print the current working dirsctory\\ \hline
\cb rehash & Update command database\\ \hline
\cb set & Set a variable\\ \hline
\cb shell & Execute operating system commands\\ \hline
\cb shift & Shift argument list\\ \hline
\cb unalias & Destroy alias\\ \hline
\cb unset & Unset a variable\\ \hline
\cb usrset & Print list of internally used variables\\ \hline
\hline
\multicolumn{2}{|c|}{\bf Input and Output Commands}\\ \hline
\cb codeblock & Manipulate codeblocks\\ \hline
\cb dumpnodes & Print node voltages and branch currents\\ \hline
\cb edit & Edit text file\\ \hline
\cb listing & List current circuit\\ \hline
\cb load & Read plot data from file\\ \hline
\cb print & Print vectors\\ \hline
\cb printf & Print vectors to logging file\\ \hline
\cb return & Return from script immediately, possibly with a value\\ \hline
\cb sced & Bring up {\Xic} schematic editor\\ \hline
\cb source & Read circuit or script input file\\ \hline
\cb write & Write data to rawfile\\ \hline
\cb xeditor & Edit text file\\ \hline
\hline
\multicolumn{2}{|c|}{\bf Simulation Commands}\\ \hline
\cb ac & Perform ac analysis\\ \hline
\cb alter & Change circuit parameter\\ \hline
\cb alterf & Dump alter list to Monte Carlo output file\\ \hline
\cb aspice & Initiate asynchronous run\\ \hline
\cb cache & Manipulate subcircuit/model cache\\ \hline
\cb check & Initiate range analysis\\ \hline
\cb dc & Initiate dc analysis\\ \hline
\cb delete & Delete watchpoint\\ \hline
\cb destroy & Delete plot\\ \hline
\cb devcnt & Print device counts\\ \hline
\cb devload & Load device module\\ \hline
\cb devls & List available devices\\ \hline
\cb devmod & Change device model levels\\ \hline
\cb disto & Initiate distortion analysis\\ \hline
\cb dump & Print circuit matrix\\ \hline
\cb findlower & Find lower edge of operating range\\ \hline
\cb findrange & Find edges of operating range\\ \hline
\cb findupper & Find upper edge of operating range\\ \hline
\cb free & Delete circuits and/or plots\\ \hline
\cb jobs & Check asynchronous jobs\\ \hline
\cb loop & Alias for sweep command\\ \hline
\cb mctrial & Run a Monte Carlo trial\\ \hline
\cb measure & Set up a measurement\\ \hline
\cb noise & Initiate noise analysis\\ \hline
\cb op & Compute operating point\\ \hline
\cb pz & Initiate pole-zero analysis\\ \hline
\cb reset & Reset simulator\\ \hline
\cb resume & Resume run in progress\\ \hline
\cb rhost & Identify remote SPICE host\\ \hline
\cb rspice & Initiate remote SPICE run\\ \hline
\cb run & Initiate simulation\\ \hline
\cb save & List vectors to save during run\\ \hline
\cb sens & Initiate sensitivity analysis\\ \hline
\cb setcirc & Set current circuit\\ \hline
\cb show & List parameters\\ \hline
\cb state & Print circuit state\\ \hline
\cb status & Print trace status\\ \hline
\cb step & Advance simulator\\ \hline
\cb stop & Specify stop condition\\ \hline
\cb sweep & Perform analysis over parameter range\\ \hline
\cb tf & Initiate transfer function analysis\\ \hline
\cb trace & Set trace\\ \hline
\cb tran & Initiate transient analysis\\ \hline
\cb vastep & Advance Verilog simulator\\ \hline
\cb where & Print nonconvergence information\\ \hline
\hline
\multicolumn{2}{|c|}{\bf Data Manipulation Commands}\\ \hline
\cb compose & Create vector\\ \hline
\cb cross & Vector cross operation\\ \hline
\cb define & Define a macro function\\ \hline
\cb deftype & Define a data type\\ \hline
\cb diff & Compare plots and vectors\\ \hline
\cb display & Print vector list\\ \hline
\cb fourier & Perform spectral analysis\\ \hline
\cb let & Create or assign vectors\\ \hline
\cb linearize & Linearize vector data\\ \hline
\cb pick & Create vector from reduced data\\ \hline
\cb seed & Seed random number generator\\ \hline
\cb setdim & Set current plot dimensions\\ \hline
\cb setplot & Set current plot\\ \hline
\cb setscale & Assign scale to vector\\ \hline
\cb settype & Assign type to vector\\ \hline
\cb spec & Perform spectral analysis\\ \hline
\cb undefine & Undefine macro function\\ \hline
\cb unlet & Undefine vector\\ \hline
\hline
\multicolumn{2}{|c|}{\bf Graphical Output Commands}\\ \hline
\cb asciiplot & Generate line printer plot\\ \hline
\cb combine & Combine plots\\ \hline
\cb hardcopy & Send plot to printer\\ \hline
\cb iplot & Plot during simulation\\ \hline
\cb mplot & Plot range analysis output\\ \hline
\cb plot & Plot simulation results\\ \hline
\cb plotwin & Pop down and destroy plot windows\\ \hline
\cb xgraph & Plot simulation results using {\vt xgraph}\\ \hline
\hline
\multicolumn{2}{|c|}{\bf Miscellaneous Commands}\\ \hline
\cb bug & Submit bug report\\ \hline
\cb help & Enter help system\\ \hline
\cb helpreset & Clear help system cache\\ \hline
\cb qhelp & Print command summaries\\ \hline
\cb quit & Exit program\\ \hline
\cb rusage & Print resource usage statistics\\ \hline
\cb stats & Print resource usage statistics\\ \hline
\cb version & Print program version\\ \hline
\end{longtable}


%S-----------------------------------------------------------------------------
\section{Control Structures}
\index{control structures}

% spCommands.hlp:controlcmds 012209

Control structures operate on expressions involving vectors,
constants, and ({\vt \$}-substituted) shell variables.  A non-zero
result (of any element, if the length is greater than 1) indicates
``true''.  The following control structures are available:

Although control structures are most commonly used in command scripts,
they are also allowed from the command line.  While a block is active,
the command prompt changes to one or more ``$>$'' characters, the
number of which represents the current depth into the control
commands.  As with a UNIX shell, control structures can be used from
the command line to repeat one or more commands.

\begin{description}
\item{{\bf repeat} block}\\
\index{repeat block}

\begin{quote}
{\vt {\bf repeat} [{\it number\/}]}\\
\quad {\it statement}\\
\quad {...}\\
{\bf\vt end}
\end{quote}
Execute the statements in the block defined by the {\et repeat} line
and the corresponding {\et end} statement {\it number\/} times, or
indefinitely if no {\it number} is given.  The {\it number} must be a
constant, or a shell variable reference that evaluates to a constant,
which may be a vector reference in the {\vt \$\&} form.  A vector name
is not valid.

\item{{\bf while} block}\\
\index{while block}

\begin{quote}
{\bf\vt while} {\it condition}\\
\quad {\it statement}\\
\quad {...}\\
{\bf\vt end}
\end{quote}
The {\et while} line, together with a matching {\et end} statement,
defines a block of commands that are executed while the {\it
condition} remains true.  The {\it condition} is an expression which
is considered true if it evaluates to a nonzero value, or if a vector,
any component is nonzero.  The test is performed at the top of the
loop, so that if the {\it condition} is initially false, the
statements are not executed.

\item{{\bf dowhile} block}\\
\index{dowhile block}

\begin{quote}
{\bf\vt dowhile} {\it condition}\\
\quad {\it statement}\\
\quad {...}\\
{\bf\vt end}
\end{quote}
The {\et dowhile} line, together with a matching {\et end} statement,
defines a block of commands that are executed while the {\it
condition} remains true.  The {\it condition} is an expression which
is considered true if it evaluates to a nonzero value, or if a vector,
any component is nonzero.  Unlike the {\et while} statement, the test
is performed at the bottom of the loop -- so that the loop executes at
least once.

\item{{\bf foreach} block}\\
\index{foreach block}

\begin{quote}
{\bf\vt foreach} {\it var value\/} ...\\
\quad {\it statement}\\
\quad {...}\\
{\bf\vt end}
\end{quote}
The {\et foreach} statement opens a block which will be executed once
for each {\it value} given.  Each time through, the {\it var} will be
set to successive {\it value\/}s.  After the loop is exited it will
have the last value that was assigned to it.  The {\it var} can be
accessed in the loop with the {\vt \$var} notation, i.e., it should be
treated as a shell variable, not a vector.  This is set to each {\it
value} as a text item.

\item{{\bf if} block}\\
\index{if block}

\begin{quote}
{\bf\vt if} {\it condition}\\
\quad {\it statement}\\
\quad {...}\\
{\bf\vt else}\\
\quad {\it statement}\\
\quad {...}\\
{\bf\vt end}
\end{quote}
If the {\it condition\/} is non-zero then the first set of statements is
executed, otherwise the second set.  The {\et else} and the second set of
statements may be omitted.

\item{{\bf label} statement}\\
\index{label statement}

\begin{quote}
{\bf\vt label} {\it labelname}
\end{quote}
This defines a label which can be used as an argument to a {\et goto}
statememt.

\item{{\bf goto} statement}\\
\index{goto statement}

\begin{quote}
{\bf\vt goto} {\it label}
\end{quote}
If there is a {\et label} statement defining the {\it label} in the
block or an enclosing block, control is transfered there.  If the {\et
goto} is used outside of a block, the label must appear ahead of the
{\et goto} (i.e., a forward {\et goto} may occur only within a block). 
There is a {\et begin} macro pre-defined as ``{\vt if 1}'' which may
be used if forward label references are required outside of a block
construct.

\item{{\bf continue} statement}\\
\index{continue statement}

\begin{quote}
{\bf\vt continue [{\it number}]}
\end{quote}
If there is a {\et while}, {\et dowhile}, {\et foreach} or {\et
repeat} block enclosing this statement, the next iteration begins
immediately and control passes to the top of the block.  Otherwise an
error results.  If a {\it number} is given, that many surrounding
blocks are continued.  If there are not that many blocks, an error
results.

\item{{\bf break} statement}\\
\index{break statement}

\begin{quote}
{\bf\vt break [{\it number}]}
\end{quote}
If there is a {\et while}, {\et dowhile}, {\et foreach}, or {\et
repeat} block enclosing this statement, control passes out of the
block.  Otherwise an error results.  If a {\it number} is given, that
many surrounding blocks are exited.  If there are not that many
blocks, an error results.

\item{{\bf end} statement}\\
\index{end statement}

\begin{quote}
{\bf\vt end}
\end{quote}
This statement terminates a block.  It is an error for an {\et end} to
appear without a matching {\et if}, {\et while}, {\et dowhile}, {\et
foreach}, or {\et repeat} statement.  The keywords {\et endif}, {\et
endwhile}, {\et enddowhile}, {\et endforeach}, and {\et endrepeat} are
internally aliased to {\et end}.
\end{description}

Control structures may be nested.  When a block is entered and the
input is from the keyboard, the prompt becomes a number of $>$'s
equalling the depth of blocks the user has entered.  The current
control structures may be examined with the debugging command {\cb
cdump}.

\newcommand{\spcmd}[1]{The {\cb #1} Command}

%SU-------------------------------------
\subsection{\spcmd{cdump}}
\index{cdump command}

% spCommands.hlp:cdump 012709

The {\cb cdump} command prints out the contents of the currently
active control structures.  The command takes no arguments.  It is
intended primarily for debugging.


%S-----------------------------------------------------------------------------
\section{String Comparison and Global Return Value}
\index{string comparison}
\index{global return value}

% spCommands.hlp:strcmds 030519

These commands are used for string comparison, and for setting the
global return value.  The global return value is an internal global
variable that can be set and queried from any script (with the {\vt
\$?} construct).  This can be used to pass numeric data from a script,
but one must take care that the value is not overwritten before use,
as its scope is global.  The string comparison functions return their
comparison result in the global return value.  There is no native
string data type in the scripting language, and the commands here
provide basic string support.

\begin{tabular}{|l|l|}\hline
\cb strcmp & Compare strings\\ \hline
\cb strcicmp & Compare strings, case insensitive\\ \hline
\cb strprefix & Check if string is prefix of another\\ \hline
\cb strciprefix & Check if string is prefix of another, case insensitive\\ \hline
\cb retval & Set the global return value\\ \hline
\end{tabular}

%SU-------------------------------------
\subsection{\spcmd{strcmp}}
\index{strcmp command}

% spCommands.hlp:strcmp 080816

The {\cb strcmp} command is used for string comparison in control
structures.
\begin{quote}\vt
strcmp [{\it varname\/}] {\it string1 string2}
\end{quote}
This supports the original Spice3 {\cb strcmp} which returns is value
in a given variable, and the {\WRspice} convention where the
comparison value is returned in the global return value (accessible
with ``{\vt \$?}'').

In either case, the comparison value is a number that is less than,
equal to, or greater than zero according to whether {\it string1} is
lexically before, equal to, or after {\it string2\/}.

If three arguments are given, the first argument is taken as the name
of a variable which is set to the comparison value.  This convention
is supported for backwards compatibility, of this function only. 
Otherwise, the global return value will be set to this value.  The
other arguments are literal strings.

Example
\begin{quote}\vt
.control\\
set str1="abcd efgh"\\
set str2="bbcd efgh"\\
strcmp "\$str1" "\$str2"\\
if (\$? < 0)\\
\hspace*{2em}echo "\$str1" ahead of "\$str2"\\    
else\\
if (\$? = 0)\\
\hspace*{2em}echo strings are the same\\    
else\\
\hspace*{2em}echo "\$str1" after "\$str2"\\    
end\\
end\\
.endc
\end{quote}

%SU-------------------------------------
\subsection{\spcmd{strcicmp}}
\index{strcicmp command}

% spCommands.hlp:strcicmp 080816

The {\cb strcicmp} command is used for string comparison in control
structures.
\begin{quote}\vt
strcicmp {\it string1 string2}
\end{quote}
The {\cb strcicmp} command is similar to {\cb strcmp}, however the
comparison result is case-insensitive, and the Spice3 return
convention is not supported.  The global return value (accessible as
``{\vt \$?}'') is set to the comparison value.  The comparison value
is a number that is less than, equal to, or greater than zero
according to whether {\it string1} is lexically before, equal to, or
after {\it string2}.  The two arguments are literal strings.

%SU-------------------------------------
\subsection{\spcmd{strprefix}}
\index{strprefix command}

% spCommands.hlp:strprefix 080816

The {\cb strprefix} command will set the global return value to one if
{\it string1} is a prefix of {\it string2\/}, or zero if not.
\begin{quote}\vt
strprefix {\it string1 string2}
\end{quote}

%SU-------------------------------------
\subsection{\spcmd{strciprefix}}
\index{strciprefix command}

% spCommands.hlp:strciprefix 080816

The {\cb strciprefix} command will set the global return value to one
if {\it string1} is a case-insensitive prefix of {\it string2\/}, or
zero if not.
\begin{quote}\vt
strciprefix {\it string1 string2}
\end{quote}

%SU-------------------------------------
\subsection{\spcmd{retval}}
\index{retval command}

% spCommands.hlp:retval 030519

The {\cb retval} command will set the global return value to the numeric
value given.
\begin{quote}\vt
retval {\it value}
\end{quote}
This can be used to pass a value back from a script.  The value is
initialized to zero whenever a script is executed, so that zero is the
default return value.  The global return value is a global value
available in any script and the command prompt line, and is accessed
with the special variable name {\vt \$?}.  The global return value is
set by this function and the string comparison functions, and
optionally by the {\cb return} function.


%S-----------------------------------------------------------------------------
\section{User Interface Setup Commands}
\index{user interface setup commands}

% spCommands.hlp:uicmds 102817

These commands perform setup and control of aspects of the user
interface, both graphical and non-graphical.

\begin{tabular}{|l|l|}\hline
\multicolumn{2}{|c|}{Uset Interface Setup Commands}\\ \hline
\cb mapkey & Create keyboard mapping\\ \hline
\cb setcase & Check/set case sensitivity for name classes\\ \hline
\cb setfont & Set graphical interface fonts\\ \hline
\cb setrdb & Set X resources\\ \hline
\cb tbupdate & Save tool window configuration\\ \hline
\cb wrupdate & Download/install program updates\\ \hline
\end{tabular}

%SU-------------------------------------
\subsection{\spcmd{mapkey}}
\index{mapkey command}

% spCommands.hlp:mapkey 011909

The {\cb mapkey} command provides limited keyboard mapping support.
\begin{quote}\vt
mapkey [ -r [{\it filename\/}] | -w [{\it filename\/}] |
 {\it keyname data} ]
\end{quote}
Only the keys that are used for command line editing are mappable. 
This is to account for ``strange'' terminals that may not send the
expected data when a key is pressed.

The following keys can be mapped:
\begin{quote}\kb
Ctrl-A\\
Ctrl-D\\
Ctrl-E\\
Ctrl-K\\
Ctrl-U\\
Ctrl-V\\
Tab\\
Backspace\\
Delete\\
LeftArrow\\
RightArrow\\
UpArrow\\
DownArrow
\end{quote}
Of these, the arrow keys and {\kb Delete} are most likely to need
remapping.

If no argument is given, the user is prompted to press each of these
keys, and the internal map is updated.  After doing this, the keys
should have their expected effect when pressed while entering a
{\WRspice} command.

If ``{\vt -w} [{\it filename\/}]'' is given, the present internal
map will be saved in the named file, or ``{\vt wrs\_keymap}'' in the
current directory if no {\it filename} is given.

If ``{\vt -r} [{\it filename\/}]'' is given, the file will be read
as a key mapping file, and the internal map will be updated.  The
{\it filename}, if not given, defaults to ``{\vt wrs\_keymap}''.  If
no path is given, it will be found in the current directory or the
startup directory.

If ``{\it keyname data...}'' is given, a single key in the internal
map can be updated.  The format is the same as the entries in the
mapping file, i.e., one of the names above, followed by one or more
hex bytes of data.  The bytes represent the stream sent when the named
key is pressed, and will henceforth be interpreted as the pressing of
that key.  The bytes should be in hex format, and the first byte of a
multi-byte sequence must be the {\kb Escape} character (1b).

Example (from real life):

After installing the latest X-window system, suppose one finds that,
when running {\WRspice} in an {\vt xterm} window, the {\kb Delete} key
no longer deletes the character under the cursor in {\WRspice}, but
instead injects some gibberish.  There are three ways to fix this. 
The first two are specific to the {\vt xterm} program, and instruct
the {\vt xterm} to send the ASCII Del character when {\kb Delete} is
pressed, rather than use the new default which is to send the VT-100
``delete character'' string.  The third method is to map this string
into the delete function in {\WRspice}.

\begin{enumerate}
\item{From the main {\vt xterm} menu, find and click on the ``{\cb
Delete is DEL}'' entry.  Usually, holding the {\kb Ctrl} key and
clicking in the {\vt xterm} with button 1 displays this menu.}

\item{Create a file named ``{\vt XTerm}'' in your home directory,
containing the line
\begin{quote}
{\vt *deleteIsDEL: true}
\end{quote}}

\item{In {\WRspice}, type ``{\vt mapkey}'' and follow the prompts. 
You can save the new map, and add a line to a {\vt .wrspiceinit}
startup file to read it when {\WRspice} starts.}
\end{enumerate}


%SU-------------------------------------
\subsection{\spcmd{setcase}}
\index{setcase command}

% spCommands.hlp:setcase 091511

Syntax: {\vt setcase} [{\it flags\/}]

This command sets or reports the case sensitivity of various name
classes in {\WRspice}.  These classes are:

\begin{quote}
Function names.\\
User-defined function names.\\
Vector names.\\
.PARAM names.\\
Codeblock names.\\
Node and device names.\\
\end{quote}

The {\it flags} is a word consisting of letters, each letter
corresponds to a class from the list above.  If lower-case, the class
will be case-sensitive.  If upper-case, the class will be
case-insensitive.

The letters are {\vt f}, {\vt u}, {\vt v}, {\vt p}, {\vt c}, and {\vt
n} corresponding to the classes listed above.  By default, all
{\WRspice} identifiers are case-insensitive, which corresponds to the
string ``{\vt FUVPCN}''.  Letters can appear in any order, and
unrecognized characters are ignored.  Not all letters need be
included, only those seen will be used.

If given an argument string as described above, and called from a
startup file, the case sensitivities will be set.  This can {\bf not}
be done from the {\WRspice} prompt.  Case sensitivity can also be set
from the command line by using the {\vt -c} option.

If no argument, a report of the case sensitivity status is printed. 
This can be done from the {\WRspice} prompt.


%SU-------------------------------------
\subsection{\spcmd{setfont}}
\index{setfont command}

% spToolbar.hlp:setfont 030518

Syntax: {\vt setfont} {\it font\_num} {\it font\_specifier}

This command can be used to set the fonts employed in the graphical
interface.  Although this can be given at a prompt, it is intended to
be invoked in a startup script.

The first argument is an integer 1--6 (1--4 on Windows) which
designates the font category.  The index corresponds to the entries in
the drop-down menu of font categories found in the Font Selection
panel.

The rest of the line is a font description string.  This varies
between graphics types.

\begin{description}
\item{Unix/Linux}\\
For GTK1 releases, the name is the X Logical Font Descriptor name for
a font available on the user's system, or an alias.  For GTK2
releases, the name is a Pango font description name.  There is a very
modest attempt to interpret a specification of the wrong type.
  
\item{Windows}
The name is in one or the following formats:
 \begin{description}
 \item{New standard ({\WRspice} release 2.3.58 and later)}\\
 {\it face\_name} {\it pixel\_height}
 \begin{quote}
 Example: {\vt Lucida Console 12}
 \end{quote}

 \item{Old standard (deprecated)}\\
 ({\it pixel\_height\/}){\it face\_name}
 \begin{quote}
 Example: {\vt (12)Lucida Console}
 \end{quote}
 \end{description}

 The {\it face\_name} is the name of a font family installed on the
 system, and the {\it pixel\_height} is the on-screen size.
\end{description}

You will probably never need to use the {\cb setfont} command
directly.  All settable fonts are saved in the {\vt .wrspiceinit}
startup file when the {\cb Update Tools} menu command in the {\cb
File} menu is given, or the {\cb tbupdate} command is invoked.

%SU-------------------------------------
\subsection{\spcmd{setrdb}}
\index{setrdb command}

% spCommands.hlp:setrdb 012209

The {\cb setrdb} command adds resources to the X resource database.
\begin{quote}\vt
setrdb {\it resource\/}: {\it value}
\end{quote}
The user interface toolset currently used to implement the {\WRspice}
user interface is the GTK toolkit ({\vt www.gtk.org}) which does not
use the X resource mechanism.

{\WRspice} presently only recognizes resource strings which set the
plotting colors for the {\cb plot} command.  The names of these
resources are ``{\vt color0}'' through ``{\vt color19}'', which
correspond directly to the shell variables of the same name, and to
the colors listed in the {\cb Colors} tool of the {\cb Tools} menu of
the {\cb Tool Control} window.  To set a color using the {\cb setrdb}
command, one can use forms like
\begin{quote}
``{\vt setrdb *color2:  pink}''
\end{quote}

%SU-------------------------------------
\subsection{\spcmd{tbupdate}}
\index{tbupdate command}

% spToolbar.hlp:tbupdate 042118

This command will update the user's {\vt .wrspiceinit} file in the
home directory to reflect the current tool setup.
\begin{quote}\vt
tbupdate
\end{quote}
The window arrangement should be the same the next time the user
starts {\WRspice}.  This command is also performed when the user
presses the {\cb Update Tools} button in the {\cb File} menu of the
{\cb Tool Control} window.

%SU-------------------------------------
\subsection{\spcmd{wrupdate}}
\index{wrupdate command}

% spCommands.hlp:wrupdate 042118

This command can be used to check for, download, and install updates
to the program.
\begin{quote}
{\vt wrupdate}
\end{quote}
This command is equivalent to giving the special keyword ``{\vt
:xt\_pkgs}'' to the help system, which brings up the {\XicTools}
package management page (see \ref{update}).  The page lists installed
and available packages for each of the {\XicTools} programs for the
current operating system, and provides buttons to download and install
the packages.

Unlike in earlier {\WRspice} releases, there is no provision for
automatic checking for updates, so this command or equivalent should
be run periodically to check for updated packages.  The computer must
have http access to the internet for successful use of this
functionality.


%S-----------------------------------------------------------------------------
\section{Shell Commands}
\index{shell commands}

% spCommands.hlp:shellcmds 012709

The commands listed below are built into the {\WRspice} shell, or
control shell operation. 
    
\begin{tabular}{|l|l|}\hline
\multicolumn{2}{|c|}{Shell Commands}\\ \hline
\cb alias & Create alias\\ \hline
\cb cd & Change directory\\ \hline
\cb echo & Print string\\ \hline
\cb echof & Print string to file\\ \hline
\cb history & Print command history\\ \hline
\cb pause & Pause script execution\\ \hline
\cb pwd & Print the current working dirsctory\\ \hline
\cb rehash & Update command database\\ \hline
\cb set & Set a variable\\ \hline
\cb shell & Execute operating system commands\\ \hline
\cb shift & Shift argument list\\ \hline
\cb unalias & Destroy alias\\ \hline
\cb unset & Unset a variable\\ \hline
\cb usrset & Print list of internally used variables\\ \hline
\end{tabular}

%SU-------------------------------------
\subsection{\spcmd{alias}}
\index{alias command}

% spCommands.hlp:alias 011909

The {\cb alias} command is used to create aliases, as in the C-shell.
\begin{quote}\vt
alias [{\it word\/}] [{\it text\/}]
\end{quote}
The {\cb alias} command causes {\it word\/} to be aliased to {\it
text}.  Whenever a command line beginning with {\it word} is typed,
{\it text} is substituted.  Arguments are either appended to the end,
or substituted in if history characters are present in the text.  With
no argument, a list of the current aliases is displayed.

In the body of the alias text, any strings of the form {\vt !:}{\it
number} are replaced with the {\it number\/}'th argument of the actual
command line.  Note that when the alias is defined with the {\cb
alias} command, these strings must be quoted to prevent history
substitution from replacing the {\vt !}'s before the alias command can
get to them.  Thus the command
\begin{quote}\vt
alias foo echo '!:2' '!:1'
\end{quote}
causes ``{\vt foo bar baz"}'' to be replaced with ``{\vt echo baz
bar}''.  Other {\vt !} modifiers as described in the section on
history substitution may also be used, always referring to the actual
command line arguments given.  If a command line starts with a
backslash `{\vt \symbol{92}}' any alias substitution is inhibited.

%SU-------------------------------------
\subsection{\spcmd{cd}}
\index{cd command}

% spCommands.hlp:cd 011909

The {\cb cd} command is used to change the current working directory.
\begin{quote}\vt
cd [{\it directory\/}]
\end{quote}
The command will change the current working directory to {\it
directory\/}, or to the user's home directory if none is given.

%SU-------------------------------------
\subsection{\spcmd{echo}}
\index{echo command}

% spCommands.hlp:echo 011909

The {\cb echo} command will print its arguments on the standard output.
\begin{quote}\vt
echo [-n][{\it stuff} ...]
\end{quote}
If the {\vt -n} option is given, then the arguments are echoed without
a trailing newline.

%SU-------------------------------------
\subsection{\spcmd{echof}}
\index{echof command}

% spCommands.hlp:echof 012709

This command is only available from the control scripts which are
active during Monte Carlo or operating range analysis. 

The {\cb echof} command is used in the same manner as the {\cb echo}
command, however the text is directed to the output file being
generated as the analysis is run.  If the file is not open, there is
no action.  This command can be used in the scripts to insert text,
such as the Monte Carlo trial values, into the output file.

%SU-------------------------------------
\subsection{\spcmd{history}}
\index{history command}

% spCommands.hlp:historycomm 011909

The {\cb history} command prints the last commands executed.
\begin{quote}\vt
history [-r] [{\it number\/}]
\end{quote}
The command will print out the last {\it number} commands typed by the
user, or all the commands saved if {\it number} is not given.  The
number of commands saved is determined by the value of the {\et
history} variable.  If the {\vt -r} flag is given, the list is printed
in reverse order.

%SU-------------------------------------
\subsection{\spcmd{pause}}
\index{pause command}

% spCommands.hlp:pause 011909

The {\cb pause} command is used in scripts to cause the executing
script to wait for a keypress.  The function takes no arguments, and
the keypress is discarded.

%SU-------------------------------------
\subsection{\spcmd{pwd}}
\index{pwd command}

% spCommands.hlp:pwd 091714

Print the current working directory.

%SU-------------------------------------
\subsection{\spcmd{rehash}}
\index{rehash command}

% spCommands.hlp:rehash 011909

The {\cb rehash} command rebuilds the command list from the files
found along the user's executable file search path.  The command
will recalculate the internal hash tables used when looking up
operating system commands, and make all operating system commands in
the user's {\et PATH} available for command completion.  This
command takes no arguments, and has effect only when the {\et
unixcom} variable is set.

%SU-------------------------------------
\subsection{\spcmd{set}}
\index{set command}
\label{setcmd}

% spCommands.hlp:set 041611

The {\cb set} command allows the user to examine and set shell
variables.  It is also possible to assign vectors with the {\cb set}
command.
\begin{quote}\vt
set [{\it varname} [= {\it value}] ...]
\end{quote}
In addition, shell variables are set which correspond to definitions
supplied on the {\vt .options} line of the current circuit, and there
are additional shell variables which are set automatically in accord
with the current plot.  The shell variables that are currently active
can be listed with the {\cb set} command given without arguments, and
are also listed within the {\cb Variables} window brought up from the
{\cb Tools} menu of the {\cb Tool Control} window.  In these listings,
a `{\vt +}' symbol is prepended to variables defined from a {\vt
.options} line in the current circuit, and a `{\vt *}' symbol is
prepended to those variables defined for the current plot.  These
variable definitions will change as the current circuit and current
plot change.  Some variables are read-only and may not be changed by
the user, though this is not indicated in the listing.

Before a simulation starts, the options from the {\vt .options} line
of the current circuit are merged with any of the same name that have
been set using the shell.  The result of the merge is that options
that are booleans will be set if set in either case, and those that
take values will assume the value set through the shell if conflicting
definitions are given.  The merge will be suppressed if the shell
variable {\et noshellopts} is set {\it from the shell}, in which case
the only options used will be those from the {\vt .options} line, and
those that are redefined using the {\cb set} command will be ignored.

Above, the {\it varname} is the name of the shell variable to set, and
{\it value}, if present, is a single token to be assigned. 
Multiple variables can be assigned with a single {\cb set} command. 
If {\it value} is missing (along with the `{\vt =}'), then {\it
varname} is of boolean type and always taken as ``true'' when set. 
If {\it value} is a pure number not double quoted, then {\it
varname} will reference that number.  Otherwise, {\it varname} will
reference {\it value} as a character string, unless {\it value} is
a list.  A list is a space-separated list of tokens in space-separated
parentheses, as in
\begin{quote}\vt
set mylist = ( abc def 1.2 xxdone )
\end{quote}
which sets the variable {\vt mylist} to the list of four tokens.  The
{\cb unset} command can be used to delete a variable.

The value of a variable {\it word\/} may be inserted into a command by
writing {\vt \${\it word}}.  If a variable is set to a list of values
that are enclosed in parentheses (which must be separated from their
values by white space), the value of the variable is the list.

The set command can also be used to assign values to vectors (vectors
are described in \ref{vectors}).  The syntax in this case is
 
\begin{quote}
{\vt set \&}{\it vector} {\vt =} {\it value}
\end{quote}
 
which is equivalent to
 
\begin{quote}
{\vt let} {\it vector} {\vt =} {\it value}
\end{quote}
 
When entering this form from the {\WRspice} command line, the `{\vt
\&}' character must be hidden from the shell, perhaps most
conveniently be preceding it with a backslash.  The {\it value} must
be numeric, and a value must be given, unlike for a variable which can
be set as a boolean.

There are a number of variables with internal meaning to {\WRspice},
and in fact this is the mechanism by which most {\WRspice} defaults
are specified.  Several of the other buttons in the {\cb Tools} menu,
including {\cb Commands}, {\cb Debug}, {\cb Plot Opts}, {\cb Shell},
and {\cb Sim Opts} bring up panels from which these special variables
can be modified.

The predefined variables which have meaning to {\WRspice} (see
\ref{variables}) can be listed with the {\cb usrset} command.  In
general, variables set in the {\vt .options} line are available for
expansion in {\vt \$}{\it varname} references, but do not otherwise
affect the functionality of the shell.

%SU-------------------------------------
\subsection{\spcmd{shell}}
\index{shell comand}

% spCommands.hlp:shell 011909

The {\cb shell} command will pass its arguments to the operating system
shell.
\begin{quote}\vt
shell [{\it command\/}]
\end{quote}
The command will fork a shell if no {\it command\/} is given, or
execute the arguments as a command to the operating system.

%SU-------------------------------------
\subsection{\spcmd{shift}}
\index{shift command}

% spCommands.hlp:shift 011909

The {\cb shift} command facilitates handling of list variables in
shell scripts.
\begin{quote}\vt
shift [{\it varname\/}] [{\it number\/}]
\end{quote}
If {\it varname} is the name of a list variable, it is shifted to
the left by {\it number} elements, i.e., the {\it number} leftmost
elements are removed. The default {\it varname} is {\vt argv}, and
the default {\it number} is 1.

%SU-------------------------------------
\subsection{\spcmd{unalias}}
\index{unalias command}

% spCommands.hlp:unalias 011909

The {\cb unalias} command is used to remove aliases previously set with
the {\cb alias} command.
\begin{quote}\vt
unalias [{\it word} ...]
\end{quote}
The command removes any aliases associated with each of the {\it
word\/}s.  The argument may be ``{\vt *}'', in which case all aliases
are deleted.

%SU-------------------------------------
\subsection{\spcmd{unset}}
\index{unset command}

% spCommands.hlp:unset 011909

The {\cb unset} command will remove the definitions of shell
variables, previously defined with the {\cb set} command, passed as
arguments.
\begin{quote}\vt
unset [{\it varname} ...]
\end{quote}
All of the named variables are unset (undefined).  The argument may be
``{\vt *}'', in which case all variables are unset (although this is
usually not something that one would want to do).

%SU-------------------------------------
\subsection{\spcmd{usrset}}
\index{usrset command}

% spCommands.hlp:usrset 011909

The {\cb usrset} command prints a (long) list of all of the variables
used internally by {\WRspice} which can be set with the {\cb set}
command.
\begin{quote}\vt
usrset [-c][-d][-p][-sh][-si] [{\it keyword} ...]
\end{quote}
{\WRspice} provides a substantial number of internal switches and
variables which can be configured with the {\cb set} command.  The
{\cb usrset} command prints a listing and brief description of each of
the variables with internal significance to {\WRspice}.  If no
arguments are given, all of the variables which control {\WRspice}
will be printed.  The options print sets of keywords associated with
certain functions, which are in turn associated with a particular
panel accessible from the {\cb Tool Control} window.
\begin{quote}
\begin{tabular}{|l|l|l|}\hline
Option & Toolbar Button & Description\\ \hline\hline
\vt -c & \cb Commands & Variables which control {\WRspice} commands\\ \hline
\vt -d & \cb Debug & Debugging variables\\ \hline
\vt -p & \cb Plot Opts & Variables which control plotting\\ \hline
\vt -sh & \cb Shell & Variables which control the shell\\ \hline
\vt -si & \cb Sim Opts & Simulation control and SPICE options\\ \hline
\end{tabular}
\end{quote}
Other arguments are taken as variable names, which will result in
a description of that variable being printed.


%S-----------------------------------------------------------------------------
\section{Input and Output Commands}

% spCommands.hlp:iocmds 011721

These commands manage input to {\WRspice}, or allow {\WRspice}
output to be saved in files.

\begin{tabular}{|l|l|}\hline
\multicolumn{2}{|c|}{Input and Output Commands}\\ \hline
\cb codeblock & Manipulate codeblocks\\ \hline
\cb dumpnodes & Print node voltages and branch currents\\ \hline
\cb edit & Edit text file\\ \hline
\cb listing & List current circuit\\ \hline
\cb load & Read plot data from file\\ \hline
\cb print & Print vectors\\ \hline
\cb printf & Print vectors to logging file\\ \hline
\cb return & Return from script immediately, possibly with a value\\ \hline
\cb sced & Bring up {\Xic} schematic editor\\ \hline
\cb source & Read circuit or script input file\\ \hline
\cb write & Write data to rawfile\\ \hline
\cb xeditor & Edit text file\\ \hline
\end{tabular}

%SU-------------------------------------
\subsection{\spcmd{codeblock}}
\index{codeblock command}
\label{codeblock}

% spCommands.hlp:codeblock 032320

The {\cb codeblock} command manipulates codeblocks.
\begin{quote}\vt
codeblock [{\it -options\/}] [{\it filename\/}]
\end{quote}
A codeblock is a stored executable structure derived from a script
file.  Being internal representations, codeblocks execute more
efficiently than script files.  A codeblock generally has the same
name as the script file from which it was derived.

Option characters, which may be grouped or given as separate tokens,
following a '--' character, are listed below.
\begin{quote}
\begin{tabular}{|l|l|}\hline
{\vt p} & print the text of a block (synonym {\vt t})\\ \hline
{\vt d} & delete the block (synonym {\vt f})\\ \hline
{\vt a} & add a block\\ \hline
{\vt b} & bind the block to the ``controls'' of the current circuit\\ \hline
{\vt be} & bind the block to the ``execs'' of the current circuit\\ \hline
{\vt c} & list bound codeblocks of the current circuit\\ \hline
\end{tabular}
\end{quote}

If no {\it filename} is given, and neither of the bind options is
given, all of the blocks in the internal list are listed by name, and
their commands are printed if {\vt p} is given, and the blocks are
deleted if {\vt d} is given.  In the latter case, the current circuit
codeblock references become empty.

If no {\it filename} is given and one of the bind options is given,
the respective bound codeblock reference in the current circuit is
removed.  Only one of {\vt b} or {\vt be} can be given.

In either case, if {\vt c} is given, the bound codeblocks in the
current circuit are listed, after other operations.  The {\vt a}
option is ignored if no {\it filename} is given.

The bound codeblocks for the current circuit are also listed in the
{\cb listing} command.

Otherwise, when a name is given, the named file/block is acted on.
If no option is given, the add option is assumed.  Added blocks
overwrite existing blocks of the same name.  The options all apply
if given, and the operations are performed in the order
\begin{quote}
{\vt p} (if {\vt a} not given)\\
{\vt d}\\
{\vt a}\\
{\vt p} (if {\vt a} given)\\
{\vt b} or {\vt be}\\
{\vt c}
\end{quote}

When a command is entered in response to a prompt or in a script (or
another codeblock), the blocks are checked first, then the {\WRspice}
internal commands, then scripts, then vectors (for the implicit {\cb
let} in {\it vector} = {\it something\/}) and finally operating system
commands if {\et unixcom} is set.

Thus, once a codeblock has been added, it can be executed by simply
entering its name, as if it were a shell command.  If a name conflicts
with an internal command or script, the codeblock has precedence.

A codeblock can be ``bound'' to the current circuit with the {\vt b}
and {\vt be} options.  If {\vt be}, the block is bound as an ``exec''
codeblock, and if {\vt b} is given, the block is bound as a
``control'' codeblock.  Each circuit has one of each type, which are
by default derived from the {\vt .exec} and {\vt .control} statements
from the circuit file.  Binding an external codeblock overrides the
blocks obtained from the file.  If no {\it filename} was given, the
existing binding is deleted from the current circuit, according to
whether the {\vt b} or {\vt be} was given.  Separate calls are
required to unbind both blocks.

Note:  Bound codeblocks are parameter expanded, named codeblocks
are not.  In a named codeblock, parameters are available through
the {\vt @}{\it parmname} (special vector) syntax.

Operating range and Monte Carlo analysis can make use of ``bound''
codeblocks.  In both types of analysis, the ``controls'' codeblock
execution sets a variable indicating whether the circuit simulated
properly according to user specified criteria.  When a margin analysis
file is input, the lines between {\vt .control} and {\vt .endc} become
the default controls codeblock.  Similarly, the lines between {\vt
.exec} and {\vt .endc} become the default exec codeblock.  A bound
codeblock will always supersede the default codeblock.

%SU-------------------------------------
\subsection{\spcmd{dumpnodes}}
\index{dumpnodes command}

% spCommands.hlp:dumpnodes 092611

\begin{quote}\vt
dumpnodes
\end{quote}

This command prints, on the standard output, a table of the most
recently computed node voltages (and branch currents) for the current
circuit.

%SU-------------------------------------
\subsection{\spcmd{edit}}
\index{edit command}

% spCommands.hlp:edit 093015

The {\cb edit} command allows the text of an input file to be edited.
\begin{quote}\vt
edit [-n][-r] [{\it filename\/}]
\end{quote}
The command will bring up a text editor loaded with the named file. 
If no file name is given, the file associated with the current circuit
will be edited.  If no file is associated with the current circuit,
the current circuit will be printed into a temporary file which is
opened for editing.  If no circuits are present, an empty file is
opened for editing.  Pressing the {\cb Text Editor} button in the {\cb
Edit} menu of the {\cb Tool Control} window is equivalent to giving
the {\cb edit} command without arguments.

It should be noted that one can also provide input to {\WRspice}> from
an arbitrary text editor by ``saving'' the file to the active fifo
file (see \ref{fifo}) that {\WRspice} creates in the user's home
directory.  This is a special file the contains a port into
{\WRspice}, whereby data written to the fifo appear in {\WRspice} as
if sourced from a regular file (if {\WRspice} is busy, the fifo write
will block until {\WRspice} is ready).

The editor used is named by the {\et editor} variable, the {\et
SPICE\_EDITOR} environment variable, or the {\et EDITOR} environment
variable, in that order.  If none of these is set, or the first one
found is set to ``{\vt xeditor}'', the internal editor is used, if
graphics is available.  If graphics is not available and no editor is
specified, {\WRspice} will attempt to use the ``{\vt vi}'' editor. 
The internal editor has the advantage of asynchronous deck sources
with the edit window displayed at all times, through the {\cb Source}
button in the editor's {\cb Options} menu.  The {\cb xeditor} command
is similar to the {\cb edit} command, but will always call the
internal editor.  See \ref{xeditor} for a description of the internal
editor.

If an external editor is used, if graphics is available the default
action is to start the editor in a new {\vt xterm} window.  This can
be suppressed if the {\et noeditwin} variable is set.  This variable
should be set if the external editor creates its own window to avoid
the unneeded {\vt xterm}.  It can also be set for an editor such as
{\vt vi}, in which case the editing will take place in the same window
used to interact with {\WRspice}.

The {\vt -r} and {\vt -n} options are available only when the internal
editor is {\it not} being used, and the editor is a text-mode editor
such as {\vt vi} and {\et noeditwin} is set so that editing takes
place in the console controlling {\WRspice}.  If this is the case,
after quitting the editor, the file will be sourced automatically if
the text was saved.  The {\vt -n} (no source) option prevents this,
and should be given if the editor is used to browse files that are not
SPICE input files.  The {\vt -r} (reuse) option will reuse the
existing circuit for the automatic source, rather than creating a new
one.  This saves memory, but prevents revisiting earlier revisions of
the circuit.  If the internal editor, or any editor that creates its
own window is used, {\WRspice} will pop up the editor and resume
command prompting.  There is no automatic source in this case.

%SU-------------------------------------
\subsection{\spcmd{listing}}
\index{listing command}

% spCommands.hlp:listing 022514

The {\cb listing} command is used to generate a listing of the current
circuit.
\begin{quote}\vt
listing [l[ogical]] [p[hysical]] [d[eck]] [e[xpand]] [n[ocontinue]]
\end{quote}
The command will print a listing of the current circuit to the
standard output.  The arguments control the format of the listing.  A
{\vt logical} listing is one in which comments are removed and
continuation lines are appended to the end of the continued line.  A
{\vt physical} listing is one in which comments and continuation lines
are preserved.  A {\vt deck} listing is a {\vt physical} listing
without line numbers, so as to be acceptable to the circuit parser ---
it recreates the input file verbatim.  The last option, {\vt expand},
is orthogonal to the previous three --- it requests that the circuit
be printed after subcircuit expansion.  Note that only in an expanded
listing are error messages associated with particular lines visible. 
When using {\vt deck} and {\vt expand}, by default long lines are
broken into continuation lines.  If the {\vt nocontinue} option is
also given, this will not be done.  This option is ignored in other
cases.

If no argument is given, {\vt logical} is understood.

%SU-------------------------------------
\subsection{\spcmd{load}}
\index{load command}

% spCommands.hlp:load 060214

The {\cb load} command loads data from the files given.
\begin{quote}\vt
load [{\it filename\/}] [{\vt -p} {\it printfile\/}]
 [{\vt -c}{\it N\/}[{\vt +}[{\it M\/}]] [{\it datafile\/}] [...]
\end{quote}

Several file formats are supported, as is discussed below.

The file data will be converted into internal plot structures
containing vectors available for printing, plotting, and other
manipulation just as if the analysis had been run.  The last plot read
becomes the current plot.  Data files can also be loaded from the {\cb
Load} button in the {\cb Files} menu of the {\cb Tool Control} window. 
A file name given without a path prefix is searched for in the source
path.

The {\cb load} command is internet aware, i.e., if a given filename
has an {\vt http://} or {\vt ftp://} prefix, the file will be
downloaded from the internet and loaded.  The file is transferred as a
temporary file, so if a permanent local copy is desired, the {\cb
write} command should be used to save a file to disk.

ASCII and binary rawfiles, and Common Simulation Data Format (CSDF)
files can be listed without options.  These formats are auto-detected
and the file data will be processed appropriately.  The rawfile format
is the native format used in {\WRspice} and Berkeley SPICE3.  CSDF is
one of the formats used by HSPICE, and post-processing tools such as
Synopsys WaveView.

In HSPICE, ``{\vt .options csdf=1}'' and ``{\vt .options post=csdf}''
will produce CSDF files.  These files can be loaded into {\WRspice}
for display and other purposes with the {\cb load} command.

In {\WRspice} rawfiles or CSDF files can be produced by the {\cb Save
Plot} button in {\cb plot} windows, the {\cb write} and {\cb run}
commands, and may be generated in batch mode.

If no argument is given, {\WRspice} will attempt to load a file with a
default name.  The default name is the value of the {\et rawfile}
variable if set, or the argument to the {\vt -r} command line option
if one was given, or ``{\vt rawspice.raw}''.

If the option flag {\vt -p} appears before a file name, the file that
follows is assumed to be a file produced with the {\WRspice} {\cb
print} command.  This works for the default columnar print format
only.  The format is common to other SPICE programs.  This can be
useful on occasion, but the print format lacks to expressiveness of
the plot data file formats.

The {\vt -c} option will allow parsing of general columnar numerical
data, and is useful for extracting data from output from other
programs, or report text files.  The option has several forms.

\begin{description}
\item{\vt -c}{\it N}\\
{\it N} is an integer greater than 0, representing the number of
numerical columns.  A plot with {\it N} vectors will be created,
with names ``{\vt column\_0}'', ``{\vt column\_1}'', etc.  The
{\vt column\_0} vector will be taken as the scale vector.  The file is
read, amd all lines that start with {\it N} space or comma-separated
numbers will contribute to the vectors.  Any additional text on the
line following the numbers is ignored.  Lines that don't provide
{\it N} numbers are also ignored.

\item{\vt -c}{\it N\/}{\vt +}\\
As above, but lines must provide exactly {\it N} numbers or will
be ignored.  Parsing of a line stops if a token is read that is
not a number, so that any numbers following a non-number in the
line will always be ignored.

\item{-c}{\it N\/}{\vt +}{\it M}\\
This assumes that there are {\it N} columns of numbers in a logical
block, followed by a logical block containing {\it M} columns of
numbers.  We assume that there are {\it N} + {\it M} vectors, and the
lines have been broken to avoid being too long, as is done in the
SPICE printing if the number of columns to be printed would exceed the
page width.  However, it is required that {\it M} be less than {\it
N}, and only one ``wrap'' can be accommodated.  If for some reason the
{\it M} vectors end up being a different length than the {\it N}
vectors, they will be truncated or zero-padded so that all vectors
will have the same length.
\end{description}

When reading columnar or print data, the scale vector is checked for
cyclicity, and the plot dimensions will be set if found.  Only
two-dimensional vectors are produced, higher dimensions can not be
determined.

%SU-------------------------------------
\subsection{\spcmd{print}}
\index{print command}
\label{print}

% spCommands.hlp:print 092816

The {\cb print} command is used to print vector data on-screen or
to a file using output redirection.
\begin{quote}\vt
print [/{\it format\/}] [col | line] {\it expr\/} [...]
\end{quote}
The command prints the values of the given expressions to the standard
output.

The default is to use exponential format for all values, with the
number of digits given by the {\et numdgt} variable.  However this,
and some other presentation attributes, can be specified in the format
string, if given.  If given, the format string must be the first
argument, and the string must start with a '/' (forward slash)
character.  The syntax is further described below.

All vectors listed will be printed in the same format, except for the
scale vector, which is printed by default in the {\vt col} mode, which
is printed with the default notation.

If {\vt line} is specified, the value of each expression is printed on
one line (or more if needed).  If all expressions have a length of 1,
the default style is {\vt line}, otherwise {\vt col} is the default.

If {\vt col} is specified, the values are printed in columns.  This is
the default if any of the vectors are multi-valued.  This mode makes
use of the {\vt height} and {\vt width} variables to define the page
size.  By default, per-page formatting is applied, with page eject
characters between pages.  With column formatting, by default the
scale vector ({\et time}, {\et frequency}) will be shown in the first
column.  If there are more vectors that can be accommodated with the
page width, the print will be repeated, with a new set of columns
(other than the scale) until all variables have been printed.

If the expression is ``{\vt all}'', all of the vectors in the current
plot are printed.  If no arguments are given, the arguments to the
last given {\cb print} command are used.  If only the format argument
is given, the arguments from the last given {\cb print} command other
than the format are used, with the new format.

If the argument list contains a token consisting of a single period
(``.''), this is replaced with the vector list found in the first {\vt
.print} line from the input file with the same analysis type as the
current plot.  For example, if the input file contains
\begin{quote}\vt
    .tran .1u 10u\\
    .print tran v(1) v(2)\\
\end{quote}
then one can type ``{\vt run}'' followed by ``{\vt print .}'' to print
{\vt v(1)} and {\vt v(2)}.

The related syntax {\vt .@}{\it N} is also recognized, where {\it N}
is an integer representing the {\it N\/}'th matching {\vt .print} line. 
The count is 1-based, but {\it N\/}=0 is equivalent to {\it N\/}=1. 
The token is effectively replaced by the vector list from the
specified {\vt .print} line found in the circuit deck.

The print command is responsive to the following variables.

\begin{description}
\item{{\et width}, {\et height}}\\
These option variables set the page size (in characters and lines)
assumed for the output when directed to a flie or device.  If not set,
a standard A-size page is assumed.  When printing on-screen, the
actual screen or window size will be used.

\item{\et nopage}\\
This boolean option will suppress page breaks between pages when set. 
This is always true when printing to a screen.  Page breaks consist of
a form-feed character, which may be followed by a two-line page
header.
\end{description}

The following variables are all booleans, and apply only to column
mode of the {\cb print} command.

\begin{description}
\item{\et printautowidth}\\
When set, the window width or the setting of the {\et width} variable
is ignored, and a line width sufficient to include columns for all
variables being printed is used, if possible.  There is a hard limit
of 2048 characters in the lines.  Variables that don't fit are printed
subsequently, as in the case with {\et printautowidth} not set.

\item{\et printnoheader}\\
When set, don't print the top header, which consists of the plot
title, circuit name, data, and a line of ``{\vt -}'' characters (three
lines).  This is normally printed at the top of the first page of
output.

\item{\et printnoindex}\\
When set, don't print the vector indices, which are otherwise printed
in the leftmost column of each page.

\item{\et printnopageheader}\\
When set, don't print the page header.  The page header, which
consists of the variable names at the top of each column and a line of
``{\vt -}'' characters, is otherwise printed at the top of each page
of output.

\item{\et printnoscale}\\
When set, don't print the scale vector in the leftmost data column. 
This is otherwise done for each set of variables printed.  The Spice3
{\et noprintscale} variable is an alias, but deprecated.
\end{description}

The syntax of the format string to the {\cb print} command allows
overriding the states of the switches listed above while printing. 
The format string, if used, must be the first argument given to the
{\cb print} command, and must begin with a `{\vt /}' (forward slash)
character.  It contains no space, and is a sequence of the characters
and forms shown below, all of which are optional.

\begin{description}
\item{\it integer}\\
The {\it integer} is the number of figures to the right of the decimal
point to print.  If not given, the value of the {\et numdgt} variable
is used if set, otherwise a default of 6 is used.

\item{\vt f}\\
If `{\vt f}' is found in the string, data values will be printed using
a fixed-point format, rather than the default exponential format.
\end{description}

The remaining options apply/unapply the switches, whose defaults are
set by the {\et print...} variables described above.  The format
string always overrides the variables.

\begin{description}
\item{\vt -}\\
Negate the effect of options that follow.
\item{\vt +}\\
Don't negate effect of options that follow.  This is redundant
unless it follows `{\vt -}'.
\item{\vt a}\\
Take {\et printautowidth} as if set, or not set if negated.
\item{\vt b}\\
Take {\et nopage} as if set, or not set if negated.
\item{\vt h}\\
Take {\et printnoheader} as if set, or not set if negated.
\item{\vt i}\\
Take {\et printnoindex} as if set, or not set if negated.
\item{\vt p}\\
Take {\et printnopageheader} as if set, or not set if negated.
\item{\vt s}\\
Take {\et printnoscale} as if set, or not set if negated.
\item{\vt n}\\
Alias for ``{\vt abhips}''.
\end{description}

Examples
\begin{quote}\vt
print /3f+ahi-ps ...
\end{quote}
Print using a fixed three decimal place format, and as if {\et
printautowidth}, {\et printnoheader}, and {\et printnoindex} were set,
and {\et printnopageheader} and {\et printnoscale} were unset.
\begin{quote}\vt
print /n ...
\end{quote}
Print the vectors listed, and nothing but the vectors listed.  This is
useful when one wants to feed a simple list of numbers to another
application.
\begin{quote}\vt
print /n-s ...
\end{quote}
As above, but print the scale in the first column.  The `{\vt -}' can
be used as shown to undo individual implicit settings from `{\vt n}'.
\begin{quote}\vt
print /3f v(5)
\end{quote}
This prints v(5) to three decimal places in fixed-point notation.
\begin{quote}\vt
print /4f v(2) v(3) v(4) > myfile
\end{quote}
This prints the vectors to four decimal places in the file "myfile".
\begin{quote}\vt
print 2*v(2)+v(3) v(4)-v(1)
\end{quote}
This prints the computed quantities using the default format.

%SU-------------------------------------
\subsection{\spcmd{printf}}
\index{printf command}

% spCommands.hlp:printf 011721

The {\cb printf} command is equivalent to the {\cb print} command,
however output goes to the logging file for use in operating range and
Monte Carlo analysis.
\begin{quote}\vt
print [/{\it format\/}] [col | line] {\it expr\/} [...]
\end{quote}
This is used in codeblocks evaluated while those processes are active.

%SU-------------------------------------
\subsection{\spcmd{return}}
\index{return command}

% spCommands.hlp:return 030519

This will cause the currently executing script or codeblock to
terminate immediately and return to the caller.
\begin{quote}\vt
return [{\it expression\/}]
\end{quote}
If an expression follows, it will be evaluated and the global return
value will be set to the result.  The global return value is an
internal global variable that can be set and queried from any script
or the comand prompt as the special variable name {\vt \$?}.  The {\cb
retval} command is used to set the global return value without
immediately returning.


%SU-------------------------------------
\subsection{\spcmd{sced}}
\index{sced command}

% spCommands.hlp:sced 012109

The {\cb sced} command brings up the {\Xic} graphical editor (if
available) in electrical mode.
\begin{quote}\vt
sced [{\it filename} ...]
\end{quote}
This allows schematic capture, with most of the {\WRspice}
functionality directly available through the {\Xic} interface.  If the
{\Xic} graphical editor is not available for execution, this command
will exit with a message indicating that {\Xic} is not available. 
Otherwise, the {\cb sced} command will bring up the schematic capture
front-end with file {\it filename\/}, which must be an {\Xic} input
file ({\it not} a standard {\WRspice} circuit file!).  If the current
circuit originated from {\Xic}, that file will be loaded into {\Xic}
if no {\it filename} is given. 

When {\it Xic} saves a native-mode top-level cell containing a
schematic, the circuit SPICE listing is appended to the file. 
{\WRspice} is smart enough to ignore the geometric information in
these files and read only the circuit listing.

{\Xic} can also be started from the {\cb Xic} button in the {\cb Edit}
menu of the {\cb Tool Control} window.

%SU-------------------------------------
\subsection{\spcmd{source}}
\index{source command}

% spCommands.hlp:source 051516

The {\cb source} command is used to load circuit files and command
scripts.
\begin{quote}\vt
source [{\vt -r}] [{\vt -n}] [{\vt -c}] {\it file} [{\it file} ...]
\end{quote}
If more than one file name is given, the files will be concatenated
into a temporary file, which is read.  The command will read and
process circuit descriptions and command text from the file(s).  If
{\vt .newjob} lines are found within the files, the input will be
partitioned into two or more circuit decks, divided by the {\vt
.newjob} lines.  Each circuit deck is processed independently and in
sequence.

If a file does not have a path prefix, it is searched for in the
search path specified by the {\et sourcepath} variable.  If not in the
search path or current directory, a full path name must be given.

The {\cb source} command is internet aware, i.e., if a given filename
has an ``{\vt http://}'' or ``{\vt ftp://}'' prefix, the file will be
downloaded from the internet and sourced.  The file is transferred as
a temporary file, so if a permanent local copy is desired, the {\cb
edit} or {\cb listing} commands should be used to save the circuit
description to disk. 

When an input file or set of files is ``sourced'', the following steps
are performed for each circuit deck found.  The logic is rather
complex, and the following steps illustrate but perhaps oversimplify
the process.  In particular, the subcircuit/model cache substitution
is omitted here.

\begin{enumerate}
\item{The input is read into a ``deck'' in memory.  Line continuation
is applied.}

\item{In interactive mode, the title line from the circuit is printed
on-screen, unless the {\et noprtitle} variable is set, in which case
this printing is suppressed.  The variable can be set by checking the
box in the {\cb source} page of the {\cb Command Options} tool from
the {\cb Tools} menu.}

\item{The deck is scanned for {\vt .param} lines which are outside of
subcircuit definitions.  These are shell expanded, and used to
evaluate {\vt .if}, {\vt .elif} and similar lines.  Lines that are not
in scope are ignored.}

\item{Files referenced from {\vt .include} and {\vt .lib} lines are
resolved and read.  At each level, parameters are scanned again, so
that {\vt .if}, etc.  lines do the right thing at each level.}

\item{Verilog blocks, {\vt .exec} blocks, and {\vt .control} blocks
are moved out of the main deck into separate storage.}

\item{The {\vt .exec} lines, if any, are executed by the shell.}

\item{The {\vt .options} lines are extracted, shell expanded, and
evaluated.  During evaluation, the shell receives the assignment
definitions.}

\item{The remaining lines in the deck are shell expanded.}

\item{Subcircuit expansion is performed.  This takes care of parameter
expansion within subcircuit definition blocks.}

\item{The circuit (if any) is parsed, and added to the internal
circuits list.}

\item{The {\vt .control} lines, if any, and executed by the shell.}
\end{enumerate}

After a {\cb source}, the current circuit will be the last circuit
parsed.

There are three option flags available, which modify the behavior
outlined above.  These can be grouped or given as individual tokens,
following a `--' character.  Note that if a file name starts with
`--', it must be quoted with double-quote marks.  The options are
applied before files are read.

\begin{description}
\item{\vt r}\\
Reuse the current circuit.  The current circuit is destroyed before
the new circuit is created, which becomes the current circuit.  This
option is ignored if {\vt -n} is also given.

\item{\vt n}\\
Ignore any circuit definition lines in input.  Executable lines will
still be executed, but no new circuit will be produced.

\item{\vt c}\\
Ignore any {\vt .control} commands.  However, {\vt .exec} lines will
still be executed.

\item{{\vt n} and {\vt c}}\\
If both of the {\vt n} and {\vt c} options are given, all lines of
input except for the first ``title'' line are taken to be executable,
and are executed, as if for a startup file.
\end{description}

\subsubsection{Implicit Source}
\index{source, implicit}
\index{implicit source}

In many cases, the ``{\vt source}'' is optional.  If the name of an
existing file is given as a command, the {\cb source} is applied
implicitly, provided that the file name does not clash with a
{\WRspice} command.

\subsubsection{Input Format Notes}

The first line in the input file (after concatenation of multiple
input files), and the first line following a {\vt /newjob} line, is
considered a title line and is not parsed but kept as the name of the
circuit.  The exceptions to this rule are old format margin analysis
input files and {\Xic} files.

Command lines must be surrounded by the lines {\vt .exec} or {\vt
.control} and {\vt .endc} in the file, or prefixed by ``{\vt *@}'' or
``{\vt *\#}'' in order to be recognized as commands, except in startup
files where all lines but the title line are taken as executable. 
Commands found in {\vt .exec} blocks or {\vt *@} lines are executed
before the circuit is parsed, thus can set variables used in the
circuit.  Commands found in {\vt .control} blocks or {\vt *\#} lines
are executed after the circuit is parsed, so a control line of ``{\vt
ac ...}'' will work the same as the corresponding {\vt .ac} line, for
example.  Use of the ``comment'' control prefixes {\vt *@} and {\vt *\#}
makes it possible to embed commands in {\WRspice} input files
that will be ignored by earlier versions of SPICE.

Shell variables found in the circuit deck (but not in the
commands text) are evaluated during the source.  The {\cb reset}
command can be used to update these variables if they are later
changed by the shell after sourcing. 

%SU-------------------------------------
\subsection{\spcmd{write}}
\index{write command}
\label{writecmd}

% spCommands.hlp:write 022117

The {\cb write} command is used to save simulation data to a file.
\begin{quote}\vt
write [{\it file} [{\it expr} ...]]
\end{quote}
There are two data formats universally available, the ``rawfile''
format native to {\WRspice} and other simulators based on Berkeley
SPICE3, and the Common Simulation Data Format (CSDF).  The CSDF is one
of the formats generated by HSPICE, and is compatible with
post-processors such as Synopsys WaveView.

\index{PSF file format}
In the Red Hat 6 and 7 releases, a third output format is available: 
the Cadence PSF format.  This support is provided through third-party
libraries which support only the indicated operating systems.  Unlike
the other formats, PSF output can not be read back into {\WRspice}. 
This format is used by the waveform viewer component of the Cadence
Analog Design Environment (ADE) product.

PSF output consists of files created in a specified directory. 
Presently, output is available only for AC, DC, transient, and
operating-point analysis.  Only simple analysis is supported, no
chained DC or looping.

To specify PSF output, one gives a ``filename'', for example to the
{\cb write} command or the {\vt rawfile} variable, in the form

\begin{quote}
{\vt psf}[{\vt @}{\it path\/}]
\end{quote}

If this is simply ``{\vt psf}'', output goes to a directory named {\vt
psf} in the current directory.  Otherwise, the {\vt psf} keyword can
be followed by a `{\vt @}' character and a path to a directory, with
no white space around the {\vt @}.  Output will go to the indicated
directory.  In either case, the directory will be created if it
doesn't exist, but in the second case and parent directories must
currently exist, they won't be created.

\index{CSDF file format}
If the file name is given an extension from among those listed
below, CSDF output will be generated.  Otherwise, rawfile format
will be used.
\begin{quote}
{\vt .csdf}\\
{\vt .tr}{\it N}\\
{\vt .ac}{\it N}\\
{\vt .sw}{\it N}
\end{quote}
The {\it N} is an integer, and {\vt tr}, {\vt ac}, and {\vt sw}
correspond to transient, ac, and dc sweep results, respectively.  This
is the same convention as used by HSPICE when generating files for
post-processing.
 
If no {\it expr} is given, then all vectors in the current plot will
be written, the same as giving the word ``{\vt all}'' as an {\it
expr}.  If, in addition, no file name is given, a default name will be
used.  The default name is the value of the {\et rawfile} variable if
set, or the argument to the {\vt -r} command line option if one was
given, or ``{\vt rawspice.raw}''.
 
The command writes out the {\it exprs} to the {\it file}.  First,
vectors are grouped together by plots, and written out as such.  For
example, if the expression list contained three vectors from one plot
and two from another, then two plots will be written, one with three
vectors and one with two.  Additionally, if the scale for a vector
isn't present, it is automatically written out as well.

The default rawfile format is ASCII, but this may be changed with the
{\et filetype} variable or the {\et SPICE\_ASCIIRAWFILE} environment
variable.

If the {\et appendwrite} variable is set, the data will be appended to
an existing file.

Files that have been appended to, or have multiple plots, are
concatenations of data for a single plot.  This is expected and
perfectly legitimate for rawfiles, and for CSDF files used only by
{\WRspice}, but concatenated CSDF files may not be portable to other
applications.


%SU-------------------------------------
\subsection{\spcmd{xeditor}}
\index{xeditor command}
\label{xeditor}

% spCommands.hlp:xeditorcom 012209

The {\cb xeditor} command invokes a text editing window for editing
circuit and other text files.  It is available only when graphics is
enabled.
\begin{quote}\vt
xeditor [{\it file\/}]
\end{quote}
This is similar to the {\cb edit} command, however the internal editor
is always used.  The {\et editor} variable and the environment
variables used by the {\cb edit} command are ignored by the {\cb
xeditor} command.

The {\cb xeditor} command brings up a general-purpose text editor
window.  The same pop-up editor is invoked in read-only mode by the
{\cb Notes} button of the {\cb Help} menu in the {\cb Tool Control}
window for use as a file viewer.  In that mode, commands which modify
the text are not available.

See \ref{textedit} for more information about the text editor.


%S-----------------------------------------------------------------------------
\section{Simulation Control Commands}
\label{simcmds}

% spCommands.hlp:simcmds 032420

The commands described in this section initiate, control, and monitor
{\WRspice} simulations.  One can monitor the progress of a run in two
ways, in addition to the percentage complete that is printed in the
{\cb Tool Control} window.  First, the {\cb iplot} command can be used
to plot one or more variables as the simulation is progressing.  To
plot {\vt v(1)}, for example, one would type, before the run is
started, ``{\vt iplot v(1)}''.  During the run, {\vt v(1)} will be
plotted on screen, with the plot rescaled as necessary.  Second, one
can print variables.  For example, the {\cb trace} command can be
used, by typing ``{\vt trace time}'' before the run starts, to cause
the time value to be printed at each output point during transient
analysis.

\index{runops}
\label{runop}
The {\cb iplot} and {\cb trace} commands are examples of what are
called ``runops''.  Other runops include the {\cb stop} and {\cb
measure} commands.  A runop remains in effect until deleted with the
{\cb delete} command, and the runops in effect can be listed with the
{\cb status} command.  The runops can also be listed, deleted, or made
inactive with the {\cb Trace} tool from the {\cb Tools} menu in the
{\cb Tool Control} window.  All runops are available as commands,
which apply to any circuit while in force.  Some runops can be
specified from within the {\WRspice} input file, in which case the
runop applies when simulating that file only.  The table below lists
the runops that are presently available.

\begin{tabular}{|l|l|}\hline
\multicolumn{2}{|c|}{Runops}\\ \hline
\cb Command & \cb Input Keyword\\ \hline\hline
\cb save & \vt .save\\ \hline
\cb trace & \vt -\\ \hline
\cb iplot & \vt -\\ \hline
\cb measure & \vt .measure\\ \hline
\cb stop & \vt .stop\\ \hline
\end{tabular}

The run can be paused at any time by typing {\kb Ctrl-C} in the
controlling text window.  The run can be resumed with the {\cb resume}
command, or reset with the {\cb reset} command.

It is possible to transparently execute simulations on a remote
machine while in {\WRspice}, if the remote machine has a {\vt
wrspiced} daemon running.  It is also possible to run simulations
asynchronously on the present machine.  These jobs are not available
for use with the {\cb iplot} command, however.  The {\cb jobs} command
can be used to monitor their status.

Many of these commands operate on the ``current circuit'' which by
default is the last circuit entered into {\WRspice} explicitly with
the {\cb source} command, or implicitly by typing the file name.  The
{\cb setcirc} command can be used to change the current circuit.  The
{\cb Circuits} button in the {\cb Tools} menu also allows setting of
the current circuit.

When a circuit file is read, any references to shell variables are
expanded to their definitions.  Shell variables are referenced as {\vt
\$}{\it name}, where {\it name} has been set with the {\cb set}
command or in the {\vt .options} line.  This expansion occurs only
when the file is sourced, or the {\cb reset} command is given, so that
if the variable is changed, the circuit must be sourced or reset to
make the change evident in the circuit.  If a variable is set in the
shell and also in the {\vt .options} line, the value from the shell
is used.

\begin{tabular}{|l|l|}\hline
\multicolumn{2}{|c|}{Simulation Commands}\\ \hline
\cb ac & Perform ac analysis\\ \hline
\cb alter & Change circuit parameter\\ \hline
\cb alterf & Dump alter list to Monte Carlo output file\\ \hline
\cb aspice & Initiate asynchronous run\\ \hline
\cb cache & Manipulate subcircuit/model cache\\ \hline
\cb check & Initiate range analysis\\ \hline
\cb dc & Initiate dc analysis\\ \hline
\cb delete & Delete watchpoint\\ \hline
\cb destroy & Delete plot\\ \hline
\cb devcnt & Print device counts\\ \hline
\cb devload & Load device module\\ \hline
\cb devls & List available devices\\ \hline
\cb devmod & Change device model levels\\ \hline
\cb disto & Initiate distortion analysis\\ \hline
\cb dump & Print circuit matrix\\ \hline
\cb findlower & Find lower edge of operating range\\ \hline
\cb findrange & Find edges of operating range\\ \hline
\cb findupper & Find upper edge of operating range\\ \hline
\cb free & Delete circuits and/or plots\\ \hline
\cb jobs & Check asynchronous jobs\\ \hline
\cb loop & Alias for sweep command\\ \hline
\cb mctrial & Run a Monte Carlo trial\\ \hline
\cb measure & Set up a measurement\\ \hline
\cb noise & Initiate noise analysis\\ \hline
\cb op & Compute operating point\\ \hline
\cb pz & Initiate pole-zero analysis\\ \hline
\cb reset & Reset simulator\\ \hline
\cb resume & Resume run in progress\\ \hline
\cb rhost & Identify remote SPICE host\\ \hline
\cb rspice & Initiate remote SPICE run\\ \hline
\cb run & Initiate simulation\\ \hline
\cb save & List vectors to save during run\\ \hline
\cb sens & Initiate sensitivity analysis\\ \hline
\cb setcirc & Set current circuit\\ \hline
\cb show & List parameters\\ \hline
\cb state & Print circuit state\\ \hline
\cb status & Print trace status\\ \hline
\cb step & Advance simulator\\ \hline
\cb stop & Specify stop condition\\ \hline
\cb sweep & Perform analysis over parameter range\\ \hline
\cb tf & Initiate transfer function analysis\\ \hline
\cb trace & Set trace\\ \hline
\cb tran & Initiate transient analysis\\ \hline
\cb vastep & Advance Verilog simulator\\ \hline
\cb where & Print nonconvergence information\\ \hline
\end{tabular}

%SU-------------------------------------
\subsection{\spcmd{ac}}
\index{ac command}

% spCommands.hlp:ac 011909

The {\cb ac} command initiates an ac analysis of the current circuit.
\begin{quote}\vt
ac {\it ac\_args} [dc {\it dc\_args\/}]
\end{quote}
The {\it ac\_args} are the same as appear in a {\vt .ac} line (see
\ref{acline}).  If a dc sweep specification follows, the ac analysis
is performed at each point of the dc analysis (see \ref{dcline}).

%SU-------------------------------------
\subsection{\spcmd{alter}}
\index{alter command}

% spCommands.hlp:alter 041711

The {\cb alter} command allows circuit parameters to be changed for
the next simulation run.
\begin{quote}\vt
alter [{\it device\_list\/} , {\it param} [{\vt =}] {\it value\/}
  [{\it param} [{\vt =}]  {\it value\/} ... ]]
\end{quote}
The parameters will revert to original values on subsequent runs,
unless the {\cb alter} command is reissued.

If given without arguments, a list of previously entered alterations
of the current circuit, to be applied in the next analysis run, is
printed.  List entries may have come from previously given {\cb alter}
commands, or from assignments to the {\vt @}{\it device\/}{\vt [}{\it
param\/}{\vt ]} special vectors.

The {\it device\_list} is a list of one or more device or model names
found in the circuit.  The names are separated by white space, and the
list is terminated with a comma.  Following the comma is one or more
name/value pairs, optionally an equal sign can appear between the two
tokens.  The name is a device or model keyword, which should be
applicable to all of the names listed in the {\it device\_list}.  Note
that this probably means that the {\it device\_list} can contain
device names or models, but not both.  The device and model keywords
can be obtained from the {\cb show} command.

The {\cb alter} command can be issued multiple times, to set
parameters of devices or models which can't be intermixed according to
the rule above.

The {\it device\_list} can contain ``globbing'' (wild-card)
characters with similar behavior to globbing (global substitution) in
the {\WRspice} shell.  Briefly, `{\vt ?}' matches any character, '{\vt
*}' matches any set of characters or no characters, ``{\vt [abc]}''
matches the characters `{\vt a}', `{\vt b}', and `{\vt c}', and ``{\vt
a}\{{\vt bc,de}\}'' matches ``{\vt abc}'' and ``{\vt ade}''.

When the next simulation run of the current circuit is started, the
given parameters will be substituted.  Thus, the {\cb show} command,
if given before the next run, will not show the altered values.  The
internal set of altered values will be destroyed after the
substitutions.

Examples:
\begin{quote}
{\vt alter R2, resistance=50}\\
{\vt alter c\{1,2,3\}, capacitance 105p}
\end{quote}

%SU-------------------------------------
\subsection{\spcmd{alterf}}
\index{alterf command}

% spCommands.hlp:alterf 011721

This will dump the alter list to the output file, for use in Monte
Carlo analysis.
\begin{quote}\vt
alterf
\end{quote}
In this approach, the {\cb alter} command, or equivalently forms like
``{\vt let @}{\it device\/}{\vt [}{\it param\/}{\vt ]} {\vt =} {\it
trial\_value}'' are used to set trial values in the {\vt exec} block. 
Once set, this can be called to dump the values into the output file.

In 4.3.13, these are added to the logging file automatically, so
this command may be obsolete.

%SU-------------------------------------
\subsection{\spcmd{aspice}}
\index{aspice command}

% spCommands.hlp:aspice 011909

The {\cb aspice} command allows simulation jobs to be run in the
background on the present machine.
\begin{quote}\vt
aspice {\it infile} [{\it outfile\/}]
\end{quote}
This command will run a simulation asynchronously with
{\it infile} as an input circuit.  If {\it outfile} is given, the
output is saved in this file, otherwise a temporary file is used. 
After this command is issued, the job is started in the background,
and one may continue using {\WRspice} interactively.  When the job is
finished, the rawfile is loaded and becomes the current plot, and any
output generated is printed.  Specifically, {\WRspice} forks off a new
process with the standard input set to {\it infile}, and which writes
the standard output to {\it outfile}.  The forked program is expected
to create a rawfile with name given by a {\vt -r} command line option. 
The forked command is effectively ``{\vt {\it program} -S -r {\it
rawfile} <{\it infile} >{\it outfile}}, where {\it program} is the
{\et spicepath} variable (which defaults to calling {\WRspice}), {\it
rawfile} is a temporary file name, and {\it outfile} is the file
given, or a temporary file name.  Although the {\cb aspice} command is
designed for use with {\WRspice}, it may be used with other simulators
capable of emulating the {\WRspice} server mode protocol.  One may
specify the pathname of the program to be run with the {\et spicepath}
variable, or by setting an environment variable.

%SU-------------------------------------
\subsection{\spcmd{cache}}
\index{cache command}

% spCommands.hlp:cache 011909

This function provides a control interface to the subcircuit/model cache.
\begin{quote}\vt
cache [{\it keyword\/}] [{\it tagname\/}]
\end{quote}

The subcircuit/model cache contains representations of blocks of input
lines that were enclosed in {\vt .cache} and {\vt .endcache} lines. 
These representations are used instead of the actual lines of input,
reducing setup time.

The command can have the following forms, the first argument is a
keyword (or letter).  additional arguments are tag names (the names
that follow ``{\vt .cache}'' in SPICE input).

\begin{description}
\item{\vt cache h}[{\vt elp}]\\
Print command usage information.
\item{\vt cache l}[{\vt ist}]\\
Print a list of the tag names currently in the cache.  The
{\cb cache} command with no arguments does the same thing.
\item{\vt cache d}[{\vt ump}] [{\it tagname}...]\\
This will dump the lines saved in the cache, for each
{\it tagname} given, or for all names if no {\it tagname} is
given.  Presently, {\vt .param} lines are listed as comments; 
the actual parameters are in an internal representation and not
explicitly listed.
\item{\vt cache r}[{\vt emove}] {\it tagname} [{\it tagname} ...]\\
This will remove the cached data associated with each
{\it tagname} given.  The given names will no longer be in the cache.
\item{\vt cache c}[{\vt lear}]\\
This will clear all data from the cache.
\end{description}

%SU-------------------------------------
\subsection{\spcmd{check}}
\index{check command}
\label{checkcom}

% spCommands.hlp:check 032520

The {\cb check} command is used to initiate margin analysis.  Margin
analysis can consist of either a swept operating range analysis, or
a Monte Carlo analysis.
\begin{quote}
{\vt check} [{\vt -a}] [{\vt -b}] [{\vt -c}] [{\vt -m}] [{\vt -r}]
  [{\vt -f}] [{\vt -s}] [{\vt -k}] [{\vt -h}] [{\vt -v}]
  [[{\it pstr1\/}] {\it val1} {\it del1} {\it stp1\/}]
  [[{\it pstr2\/}] {\it val2} {\it del2} {\it stp2\/}]
  [{\it analysis\/}]
\end{quote}
See Chapter \ref{oprange} for a full description of operating range
and Monte Carlo analysis.  The current circuit is evaluated, and must
have an associated block of control statements which contain the
pass/fail script.  A second associated block of executable statements
contains initialization commands.  These blocks can be provided in the
circuit file, or be previously defined codeblocks bound to the
circuit.  Codeblocks are executable data structures described in
\ref{codeblock}.  Setting up the file in one of the formats described
described in Chapter \ref{oprange} will ensure that these blocks are
created and bound transparently, however it is possible to do this by
hand.

The option characters can be grouped following a single ``{\vt -}'',
or entered separately.

\begin{description}
\item{\vt -a}\\
If the {\vt -a} flag is given, operating range analysis is performed
at every point (all points mode).  Otherwise, the analysis attempts to
limit computation by identifying the contour containing the points of
operation.  This algorithm can be confused by operating ranges with
strange shapes, or which possess islands of fail points.  If the input
file contains a {\vt .checkall} line, then the {\vt -a} flag to the
{\cb check} command is redundant, all points will be checked in this
case.

\item{\vt -b}\\
If this is given, the analysis will be paused after setup and the {\cb
check} command will return.  This is the start for atomic Monte Carlo
(see \ref{atomic}); a script can call the {\cb mctrial} command
numerous times at this point, then ``{\vt check -c}'' to clean up and
end the analysis.

\item{\vt -c}\\
The {\vt -c} (clear) option will clear any margin analysis in progress
if the analysis has been paused, for example by pressing {\kb Ctrl-C},
or if in an atomic Monte Carlo script.  Return is immediate whether or
not there is a present analysis to clear.  Unlike in release 4.3.8 and
earlier, no new analysis is started, and other options are ignored.

A paused margin analysis is resumed if the {\cb check} command is
given which does not have the {\vt -c} option set, and any arguments
given in this case are ignored.  The {\cb resume} command will also
restart a paused margin analysis.

\item{\vt -m}\\
If the {\vt -m} option is given, Monte Carlo analysis is performed,
rather than operating range analysis.  This is the default if a {\vt
.monte} line appeared in the file; the {\vt -m} option is only
required if there is no {\vt .monte} line.  The {\vt -a} option is
ignored if {\vt -m} is given, as is {\vt .checkall}.  Monte Carlo
analysis files differ from operating range files only in the header
(or header codeblock).  During Monte Carlo analysis, the header block
is executed before every simulation so that variables can be updated. 
In operating range analysis variables are initialized by the header
block only once, at the start of analysis.

\item{\vt -r}\\
If the {\vt -r} (remote) option is given, remote servers will be
assigned simulation runs, allowing parallelism to increase analysis
speed.  The remote servers must have been specified through the {\cb
rhost} command, and each must have a {\vt wrspiced} server running. 
More information on remote asynchronous runs can ge found in
\ref{rhost} and \ref{rspice}.
\end{description}

Ordinarily, during operating range and Monte Carlo analysis, only the
current data point is retained.  The amount of data retained can be
altered with the {\vt -f}, {\vt -s}, and {\vt -k} options.  However,
if a {\vt .measure} line appears in the circuit deck, or the {\cb
iplot} runop is active, data will be retained internally so that the
{\vt .measure} or {\cb iplot} is operational.

\begin{description}
\item{\vt -f}\\
The {\vt -f} option will cause the data for the current trial to be
retained.  This is implied if any {\vt .measure} lines are present, or
if an {\cb iplot} is active.  The data are overwritten for each new
trial.  The data for the last trial are available after the analysis
is complete, or can be accessed for intermediate trials if the
analysis is paused.

\item{\vt -s}\\
The {\vt -s} option also causes retention of the data for the current
trial, but in addition will dump the data to a family of rawfiles,
similar to the {\vt segment} keyword of the {\vt .tran} line (though
this works with other than transient analysis).  The default file name
is the name of the range analysis output file, suffixed with ``{\vt
.s}{\it NN\/}'', where {\it NN} is 00, 01, etc.  Each trial generates
a new suffix in sequence.

\item{\vt -k}\\
With the {\vt -k} option, all data are retained, in a
multi-dimensional plot.  Note that this can be huge, so use of the
{\et maxdata} variable and {\vt .save} lines may be necessary.  One
can see the variations by plotting some or all of the dimensions of
the output.  Recall forms like {\vt v(1)[{\it N\/}]} refer to the {\it
N+1\/}'th trial, and {\vt v(1)[{\it N,M\/}]} includes the data for the
{\it N+1\/}'th to the {\it M+1\/}'th trials.  The {\et mplot} command
has a facility for displaying trial data in a simplified manner.

\item{\vt -h}\\
Finally, the {\vt -h} (help) option will simply print a brief summary
of the options to the {\cb check} command.

\item{\vt -v}\\
If {\vt -v} (verbose) is given, results and other messages are printed
on-screen as the analysis is performed, otherwise the analysis is
silent, except for any printing statements executed in the associated
command scripts.  The {\cb mplot} command can be used to follow
progress graphically.
\end{description}

If an {\cb iplot} is active, {\vt -f} (current trial data retention)
is implied.  The data will be plotted for each trial in the same
{\cb iplot}, erasing after each trial is complete.  If {\vt -k} is
given, all data will be plotted, without erasure.  Note that an
iplot doubles internal memory requirements.

The command line may include one or two range specifications.  In
operating range analysis, each specification consists of an optional
parameter specification string, followed by three numbers.  These
numbers will augment or override the {\vt checkVAL1}, {\vt checkDEL1},
{\vt checkSTP1}, {\vt checkVAL2}, {\vt checkDEL2}, and {\vt checkSTP2}
vectors that may be in effect.  The numbers are parsed in the order
shown, and all are actually optional.  A non-numeric token will
terminate a block, and missing values must be set from the vectors.

In Monte Carlo analysis, each block can contain only a single number,
which will override the {\vt checkSTP1} and {\vt checkSTP2} values (if
any), in that order.  These values are used to define how many Monte
Carlo trials to perform.

The optional {\it pstr1} and {\it pstr2} strings take the same format
and significance as in the {\cb sweep} command.  See the description
of that command for a description of the format.  If a parameter
specifier is given, the specified device parameters will be altered
directly, and the variables and vectors normally used to pass values
will {\bf not} be set.  This applies only to operating range analysis,
and the explicit parameter strings can only be applied from the {\cb
check} command line and not from the file.  If the analysis is two
dimensional, then both dimensions must have a parameter specification,
or neither dimension can have a parameter specification; the two
mechanisms can not be mixed.

The {\it analysis} to be performed is given, otherwise it is found in
the circuit deck.  In interactive mode, if no analysis is specified,
the user will be prompted for an analysis string.

During operating range analysis, a file is usually created and placed
in the current directory for output.  This file is named with the base
name of the input file, with an extension {\vt .d}{\it NN}, where {\it
NN} is replaced with {\vt 00}, {\vt 01}, etc.~ --- the first case
where the filename is unique.  If for some reason the input file name
is unknown, the basename ``check'' will be used.  Similarly, in Monte
Carlo analysis, a file named {\it basename\/}.{\vt m}{\it NN} is
generated.  In either case, the shell variable {\et mplot\_cur} is set
to the current output file name.  These files can be plotted on-screen
with the ``{\vt mplot [{\it filename\/}]}'' command.

The results from operating range/Monte Carlo analysis are hidden away
in the resulting plot structure.  The plot can be displayed by
entering ``{\vt mplot} {\it vec}'' where {\it vec} is any vector in
the plot.

When a {\vt .measure} is included in an iterative analysis, data are
saved as follows.  Before each iteration, the previous result vector
and its scale are saved to the end of a ``history'' vector and scale,
and are then deleted.  The result vector and scale are recreated when
the measurement is completed during the iteration.  Thus, at the end
of the analysis, for a measurement named ``example'', one would have
the following vectors:

\begin{tabular}{ll}
\et  example         & the result from the final trial\\
\et  example\_scale  & the measurement interval or point in the last trial\\
\et  example\_hist   & results from the prior trials\\
\et  example\_hist\_scale & intervals from the prior trials\\
\end{tabular}

Thus, during each trial, the result vector will have the same
properties as in a standard run.  It can be used in the {\vt .control}
block of a Monte Carlo or operating range file (recall that {\vt
\$?}{\it vector} can be used to query existence, and that if there is
no {\et checkPNTS} vector defined, the {\vt .control} block is called
once at the end of each trial).

In the current circuit, the parameters to be varied are usually
included as shell variables {\vt \$value1} and {\vt \$value2}.  These
are special hard-coded shell variables which contain the parameter
values during simulation.  Before the file is sourced (recall that
variable substitution occurs during the read-in), these variables can
be set with the {\cb set} command, and the file simulated just as any
other circuit.  Initially, the variables {\vt \$value1} and {\vt
\$value2} are set to zero.  The {\et value1} and {\et value2} names
can be changed to other names, and other mechanisms can be used to
supply trial values, as described in Chapter \ref{oprange}.

Briefly, operating range analysis works as follows.  The analysis
range and other parameters are specified by setting certain vectors in
the header script, or by hand.  The range is evaluated by rows
(varying {\et value1}) for each column ({\et value2}) point.  Columns
are then reevaluated if the terminating pass point was not previously
found.  For a row, starting at the left, points are evaluated until a
pass point is found.  The algorithm skips to the right, and evaluates
toward the left until a pass point is found.  This minimizes
simulation time, however strange operating ranges, such as those that
are reentrant or have islands, will not be reproduced correctly.  The
only fool-proof method is to evaluate every point, which will occur if
the {\vt -a} option is given, or the {\vt .checkall} line was given in
the input file.

The range of evaluation is set with {\it center\/}, {\it step\/}, and
{\it number\/} variables.  The {\it number\/} is the number of steps
to take above and below the {\it center\/}.  Thus, if {\it number\/}
is 1, the range is over the three points {\it center-step\/}, {\it
center\/}, and {\it center+step\/}.  One can set ranges for {\et
value1} and {\et value2}, or alternatively one can set {\et value2},
and the algorithm can determine the operating range for {\et value1}
at each {\et value2} point.  These values represent the parameter
variation range in operating range analysis, but serve only to
determine the number of trials in Monte Carlo analysis.

\index{check command!variables}
\index{check command!vectors}
There are a number of vectors with defined names which control
operating range and Monte Carlo analysis.  In addition, there are
relevant shell variables.  The {\cb check} command creates a plot
structure, which contains all of the special control vectors, plus
vectors for each circuit node and branch.  This plot becomes the
current plot after the analysis starts.  The special vectors which
have relevance to the operating range analysis are listed below.

\begin{description}
\item{{\et checkPNTS} (real, length $>=$ 1)}\\
These are the points of the scale variable (e.g., time in transient
analysis) at which the pass/fail test is applied.  If a fail is
encountered, the simulation is stopped and the next trial started. 
This vector is usually specified as an array, with the {\cb compose}
command, and is used in operating range and Monte Carlo analysis.  If
not specified, the evaluation is performed after the trial completes.

\item{{\et checkVAL1} (real, length 1)}\\
This is the initial central value of the first parameter to be varied
during operating range analysis.  It is not used in Monte Carlo
analysis.

\item{{\et checkDEL1} (real, length 1)}\\
The first central value will be incremented or decremented by this
value between trials in operating range analysis.  It is not used in
Monte carlo analysis.

\item{{\et checkSTP1} (integer, length 1)}\\
This is the number of trials above and below the central value.  In
Monte Carlo analysis, it partially specifies the number of simulation
runs to perform, and specifies one coordinate of the visual array used
to monitor progress (with the {\cb mplot} command).  In operating
range analysis, the default is zero.  In Monte Carlo analysis, the
default is 3.

\item{\et checkVAL2, checkDEL2, checkSTP2}\\
These are as above, but relate to the second parameter to be varied in
the circuit in operating range analysis.  In Monte Carlo analysis,
only {\et checkSTP2} is used, in a manner analogous to {\et
checkSTP1}.  The total number of simulations in Monte Carlo analysis
is (2*{\et checkSTP1} + 1)*(2*{\et checkSTP2} + 1), the same as would
be checked in operating range analysis.

\item{{\et checkFAIL}  (integer, length 1, value 0 or 1)}\\
This is the global pass/fail flag, which is set after each trial, 1
indicates failure.  This variable is used in both operating range and
Monte Carlo analysis.

\item{{\et checkINIT}  (integer, length 1, value 0 or 1)}\\
This is set to 1 by {\WRspice} before the initial execution of the
header block, before operating range or the first Monte Carlo trial. 
It is set to 0 otherwise.  Thus one can identify the first trial in
Monte Carlo analysis from within the header script.

\item{{\et opmin1, opmax1, opmin2, opmax2} (real, length $>=$ 1)}\\
The operating range analysis can be directed to find the operating
range extrema of the one parameter for each value of the other
parameter.  These vectors contain the values found.  They are not used
in Monte Carlo analysis.

\item{{\et value} (real, length variable)}\\
This vector can be used to pass trial values to the circuit, otherwise
shell variables are used.  This pertains to operating range and Monte
Carlo analysis.

\item{{\et checkN1, checkN2} (integer, length 1)}\\
These are the indices into the value array of the two parameters being
varied in operating range analysis.  The other entries are fixed. 
These vectors are not used if shell variables pass the trial values to
the circuit, and are not used in Monte Carlo analysis.
\end{description}

The shell variables are:

\begin{description}
\item{{\et checkiterate} (0-10)}\\
This is the binary search depth used in finding operating range
extrema.  This is not used in Monte Carlo analysis.

\item{\et value1, value2}\\
These variables are set to the current trial values to be used in the
circuit (parameters 1 and 2).  The {\WRspice} deck should reference
these variables (as {\vt \$value1} and {\vt \$value2}) as the
parameters to vary.  Alternatively, the value array can be used for
this purpose.  These variables can be used in Monte Carlo analysis. 
Additionally, these variables, and a variable named ``{\vt value}''
can be set to a string.  When done, the variable or vector named by
the string will take on the functionality of the assigned-to variable. 
For example, if {\vt set value1 = L1} is given, the variable {\vt L1}
is used to pass trial parameter 1 values to the circuit (references
are {\vt \$L1}).

Instead of using shell substitution and the {\vt value1}/{\vt value2}
variables to set varying circuit parameters, one can use an internal
parameter passing method which is probably more efficient.
 
The form, given before the analysis,
\begin{quote}
{\vt set value1="\%}{\it devicelist\/}{\vt ,}{\it paramlist\/}{\vt "}
\end{quote}
sets up a direct push into the named {\it parameters} of listed {\it
devices}, avoiding shell expansion and vectors.  Note that the list
must follow a magic `{\vt \%}' character, which tells the system to
use the {\it devlist\/},{\it paramlist} syntax, as used in the {\cb
sweep} command (see \ref{psetting}).  This is equivalent to giving
{\it pstr1\/}, {\it pstr2} on the command line.

The {\vt jjoprng2.cir} file in the examples illustrates use of this
syntax.

\end{description}

The {\et checkVAL1}, {\et checkDEL1}, etc.  vectors used must be
defined and properly initialized, either in the deck or directly from
the shell.

The shell variables {\et value1} and {\et value2} are set to the
current variable 1 and variable 2 values.  In addition, vector
variables can be set.  This is needed for scripts such as optimization
where the parameter to be varied is required to be under program
control.  If a vector named {\et value} exists, as does a vector named
{\et checkN1}, then the vector entry {\et value[{\et checkN1\/}]} is
set to {\vt \$value1} if {\et checkN1} is in the range of {\et value}. 
Similarly, if a vector {\et checkN2} exists, then the vector entry
{\et value[{\et checkN2\/}]} is set to {\vt \$value2}, if {\et
checkN2} is in the range of {\et value}.  Thus, instead of invoking
{\vt \$value1} and {\vt \$value2} in the {\WRspice} text, one can
instead invoke {\vt \$\&value[\$\&checkN1]}, {\vt
\$\&value[\$\&checkN2]}, where we have previously defined the vectors
{\et value}, {\et checkN1}, {\et checkN2}.  The file could have a
number of parameters set to {\vt \$\&value[0]}, {\vt \$\&value[1]},
...  .  If {\et checkN1} is set to 2, for example, {\vt \$\&value[2]}
would be varied, and the other values would be fixed at predefined
entries.  The name ``value'' can be redefined by setting a shell
variable named ``{\vt value}'' to the name of another vector.

If any of the shell variables {\et value1}, {\et value2}, or a {\it
shell} variable {\et value} are set to a string, then the shell
variable or vector named in the string will have the same function as
the assigned-to variable.  For example, if in the header one has
``{\vt set value1 = L1}'', then the variable reference {\vt \$L1}
would be used in the file to introduce variations, rather than {\vt
\$value1}.  Similarly, if we have issued ``{\vt set value = myvec}'',
the vector {\et myvec} would contain values to vary (using the pointer
vectors {\et checkN1} and {\et checkN2}), and a reference would have
the form {\vt \$\&myvec[\$\&checkN1]}.  Note that the alternate
variables are not automatically defined before the circuit is parsed,
so that they should be set to some value in the header.  The default
{\vt \$value1} and {\vt \$value2} are predefined to zero.

In Monte Carlo analysis, the header block is executed before each
simulation.  In the header block, shell variables and vectors may be
set for each new trial.  These variables and vectors can be used in
the SPICE text to modify circuit parameters.  The names of the
variables used, and whether to use vectors or variables, is up to the
user (variables are a little more efficient).  Monte Carlo analysis
does not use predefined names for parameter data.  Typically, the {\vt
gauss} function is used to specify a random value for the variables
in the header block.

One can keep track of the progress of the analysis in two ways. 
{\WRspice} will print the analysis point on the screen, plus indicate
whether the circuit failed or passed at the point, if the {\vt -v}
option was given to the {\cb check} command.  The {\cb echo} command can
be used in the codeblock to provide more information on-screen, which
is printed whether or not the {\vt -v} option was given.  The second
method uses the {\cb mplot} command, which graphically records the
pass/fail points.  In this mode, the relevant arguments to {\cb mplot}
are as follows.
\begin{description}
\item{\vt mplot -on}\\
This will cause subsequent operating range analysis results to be plotted
while the analysis is running.

\item{\vt mplot -off}\\
This will return to the default (no graphical output while simulating).
\end{description}

The analysis can search for the actual edge of the operating region
for each row and column.  These data are stored in vectors named {\et
opmin1}, {\et opmax1}, {\et opmin2}, and {\et opmax2} with length
equal to the number of points of the fixed variable.  For example,
{\vt opmin1[0]} will contain the minimum parameter 1 value when
parameter 2 is equal to {\it central2} - {\it delta2\/}*{\it steps2},
and {\vt opmin1[2*{\it steps2\/}]} will contain the minimum parameter
1 value when parameter 2 is {\it central2} + {\it delta2}*{\it
steps2}.

The binary search depth is controlled by a shell variable {\et
checkiterate}, with possible values of 0--10.  If set to 1--10, the
search is performed (setting to 0 skips the range finding).  Higher
values provide more accuracy but take more time.  If the search is
performed, a vector called {\et range} and its scale {\et r\_scale}
are also produced.  These contain the Y and X coordinates of the
operating range contour, which can be plotted with the command ``{\vt
plot range}''.

A typical approach is to first unset {\et checkiterate}, {\et
checkSTP1}, and {\et checkSTP2}.  The {\cb check} command is used to
run a single-point analysis, while changing the values of {\et value1}
and {\et value2} until a pass point is found.  After the pass point is
found, {\et checkiterate} can be set to a positive value, which will
yield the ranges for the two variables.  Then, the {\et checkSTP1} and
other variables can be set to cover this range with desired
granularity, and the analysis performed again.

When only one point is checked ({\vt checkSTP1 = checkSTP2 = 0}), no
output file is generated.  If {\et checkiterate} is nonzero and the
{\vt -a} option is given, and a vector is used to supply trial values,
the range of each entry in the vector is determined, and stored in the
{\et opmin1} and {\et opmax1} vectors.  A mask vector can be defined,
with the same length as the value vector and same name with the suffix
``{\vt \_mask}''.  Value entries corresponding to nonzero entries of
this vector do not have the range computed.  If the {\vt -a} flag is
not given, the range is found in the usual way.  The central value
must pass, or the range will not be computed.

See Chapter \ref{oprange} for more information on performing operating
range and Monte Carlo analysis, and the suggested file formats.

%SU-------------------------------------
\subsection{\spcmd{dc}}
\index{dc command}

% spCommands.hlp:dc 011909

The {\cb dc} command performs a swept dc analysis of the current
circuit.
\begin{quote}\vt
dc {\it .dc dc\_args}
\end{quote}
The {\it dc\_args} are the same as used in the {\vt .dc} line (see
\ref{dcline}).

%SU-------------------------------------
\subsection{\spcmd{delete}}
\index{delete command}

% spCommands.hlp:delete 022519

The {\cb delete} command is used to remove ``runops'' (traces or
breakpoints) from the runop list.
\begin{quote}\vt
delete [[in]active] [all | save | trace | iplot | measure | stop |
 {\it number\/}] ...]
\end{quote}
With no arguments, a list of existing runops is printed, and the
user is prompted for one to delete.  The {\cb status} command also
prints a list of runops.  Runopss can also be controlled with the
panel brought up with the {\cb Trace} button in the {\cb Tools}
menu.

If the {\vt inactive}/{\vt active} keyword is given, breakpoints
listed to the right but before another {\vt (in)active} keyword are
deleted only if they are inactive/active.  Otherwise, they are deleted
unconditionally.  If one of {\vt stop}, {\vt measure}, {\vt trace},
{\vt iplot}, or {\vt save} is given, runops of that type only are
deleted.  These keywords can appear in combination.

Each runop is assigned a unique number, which is available through
the {\cb status} command.  This number can also be entered on the
command line causing that runop to be deleted (if the activity
matches the {\vt inactive} keyword, if given).  A range of numbers
can be given, for example ``2-6''.  There must be no white space in
the range token.

Examples:
\begin{quote}
Delete all traces and iplots:\\
{\vt delete trace iplot}\\
\\
Delete all inactive runops:\\
{\vt delete inactive all}\\
\\
Delete all traces and inactive iplots:\\
{\vt delete traces inactive iplots}
\end{quote}

%SU-------------------------------------
\subsection{\spcmd{destroy}}
\index{destroy command}

% spCommands.hlp:destroy 062515

The {\cb destroy} command will delete plot structures.
\begin{quote}\vt
destroy [all] | [{\it plotname} ...]
\end{quote}
Giving this command will throw away the data in the named plots and
reclaim the storage space.  This can be necessary if a lot of large
simulations are being done.  {\WRspice} should warn the user if the
size of the program is approaching the maximum allowable size (within
about 90\%), but it is advisable to run the {\vt rusage space} command
occasionally if running out of space is a possibility.  If the
argument to {\cb destroy} is {\vt all}, all plots except the constants
plot will be thrown away.  It is not possible to destroy the constants
plot.  If no argument is given the current plot is destroyed.

%SU-------------------------------------
\subsection{\spcmd{devcnt}}
\index{devcnt command}

% spCommands.hlp:devcnt 080215

This command will print a table of instantiation counts of the
different device types found in the current circuit.
\begin{quote} \vt
devcnt [{\it model\_name} ...]
\end{quote}
These are the number of device structures used in the internal
representation of the circuit, after subcircuit expansion.

If no arguments appear, all devices found will be included. 
Otherwise, arguments are taken as model names (the leftmost element
printed in the output), which may include use of ``globbing''
characters `{\vt *}' and `{\vt ?}' and friends.  Briefly, `{\vt ?}'
matches any character, '{\vt *}' matches any set of characters or no
characters, ``{\vt [abc]}'' matches the characters `{\vt a}', `{\vt
b}', and `{\vt c}', and ``{\vt a}\{{\vt bc,de}\}'' matches ``{\vt
abc}'' and ``{\vt ade}''.  Matching is case-insensitive.

Note that every device has a model, which is created internally if not
given explicitly.  In particular, simple resistor, inductor, and
capacitor devices have default models named ``{\vt R}'', ``{\vt L}'',
and ``{\vt C}''.

The {\cb devcnt} table for all devices is also appended to the
standard output of batch jobs.

%SU-------------------------------------
\subsection{\spcmd{devload}}
\index{devload command}
\index{loadable device modules}
\label{devload}

% spCommands.hlp:devload 042814

This command will load a loadable device module into {\WRspice}.
\begin{quote}\vt
devload [{\it module\_path\/} | {\vt all}]
\end{quote}

{\WRspice} supports runtime-loadable device modules.  Once loaded, the
corresponding device is available during simulation runs, in the same
way as the internally-compiled devices in the device library.

This command can be used at any time to load a device module into
{\WRspice}.  If given without arguments, a list of the dynamically
loaded device modules currently in memory is printed.  Otherwise, the
single argument can be a path to a loadable device module file to be
loaded, or a path to a directory containing module files, all of which
will be loaded.

Once a module is loaded, it can not be unloaded.  The file can be
re-loaded, however, so if a module is modified and rebuilt, it can be
loaded again to update the running {\WRspice}.

On program startup, by default known loadable device modules are
loaded automatically.  Modules are known to {\WRspice} through the
following.

\begin{enumerate}
\item{If the {\vt modpath} variable is set to a list of directory
paths, modules are loaded from each directory in the list.  The {\vt
modpath} can be set from the {\vt .wrspiceinit} file.}

\item{If the {\vt modpath} variable is {\bf not} set, then modules are
loaded from the {\vt devices} subdirectory of the {\vt startup}
directory in the installation area (which is generally installed as\\
{\vt /usr/local/xictools/wrspice/startup/devices}).  Note that if the
user sets up a {\vt modpath}, this directory must be explicitly
included for these devices, which are supplied with the {\WRspice}
distribution, to be loaded.}
\end{enumerate}

If the boolean variable {\vt nomodload} is set in the {\vt
.wrspiceinit} file, then the module auto-loading is suppressed. 
Equivalently, giving the ``{\vt -mnone}'' command line option will
also suppress auto-loading, by actually setting the {\vt nomodload}
variable.  Auto-loading is also suppressed if the ``{\vt -m}'' command
line option is given, which is another method by which modules can be
loaded.

If, instead of a module path, the keyword ``{\vt all}'' is given to
the {\cb devload} command, all known modules as described above will
be loaded, the same as for the auto-load.  This will be done whether
or not {\vt nomodload} is set.

This gives the user flexibility in setting up devices in the {\vt
.wrspiceinit} file.  Normally, devices are auto-loaded after {\vt
.wrspiceinit} is processed, so that calls to the {\cb devmod} command
(for example) in {\vt .wrspiceinit} would likely fail.  However, one
can first call ``{\vt devload all}'' to auto-load the devices, and set
{\vt nomodload} to avoid the automatic loading.  Then, one can call
commands which require that devices be loaded.

The ``{\vt all}'' form may also be useful in scripts, in conjunction
with setting the {\vt modpath} to different values.

%SU-------------------------------------
\subsection{\spcmd{devls}}
\index{devls command}

% spCommands.hlp:devls 121011

This command lists currently available devices.
\begin{quote}\vt
devls [{\it key\/}[{\it minlev\/}[-{\it maxlev\/}]]] ...
\end{quote}

This commnd prints a listing of devices available for use in
simulation, from the built-in device library or loaded as modules at
run time.  With no argument, all available devices are listed.

Arguments take the form of a key letter, optionally followed by an
integer, or two integers separated by a hyphen to indicate a range. 
This will print only devices that match the key letter, and have model
levels that match the integer or integer range given.  Any number of
these arguments can be given.

Example:  {\vt devls c r1 m30-40}\\

This will print all devices keyed by `{\vt c}' (capacitors), all
devices keyed by `{\vt r}' (resistors) with model level 1, and devices
keyed by `{\vt m}' (mos) with model levels 30--40 inclusive.

%SU-------------------------------------
\subsection{\spcmd{devmod}}
\index{devmod command}

% spCommands.hlp:devmod 121611

It is possible to program the model levels associated with devices
in {\WRspice}.
\begin{quote}\vt
devmod {\it index} [{\it level} ...]
\end{quote}

This allows the user to set up model levels for compatibility with
another simulator, or to directly use simulation files where the model
level is different from that initially assigned in {\WRspice}.  The
effect is similar to the {\vt .mosmap} input directive, but applies to
all device types.

All devices have built-in levels, which are the defaults.  This
command allows levels to be changed in the currently running
{\WRspice}.  The change occurs in memory only so is not persistent
across different {\WRspice} sessions.  However, the command can be
used in a startup script to perform the changes each time {\WRspice}
is invoked.

The first argument to {\cb devmod} is a mandatory device index.  This
is an integer that corresponds to an internal index for the device. 
These are the numbers that appear in the listing from the {\cb devls}
command.

If there are no other arguments, the device is simply listed, in the
same format as the entries from {\cb devls}.

Any following arguments are taken as model levels.  Each level is an
integer in the range 1--255, and up to eight levels can be given.  The
device will be called for any of the level numbers listed.

After pressing {\kb Enter}, the device entry is printed with the new
model levels.  The entire device list is checked, and if there are
clashes from the new model level, a warning is issued.  If two similar
devices have the same model number, the device with the lowest index
will always be selected for that value.

There are a few devices that have levels that can not be changed. 
These are built-in models, such as MOS and TRA, where the model code
is designed to handle several built-in levels (such as MOS levels 1--3
and 6).  Attempting to change these levels will fail.

Model level 1 is somewhat special in that it is the default when no
model level is given in SPICE input for a device.  Level 0 is reserved
for internal use and can not be assigned.  The largest possible model
level is 255 in WRspice.

%SU-------------------------------------
\subsection{\spcmd{disto}}
\index{disto command}

% spCommands.hlp:disto 011909

The {\cb disto} command will initiate distortion analysis of the
current circuit.
\begin{quote}\vt
disto {\it disto\_args} [dc {\it dc\_args\/}]
\end{quote}
The {\it disto\_args} are the same as appear in a {\vt .disto} line
(see \ref{distoline}).  If a dc sweep specification follows, the
distortion analysis is performed at each point of the dc analysis
(see \ref{dcline}).

%SU-------------------------------------
\subsection{\spcmd{dump}}
\index{dump command}

% spCommands.hlp:dump 072018

The {\cb dump} command sends a print of the internal matrix data
structure last used by the simulator for the current circuit to the
standard output.  It is used for program debugging, amd may also be
useful for analyzing convergence problems.

\begin{quote}
{\vt dump} [{\vt -r}] [{\vt -c}] [{\vt -t}] [{\vt -f} {\it filename\/}]
\end{quote}

The command takes the following optional arguments.
\begin{description} 
\item{\vt -r}\\
Print the reordred matrix, the default is to print the matrix as it
exists before internal reordering is performed to optimize stability.

\item{\vt -c}\\
Print in compact form, showing only which elements are nonzero (marked
with `x') and zero (marked with `.').

\item{-t}\\
Terse format, do not print header information.

\item{\vt -f} {\it filename}\\
Print output in the given file.
\end{description}

%SU-------------------------------------
\subsection{\spcmd{findlower}}
\index{findlower command}

% spCommands.hlp:findlower 032120

This command can be used to find the lower operating limit of one or
two parameters in the circuit.  See the {\cb findrange} command for a
complete description.

\begin{quote}
{\vt findlower} {\it findrange\_args}
\end{quote}

%SU-------------------------------------
\subsection{\spcmd{findrange}}
\index{findrange command}

% spCommands.hlp:findrange 032120

The command, and its associated commands {\cb findlower} and {\cb
findupper}, can be used to find the operating margins of one or two
circuit parameters.

\begin{quote}
{\vt findrange} [{\vt -n1} {\it name1\/}] [{\vt -n2} {\it name2\/}]
[[{\it pstr1\/}] {\it val1\/}] [[{\it pstr2\/}] {\it val2\/}]
\end{quote}

This utilizes the infrastructure developed for Operating Range
analysis in \ref{oprange}, but can be used in scripts for finer
control of the process.  The depth used in the binary search can be
given in the {\et checkiterate} variable as for standard range
analysis, or defaults to 6 if not set.

These commands can be running only when a range analysis has been
initiated with the {\cb check} command (see \ref{checkcom}), generally
by giving the ``{\vt -b}'' option.  Any number of the {\cb findrange}
commands or the variants can be given, as well as other commands such
as {\cb mctrial}.  When finished the {\cb check} command should be
given with the ``{\vt -c}'' option to terminate the mode and free
internal memory.

A usage example can be found in the examples: {\vt JJexamples/nor\_op.cir}.

By default, the lower and upper range values will be saved in vectors
named {\vt opmin1}, {\vt opmin2}, {\vt opmax1}, and {\vt opmax2},
which are created if necessary.  If given following ``{\vt -n1}'' or
``{\vt -n2}'' respectively, {\it name1} and {\it name2} tokens will
serve as a base for new names that replace vector names {\vt opmin1},
{\vt opmin2}, {\vt opmax1}, {\vt opmax2} for range results.  For
example,
\begin{quote}
\vt -n1 foo
\end{quote}
will save output in vectors named {\vt foo\_min}, {\vt foo\_max}.

There is a subtlety in the syntax:  a double-quoted name, e.g.,
{\vt -n1 "}{\it pname\/}{\vt "}, is accepted and the quotes will
be stripped before use.  The quotes prevent parameter substitution, so
this allows use of a name that has also been defined as a parameter
(with {\vt .param} directive or otherwise).

Each of the three functions can take parameter definitions and range
parameters, in the same syntax as supplied to the {\cb check} and {\cb
sweep} commands, however only the starting parameter value is needed. 
The simulation must run correctly at the starting value.  The command
line may include one or two specifications.  Each specification
consists of an optional parameter specification string, followed by
the starting value.  The numbers will override the {\vt checkVAL1},
and {\vt checkVAL2} vectors that may be in effect.

The optional {\it pstr1} and {\it pstr2} strings take the same format
and significance as in the {\cb sweep} command.  See the description
of that command for a description of the format.  If a parameter
specifier is given, the specified device parameters will be altered
directly, and the variables and vectors normally used to pass values
will {\bf not} be set.  If two parameters are being set, either both
must be set using the syntax above, or neither, the two methods can't
be mixed.

%SU-------------------------------------
\subsection{\spcmd{findupper}}
\index{findupper command}

% spCommands.hlp:findupper 032120

This command can be used to find the upper operating limit of one or
two parameters in the circuit.  See the {\cb findrange} command for a
complete description.

\begin{quote}
{\vt findupper} {\it findrange\_args}
\end{quote}

%SU-------------------------------------
\subsection{\spcmd{free}}
\index{free command}

% spCommands.hlp:free 011909

The {\cb free} command is used to free memory used by circuit and plot
structures.
\begin{quote}\vt
free [c[ircuit]] [p[lot]] [a[ll]] [y[es]]
\end{quote}
This command releases the memory used to store plot and circuit
structures for reuse by {\WRspice}.  The virtual memory space used by
plots in particular can grow quite large.  If {\cb free} is given
without an argument, the user is queried as to whether to delete the
current plot and circuit structures (independently).  If the argument
{\vt all} is given, the user is queried as to whether to delete all
plot and circuit structures.  If the argument {\vt circuit} is given,
only circuits will be acted on.  Similarly, if the argument {\vt plot}
is given, only plots will be acted on.  If neither {\vt circuit} or
{\vt plot} is given, both circuits and plots will be acted on.  If the
argument {\vt yes} is given, the user prompting is skipped, and the
action performed.  Only the first letter of the keywords is needed. 
Plots can also be freed from the panel brought up by the {\cb Plots}
button in the {\cb Tools} menu, and circuits can be freed from the
panel brought up with the {\cb Circuits} button.  The {\cb destroy}
command can also be used to free plots.

%SU-------------------------------------
\subsection{\spcmd{jobs}}
\index{jobs command}

% spCommands.hlp:jobs 012209

The {\cb jobs} command produces a report on the asynchronous
{\WRspice} jobs currently running.  Asynchronous jobs can be started
with the {\cb aspice} command locally, or on a remote system with the
{\cb rspice} command.  {\WRspice} checks to see if the jobs are
finished every time a command is executed.  If a job is finished, then
the data are loaded and become available.  This command takes no
arguments.

%SU-------------------------------------
\subsection{\spcmd{mctrial}}
\index{mctrial command}

% spCommands.hlp:mctrial 032520

This is a command to run a single trial for use when performing
script-driven Monte Carlo analysis.
\begin{quote}\vt
mctrial
\end{quote}

This can run only when a Monte Carlo analysis mode has been initiated
with the {\cb check} command, generally by giving the ``{\vt -b}'' and
``{\vt -m}'' options.  Any number of the {\cb mctrial} commands can be
given, as well as other commands such as {\cb findrange}.  When
finished the {\cb check} command should be given with the ``{\vt -c}''
option to terminate the mode and free internal memory.

A usage example can be found in the examples:  {\vt
JJexamples/nor\_mc.cir}.

%SU-------------------------------------
\subsection{\spcmd{measure}}
\index{measure command}

% spCommands.hlp:measure 032220

The {\cb measure} command allows one to set up a runop (see
\ref{runop}) which will identify a measurement point or interval, and
evaluate an expression at that point, or call a number of measurement
primitives that apply during the interval, such as rise time or pulse
width.

\begin{quote}
measure {\it analysis} {\it resultname} {\it point} | {\it interval}
[{\it measurements\/}] [{\it postcmds\/}]\\
measure {\it analysis} {\it resultname} param={\it expression}
[{\it postcmds\/}]
\end{quote}

The command will apply, if active, when any circuit is being run. 
There is also a {\vt .measure} input syntax element which will set up
the measurement on that circuit only.  Both use the identical syntax
described below.  The syntax is based on the {\vt .measure} statement
in HSPICE.

\begin{description}
\item{\it analysis}\\
This specifies the type of analysis during which the measurement will
be active.  Exactly one of the following keywords should appear in
this field:  {\vt tran}, {\vt ac}, {\vt dc}.

\item{\it resultname}\\
This field specifies a name for the measurement.  The name should be
unique among the measurements in the circuit, and among vectors in
scope during simulation.  The name should start with an alphabetic
character and contain no white space or other special characters.
\end{description}

A vector with this name will be added to the current plot, if the
measurement is successful.  Vector names found in {\vt .measure} lines
are added to the internal save list, guaranteeing that the necessary
data will be available when needed, whether or not the vector has been
mentioned in a {\vt .save} line.

\subsubsection{Point and Interval Specification}
\index{measurement interval}

The field that follows the {\it resultname} contains a description of
the conditions which initiate a measurement.  There are three basic
types:  a point specification, an interval specification, and a
post-measurement specificantion.

The {\it interval} begins with the ``trigger'' and ends with the
``target''.  Measurement will apply during this interval.  If no
target is given, the trigger sets the {\vt point}, where measurement
will be performed.  The trigger and target are independently specified
as follows:

\begin{description}
\item{\it point}\\
\begin{quote}
[{\vt trig}] {\it pointlist}
\end{quote}
This consists of the keyword {\vt trig} (which is optional) followed
by a point specification list.  The keyword ``{\vt from}'' is
equivalent to ``{\vt trig}''.

\item{\it interval}\\
\begin{quote}
[{\vt trig}] {\it pointlist} {\vt targ} {\it pointlist}
\end{quote}
An interval contains a second point specification initiated with the
mandatory keyword {\vt targ}.  The keyword ``{\vt to}'' is equivalent
to ``{\vt targ}''.

\item{post-measurement}\\
\begin{quote}
{\vt param=}{\it expression}
\end{quote}
Measurements in this form will be performed when all {\it point} and
{\it interval} measurements are complete.  After all {\it point} and
{\it interval} measurements have been performed, the {\it expression}
will be evaluated and the result saved in {\it resultname}.  The {\it
expression} can reference other measurement results in addition to the
usual vectors and functions provided by the system.  These measurement
lines are evaluated in the order found in the input.

\item{\it pointlist}\\
\begin{quote}
{\it pointspec} [{\it pointspec\/}] ...
\end{quote}
The point is specified with a list of {\it pointspec} specifications,
and the event is registered on the first occasion when all {\it
pointspec} elements are true, i.e., the conjunction is true.

\item{\it pointspec}\\
{\it keyword} {\it expression1} [{\vt =}][{\vt val=}] [{\it expression2\/}]
[{\vt cross=}{\it crosses\/}] [{\vt rise=}{\it rises\/}]
[{\vt fall=}{\it falls\/}]] [{\vt td=}{\it delay\/}]
\end{description}

The {\it pointspec} begins with one of the following kewords:  {\vt
before}, {\vt at}, {\vt after}, {\vt when}.  The {\vt at} keyword
strobes, meaning that the event is triggered only if the conjunctions
(other {\it pointspecs}) in the list are true at the specified event. 
The {\vt after} and {\vt when} keywords are equivalent, but varied use
can give a natural language feel to the conjuction list.  They are not
strobing, meaning that the conjunctions can become true anytime at or
after the specified event.  The {\vt before} keyword negates logic: 
the {\it pointspec} is true before the specified event.  This can be
useful as an element in the conjunction list.

Once a {\it pointspec} becomes triggered, it remains triggered for the
remainder of the simulation run.  Once triggered, a {\vt before} {\it
pointspec} will evaluate false, preventing the overall list from
triggering.  Otherwise, the overall list triggers when each {\it
pointspec} is true.  Similarly, an {\vt at} clause that did not have
all conjunctions true at its event time will thereafter always be
false.

Following the keyword are one or two general expressions.  There can
be an optional equal sign (``{\vt =}'') or a ``{\vt val}'' keyword
``{\vt val=}'' between the expressions.

An {\it expression} in this context can be:
\begin{itemize}
\item{A number or constant expression.  This is taken as the
triggering point, meaning that the event occurs during simulation when
the scale variable is equal to or exceeds the value.}

\item{An integer enclosed in square brackets.  This is interpreted as
an output index, which increments whenever data would be written out
from the running simulation.  This is most useful when the printing
increment is constant.  The event triggers when the output index
equals the integer given.}

\item{The {\it resultname} of a measure in the circuit.  The event
occurs when the referenced measurement is performed.}

\item{A general expression consisting of constants, vector names, and
circuit variables.  Frequently this will be simply a vector name
corresponding to a node voltage or branch current in the circuit.}
\end{itemize}

In {\WRspice}, an expression token is the minimum text required for a
syntactically complete expression, and may include white space. 
Single quotes or parentheses can be used to delimit expressions in the
{\it pointspec}, if nexessary.  The normal single-quote expression
expansion and substitution is suppressed in this context.

If only one {\it expression} is given, and it is not a constant
expression or a measure name, the event is triggered at the first time
the expression becomes logically true, meaning that the absolute value
is one or larger.  This corresponds to logical true produced by
comparison and other logical operations in {\WRspice}.  For example,
the expression ``{\vt v(5) > 0.25}'' returns 0 if false and 1 if true.

It may be a bit confusing but the form {\it expr1\/}{\vt =}{\it expr2}
is interpreted as two expressions, but the same form with any
relational operator other than {\vt =} is taken as a single expression
with a binary result.  Either the symbol or the keyword equivalent can
be used.  The relational operators available are listed below.

\begin{tabular}{|l|l|}\hline
{\vt eq}   or   $=$  & equal to\\ \hline
{\vt ne}   or   $<>$ & not equal to\\ \hline
{\vt gt}   or   $>$  & greater than\\ \hline
{\vt lt}   or   $<$  & less than\\ \hline
{\vt ge}   or   $>=$ & greater than or equal to\\ \hline
{\vt le}   or   $<=$ & less than or equal to\\ \hline
\end{tabular}

If two expressions are given, neither can be a measure result name. 
We are implicitly comparing the values of the two expressions, finding
points where the two expressions are equal.  By default, the first
time the values of the two expressions cross will trigger the event. 
The following keywords can be assigned an integer value to trigger at
the indicated point.

\begin{description}
\item{{\vt cross=}{\it crosses}}\\
Integer {\it crosses} is the number of crossings.

\item{{\vt rise=}{\it rises}}\\
Integer {\it rises} is the number of times that {\it expression1}
rises above {\it expression2}.

\item{{\vt fall=}{\it falls}}\\
Integer {\it falls} is the number of times that {\it expression1}
falls below {\it expression2}.
\end{description}

\begin{description}
\item{{\vt td=}{\it delay}}\\
If two expressions are given, the {\it delay} is the amount of scale
value (e.g., time in transient analysis) before starting to look for
crossing events.

If one expression is given, and the expression is not constant or a
measure result name, the {\it delay} is the amount of the scale value
to wait before checking to see if the expression evaluates true.  If
the expression is a measurement name, than the delay is added to the
measurement time of the referenced measurement.

There is a special case, where no expressions are given, only a {\vt
td=}{\it delay} value.  This can be a second or subsequent {\it
pointspec} in the {\it pointlist}.  This will trigger at the time of
the previous {\it pointspec} in the list (to the left) delayed by {\it
delay}.

\item{{\vt ts=}{\it delay}}\\
This is similar to {\vt td}, however it is strobing.  In the two
expression case, in addition to having the effect of {\vt td}, it will
convert {\vt when} and {\vt after} clauses to work as {\vt at},
requiring conjunctions to be true at the time of the event.  It simply
acts as {\vt td} for {\vt at} and {\vt before}.

In the single expression case, it requires that the expression and
any conjunctions be true at the value given for {\vt ts}.
\end{description}

Examples:\\
{\vt at v(2)=0.5 rise=3 td=0.2nS after td=0.1nS}\\
\hspace*{1em}Trigger 0.1nS after the third rising edge of v(2) after
0.2nS crosses 0.5V.\\
{\vt when v(2)<v(1) before v(2)<v(3)}\\
\hspace*{1em}Trigger the first time that {\vt v(2) < v(1)} if and only
if {\vt v(2) < v(3)} has never been true.

\subsubsection{Syntax Compatibility}

The present syntax supported by the {\vt .measure} command in
{\WRspice} is a super set of the previous syntax cases, which
    are shown below.  These should all work in the present system.

Form 1:
\begin{quote}\vt
    trig|targ at={\it value}
\end{quote}

Form 1 is straightforward; the interval starts ({\vt trig}) or ends
({\vt targ}) at {\it value}.  {\it Value} must be within the
simulation range of the scale variable (e.g., time in transient
analysis).

The same effect can be achieved with:
\begin{quote}\vt
    from={\it value} to={\it value}
\end{quote}

Form 2:
\begin{quote}\vt
    trig|targ {\it variable} [val=]{\it value}
        [td={\it delay}] [cross={\it crosses}]
        [rise={\it rises}] [fall={\it falls}]
\end{quote}

Form 2 allows the interval boundaries to be referenced to times when a
variable crosses a threshold.  The {\it variable} can be any vector
whose value is available during simulation.  The {\it value} is a
constant which is used to measure crossing events.  The {\vt val=}
which precedes the {\it value} is optional.  At least one of the {\vt
rise/fall/cross} fields should be set.  Their values are integers
which represent the variable crossing the threshold a number of times. 
The {\vt rise} indicates the variable rising through the threshold,
{\vt fall} indicates the variable decreasing from above to below the
threshold, and {\vt cross} indicates {\vt rises + falls}.  The
interval boundary is set when the specified number of transitions is
reached.

If the delay is specified, transition counting starts after the
specified delay.

\spexampo{trig v(2) 2.5 td=0.1ns rise=2}

This indicates that the interval begins at the second time {\vt v(2)} rises
above 2.5V after 0.1ns.

Form 3:
\begin{quote}\vt
    trig|targ when {\it expr1\/}={\it expr2} [td={\it delay}]
        [cross={\it crosses}] [rise={\it rises}] [fall={\it falls}]
\end{quote}

The third form is similar to the second form, except that crossings
are defined when {\it expr1 = expr2}.  These are expressions, which
must be enclosed in parentheses if they contain white space or commas. 
A rise is defined as {\it expr1} going from less than to greater than
{\it expr2}.

\subsubsection{Measurements}
\index{measurement types}

One should be aware that measurements are performed using data saved
in the plot structure as a simulation progresses.  The accuracy of the
results is directly affected by the density of saved points.  In
transient analysis, one may wish to use internal time point data by
setting the {\vt steptype=nousertp} option.  This avoids the
interpolation to tranient time increments which may reduce accuracy if
the increment is too coarse.

The following measurements are available when an interval has been
specified.

\begin{description}
\item{{\vt find} {\it expr}}\\
Evaluate the difference:  {\it expr} at target minus {\it expr} at
trigger.
\item{{\vt min} {\it expr}}\\
Find the minimum value of {\it expr\/}.
\item{{\vt max} {\it expr}}\\
Find the maximum value of {\it expr\/}.
\item{{\vt pp} {\it expr}}\\
Find the (maximum - minimum) value of {\it expr\/}.
\item{{\vt avg} {\it expr}}\\
Compute the average of {\it expr\/}.
\item{{\vt rms} {\it expr}}\\
Compute the rms value of {\it expr\/}.
\item{{\vt pw} {\it expr}}\\
This will measure the full-width half-maximum of a pulse contained in
the interval.  The baseline is taken as the initial or final value
with the smallest difference from the peak value.  The algorithm will
measure the larger of a negative going or positive going pulse.
\item{{\vt rt} {\it expr}}\\
This will measure the 10-90 percent rise or fall time of the edge
contained in the interval.  The reference start and final values are
the values at the ends of the interval.
\end{description}

These functions are also available in general expressions outside of
the {\cb measure} command:  {\cb mmin}, {\cb mmax}, {\cb mpp}, {\cb
mavg}, {\cb mrms}, {\cb mpw}, {\cb mrft}.  Each of these functions
takes three arguments:  ({\it vector\/}, {\it scaleval1\/}, {\it
scaleval2\/}).  The two scale values frame the area of measurement. 
These must be chosen to isolate the feature of interest for
rise/fall/width measurement.  If not in range of the {\it vector}
scale, the {\it vector} scale endpoints are assumed.

When a point has been specified, the only measurement form
available is

\begin{description}
\item{{\vt find} {\it expr}}\\
Evaluate {\it expr} at point.
\end{description}

A {\vt .measure} statement can contain any number of measurements,
including no measurements.  If no measurement is specified, the vector
produced contains only zeros, however the scale vector contains the
start and stop values, which may be the only result needed.  The
created vector, which is added to the current plot, will be of length
equal to the number of measurements, with the results placed in the
vector in order.

The measurement scale point(s) in {\vt .measure} statements are also
saved in a vector, which is the scale for the result vector.  If the
measurement name is ``{\vt result}'', then the scale vector is named
``{\vt result\_scale}''.  The scale contains one or two values,
depending on whether it is a point or interval measurement.

\subsubsection{Post-Measurement Commands}
\index{post-measurement commands}

There are a few commands which can be performed after measurement,
which will run whether or not any measurements are actually made.

\begin{description}
\item{{\vt print}, {\vt print\_terse}}\\
By default, nothing is printed on-screen for a {\vt .measure} line
during interactive simulation.  If the keyword {\vt print} appears in
the {\vt .measure} line, the results will be printed on the standard
output.  A more concise format can be obtained from the alternative
keyword {\vt print\_terse}.  The result vectors are created in all
cases.

\item{\vt stop}\\
If the keyword {\vt stop} appears in a {\vt .measure} line, the
analysis will be paused when {\it all} measurements are complete. 
Thus if the deck contains several {\vt .measure} lines and {\vt stop}
is given in at least one, the analysis will pause when all of the
measurements are complete, not just the one containing {\vt stop}. 
The analysis can then be resumed with the {\cb resume} command, or
reset with the {\cb reset} command.

\item{{\vt exec} {\it command}}\\
Execute the {\WRspice} shell command found in {\it command\/}, which
should be double-quoted if it contains white space.  Note that
multiple commands can be given, separated by semicolon ({\vt ';'})
characters.  This will be run before a script is called (see below) so
can be used to pass information to the script.  The command will be
executed once only, after measurements if any.

\item{{\vt call} {\it script}}\\
After the measurement (if any) is performed and any command string is
executed, the named script will be called.  The script can be a normal
script file or codeblock.  The special names ``{\vt .exec}'', ``{\vt
.control}'', and ``{\vt .postrun}'' call the exec, control, or postrun
bound codeblocks of the running circuit, if they exist.

The script can be used for additional processing or testing of
whatever sort.  If the script returns 1, the current simulation will
pause immediately (no waiting for other measures) however a calling
analysis, such as Monto Carlo, will continue.  If 2 is returned, this
indicates a fatal global error and any calling analysis will be
stopped too.  Any other return value allows the run to continue
normally.
\end{description}

When a {\vt .measure} is included in an iterative analysis (Monte
Carlo, loop, etc.), data are saved as follows.  Before each iteration,
the previous result vector and its scale are saved to the end of a
``history'' vector and scale, and are then deleted.  The result vector
and scale are recreated when the measurement is completed during the
iteration.  Thus, at the end of the analysis, for a measurement named
``example'', one would have the following vectors:

\begin{tabular}{|l|l|}\hline
\vt example & the result from the final trial\\ \hline
\vt example\_scale & the measurement interval or point in the last
 trial\\ \hline
\vt example\_hist & results from the prior trials\\ \hline
\vt example\_hist\_scale & intervals from the prior trials\\ \hline
\end{tabular}

Thus, during each trial, the result vector will have the same
properties as in a standard run.  It can be used in the {\vt .control}
block of a Monte Carlo or operating range file (recall that {\vt
\$?}{\it vector} can be used to query existence, and that if there is
no {\vt checkPNTS} vector defined, the {\vt .control} block is called
once at the end of each trial).

\index{measurements, chained}
Multiple {\vt .measure} lines can be ``chained'' in the following
manner.  The vector name following the {\vt from}, {\vt to}, {\vt
trig}, or {\vt targ} keywords can be the name of another measure.  In
this case, the effective start time is the measure time of the
referenced measure.  The measure time is the end of the interval or
the measure point.  The {\vt td}, {\vt rise}, and other keywords can
be used in the referencing measure.  The {\vt td} will be added to the
imported time, and the other keywords operate in the normal way.  If
there are no keywords other than {\vt td} specified, the time is the
delay time plus the imported time.

Example:
\begin{quote}\vt
    .measure tran t1 trig v(5) val=.4m rise=3\\
    .measure tran t2 trig v(5) val=.4m rise=4\\
    .measure tran pw trig t1 td=20p targ t2 td=20p pw v(5) max v(5)\\
\end{quote}

In this case, the measures {\vt t1} and {\vt t2} ``frame'' a period
of an (assumed) repeating signal v(5).  Note that no actual
measurement is performed for these lines.  Their purpose is to be
referenced in the third line, which takes as its interval the {\vt
t1}--{\vt t2} interval delayed by 20 pS, and measures the pulse
width and peak value.

\subsubsection{Referencing Results in Sources}
\index{measurements, source reference}

It is possible to reference {\vt .measure} results in sources.  The
referencing token has the same form as a circuit variable, with an
optional index, i.e.
\begin{quote}\vt
    @{\it result\/}[{\it index\/}]
\end{quote}
where the {\it index\/}, if used, is an integer that references a
specific component of the result (0-based).  The value is always zero
for timepoints before the measurement has been performed, and a
constant value afterward.

Example:
\begin{quote}\vt
    .measure tran peak from=50n to=150n max v(5)\\
    .measure tran stuff trig v(4) val=4.5 rise=1 targ v(4) val=4.5 fall=2\\
    + min v(4) max v(4) pp v(4) avg v(4) rms v(4) print\\
    vxx 1 0 @peak\\
    vyy 2 0 @stuff[2]\\
\end{quote}

In this example, during transient analysis, {\vt vxx} is zero until
150 nS, where the measurement takes place, at which point it jumps to
the value measured.  Likewise, {\vt vyy} is zero until the
measurement, at which point it jumps to the third component (``{\vt pp
v(4)}'') result.  The resulting voltages can be used elsewhere in the
circuit.  Note that we have two implementations of a behavioral peak
detector.


%SU-------------------------------------
\subsection{\spcmd{noise}}
\index{noise command}

% spCommands.hlp:noise 011909

The {\cb noise} command initiates a small-signal noise analysis of the
current circuit.
\begin{quote}\vt
noise {\it noise\_args} [dc {\it dc\_args\/}]
\end{quote}
The {\it noise\_args} are the same as appear in a {\vt .noise} line
(see \ref{noiseline}).  If a dc sweep specification follows, the noise
analysis is performed at each point of the dc analysis (see
\ref{dcline}).

%SU-------------------------------------
\subsection{\spcmd{op}}
\index{op command}

% spCommands.hlp:op 011909

The {\cb op} command will initiate dc operating point analysis of the
current circuit (see \ref{opline}).  The command takes no arguments.

%SU-------------------------------------
\subsection{\spcmd{pz}}
\index{pz command}

% spCommands.hlp:pz 011909

The {\cb pz} command will initiate pole-zero analysis on the current
circuit.
\begin{quote}\vt
pz {\it pz\_args}
\end{quote}
The {\it pz\_args} are the same as appear in a {\vt .pz} line (see
\ref{pzline}).

%SU-------------------------------------
\subsection{\spcmd{reset}}
\index{reset command}

% spCommands.hlp:reset 011909

The {\cb reset} command will reinitialize the current circuit.
\begin{quote}\vt
reset [-c]
\end{quote}
The command will throw out any intermediate data in the circuit (e.g,
after a breakpoint or user pause with {\kb Ctrl-C}) and re-parse the
deck.  Any standard analysis in progress will be cleared, however the
state of any margin analysis (started with the {\cb check} command),
or loop analysis (started with the {\cb loop} command) is retained by
default.  However, if the {\vt -c} option is given, these too are
cleared.  Thus, the {\cb reset} command can be used to update the
shell variables in a deck with or without affecting the status of a
margin or loop analysis in progress.

%SU-------------------------------------
\subsection{\spcmd{resume}}
\index{resume command}

% spCommands.hlp:resume 011909

The {\cb resume} command will resume an analysis in progress.  The
simulation can be stopped by typing an interrupt ({\kb Ctrl-C}) or
with the {\cb stop} command.  If no analysis is currently in
progress, the effect is the same as the {\cb run} command.  Each
circuit can have one each of a standard analysis, a loop analysis
(started with the {\cb loop} command), and a margin analysis (from
the {\cb check} command) in progress.  The {\cb resume} command will
resume standard analysis, margin analysis, and loop analysis in that
precedence.  Paused margin and loop analysis can also be restarted
with the {\cb check} and {\cb loop} commands.  These commands, and
the {\cb reset} command, can be used to clear stopped analyses.  The
{\cb resume} command takes no arguments.

%SU-------------------------------------
\subsection{\spcmd{rhost}}
\index{rhost command}
\label{rhost}

% spCommands.hlp:rhostcom 012411

The {\cb rhost} command allows addition of host names which are
available for remote {\WRspice} runs.
\begin{quote}\vt
rhost [-a][-d] [{\it hostname\/}]
\end{quote}
This command allows manipulation of a list of host names which are
available for remote {\WRspice} runs with the {\cb rspice} command. 
If no arguments are given, the list of hosts is printed.  The {\vt -a}
and {\vt -d} options allow a host name to be added to or deleted from
the list, respectively.  The default is {\vt -a}.  Hosts are added to
the list if they have been specified in the environment or with the
{\et rhost} variable, and a job has been submitted.  The {\it
hostname} can optionally be suffixed with a colon followed by the port
number to use to communicate with the {\vt wrspiced} daemon.  If not
given, the port number is obtained from the operating system for
``wrspice/tcp'', or 6114 if this is not defined.  Port number 6114 is
registered with IANA for this service.

%SU-------------------------------------
\subsection{\spcmd{rspice}}
\index{rspice command}
\label{rspice}

% spCommands.hlp:rspice 011909

The {\cb rspice} command is used to initiate simulation runs on a
remote machine.
\begin{quote}\vt
rspice {\it inputfile\/}\\
{\rm or}\\
rspice [-h {\it host\/}][-p {\it program\/}][-f {\it inputfile\/}]
[{\it analysis\/}]
\end{quote}
This command initiates a remove {\WRspice} job, using the {\it
inputfile} as input, or the current circuit if no {\it inputfile} is
given.  If the {\vt -h} option is not used, the default host can be
specified in the environment before {\WRspice} is started with the
{\et SPICE\_HOST} environment variable, or with the {\et rhost}
variable.  In addition, a list of hosts which are nominally available
for remote runs can be generated with the {\et rhost} command.  The
default host used is the host known to {\WRspice} that has the fewest
active submissions, or which appears last on the list (hosts are added
to the front of the list).  If the {\vt -p} option is not used,
{\WRspice} will use the program found in the {\et rprogram} variable,
and if not set will use the same {\it program} as the {\cb aspice}
command.  If the {\vt -f} option is not used, the current circuit is
submitted, otherwise {\it inputfile} is submitted.  If there is no
{\it analysis} specification, there must be an analysis specified in
{\it inputfile}.  If the current circuit is being submitted, there
must be an {\it analysis} specification given on the command line.

Once the job is submitted, {\WRspice} returns to interactive mode. 
When the job is complete, the standard output of the job, if any, is
printed, and the rawfile generated becomes the current plot.

Remote runs can only be performed on machines which have the {\vt
wrspiced} daemon operating, and have permission to execute the target
program.

%SU-------------------------------------
\subsection{\spcmd{run}}
\index{run command}

% spCommands.hlp:rspice 082909

The {\cb run} command initiates the analysis found in the deck associated
with the current circuit.
\begin{quote}\vt
run [{\it file\/}]
\end{quote}
The command will run the simulation as specified in the input file. 
If there were any of the analysis specification lines ({\vt .dc}, {\vt
.tran}, etc.~) they are executed.  The output is put in {\it
file\/} if it was given, in addition to being available
interactively.

There are two file formats available, the native ``rawfile'' format,
and the Common Simulation Data Format (CSDF) used by HSPICE.  See the
description of the {\cb write} command (\ref{writecmd}) for
information on format selection.

If a standard analysis run is in progress and halted with the {\cb
stop} command or by pressing {\kb Ctrl-C}, the {\cb run} command will
resume that run.  This applies only to standard analyses, and not
margin analysis or loop analysis.  Standard analyses started with the
analysis commands {\cb tran}, {\cb dc}, etc.~, will always start a new
analysis, after clearing any paused standard analysis.

%SU-------------------------------------
\subsection{\spcmd{save}}
\index{save command}

% spCommands.hlp:save 011909

The {\cb save} command can be used to save a particular set of outputs
from a simulation run.
\begin{quote}\vt
save [all] [{\it nodename\/} ...]
\end{quote}
The command will save a set of outputs, the rest will be discarded. 
If a node has been mentioned in a {\cb save} command, it will appear
in the working plot after a run has completed, or in the rawfile if
{\WRspice} is run in batch mode (in this case, the command can be
given in the input file as {\vt .save} ...).  If a node is traced or
used in an {\cb iplot} it will also be saved.  If no save commands are
given, all nodes will be saved.  The {\cb save} can be deleted with
the {\cb delete} command, or from the panel brought up by the {\cb
Trace} button in the {\cb Tools} menu.

If a {\cb save} command is given at the prompt in interactive mode, it
is placed in a global list, and activity will persist until deleted
(with the {\cb delete} command).  If the command is given in a file,
the command will be added to a list for the current circuit, and will
apply only to that circuit.  Thus, for example, a {\WRspice} file can
contain lines like
\begin{quote}
{\vt *\# save v(1) ...}
\end{quote}
and the action will be performed as that circuit is run, but the
``{\vt save v(1)} ...'' directive will not apply to other circuits.

One can save ``special'' variables, i.e., device/circuit parameters
that begin with `{\vt @}'.  If a device parameter is a list type, only
a single component can be saved.  The single component can be
specified with an integer, or with a vector name that evaluates to an
integer.  For example, the initial condition values for a Josephson
junction can be accessed as a list, say for a junction named ``b1'',
one can specify
\begin{quote}
{\vt @b1[ic,0]} or {\vt @b1[ic][0]}
\end{quote}
which are equivalent, and each the same as {\vt @b1[vj]}, the initial
voltage.  Similarly,
\begin{quote}
{\vt @b1[ic,1]} or {\vt @b1[ic][1]}
\end{quote}
are equivalent, each being the same as {\vt @b1[phi]}, the initial
phase.

One can also have
\begin{quote}
{\vt let val = 1}\qquad\qquad (this vector is defined somewhere)\\
{\vt @b1[ic,val]} or {\vt @b1[ic][val]}
\end{quote}
Thus, commands like
\begin{quote}
{\vt save @b1[ic,0]}
\end{quote}
or equivalently
\begin{quote}
{\vt save @b1[ic][0]}
\end{quote}
are accepted.  Note that ``{\vt save @b1[ic]}'' is the same as ``{\vt
save @b1[ic,0]}''.  The ``0'' can be an integer, or a vector name that
evaluates to an integer.

%SU-------------------------------------
\subsection{\spcmd{sens}}
\index{sens command}

% spCommands.hlp:sens 011909

The {\cb sens} command initiates sensitivity analysis on the current
circuit.
\begin{quote}\vt
sens {\it sens\_args\/} [dc {\it dc\_args\/}]
\end{quote}
The {\it sens\_args} are the same as appear in a {\vt .sens} line
(see \ref{sensline}).  If a dc sweep specification follows, the
sensitivity analysis is performed at each point of the dc analysis
(see \ref{dcline}).

%SU-------------------------------------
\subsection{\spcmd{setcirc}}
\index{setcirc command}

% spCommands.hlp:setcirc 011909

The {\cb setcirc} command will set the ``current circuit'' assumed
by {\WRspice}.
\begin{quote}\vt
setcirc [{\it circuit\_name\/}]
\end{quote}
The current circuit is the one that is used by the analysis commands. 
When a circuit is loaded with the {\cb source} command it becomes the
current circuit.  If no arguments are given, a list of circuits is
printed, and the user is requested to choose one.  The current circuit
can also be selected from the panel brought up by the {\cb Circuits}
button in the {\cb Tools} menu.
 
%SU-------------------------------------
\subsection{\spcmd{show}}
\index{show command}

% spCommands.hlp:show 062515

The {\cb show} command is used to display information about devices,
models, and internal statistics.
\begin{quote}\vt
show [-r|-o|-d|-n {\it nodename}|-m|-D[M]|-M] [{\it args\/}]
  [, {\it parmlist\/}]
\end{quote}
If {\vt -r} is given, system resource values are printed.  The {\it
args} are resource keywords as in the {\cb rusage} and {\cb
stats} commands, and there is no {\it parmlist}.  If there are no {\it
args}, only total time and space usage are printed.

If {\vt -o} is given, {\WRspice} option values are printed.  These
values are obtained from the {\vt .options} line of the current
circuit, or have been set with the {\cb set} command.  If no {\it
args} are given, the default is {\vt all}.  There is no {\it
parmlist}.

If {\vt -d} is given, or if no option is given, device parameters are
printed.  The {\it args} are device names, and the {\it parmlist},
which is separated from the device list by a comma, consists of device
parameter keywords.  The parameters are expected to apply to each
device in the list.  Both lists can contain ``globbing'' (wild-card)
characters with similar behavior to globbing (global substitution) in
the {\WRspice} shell.  Briefly, `{\vt ?}' matches any character, '{\vt
*}' matches any set of characters or no characters, ``{\vt [abc]}''
matches the characters `{\vt a}', `{\vt b}', and `{\vt c}', and ``{\vt
a}\{{\vt bc,de}\}'' matches ``{\vt abc}'' and ``{\vt ade}''.  Either
the device {\it args} or the {\it parmlist} can be ``{\vt all}'',
and the default is ``{\vt all, all}'' (``{\vt all}'' is
equivalent to `{\vt *}').  Either the device {\it args} or the {\it
parmlist} can be ``{\vt all}'', and the default is ``{\vt all, all}''. 
If the {\it parmlist} is the keyword ``{\vt none}'', then no
parameters are listed, only the devices with their resolved model
names.  This can be useful for determining which model is actually
used for a MOS device, if L/W model selection is being used.  The
command ``{\vt show -d m*,none}'' will display the name of the model
used for each MOS device.

If {\vt -n} is given, followed by the name of a circuit node, the
output is in the same form as for {\vt -d} however only devices
connected to the named node are displayed.

If {\vt -m} is given, model parameters are printed.  The {\it args}
are model names, and the {\it parmlist} is the list of model
parameters to print.  Wild-carding is accepted in both lists.  The
default is {\vt all, all}.  The parameters are expected to apply to
each model in the list.  See the entries for the various devices and
models for the parameter names, or type the {\cb show} command without
a parameter list to see the current values for all available
parameters for the devices or models mentioned.

Spaces around the ``,'' are optional, as is the ``,'' itself if no
parameters are given.  If no argument is given to the show command,
all parameters of all devices in the current circuit will be
displayed.

The {\vt -D} and {\vt -M} options are similar, but keywords and
descriptions from the internal models are listed, and no values are
shown.  It is not necessary to have a circuit loaded, as it is with
{\vt -d} and {\vt -m}.  The {\it args} are single characters which key
the devices in {\WRspice}, such as `{\vt c}' for capacitors, `{\vt q}'
for bipolar transistors, etc.~.  For devices with a {\vt level} model
parameter such as MOSFETs, an integer indicating the model level can
follow the key argument, without any space.

If these options are given with no argument, the device or model
info is printed for each device or model (both for ``{\vt show
-DM}'') found in the device library.  If an argument is given, only
the matching device or model will be be shown, but all of the
parameters will be listed in addition.  The {\vt -D} option lists
the instance parameters, and {\vt -M} the model parameters, and {\vt
-DM} will list both.  In the listing, the letters `RO' indicate a
read-only parameter, which is a computed quantity not set in the
instance or model lines.  The letters `NR' indicate a parameter that
can't be read, i.e., it is input-only.  Recall that device
parameters can be accessed as vectors with the {\vt @}{\it
devname\/}[{\it param\/}] construct.  There is no {\it parmlist} for
the {\vt -D} and {\vt -M} options.

For example, to print the resistance of all resistors in the current
circuit, enter
\begin{quote}\vt
show -d r*, resistance
\end{quote}
The {\vt -d} above is optional, being the default.  To print the {\vt
cbs} and {\vt cbd} parameters of mosfets {\vt m1}--{\vt m4}
\begin{quote}\vt
show m[1-4], c{\rm \{}bd,bs{\rm \}}
\end{quote}
To print the current value of the relative tolerance option, enter
\begin{quote}\vt
show -o reltol
\end{quote}
Entering
\begin{quote}\vt
show -DM q m5
\end{quote}
will list the instance and model parameters of bipolar transistors and
level 5 (BSIM2) MOSFETs.

%SU-------------------------------------
\subsection{\spcmd{state}}
\index{state command}

% spCommands.hlp:state 011909

The {\cb state} command will print the name and a summary of the state
of the current circuit.  The command takes no arguments.

%SU-------------------------------------
\subsection{\spcmd{status}}
\index{status command}

% spCommands.hlp:status 022519

The {\cb status} command is used to print a list of the ``runops''
currently in force.  The command will print out a summary of all the
{\cb save}, {\cb iplot}, {\cb trace}, {\cb measure}, and {\cb stop},
commands that are active.  Each runop is assigned a unique number,
which can be supplied to the {\cb delete} command to remove the runop. 
The runop list can also be manipulated from the panel brought up with
the {\cb Trace} button in the {\cb Tools} menu.  The command takes no
arguments.

%SU-------------------------------------
\subsection{\spcmd{step}}
\index{step command}

% spCommands.hlp:step 011909

The {\cb step} command allows single-stepping through a transient
simulation.
\begin{quote}\vt
step [{\it number\/}]
\end{quote}
The command will simulate through the number of user output points
given, or one, if no number is given.

%SU-------------------------------------
\subsection{\spcmd{stop}}
\index{stop command}

% spCommands.hlp:stop 032220

The {\cb stop} command will add a stop point to the runop list.
\begin{quote}
{\vt stop} {\it analysis} {\it point} [{\it postcmds\/}]
\end{quote}
When a condition is true, simulation will stop, but can be resumed,
after clearing the stop point, with the {\cb resume} command.  The
stop points can be cleared with the {\cb delete} command, and listed
with the {\cb status} command.  The panel brought up by the {\cb
Trace} button in the {\cb Tools} menu can also be used to manipulate
stop points.

The {\cb stop} command is a ``runop'' similar to the {\cb measure}
command, and is in fact implemented internally from the same
components.  Analogous to {\cb measure}, there is also a {\vt .stop}
input syntax element which uses the same syntax, which will be in
force when simulating the circuit containing the line.  When entered
on the command line, the stop is in force for all circuits, while the
runop is active.

Note that this is a different implementation of the {\cb stop} command
than found in {\WRspice}-4.3.8 and earlier, which was based on the
Berkeley Spice3 implementation.  Although similar, the present syntax
is a little different, and the command has more features and options. 

\begin{description}
\item{\it analysis}\\
This specifies the type of analysis during which the break condition
will be active.  Exactly one of the following keywords should appear
in this field:  {\vt tran}, {\vt ac}, {\vt dc}.  Note that this did
not appear in the {\cb stop} syntax used in {\WRspice}-4.3.8 and
earlier.

\item{\it point}\\
This is precisely the same {\it point} specification as is used in the
{\cb measure} command.  Please refer to that section for a description
of the syntax.  Note that this should cover the pre-4.3.9 syntax,
however an analysis point index is now an integer enclosed is square
brackets, numeric values are now assumed to be scale values (such as
time) otherwise.

\item{\vt repeat} {\it delta}\\
The {\it delta} is a real number scale extent.  After the {\it point}
trigger, the actions are repeated on every multipole of {\it delta}
that follows, as long as a {\vt call} script (see below) returns 1.
\end{description}

There are a couple of optional ``{\it postcmd}'' operations which can
be performed when the stop is triggered, but before simulation ends.

\begin{description}
\item{\vt exec} {\it command}\\
Execute the {\WRspice} shell command found in {\it command\/}, which
should be double-quoted if it contains white space.  Note that
multiple commands can be given, separated by semicolon ({\vt `;'})
characters.  This will be run before a script is called (see below) so
can be used to pass information to the script.  The {\it command} will
be executed only once, and only if the {\it point} condition is
reached.

\item{\vt call} {\it script}\\
After the {\it point} is reached and any command string is executed,
the named script will be called.  The script can be a normal script
file or codeblock.  The special names ``{\vt .exec}'', ``{\vt
.control}'', and ``{\vt .postrun}'' call the exec, control, or postrun
bound codeblocks of the running circuit, if they exist.

The script can be used for additional processing or testing of
whatever sort.  If the script returns 1, the current simulation will
{\bf not} stop, and will continue as if the stop condition never
occurred.  If the script returns 2, a global error is indicated and
the present analysis is terminated.  If any other value is returned,
or there is no explicit return, the analysis will stop as normal, and
can be resumed.

\item{\vt silent}\\
Normally when the stop is activated a message is printed.  If the {\vt
silent} keyword is given, no message will be printed.  Suppressing the
message may be desirable when the stop is being used to terminate
failed Monte Carlo trials, for example, where message output simply
clutters the screen.
\end{description}

If a {\cb stop} command is given at the prompt in interactive mode, it
is placed in the global runop list, and activity will persist until
deleted (with the {\cb delete} command).  If the command is given in a
file, the command will be added to a list for the current circuit, and
will apply only to that circuit.  Thus, for example, a {\WRspice} file
can contain lines like
\begin{quote}\vt
*\# stop tran when ...
\end{quote}
and the action will be performed as that circuit is run, but the
``{\vt stop tran when ...  }'' directive will not apply to other
circuits.  This is the same effect as a {\vt .stop} line.


%SU-------------------------------------
\subsection{\spcmd{sweep}}
\index{sweep command}
\index{loop command}

% spCommands.hlp:sweep 032520

The {\cb sweep} command, which for historical compatibility is also
available as ``{\cb loop}'', is used to perform a simulation analysis
over a range of conditions.

\begin{quote}\vt
sweep [-c] [[[{\it pstr1\/}] {\it min1} {\it max1\/} [{\it step1\/}]]
 [[{\it pstr2\/}] {\it min2\/} [{\it max2\/} [{\it step2\/}]]]
 [{\it analysis\/}]]
\end{quote}
The command works something like a chained dc sweep, running an
analysis over a one or two-dimensional range of parameter values.  The
resulting plot will be multi-dimensional.

There are two fundamental ways in which parameter values can be passed
to the circuit.  In the command, the {\it pstr1} and {\it pstr2} are
text tokens which specify the device parameters to vary, in a format
to be described.  In a two-dimensional sweep, both {\it pstr1} and
{\it pstr2} must be given, or neither can be given.  The two different
value-setting mechanisms can not be mixed.

The specified analysis is performed at each point, yielding
multidimensional output vectors.  If {\it analysis} is omitted, an
analysis specification is expected to be found in the circuit deck.

If a sweep analysis is paused, for example by pressing {\kb Ctrl-C},
it can be resumed by entering the {\cb sweep} command again.  No
arguments are required in this case, however if the {\vt -c} option is
given the old analysis is cleared, and a new analysis started if
further parameters are supplied.  The {\vt -c} is ignored if there was
no sweep analysis in progress.  The {\cb resume} command will also
resume a paused sweep analysis.  The {\cb reset} command given with
the {\vt -c} option will also clear any paused sweep analysis.

\subsubsection{Without explicit device parameter setting}

Assume in this section that the {\it pstr1} and {\it pstr2} parameter
specification strings do not appear, then the the shell variables {\vt
value1} and {\vt value2}, which are accessible in the circuit as {\vt
\$value1} and {\vt \$value2}, are incremented, as in operating range
analysis.  This is the behavior of the historic {\cb loop} command. 
As in operating range analysis, there are various related ways of
introducing the variations.

\begin{enumerate}
\item{
Perhaps the most direct method is to include the forms {\vt
\$value1} and {\vt \$value2} (if two dimensional) for substitution in
the current circuit.  The variables will be replaced by the
appropriate numerical values before each trial, as for shell variable
substitution.
}

\item{
If a variable named ``{\vt value1}'' is set to a string token
with the {\cb set} command, then a variable of the same name as the
string token will be incremented, instead of {\vt value1}.  The same
applies to {\vt value2}.  Thus, for example, if the circuit contains
expansion forms of the variables {\vt foo1} and {\vt foo2} (i.e., {\vt
\$foo1} and {\vt \$foo2}), one could perform a sweep analysis using
these variables as

\begin{quote}
{\vt set value1 = foo1 value2 = foo2}\\
{\vt sweep} ...
\end{quote}
}

\item{
The method above allows the SPICE options to be iterated.  These are
the built-in keywords, which can be set with the {\cb set} command or
in a {\vt .options} line in an input file, which control or provide
parameters to the simulation.

The most important example is temperature sweeping, using the
{\vt temp} option.  A temperature sweep would look like

\begin{quote}
{\vt set value1=temp}\\
{\vt sweep -50 50 25} {\it analysis}
\end{quote}

This will run the analysis at -50, -25, 0, 25, and 50 Celsius.
}

\item{
If there are existing vectors named ``{\vt checkN1}'' and (if two
dimensions) ``{\vt checkN2}'' that contain integer values, and the
variable named ``{\vt value}'' is set to the name of an existing
vector (or a vector named ``{\vt value}'' exists), then the vector
components indexed by {\vt checkN1} and {\vt checkN2} will be
iterated, if within the size of the vector.  For example:

\begin{quote}
{\vt let vec[10] = 0}\\
{\vt let checkN1 = 5 checkN2 = 6}\\
{\vt set value = vec}\\
{\vt sweep} ...
\end{quote}

The first line creates a vector named ``{\vt vec}'' of size sufficient
to contain the indices.  The iterated values will be placed in {\vt
vec[5]} and {\vt vec[6]}.  The circuit should reference these values,
either through shell substitution (e.g., {\vt \$\&vec[5]}) or directly
as vectors.

Alternatively, a variable named ``{\vt checkN1}'' can be set.  If the
value of this variable is an integer, that integer will be used as the
index.  If the variable is a name token, then the index will be
supplied by a vector of the given name.  The same applies to {\vt
checkN2}.  The following example illustrates these alternatives:

\begin{quote}
{\vt let vec[10] = 0}\\
{\vt set checkN1 = 5}\\
{\vt let foo = 6}\\
{\vt set checkN2 = foo}\\
{\vt sweep} ...
\end{quote}
}

\item{
Given that it is possible to set a vector as if a variable, by using
the {\cb set} command with the syntax

\begin{quote}
{\vt set \&}{\it vector} {\vt =} {\it value}
\end{quote}

it is possible to iterate vectors with the {\cb sweep} command.  The
form above is equivalent to

\begin{quote}
{\vt let} {\it vector} {\vt =} {\it value}
\end{quote}

Note, however, that the `{\vt \&}' character has special significance
to the {\WRspice} shell, so when this form is given on the command
line the ampersand should be quoted, e.g., by preceding it with a
backslash.

Thus, suppose that the circuit depends on a vector named {\vt delta}. 
One can set up iteration using this vector as

\begin{quote}
{\vt set value1 = '\&delta'}\\
{\vt sweep} ...
\end{quote}
}

\item{
The construct above can be extended to ``special'' vectors, which
enable device and model parameters to be set ahead of the next
analysis.  These special vectors have the form

\begin{quote}
{\vt @}{\it devname\/}{\vt [}{\it param\/}{\vt ]}
\end{quote}

where {\it devname} is the name of a device or model in the circuit,
and {\it param} is one of the parameter keywords for the device or
model.  These keywords can be listed with the {\cb show} command.

For example, if the circuit contains a MOS device {\vt m1} one might
have

\begin{quote}
{\vt set value1 = '\&@m1[w]'}\\
{\vt sweep 1.0u 2.0u 0.25u} {\it analysis}
\end{quote}

This will perform the analysis while varying the {\vt m1} {\vt w}
(device width) parameter from 1.0 to 2.0 microns in 0.25 micron
increments.
}
\end{enumerate}

\subsubsection{Explicit parameter setting}
\label{psetting}

If parameters specifications ({\it pstr1} and {\it pstr2\/}) are
given, there is no variable or vector setting.  Instead, the indicated
device parameters are altered directly, very similar to the {\cb
alter} command.

The syntax for the {\it pstr} strings is very similar to the
device/parameter lists accepted by the {\cb show} command.

\begin{quote}
{\it device\_list\/}{\vt ,}{\it param\_list}
\end{quote}

The {\it device\_list} is a list of one or more device names found in
the circuit.  The names are separated by white space, and the list is
terminated with a comma.  Following the comma is one or more parameter
names.  A parameter name is a device or model keyword, which should be
applicable to all of the names listed in the {\it device\_list}.  The
device keywords can be obtained from the {\cb show} command.

The {\it device\_list} can contain ``globbing'' (wild-card)
characters with similar behavior to globbing (global substitution) in
the {\WRspice} shell.  Briefly, `{\vt ?}' matches any character, '{\vt
*}' matches any set of characters or no characters, ``{\vt [abc]}''
matches the characters `{\vt a}', `{\vt b}', and `{\vt c}', and ``{\vt
a}\{{\vt bc,de}\}'' matches ``{\vt abc}'' and ``{\vt ade}''.

If the string contains white space, it must be quoted.  Since the same
range is applied to all the parameters, if would be unusual to list
more than one parameter name.  However, wildcarding or multiple names
in the device list allows setting the values of arbitrarily many
devices for each trial.

If the {\it device\_list} contains only a single name, and the name is
a voltage or current source, resistor, capacitor, or inductor, then
the comma and parameter name can be omitted.  It will be taken as the
output of a source, or the resistance, capacitance, or inductance of
the component.

%SU-------------------------------------
\subsection{\spcmd{tf}}
\index{tf command}

% spCommands.hlp:tf 011909

The {\cb tf} command will initiate a transfer function analysis of the
current circuit.
\begin{quote}\vt
tf {\it tf\_args} [dc {\it dc\_args\/}]
\end{quote}
The arguments appear as they would in a {\vt .tf} line (see
\ref{tfline}) in the input file.  If a dc sweep specification follows,
the transfer function analysis will be performed at each dc sweep
point (see \ref{dcline}).

%SU-------------------------------------
\subsection{\spcmd{trace}}
\index{trace command}

% spCommands.hlp:trace 051219

The {\cb trace} command will add a ``runop'' which prints the value of
the expression(s) at each user analysis point.
\begin{quote}\vt
trace {\it expr\/} [...]
\end{quote}
At each time point, the expressions on the command line will be
evaluated, and their values printed on the standard output.

If a trace command is given at the prompt in interactive mode, it is
placed in a global list, and activity will persist until deleted (with
the {\cb delete} command).  If the command is given in a file, the
command will be added to a list for the current circuit, and will
apply only to that circuit.  Thus, for example, a {\WRspice} file can
contain lines like
\begin{quote}
{\vt *\# trace v(1)}
\end{quote}
and the trace will be performed as that circuit is run, but the ``{\vt
trace v(1)}'' directive will not apply to other circuits.

The traces in effect can be listed with the {\cb status} command,
deleted with the {\cb delete} command, and otherwise manipulated from
the panel brought up with the {\cb Trace} button in the {\cb Tools}
menu.

%SU-------------------------------------
\subsection{\spcmd{tran}}
\index{tran command}

% spCommands.hlp:tran 011909

The {\cb tran} command initiates transient analysis of the current
circuit.
\begin{quote}\vt
tran {\it tran\_args} [dc {\it dc\_args\/}]
\end{quote}
The arguments are the same as those of a {\vt .tran} line (see
\ref{tranline}).  Output is retained at {\it tstart}, {\it tstop}, and
multiples of {\it tstep} in between, unless the variable {\et
steptype} is set to {\vt nousertp}.  In this case, output is retained
at each internally generated time point in the range.  If a dc sweep
specification follows, the transient analysis is performed at each
sweep point.

%SU-------------------------------------
\subsection{\spcmd{vastep}}
\index{vastep command}

% spCommands.hlp:vastep 032420

This command has application when simulating a circuit containing
Verilog block, and the option {\et vastep} has been set to 0.  In this
case, a call to this command will advance the Verilog simulation to
the next clock tick.  This function can be called from a callback
initiated from a {\vt .stop} line, used when co-simulating Verilog and
SPICE.

%SU-------------------------------------
\subsection{\spcmd{where}}
\index{where command}

% spCommands.hlp:where 012209

The {\cb where} command, which takes no arguments, prints information
about the last nonconvergence, for debugging purposes.


%S-----------------------------------------------------------------------------
\section{Data Manipulation Commands}

% spCommands.hlp:datacmds 091714

The following commands perform various operations on vectors, which
are the basic data structures of {\WRspice}.  Vectors from the current
plot can be referenced by name.  A listing of the vectors for the
current plot is obtained by typing the {\cb let} or {\cb display}
commands without arguments, or pressing the {\cb Vectors} button in
the {\cb Tools} menu.  Vectors for other than the current plot are
referenced by {\it plotname\/}.{\it vecname}, for example, {\vt
tran2.v(1)}.  The current plot can be changed with the {\cb setplot}
command, or from the panel brought up by the {\cb Plots} button in the
{\cb Tools} menu.  See \ref{vectors} for more information about
vectors.

Vectors can be created and manipulated in many ways.  For example, typing
\begin{quote}
{\vt let diff = v(1) - v(2)}
\end{quote}
creates a new vector {\et diff}.  All vectors can be printed, plotted, or
used in expressions.  They can be deleted with the {\cb unlet} command.

\begin{tabular}{|l|l|}\hline
\multicolumn{2}{|c|}{Data Manipulation Commands}\\ \hline
\cb compose & Create vector\\ \hline
\cb cross & Vector cross operation\\ \hline
\cb define & Define a macro function\\ \hline
\cb deftype & Define a data type\\ \hline
\cb diff & Compare plots and vectors\\ \hline
\cb display & Print vector list\\ \hline
\cb fourier & Perform spectral analysis\\ \hline
\cb let & Create or assign vectors\\ \hline
\cb linearize & Linearize vector data\\ \hline
\cb pick & Create vector from reduced data\\ \hline
\cb seed & Seed random number generator\\ \hline
\cb setdim & Set current plot dimensions\\ \hline
\cb setplot & Set current plot\\ \hline
\cb setscale & Assign scale to vector\\ \hline
\cb settype & Assign type to vector\\ \hline
\cb spec & Perform spectral analysis\\ \hline
\cb undefine & Undefine macro function\\ \hline
\cb unlet & Undefine vector\\ \hline
\cb vastep & Advance Verilog simulator\\ \hline
\end{tabular}

%SU-------------------------------------
\subsection{\spcmd{compose}}
\index{compose command}

% spCommands.hlp:compose 032220

The {\cb compose} command is used to create vectors.  It has three forms:
\begin{quote}\vt
compose {\it vecname} values {\it value} [...]\\
{\rm or}\\
compose {\it vecname} pattern [{\it n1} [{\it n2\/}]] {\it bstring}
[{\it modifiers\/}] [...]\\
{\rm or}\\
compose {\it vecname} {\it param = value} [...]
\end{quote}

All forms of this command create a new vector called {\it vecname\/}. 
In the first form, indicated by the keyword ``{\vt values}'', the
given values are concatenated to form the vector.  The second form
creates a binary pattern of 1 and 0 values based on the given pattern
specification to be described.  In the third form, the values in the
vector are determined by the parameters given, as will be described.

The pattern generation syntax given in the second form is as used in
pulse source.  See \ref{pattern} for a complete description of the
{\it bstring} and {\it modifier} syntax and usage.  The optional
preceding numbers {\it n1} and {\it n2} apply only when infinite
repetition ({\vt r=-1}) is given in the {\it modifier\/}:  neither
given will will cause the vector to end at the sequence end, with no
repeat.  If {\it n1} only is given, this number is taken as the
maximum length of the vector.  If both {\it n1} and {\it n2} are
given, the two numbers are taken as {\it step} and {\it stop}, with
the maximum length {\it stop}/{\it step}.  This is convenient for
setting the length to match a transient analysis specification.

In the third form, there are three groups of possible parameter sets. 
The first set facilitates creation of uniform arrays.  This set
contains the following parameters.

\begin{quote}
\begin{tabular}{|l|l|}\hline
\vt start & The value at which the vector should start\\ \hline
\vt stop & The value at which the vector should end\\ \hline
\vt step & The difference between successive elements\\ \hline
\vt lin & The number of points, linearly spaced\\ \hline
\vt log & The number of points, logarithmically spaced\\ \hline
\vt dec & The number of points per decade, logarithmically spaced\\ \hline
\end{tabular}
\end{quote}

The words ``{\vt len}'' and ``{\vt length}'' are synonyms for ``{\vt
lin}''.  A subset of these parameters that provides the information
needed is sufficient.  If all four are given, the point count and step
value must be consistent or the command will fail.  The parameter {\vt
start} defaults to zero, unless implicitly set by other parameters. 
The {\vt stop} and {\vt step} have no defaults and must be supplied
unless implied by other parameters.  If the {\vt lin} parameter is not
given, the other parameters determine the vector length.

The second parameter group generates Gaussian random values.

\begin{quote}
\begin{tabular}{|l|l|}\hline
\vt gauss & The number of points in the gaussian distribution\\ \hline
\vt mean & The mean value for the gaussian distribution\\ \hline
\vt sd & The standard deviation for the gaussian distribution\\ \hline
\end{tabular}
\end{quote}

The {\vt gauss} parameter is required, {\vt sd} defaults to 1.0, and
{\vt mean} defaults to 0.  The random number sequences can be reset by
calling the {\cb seed} command.

The third parameter group generates uniform random values.

\begin{quote}
\begin{tabular}{|l|l|}\hline
\vt random & The number of randomly selected points\\ \hline
\vt center & Where to center the range of points\\ \hline
\vt span & The size of the range of points\\ \hline
\end{tabular}
\end{quote}

The {\vt random} parameter is required, {\vt span} defaults to 2.0,
and {\vt center} defaults to 0.  The random number sequences can be
reset by calling the {\cb seed} command.

%SU-------------------------------------
\subsection{\spcmd{cross}}
\index{cross command}

% spCommands.hlp:cross 012009

The {\cb cross} command creates a new vector.
\begin{quote}\vt
cross {\it vecname number} {\it source} [...]
\end{quote}
The vector is constructed, with name {\it vecname} and values
consisting of the {\it number\/}'th element of each of the source
vectors.  If the index is out of range for a vector, 0 is taken.

%SU-------------------------------------
\subsection{\spcmd{define}}
\index{define command}

% spCommands.hlp:define 092312

The {\cb define} command is used to specify user-defined vector
functions.
\begin{quote}\vt
define [{\it function\/}({\it arg1\/}, {\it arg2\/}, ...)]
[=] [{\it expression\/}]
\end{quote}
This will define the user-definable function with the name {\it
function\/} and arguments {\it arg1\/}, {\it arg2\/}, ...  to be {\it
expression}, which will usually involve the arguments.  When the
function is called, the arguments that are given are substituted
for the formal arguments.

The {\cb define} command and the {\vt .param} line in input files can
be used to define user-defined functions (UDFs).  User-defined
function definitions are modularized and prioritized.  At the base of
the hierarchy (with lowest priority) are the "shell" UDFs which are
defined with the {\cb define} command.

Every circuit has its own set of UDFs, which are obtained from {\vt
.param} lines which are not part of a subcircuit.  When a circuit is
the current circuit, its UDFs will be searched before the shell UDFs
to resolve a function reference.  The current circuit's UDF database
is pushed onto a stack, ahead of the shell UDFs.  Most of the time,
this stack is two levels deep.

During initial circuit processing, when subcircuit expansion is being
performed, when a subcircuit is bing expanded, any functions defined
within the {\vt .subckt} text with {\vt .param} lines are pushed on
the top of the stack.  Since subcircuit definitions may be nested,
functions will be pushed/popped according to the depth in the
hierarchy currently being processed.
  
Thus, a function defined in a subcircuit will have priority over a
function of the same name and argument count defined in the circuit
body, and a function defined in the circuit body will have priority
over a function with the same name and argument count defined from the
shell with the {\cb define} command.

When {\cb define} is given without arguments, all currently defined
functions are listed.  Those definitions from the current circuit will
be shown with an asterisk `{\vt *}' in the first column.  Other
functions listed have been defined with the {\cb define} command.  The
functions defined in subcircuits are invisible, their use is only
transient and they are part of the database only during subcircuit
expansion.

If only a function name is given, any definitions for functions with
the given name are printed.

It is possible to define a function that calls a non-existing
function.  The resolution is done when the function is evaluated. 
Thus, functions of functions can be defined in any order.

Note that one may have different functions defined with the same name
but different argument counts.  Some useful definitions (which are
part of the default environment) are:
\begin{quote} \vt
define max(x,y) x > y ? x : y\\
define min(x,y) x < y ? x : y
\end{quote}

%SU-------------------------------------
\subsection{\spcmd{deftype}}
\index{deftype command}

% spCommands.hlp:deftype 012009

The {\cb deftype} command defines a new data type.
\begin{quote}\vt
    deftype v {\it typename} [{\it abbrev\/}]\\
    deftype p {\it plottype} [{\it pattern} ...]
\end{quote}
This is an obscure command that might be useful for exporting rawfile
data to other programs.  If a vector's value indicates furlongs per
fortnight, its type can be so defined.  However, user-defined types
are not compatible with the internal {\WRspice} type propagation
logic.  Vectors with user-defined types, or results involving
user-defined types, will be treated as untyped in {\WRspice}.

The first form defines a new type for vectors.  The {\it typename} may
then be used as a vector type specification in a rawfile.  If an {\it
abbrev} is given, values of that type can be named {\it abbrev}({\it
something}) where {\it something} is the name given in the rawfile
(and {\it something} doesn't contain parentheses).

The second form defines a plot type.  The (one word) name for a plot
with any of the patterns present in its plot type name as given in the
rawfile will be {\it plottype}N, where N is a positive integer
incremented every time a rawfile is read or a new plot is defined.

%SU-------------------------------------
\subsection{\spcmd{diff}}
\index{diff command}

% spCommands.hlp:diff 012009

The {\cb diff} command compares vectors in different plots.
\begin{quote}\vt
diff {\it plot1 plot2} [{\it vecname} ...]
\end{quote}
The command will compare all the vectors in the specified
plots, or only the named vectors if any are given.  If there are
different vectors in the two plots, or any values in the vectors
differ significantly, the difference is reported.  The variables {\et
diff\_abstol}, {\et diff\_reltol}, and {\et diff\_vntol} are used to
determine if two values are ``significantly'' different.

%SU-------------------------------------
\subsection{\spcmd{display}}
\index{display command}

% spCommands.hlp:display 012009

The {\cb display} command prints information about the named vectors,
or about all vectors in the current plot if no names are given.
\begin{quote}\vt
display [{\it vecname} ...]
\end{quote}
This command will list the names, types and lengths of the vectors,
and whether the vector is real or complex.

Additional information is also given:  if there is a minimum or
maximum value for the vector defined, this is listed (see
\ref{rawfilefmt} for the manner in which this and the rest of the
per-vector parameters are defined), if there is a default grid type or
a default plot type, they are mentioned, and if there is a default
color or a default scale for the vector it is noted.  Additionally,
one vector in the plot will have the notation {\vt [default scale]}
appended --- this vector will be used as the x-scale for the {\cb
plot} command if none is given or if the vectors named have no default
scales of their own.  See the {\cb plot} command (\ref{plotcmd}) for
more information on scales.

The vectors are sorted by name unless the variable {\et nosort} is
set.  The {\cb let} command without arguments is equivalent to the
{\cb display} command without arguments.

%SU-------------------------------------
\subsection{\spcmd{fourier}}
\index{fourier command}

% spCommands.hlp:fourier 012009

The {\cb fourier} command performs Fourier analysis.
\begin{quote}\vt
fourier {\it fundamental\_frequency} [{\it value} ...]
\end{quote}
The command initiates a fourier analysis of each of the given values,
using the first 10 multiples of the fundamental frequency (or the
first {\vt nfreqs}, if that variable is set).  The values may be any
valid expression.  They are interpolated onto a fixed-space grid with
the number of points given by the {\et fourgridsize} variable, or 200
if it is not set.  The interpolation will be of degree {\et
polydegree} if that variable is set, or 1.  If {\et polydegree} is 0,
then no interpolation will be done.  This is likely to give erroneous
results if the time scale is not monotonic.  This command is executed
when a {\vt .four} line is present in the input file and {\WRspice} is
being run in batch mode.

%SU-------------------------------------
\subsection{\spcmd{let}}
\index{let command}

% spCommands.hlp:let 060314

The {\cb let} command is used to assign vectors.
\begin{quote}\vt
let [{\it vecname} [= {\it expr\/}]] [{\it vecname} = {\it expr\/} ...]
\end{quote}
With no arguments, the list of vectors from the current plot is
printed, similar to the {\cb display} command.  If one or more
arguments appear without an assignment, information about the named
vectors is printed, similar to the {\cb display} command.  Otherwise,
for each assignment, if {\it vecname} does not exist, a new vector is
created with name {\it vecname} and value given by the expression {\it
expr\/}.  An existing vector with the given name will be overwritten
with new data.

In {\WRspice} releases prior to 3.0.9, only a single assignment could
appear in a {\cb let} command.  In current releases, any number of
assignemnts can be given in a single command line.  The assignments
are performed left-to-right, so that expressions to the right of an
assignment may make use of that assignment, i.e., forms like
\begin{quote}
\vt let a=1 b=a
\end{quote}
work properly.

None of the vector options such as default scale, color, etc.  that
are read from the rawfile are preserved when a vector is created with
the {\cb let} command.

The {\it vecname} above can actually be in the {\it plotname\/}.{\it
vecname} format, where the {\it plotname} is the name of a plot or one
of the plot aliases as described in \ref{vectors}.  In this case, only
the indicated plot will be searched for a vector named {\it
vecname\/}, and if not found, a new vector of that name will be
created in the indicated plot.

If no plot is specified, a search for {\it vecname} will occur in the
current plot, then the context plot if any, and finally the {\vt
constants} plot.  If a match is found, that vector will be reused,
which may not be what is intended.  When a scrpt is run, the current
plot at the time the script starts is saved as the ``context plot''. 
Vectors created in the script before any change in the current plot
are saved in the context plot.  If the script runs an analysis, the
current plot will change, but the previously defined variables will
still be available by name as the context plot will be searched as
well as the current plot.

If the intention is to use or create a vector in the current plot,
the form
\begin{quote}
{\vt let curplot}.{\it vecname} {\vt =} {\it expr}
\end{quote}
should be used, if there is any chance of ambiguity.

The syntax
\begin{quote}
{\vt let a[N] = {\it vec\/}}
\end{quote}
with {\vt N} a non-negative integer, is valid.  If {\it vec\/} is a
vector, then {\vt a[N] = {\it vec\/}[0]}, {\vt a[N+1] = {\it
vec\/}[1]}, etc., If undefined, {\vt a} is defined, and new entries
that are not explicitly set are zeroed.  The length of {\vt a} is set
or modified to accommodate {\it vec\/}.  The syntax {\vt a[0] = {\it
vec\/}} is also valid, and is equivalent to {\vt a = {\it vec\/}}.  If
{\it vec\/} is a vector, then {\vt a} is a copy of {\it vec\/}.  If
{\it vec\/} is a scalar (unit length vector), then {\vt a} is also a
scalar with the value of {\it vec\/}. 

When assignment is from a scalar value, any SPICE number format may be
used.  That is, if alpha characters appear after a number, the initial
characters are checked as a scale factor.  Recognized sequences are t,
g, k, u, n, p, f, m, meg, mil.  Remaining characters are parsed as a
units string.  This is all case insensitive.

The units suffix of a constant value is used to assign the units
of any vector to which the constant is assigned.  This means, for
example, in
\begin{quote}\vt
    let a = v(1)/15o
\end{quote}
{\vt a} has units of current (A).  Use the {\cb settype} command
without arguments to see a list of recognized types.

The ``let'' is actually optional; the {\cb let} command will be
applied to a line with the second token being ``=''.  This is somewhat
less efficient, however.

%SU-------------------------------------
\subsection{\spcmd{linearize}}
\index{linearize command}

% spCommands.hlp:linearize 012009

This {\cb linearize} command is used to create linearized vectors from
vectors whose scales are not evenly spaced. 
\begin{quote}\vt
linearize [{\it vecname\/} ...]
\end{quote}
The command will force data from a transient analysis to conform to a
linear scale, if the plot has been created using raw timepoints.  This
is the case only when the {\et steptype} variable is set to ``{\vt
nousertp}''. 

The {\cb linearize} command will create a new plot with all of the
vectors in the current plot, or only those mentioned if arguments are
given.  The new vectors will be interpolated onto a linear time scale,
which is determined by the values of {\vt tstep}, {\vt tstart}, and
{\vt tstop} in the currently active transient analysis.  The currently
loaded deck must include a transient analysis, or a {\cb tran} command
may be run interactively, and the current plot must be from this
transient analysis.  The variable {\et polydegree} determines the
degree of interpolation.

%SU-------------------------------------
\subsection{\spcmd{pick}}
\index{pick command}

% spCommands.hlp:pick 012009

The {\cb pick} command creates a new vector from elements of other vectors.
\begin{quote}\vt
pick {\it vecname offset period vector} [{\it vector ...\/}]
\end{quote}
The command creates a vector {\it vecname} and fills it with every
{\it period\/}'th value starting with {\it offset} from the vectors. 
The {\it offset} and {\it period} are integers.  For example, for
\begin{quote}\vt
    pick xx 1 2 v1 v2
\end{quote}
we obtain
\begin{quote}\vt
  xx[0] = v1[1]\\
  xx[1] = v2[1]\\
  xx[2] = v1[3]\\
  xx[3] = v2[3]\\
\end{quote}
and so on.

%SU-------------------------------------
\subsection{\spcmd{seed}}
\index{seed command}

% spCommands.hlp:seed 032715

The {\cb seed} command will reset the internal random number generator.
\begin{quote}\vt
seed [{\it seed\_integer\/}]
\end{quote}
The {\it seed\_integer\/}, if given, will be used to seed the new
random number sequence.  This affects the statistical functions in
\ref{statfuncs} and other functions that generate random values. 
Setting the seed explicitly enables the sequence of ``random'' values
returned from these functions to be repeatable (the default seed is
random).

%SU-------------------------------------
\subsection{\spcmd{setdim}}
\index{setdim command}

% spCommands.hlp:setdim 022015

The {\cb setdim} command allows the dimensions of the current plot to
be changed.

\begin{quote}
{\vt setdim} [{\it numdims} [{\it dim} ...]]
\end{quote}
  
If given without arguments, the length and dimensions of the scale
vector of the current plot are printed.  Otherwise, all arguments are
non-negative numbers.  There should be {\it numdims\/}-1 ``{\it
dims}'' given.  The {\it numdims} is the new dimensionality of the
plot.  Values of 0--8 are allowed.  The sub-dimensions that follow are
integers 2 or larger.

The dimension list must be compatible with the existing plot
dimensions in that the total number of points must remain the same,
and the size of the basic vector (scale period) remains the same.

There is a special case where the {\it numdims} is the same as the
vector length.  The plot will become multidimensional, with each
dimension having one point.  There is no limit to the number of
dimensions in this case.  Such vectors plot as collections of
multi-colored points.  This type of plot is generated normally by, for
example, use of the {\cb loop} command to repeat op analysis. 
Additional argumens to the command are ignored.

Giving {\it numdims} a value of 0 or 1 will set to ``no''
dimensionality, the status of a regualar vector.

%SU-------------------------------------
\subsection{\spcmd{setplot}}
\index{setplot command}

% spCommands.hlp:setplot 040410

The {\cb setplot} command can be used to set the current plot, or to
create a new, empty plot and make it the current plot.
\begin{quote}\vt
setplot [{\it plotname\/}]
\end{quote}
Here, the word ``plot'' refers to a group of vectors that are the
result of one {\WRspice} simulation run.  Plots are created in memory
during a simulation run, or by loading rawfile data.  When more than
one file is loaded in, or more than one plot is present in one file,
{\WRspice} keeps them separate and only shows the vectors in the
current plot.  One generally accesses a given plot by first making it
the current plot. 

The same functionality is available from the {\cb Plots} button in the
{\cb Tools} menu.  The {\cb setplot} command will set the current plot
to the plot with the given {\it plotname\/}, or if no name is given,
prompt the user with a menu.  The plots are named as they are loaded,
by reading in a rawfile, or created by running a simulation, with
names like {\vt tran1} or {\vt ac2}.  These names are shown by the
{\cb setplot} and {\cb display} commands and are used by other
commands.

The {\it plotname} can also be a numerical index.  Plots are saved in
the order created, and as listed by the {\cb setplot} command without
arguments, and in the {\cb Plots} tool.  In addition to the plot name,
the following constructs are recognized.  Below, {\it N} is an
integer.

\begin{description}
\item{\vt -}{\it N}\\
Use the {\it N\/}'th plot back from the current plot.  {\it N} must be
1 or larger.  For example, ``{\vt setplot -1}'' will set the current
plot to the previous plot.  The command will fail if there is no such
plot.

\item{\vt +}{\it N}\\
This goes in the reverse direction, indicating a plot later in the 
list than the current plot.

\item{\it N}\\
An integer without {\vt +} or {\vt -} indicates an absolute index into
the plot list, zero-based.  The value 0 will always indicate the
``constants'' plot, which is the first plot created (on program
startup).
\end{description}

If the {\it plotname} is ``{\vt new}'', a new plot is created, which
becomes the current plot.  This plot has no vectors.

The current plot can also be changed by resetting the {\et curplot}
variable.  There are three read-only variables which are reset
internally whenever the current plot changes.  Each contains a string
describing a feature of the current plot.  These are {\et
curplotdate}, {\et curplotname}, and {\et curplottitle}.

%SU-------------------------------------
\subsection{\spcmd{setscale}}
\index{setscale command}

% spCommands.hlp:setscale 012009

The {\cb setscale} command is used to set the vector used as a scale
when plotting other vectors.
\begin{quote}\vt
setscale [{\it plot\/} or {\it vector\/}] [{\it vectors} ...]
\end{quote}
Each plot has a default scale, which can be set with this command. 
Each vector has a scale variable, which if set will override the
default scale of the plot.  These also can be set with this command. 
This command takes as input the names of a plot and a new scale vector
in that plot, or the names of vectors from the current plot.  The
wildcard forms using ``{\vt all}'' and the plot prefix form {\it
plot\/}.{\it vector} are not allowed in this command.  If only one
argument is given, i.e.
\begin{quote}
{\vt setscale} {\it vector}
\end{quote}
then {\it vector} is assigned as the default scale of the current plot.
The vector must already exist in the current plot.

If two arguments are given, the first argument is initially
interpreted as the name of a plot, and the second argument is the name
of a vector in that plot to use as the scale.  The plot has names like
``{\vt tran1}'' or ``{\vt ac2}'' and the {\it vector} must exist in
that plot.

If the first argument is not a plot name, or there are more than two
arguments, the arguments are expected to be vectors in the current
plot, and the last vector will be assigned as the scale for the other
listed vectors.

The scales assigned to vectors can be removed by assigning the vector
that is the current default scale for the plot, or the scale vector
name given can have the special names ``{\vt none}'' or ``{\vt
default}''.  The scale for plots can't be removed, since a plot must
always have a default scale (if any vectors are defined).

The {\cb let} command without arguments lists the vectors and will
show the scales, if any.

%SU-------------------------------------
\subsection{\spcmd{settype}}
\index{settype command}
\label{settype}

% spCommands.hlp:settype 012009

The {\cb settype} command is used to change the data types
of the vectors in a plot.
\begin{quote}\vt
settype [{\it type\/}] [{\it vector} ...]
\end{quote}
The command will change the type of the named vectors to {\it type\/}. 
With no arguments, the list of recognized types and abbreviations is
printed.  The {\it type} field can consist of a single name, or a
single token containing a list of abbreviations.  The token list can
contain a digit power after an abbreviation, and a single `/' for
denominator units.  Examples are ``F/M2'', ``Wb2/Hz''.  Units of
vectors generated during analysis are set automatically.

The {\WRspice} numerical input format (see \ref{number}) allows the
type to be specified when a value is given to {\WRspice}, either
interactively or in an input file.

Type names can also be found in the description of the rawfile format
in \ref{rawfilefmt}, or they may be defined with the {\cb deftype}
command.  However, only the primitive types listed below propagate
through expressions and are recognized by the {\WRspice}
type-propagation system.

The primitive built-in types and abbreviations are:
\begin{quote}
\begin{tabular}{|l|c|}\hline
\vt time        & S\\ \hline
\vt frequency   & Hz\\ \hline
\vt voltage     & V\\ \hline
\vt current     & A\\ \hline
\vt charge      & Cl\\ \hline
\vt flux        & Wb\\ \hline
\vt capacitance & F\\ \hline
\vt inductance  & H\\ \hline
\vt resistance  & O\\ \hline
\vt conductance & Si\\ \hline
\vt length      & M\\ \hline
\vt area        & M2\\ \hline
\vt temperature & C\\ \hline
\vt power       & W\\ \hline
\end{tabular}
\end{quote}

The codes from the rawfile are:
\begin{quote}
\begin{tabular}{|l|c|c|}\hline
Name         & Description          & SPICE2 Numeric Code\\ \hline\hline
{\vt notype}       & Dimensionless value  & 0\\ \hline
{\vt time}         & Time                 & 1\\ \hline
{\vt frequency}    & Frequency            & 2\\ \hline
{\vt voltage}      & Voltage              & 3\\ \hline
{\vt current}      & Current              & 4\\ \hline
{\vt output-noise} & SPICE2 .noise result & 5\\ \hline
{\vt input-noise}  & SPICE2 .noise result & 6\\ \hline
{\vt HD2}          & SPICE2 .disto result & 7\\ \hline
{\vt HD3}          & SPICE2 .disto result & 8\\ \hline
{\vt DIM2}         & SPICE2 .disto result & 9\\ \hline
{\vt SIM2}         & SPICE2 .disto result & 10\\ \hline
{\vt DIM3}         & SPICE2 .disto result & 11\\ \hline
{\vt pole}         & SPICE3 pz result     & 12\\ \hline
{\vt zero}         & SPICE3 pz result     & 13\\ \hline
\end{tabular}
\end{quote}

%SU-------------------------------------
\subsection{\spcmd{spec}}
\index{spec command}

% spCommands.hlp:spec 012009

The {\cb spec} command will create a new plot consisting of the
Fourier transforms of the vectors given on the command line.
\begin{quote}\vt
spec {\it start\_freq stop\_freq step\_freq vector} [...]
\end{quote}
This is based on a SPICE3 {\cb spec} command by Anthony Parker of
Macquarie University in Sydney Australia, which is available as part
of the patch set from\\
{\vt http://www.elec.mq.edu.au/cnerf/spice/spice.html}.

The command will create a new plot consisting of the Fourier
transforms of the vectors given on the command line.  Each vector
given should be a transient analysis result, i.e., have time as a
scale, and each should have the same time scale.  The Fourier
transform will be computed using the frequency parameters given, and
will use a window function as given with the {\et specwindow}
variable.

The following variables control operation of the {\cb spec} command. 
Each can be set with the {\cb set} command, or equivalently from the
{\cb Fourier} tab of the {\cb Commands} tool.

\begin{description}
\index{spectrace variable}
\item{\et spectrace}\\
This enables messages to be printed during Fourier analysis with the
{\cb spec} command, for debugging purposes.

\index{specwindow variable}
\item{\et specwindow}\\
This variable is set to one of the following strings, which will
determine the type of windowing used for the Fourier transform in the
{\cb spec} command.  If not set, the default is {\vt hanning}.

\begin{tabular}{ll}
\vt bartlet & Bartlet (triangle) window\\
\vt blackman & Blackman order 2 window\\
\vt cosine & Hanning (cosine) window\\
\vt gaussian & Gaussian window\\
\vt hamming & Hamming window\\
\vt hanning & Hanning (cosine) window\\
\vt none & No windowing\\
\vt rectangular & Rectangular window\\
\vt triangle & Bartlet (triangle) window\\
\end{tabular}

\index{specwindoworder variable}
\item{\et specwindoworder}\\
This can be set to an integer in the range 2--8.  This sets the order
when the gaussian window is used in the {\cb spec} command.  If not
set, order 2 is used.
\end{description}

%SU-------------------------------------
\subsection{\spcmd{undefine}}
\index{undefine command}

% spCommands.hlp:undefine 012009

The {\cb undefine} command is used to undefine user-defined functions
that have previously been defined with the {\cb define} command.
\begin{quote}\vt
undefine {\it word} [...]
\end{quote}
The command deletes the definitions of the user-defined functions
passed as arguments.  If the argument is ``*'', then all macro
functions are deleted.  Note that all functions with the given names
are removed, so there is no way to delete a function with a particular
argument count without deleting all functions with that name.

%SU-------------------------------------
\subsection{\spcmd{unlet}}
\index{unlet command}

% spCommands.hlp:unlet 012009

The {\cb unlet} command will delete the vectors listed as arguments. 
\begin{quote}\vt
unlet {\it vecname} [...]
\end{quote}
The current plot is assumed, though the {\it plot\/}.{\it vector}
notation is accepted.  When the default scale vector is deleted,
another random vector will become the default scale.  The names can be
``{\vt all}'', indicating that all matching vectors should be removed. 
If the vector name is ``{\vt all}'', all vectors in the plot are
removed, but the plot itself is not deleted.  Giving ``{\vt all.all}''
will clear the vectors in all plots (not very useful).  To delete a
plot, use the {\cb destroy} or {\cb free} commands.


%S-----------------------------------------------------------------------------
\section{Graphical Output Commands}
\label{grout}

% spPlot.hlp:graphcmds 012209

The following commands display the output of simulations graphically,
either on-screen or on a printing device.  Many take as input a list of
vectors or expressions to plot, and in some cases ambiguities may arise.
An example would be
\begin{quote}
{\vt plot v(1) -v(2)}
\end{quote}
which would be interpreted as a plot of the difference between the 
vectors (1 trace) rather than two traces.  To resolve such ambiguities, 
double quotes may be used, as in 
\begin{quote}
{\vt plot v(1) "-v(2)"}
\end{quote}
which enforses interpretation as separate expressions.  Additional
parentheses may also be used to the same effect.

In the expression list, a ``.'' token is replaced with the vector list
found in a {\vt .plot} line from the file with the same analysis type
as the current plot.  For example, if the input file contained
\begin{quote}\vt
   .tran .1u 10u\\
   .plot tran v(1) v(2)\\
\end{quote}
then one can type ``{\vt run}'', then ``{\vt plot .}'' to plot {\vt
v(1)} and {\vt v(2)}.

\begin{tabular}{|l|l|}\hline
\multicolumn{2}{|c|}{Graphical Output Commands}\\ \hline
\cb asciiplot & Generate line printer plot\\ \hline
\cb combine & Combine plots\\ \hline
\cb hardcopy & Send plot to printer\\ \hline
\cb iplot & Plot during simulation\\ \hline
\cb mplot & Plot range analysis output\\ \hline
\cb plot & Plot simulation results\\ \hline
\cb plotwin & Pop down and destroy plot windows\\ \hline
\cb xgraph & Plot simulation results using {\vt xgraph}\\ \hline
\end{tabular}

%SU-------------------------------------
\subsection{\spcmd{asciiplot}}
\index{asciiplot command}

% spPlot.hlp:asciiplot 012209

The {\cb asciiplot} command generates a crude plot on a character mode
device.  It is not often used in modern environments, but is retained
for compatibility with SPICE2.
\begin{quote}\vt
asciiplot {\it plotargs}
\end{quote}
The {\it plotargs} are vectors or expressions to be plotted, as with
the {\cb plot} command.  The plot is sent to the standard output, so
one can put it into a file by using redirection.  The variables {\et
width}, {\et height}, and {\et nobreak} determine the width and height
of the plot, and whether there are page breaks, respectively, though
if the {\cb asciiplot} is printed on-screen or in a window, the plot
width and height are determined by the window size.

There are problems if one tries to plot something with an X scale that
is not monotonic, because {\cb asciiplot} uses a simple-minded sort of
linear interpolation.  Also, most of the variables that the {\cb plot}
command recognizes aren't used by {\cb asciiplot}.  The scaling and
other variables can be set with the {\cb set} command as for the {\cb
plot} command.  These variables can also be set with the {\cb Plot
Options} tool from the {\cb Tools} menu of the {\cb Tool Control}
window.

The {\et nointerp} variable is used only by the {\cb asciiplot}
command.  Normally {\cb asciiplot} interpolates data onto a linear
scale before plotting it.  If this option is given this won't be done
--- each line will correspond to one data point as generated by the
simulation.  Since data are already linearized unless from a transient
analysis with {\et steptype} set to {\vt nousertp}, setting this
variable will avoid a redundant linearization.

Ordinarily, the first vector plotted has its values also printed in
the first column.  This can be suppressed by setting the variable {\et
noasciiplotvalue}.  When printing, the number of significant digits
used can be set with {\et numdgt} variable.

This command is completely obsolete, but is retained for nostalgia for
those who fondly remember punched cards and line printers.

%SU-------------------------------------
\subsection{\spcmd{combine}}
\index{combine command}

% spPlot.hlp:combine 012209

The {\cb combine} command takes no arguments.  The command will
combine the two most recent plots, if similar, into a single plot, and
expands the dimensionality of the resulting plot.  The two plots must
have identical vector names and compatible lengths.  The purpose of
this command is to create a single multi-dimensional plot from
sequences of runs.  The most recent plot is added to the end of the
previous plot, and is deleted.

Example:
\begin{quote}
{\vt\raggedright
while i < 5\\
\qquad {\rm (set parameters for run)}\\
\qquad run\\
\qquad if i > 0\\
\qquad\qquad combine\\
\qquad end\\
\qquad i = i + 1\\
end}
\end{quote}

This will combine all the data from the five runs into a single
plot.

%SU-------------------------------------
\subsection{\spcmd{hardcopy}}
\index{hardcopy command}

% spPlot.hlp:hardcopy 012209

The {\cb hardcopy} command is used to generate hardcopy plots of
simulation data on a printer or plotter.  This capability is similar
to the {\cb Print} button which appears on each of the on-screen plots
from the {\cb plot} command.
\begin{quote}\vt
hardcopy [{\it setupargs\/}] {\it plotargs\/}\\
setupargs: -d {\it driver} -c {\it command} -f {\it filename}
 -r {\it resolution} -w {\it width} -h {\it height}\\
 -x {\it left\_marg} -y {\it top\_marg} -l
\end{quote}
This command uses the internal hardcopy drivers to generate a hard
copy of the vectors and expressions given in {\it plotargs}.  The {\it
plotargs} are vectors or expressions to be plotted, as with the {\cb
plot} command.  If no {\it plotargs} are provided, the arguments are
taken to be the same as those given to the last plotting command given
(these include {\cb plot}, {\cb asciiplot}, {\cb hardcopy}, and {\cb
xgraph}).  The {\it setupargs} override the current values established
using the {\cb set} command or the {\cb Plot Options} tool in the {\cb
Tools} menu, and default to the driver defaults if not specified
either way.

The {\vt -d} {\it driver} specifies the name of a hardcopy driver
using one of the keywords known to the {\et hcopydriver} variable.  If
the {\vt -d} option is not specified, the {\et hcopydriver} variable
will be used if set.  If no driver is set, or set to an unrecognized
driver name, the hardcopy is aborted.

The {\vt -c} {\it command} option specifies the operating system
command used to send the job to the printer, and overrides the value
of the {\et hcopycommand} variable, which is otherwise used if set. 
The value is a string (which must be quoted it it contains space),
where the characters ``{\vt \%s}'' are replaced by the name of the
(possibly temporary) file used to store the plot data.  If no {\vt
\%s} appears, the file name is appended to the end of the command
string.  In BSD Unix, the command string might be ``{\vt lpr -h
-Pmyprinter}'', for example.  See the man page for the print command
on your machine for more information.  If there is no command string
given using the {\vt -c} option and {\et hcopycommand} is undefined,
the data will be saved in a file, but not printed.

The {\vt -f} {\it filename} option gives a file name to store the plot
data.  There is no analogous ``set'' variable.  If given, the plot
will be saved in the file, and {\it not} sent to the printer.

The {\vt -r} {\it resolution} command will set the printer to use the
specified resolution, if that resolution is supported by the driver
and the printer.  If not given, the value of {\et hcopyresol} is used,
if set, otherwise the driver default is used.  The default is almost
always the best choice.

The {\vt -w} {\it width} and {\vt -h} {\it height} options set the
size of the image as it would appear on a portrait-oriented page.  The
numbers given represent inches, unless followed by ``cm'' which
indicates centimeters.  If these options are not given, the {\et
hcopywidth} and {\et hcopyheight} variables are used if set, otherwise
the driver defaults are used.

The {\vt -x} {\it xoffset} and {\vt -y} {\it yoffset} options control
the position of the image on the page, as defined in portrait
orientation.  The {\it yoffset} may be measured from the top or bottom
of the page, depending upon the driver.  These values default to those
in the variables {\et hcopyxoff} and {\et hcopyyoff} if set, otherwise
driver defaults are used.  The numbers represent inches, unless
followed by ``cm'' indicating centimeters.

If the {\vt -l} option is given, or the {\et hcopylandscape} variable
is set, the image will be rotated and printed in landscape
orientation.

The variables which control plot presentation also control the
presentation of the hardcopy (see \ref{plotcmd}).  The hardcopy
command is suited for use in scripts.  For general plotting, the {\cb
Print} button in the {\cb plot} windows brings up a panel which
provides a superior user interface.
 
%SU-------------------------------------
\subsection{\spcmd{iplot}}
\index{iplot command}

% spPlot.hlp:iplot 022519

The {\cb iplot} command adds an incremental plot to the ``runop'' list.
While a simulation is running, the plots will be generated, allowing
immediate feedback as to whether the simulation is producing the
``right'' results.
\begin{quote}\vt
iplot {\it plotargs}
\end{quote}
The {\it plotargs} are vectors or expressions to be plotted, as with
the {\cb plot} command.  The variables which control plotting also
apply to iplots.  These are set with the {\cb set} command, or with
the {\cb Plot Options} tool in the {\cb Tools} menu of the {\cb Tool
Control} window.

The argument list can not be empty.  Similar to the {\cb plot}
command, if the argument list contains a token consisting of a single
period (``{\vt .}''), this is replaced with the vector list found in
the first {\vt .plot tran} line from the input file.  For example, if
the input file contains
\begin{quote} \vt
.plot tran v(1) v(2)
\end{quote}
then one can type ``{\vt iplot .}'' as a short cut for ``{\vt iplot
v(1) v(2)}''.

The related syntax {\vt .@}{\it N} is also recognized, where {\it N}
is an integer representing the {\it N\/}'th matching {\vt .plot tran}
line.  The count is 1-based, but {\it N\/}=0 is equivalent to {\it
N\/}=1.  The token is effectively replaced by the vector list from the
specified {\vt .plot tran} line found in the circuit deck.

The iplots can be deleted with the {\cb delete} command, and can also
be specified and deleted using the panel brought up by the {\cb Trace}
button in the {\cb Tools} menu.  The {\cb status} command will list
the runops, including iplots.

If an {\cb iplot} command is given at the prompt in interactive mode,
it is placed in a global list, and activity will persist until deleted
(with the {\cb delete} command or with the {\cb Trace} tool).  If the
command is given in a file, the command will be added to a list for
the current circuit, and will apply only to that circuit.  Thus, for
example, a {\WRspice} file can contain lines like
\begin{quote}\vt
*\# iplot v(1)
\end{quote}
and the iplot will be performed as that circuit is run, but the ``{\vt
iplot v(1)}'' directive will not apply to other circuits.

%SU-------------------------------------
\subsection{\spcmd{mplot}}
\label{mplot}
\index{mplot command}

% spPlot.hlp:mplot 041711

The {\cb mplot} command is used to plot the results from margin analysis,
which includes operating range and Monte Carlo analyses.  It is also used
to set and clear interactive margin analysis plotting.
\begin{quote}\vt
mplot [[-on|-off] | [-c][{\it filename} ...] | {\it vector\/}]
\end{quote}
The {\it filenames} are names of files produced by the margin
analysis.  If no file is specified, the file produced by the last
margin analysis run in the current session is assumed.  If no margin
analysis files have been produced in the current session, the file
named ``{\vt check.dat}'' is assumed.  It is also assumed that these
files exist in the current directory.  The name of the most recent
margin analysis output file produced in the current session is saved
in the {\et mplot\_cur} variable.

The results from operating range/Monte Carlo analysis are also hidden
away in the resulting plot structure.  The {\cb mplot} can be displayed by
entering ``{\vt mplot} {\it vector}'' where {\it vector} is any vector
in the plot.

The {\it vector} can actually be any multi-dimensional vector, from
margin analysis or not.  The selections (see below) can then be used
to determine which dimensions are displayed in subsequent plots.

The {\vt -c} option combines the operating range data from the files
on the command line into a single display, if possible.  Thus, if two
or more successive operating range analysis runs are required to
obtain the total operating range, then it is possible to plot all of
the results on a single graph with the {\vt -c} option.  The data must
have identical coordinate spacing and projected origins to be
combinable.

There are two switches, {\vt -on} and {\vt -off}, which control
whether or not operating range analysis results are plotted on the
screen during analysis, similar to the {\cb iplot} command.  Entering
{\vt mplot -on} will cause margin analysis results to be plotted while
simulating, and {\vt mplot -off} will turn this feature off.

The display consists of an array of cells, each of which represent the
results of a single trial.  As the results become available, the cells
indicate a pass or fail.  In operating range analysis, the cells
indicate a particular bias condition according to the axes.  In Monte
Carlo analysis, the position of the cells has no significance.  In
this case the display indicates the number of trials completed.

The panel includes a {\cb Help} button which brings up the appropriate
topic in the help system, a {\cb Redraw} button to redraw the plot if,
for example, the plotting colors are redefined, and a {\cb Print}
button for generating hard copy output of the plot.

Text entered while the pointer is in the {\cb mplot} window will
appear in the plot, and hardcopies.  This text, and other text which
appears in the plot, can be edited in the manner of text in {\cb plot}
windows.

\subsubsection{Selections}

The cells in an {\cb mplot} can be selected/deselected by clicking on
them.  Clicking with button 1 will select/deselect that cell.  Using
button 2, the row containing the cell will be selected or deselected,
and with button 3 the column will be selected or deselected.  A
selected cell will be shown with a colored background, with an index
number printed.

Only one {\cb mplot} window can have selections.  Clicking in a new
window will deselect all selections in other {\cb mplot} windows.

At present, the selections are used to facilitate plotting of
multidimensional plots, such as those obtained from the {\vt -k}
option of the {\cb check} command.  If selections exist, only the data
from the selected cells will be plotted from the associated
multidimensional vectors in the {\cb plot} command.

For example, after running ``{\vt check -k}'', suppose one has a
resulting vector v(1) (which will contain data from all of the
trials).  If not using ``{\vt mplot -on}'' during the run, one can
type ``{\vt mplot}'' after the run to display the pass/fail results. 
In the {\cb mplot} window, select one of the cells.  Then, ``{\vt plot
v(1)}'' will plot the v(1) from that trial only.  If no cells are
selected, or all cells are selected, ``{\vt plot v(1)}'' would show
the superimposed v(1) traces from all trials.  The index number that
appears in the cell is the vector index, so for example if a single
box is selected with index 4, ``{\vt plot v(1)}'' would be equivalent
to ``{\vt plot v(1)[4]}''.  Note that the selection mechanism allows
combinations of traces to be plotted which can't easily be obtained
from indexing.

This capability is carried a step further for general multidimensional
plots.  If one enters ``{\vt mplot} {\it vector}'' where {\it vector}
is the name of a multidimensional vector from whatever source, an {\cb
mplot} will appear.  If the vector originated from operating range or
Monte Carlo analysis, the resulting {\cb mplot} will appear (the
pass/fail results are saved in the plot structure, as well as in the
output file).  Otherwise, the {\cb mplot} has nothing to do with range
analysis, and all cells are marked "fail".  Either case allows the
selection mechanism to be used for displaying the plots.

Suppose for example one has a multidimensional plot from a
loop-transient analysis.  Entering ``{\vt mplot time}'' will bring up
a dummy {\cb mplot} whose cells represent the loop iterations (time is
the scale vector for the plot, but any data vector in the plot would
suffice).  Then, by selecting the cells, one can choose which
iterations will be visible when vectors from the plot are plotted with
the {\cb plot} command.

The plot window will use a ``flat'' dimension map which can
subsequently be used to control which dimensions are visible.  The
mplot selections set the initial state of this map.

%SU-------------------------------------
\subsection{\spcmd{plot}}
\index{plot command}
\label{plotcmd}

% spPlot.hlp:plot 052411

The {\cb plot} command is used to plot simulation output on-screen. 
Each execution of a {\cb plot} command will bring up a window which
displays the plot, along with several command buttons.  Each plot will
remain on-screen until dismissed with the {\cb Dismiss} button.
\begin{quote}\vt
plot [{\it expr} ... ] [vs {\it x-expr}] [{\it attributes\/}]
\end{quote}
The set of expressions can be followed with a ``{\vt vs} {\it x-expr}''
clause, which will produce an x-y plot using the values of {\it
x-expr} as the x scale.

If no arguments are given, the arguments to the last given {\cb plot}
command are used.  If the argument list contains a token consisting of
a single period (``.''), this is replaced with the vector list found
in the first {\vt .plot} line from the input file with the same
analysis type as the current plot.  For example, if the input file
contains
\begin{quote}\vt
    .tran .1u 10u\\
    .plot tran v(1) v(2)\\
\end{quote}
then one can type ``{\vt run}'' followed by ``{\vt plot .}'' to plot
{\vt v(1)} and {\vt v(2)}.

The related syntax {\vt .@}{\it N} is also recognized, where {\it N}
is an integer representing the {\it N\/}'th matching {\vt .plot} line. 
The count is 1-based, but {\it N\/}=0 is equivalent to {\it N\/}=1. 
The token is effectively replaced by the vector list from the
specified {\vt .plot} line found in the circuit deck.

Vectors and expression results will be interpolated to the scale used
for the plot.  This applies when using forms like ``{\vt tran2.v(2)}''
where the {\vt tran2} may have a different scale, for example the
x-increment may be different, or the data may correspond to internal
time points vs.  user time points.

The plot style can be controlled by a number of variables (listed
below), which can be set with the {\cb set} command.  These define
default behavior, as the plot window contains buttons which also
determine presentation.  The {\cb Plot Options} tool from the {\cb
Tools} menu of the {\cb Tool Control} window can also be used to set
these variables.  The {\cb Colors} tool from the {\cb Tools} menu can
be used to change the colors used for plotting.

For each of the variables listed in the table below with an asterisk
in the middle column, if a variable named {\et \_temp\_}{\it varname}
is defined, its value will be used rather than that of {\it varname}. 
This allows temporary overriding of the nominal settings of the
variables, and is used internally for the zoom-in operation.  In
addition, there are certain variables such as {\et gridstyle} which
can be set to one of several keywords.  If the keyword itself is set
as a boolean variable, it will override the string variable.  For
example, one could issue ``{\vt set gridstyle = lingrid}'' to set a
nominally linear grid.  This can be changed by, for example, ``{\vt
set loglog}'' (or ``{\vt set \_temp\_loglog}''), but it is an error to
have two or more such keywords set as booleans at a time.

The variables with an asterisk in the middle column can appear in a
{\vt .options} line in a circuit file.  The option will be in force
when the circuit containing this line is the current circuit.

Many of these attributes can also be set from the {\cb plot} command
line, which will override any corresponding variable, if set.  The
functionality is as described for the variables.  The ``value'' of the
variables (if any) should follow the keyword, separated by space
and/or an optional `{\vt =}' character.  For values consisting of two
numbers, a comma and/or space can delimit the numbers.  The variable
names that are also recognized as command line keywords are shown with
an asterisk in the third column in the table below.

\begin{longtable}{|l|l|l|}\hline
\bf Variable    & \_temp\_{\it name\/}? & Attribute?\\ \hline
\vt color       & & \\ \hline
\vt combplot    & * & *\\ \hline
\vt gridsize    & & \\ \hline
\vt gridstyle   & & \\ \hline
\vt group       & * & *\\ \hline
\vt lingrid     & * & *\\ \hline
\vt linplot     & * & *\\ \hline
\vt loglog      & * & *\\ \hline
\vt multi       & * & *\\ \hline
\vt nogrid      & * & *\\ \hline
\vt nointerp    & * & *\\ \hline
\vt noplotlogo  & * & *\\ \hline
\vt plotposn    & & \\ \hline
\vt plotstyle   & & \\ \hline
\vt pointchars  & & \\ \hline
\vt pointplot   & * & *\\ \hline
\vt polar       & * & *\\ \hline
\vt polydegree  & & \\ \hline
\vt polysteps   & & \\ \hline
\vt scaletype   & & \\ \hline
\vt single      & * & *\\ \hline
\vt smith       & * & *\\ \hline
\vt smithgrid   & * & *\\ \hline
\vt ticmarks    & & \\ \hline
\vt title       & * & *\\ \hline
\vt xcompress   & * & *\\ \hline
\vt xdelta      & * & *\\ \hline
\vt xindices    & * & *\\ \hline
\vt xlabel      & * & *\\ \hline
\vt xlimit      & * & *\\ \hline
\vt xlog        & * & *\\ \hline
\vt ydelta      & * & *\\ \hline
\vt ylabel      & * & *\\ \hline
\vt ylimit      & * & *\\ \hline
\vt ylog        & * & *\\ \hline
\vt ysep        & * & *\\ \hline
\end{longtable}

When a plot is read from a rawfile, defaults for the presentation
attributes are set as specified in the rawfile.  These can be
overridden by reseting the attributes in {\WRspice}, with the exception
of the color specification in the rawfile.  If given, that color will
be used for a particular trace independent of the current setting
within {\WRspice}.  {\WRspice} never sets the color specification, when
writing a rawfile, unless that color was indicated from a previous
rawfile.  If a certain unalterable color is desired for a trace, the
rawfile can be edited with a text editor to specify that color.

Any text typed while the pointer is in the plot window will appear on
the plot (and hardcopies).  This is useful for annotation.  Entered
and existing text can be edited and moved.  In addition, traces in the
plot can be moved to change the order, or moved to other (x-scale
compatible) plot windows.  The description of the plot window
(\ref{plotpanel}) contains more information.


%SU-------------------------------------
\subsection{\spcmd{plotwin}}
\index{plotwin command}

% spPlot.hlp:plotwin 091714

The {\cb plotwin} command provides an interface for destroying plot
windows, most useful in scripts.  It applies in graphical mode only. 
There are two forms:
 
\begin{quote}
{\vt plotwin} [{\vt id}]
\end{quote}
 
Given without an argument, or with literal ``{\vt id}'' (only the
first letter is significant, case insensitive), the identification
number of the most recently created plot window is printed.  Every
plot window has a unique running identification number, which can be
used as a ``handle'' to the window.
 
\begin{quote}
{\vt plotwin} {\vt k}[{\vt ill}] [{\it idarg\/}]
\end{quote}
 
This form is used to destroy plot windows.  The first token is a word
starting with `{\vt k}', case insensitive.  The {\it idarg} is a
number.  If not given or zero, the most recently created plot is
destroyed.  If {\it idarg} is positive, the plot window with that
identification number is destroyed.  If {\it idarg} is negative, the
plot window relative to the most recently created plot window is
destroyed.  For example, -1 destroys the plot before the most recent,
-2 the one before that, etc.  The {\it idarg} can also be a word
starting with `{\vt a}' (for ``{\vt all}'') in which case all plot
windows are destroyed.


%SU-------------------------------------
\subsection{\spcmd{xgraph}}
\index{xgraph command}

% spPlot.hlp:xgraph 012209

The {\cb xgraph} command will produce plots using the UNIX {\vt
xgraph} utility.
\begin{quote}\vt
xgraph {\it file plotargs}
\end{quote}
This command is similar to the {\cb plot} command, however the {\vt
xgraph} program (an obsolete plotting package) actually generates
the plots.  If the given {\it file} is either ``{\vt tmp}'' or ``{\vt
temp}'', then a temporary file is used to hold the data while being
plotted.  Polar and Smith plots are not supported, otherwise the
variables associated with the {\cb plot} command apply.

The {\et xglinewidth} variable specifies the line width in pixels to
use in the plots.  If not set, a minimum line width is used.
 
If {\et xgmarkers} is set, point plots will use cross marks, otherwise
big pixels are used.


%S-----------------------------------------------------------------------------
\section{Miscellaneous Commands}

% spCommands.hlp:misccmds 062515

These commands perform miscellaneous functions.

\begin{tabular}{|l|l|}\hline
\multicolumn{2}{|c|}{Miscellaneous Commands}\\ \hline
\cb bug & Submit bug report\\ \hline
\cb help & Enter help system\\ \hline
\cb helpreset & Clear help system cache\\ \hline
\cb qhelp & Print command summaries\\ \hline
\cb quit & Exit program\\ \hline
\cb rusage & Print resource usage statistics\\ \hline
\cb stats & Print resource usage statistics\\ \hline
\cb version & Print program version\\ \hline
\end{tabular}

%SU-------------------------------------
\subsection{\spcmd{bug}}
\index{bug command}

% spCommands.hlp:bug 012209

The {\cb bug} command facilitates sending bug reports and other
messages to the {\WRspice} administrator.  Issuing the {\cb bug}
command will pop up a mail editing window if graphics is available,
or will allow a message to be entered on the command line if not. 
The environment variable {\et SPICE\_BUGADDR} is used to set the
internet address to which bug reports are sent (this can be changed
in the pop-up mail editor window).  If not set, the report is sent
to the Whiteley Research technical support staff.  This command
takes no arguments.

The mail editor window can also be displayed by pressing the {\cb WR}
button in the {\cb Tool Control} window.

%SU-------------------------------------
\subsection{\spcmd{help}}
\index{help command}
\label{help}

% spCommands.hlp:help 012209

The {\cb help} command brings up a help window describing the topic
keyword passed as an argument to the command, or the top-level entry
if no argument is given.
\begin{quote}\vt
help [-c | {\it topic\/}]
\end{quote}
When graphics is not available, the help text is presented in a
text-only format on the terminal.  The HTML to ASCII text converter
only handles the most common HTML tags, so some descriptions may look
a little strange.  The figures (and all images) are not shown, and
links are not available, except for the ``subtopics'' and
``references'' lists.

The help data files are found in directories specified in the {\et
helppath} variable, or from the\\ {\et SPICE\_HLP\_PATH} environment
variable.  If for some reason the help directory is not found, a very
minimal internal text-mode help system will be provided.  The single
character `{\vt ?}' is internally aliased to ``{\vt help}''.

If the single argument ``{\vt -c}'' is given, the internal topic hash
tables are cleared.  Since the topics are hashed as offsets into the
files, if a topic text changes, the offsets will be incorrect.  After
changes are made to a help file, or new help files are added, if in
{\WRspice} and the help database has already been cached by viewing
any help topic, giving ``{\vt help -c}'' will ensure that new topics
are found and present topics display correctly.  This is the same
effect as giving the {\cb helpreset} command.

The {\et helpinitxpos} variable specifies the distance in pixels from
the left edge of the screen to the left edge of the help window, when
it first appears.  If not set, the value taken is 100 pixels.  The
{\et helpinitypos} variable specifies the distance in pixels from the
top edge of the screen to the top edge of the help window, when it
first appears.  If not set, the value taken is 100 pixels.

See \ref{helpsys} for more information about the {\WRspice} help
system.

%SU-------------------------------------
\subsection{\spcmd{helpreset}}
\index{helpreset command}

% spCommands.hlp:helperset 012209

This will clear the internal topic cache used by the help system.  The
cache saves topic references as offsets into the help ({\vt .hlp})
files, so that if the text of a help file is modified, the offsets are
probably no longer valid.  This function is useful when editing the
text of a help file, while viewing the entry in {\WRspice}.  Use this
function when editing is complete, before reloading the topic into the
viewer.  Although the offset to the present topic does not change when
editing, so that simply reloading would look fine, other topics in the
file that come after the present topic would not display correctly if
the offsets change.

This is the same effect as giving the {\cb help} command with the {\vt
-c} option.

%SU-------------------------------------
\subsection{\spcmd{qhelp}}
\index{qhelp command}

% spCommands.hlp:qhelp 012209

The {\cb qhelp} command prints a brief description of each command
listed as an argument.  If no arguments are given, all commands are
listed.  This is not part of the main help system.

%SU-------------------------------------
\subsection{\spcmd{quit}}
\index{quit command}

% spCommands.hlp:quit 012209

The {\cb quit} command terminates the {\WRspice} session.  If there
are circuits that are in the middle of a simulation, or plots that
have not been saved in a file, the user is reminded of this and
asked to confirm.  The variable {\et noaskquit} disables this. 
{\WRspice} can also be terminated from the {\cb Quit} button in the
{\cb File} menu of the {\cb Tool Control} window.  The command takes
no arguments.

%SU-------------------------------------
\subsection{\spcmd{rusage}}
\index{rusage command}
\label{rusage}

% spRusage.hlp:rusage 032320

The {\cb rusage} command is used to obtain information about the
consumption of system resources and other statistics during the
{\WRspice} session.
\begin{quote}\vt
rusage [all] [{\it resource\/} ...]
\end{quote}
If any resource keywords are given, only those resources are printed. 
All resources are printed if the keyword {\vt all} is given.  With no
arguments, only total time and space usage are printed.  The {\cb
show} command can also be used to obtain resource statistics.  The
recognized keywords are listed below.

The {\cb stats} command is almost identical to {\cb rusage}, and
accepts the same keywords.  The difference is that {\cb stats} given
without arguments will print all run statistics.

In release 4.3.10 and later, statistics accumulate in Monte Carlo,
operating range, and sweep operations.  This was not the case in
earlier releases.

The two tables that follow list the available resource statistics.  An
internal statistical database maintains these values, the {\cb rusage}
and {\cb stats} commands are the user interface to this database.  The
following are a few keywords handled by the {\cb rusage} and {\cb
stats} commands directly.  Other keywords are passed in queries to the
internal statistical database.

\begin{description}
\item{\vt elapsed}\\
\index{rusage command!elapsed}
This keyword prints the total amount of time that has elapsed since
the last call of the {\cb rusage} or {\cb stats} command with the {\vt
elapsed} keyword (explicit or implied with ``{\vt all}''), or to the
program start time.

\item{\vt faults}\\
\index{rusage command!faults}
This keyword prints the number of page faults and context switches
seen by the program thus far.  See also {\et pagefaults}, {\et
involcxswitch}, and {\et volcxswitch} for the values that occurred
during the last anslysis.

\item{\vt space}\\
\index{rusage command!space}
This keyword will print the memory presently in use by {\WRspice}.

\item{\vt totaltime}\\
\index{rusage command!totaltime}
If this keyword is given, the total time used in the present session
will be printed.
\end{description}

subsubsection{Statistical Database Entries}
\index{statistical database}

The statistical database contains the following data items, listed in
the tables below and with a more detailed description of each item
following.

\begin{longtable}{|p{1in}|p{4.75in}l|} \hline
\bf Resource Name & \bf Description&\\ \hline
\multicolumn{3}{|l}{}\\
\multicolumn{3}{|l}{\bf Real-Valued Parameters}\\ \hline
{\vt cvchktime} & \rr Time spent convergence testing.&\\ \hline
{\vt loadtime} & \rr Device model evaluation and matrix load time.&\\ \hline
{\vt lutime} & \rr L-U decomposition time.&\\ \hline
{\vt reordertime} & \rr Matrix reordering time.&\\ \hline
{\vt solvetime} & \rr Matrix solve time.&\\ \hline
{\vt time} & \rr Total analysis time.&\\ \hline
{\vt tranlutime} & \rr Transient L-U decomposition time.&\\ \hline
{\vt tranouttime} & \rr Transient output recording time.&\\ \hline
{\vt transolvetime} & \rr Transient solve time.&\\ \hline
{\vt trantime} & \rr Transient time.&\\ \hline
{\vt trantstime} & \rr Transient timestep computation time.&\\ \hline

\multicolumn{3}{|l}{}\\
\multicolumn{3}{|l}{\bf Integer-Valued Parameters}\\ \hline
{\vt accept} & \rr Accepted timepoints.&\\ \hline
{\vt equations} & \rr Circuit equations.&\\ \hline
{\vt fillin} & \rr Fill-in terms from decomposition.&\\ \hline
{\vt involcxswitch} & \rr Involuntary context switches during analysis.&\\ \hline
{\vt loadthrds} & \rr Number of device loading helper threads.&\\ \hline
{\vt loopthrds} & \rr Number of repetitive analysis helper threads.&\\ \hline
{\vt matsize} & \rr Matrix size.&\\ \hline
{\vt nonzero} & \rr Number of nonzero matrix entries.&\\ \hline
{\vt pagefaults} & \rr Number of page faults during analysis.&\\ \hline
{\vt rejected} & \rr Number of rejected timepoints.&\\ \hline
{\vt runs} & \rr Accumulated core analysis runs.&\\ \hline
{\vt totiter} & \rr Total iterations.&\\ \hline
{\vt trancuriters} & \rr Transient interations at last timepoint.&\\ \hline
{\vt traniter} & \rr Transient interations.&\\ \hline
{\vt tranitercut} & \rr Transient timepoints where iteration limit exceeded.&\\ \hline
{\vt tranpoints} & \rr Transient timepoints.&\\ \hline
{\vt trantrapcut} & \rr Transient timepoints where trapcheck failed.&\\ \hline
{\vt volcxswitch} & \rr Voluntary context switches during analysis.&\\ \hline
\end{longtable}

\subsubsection{Real Valued Database Entries}

\begin{description}
\item{\vt cvchktime}\\
\index{rusage command!cvchktime}
Print the time spent checking for convergence in the most recent dc or
transient analysis (including operating point).

\item{\vt loadtime}\\
\index{rusage command!loadtime}
If given, print the time spent loading the matrix in the last
simulation run.  This includes the time spent in computation of device
characteristics.

\item{\vt lutime}\\
\index{rusage command!lutime}
The {\vt lutime} keyword will print the time spent in LU factorization
of the matrix during the last simulation run.

\item{\vt reordertime}\\
\index{rusage command!reordertime}
Print the time spent reordering the matrix for numerical stability in
the most recent simulation.

\item{\vt solvetime}\\
\index{rusage command!solvetime}
This will print the time spent solving the matrix equations, after
LU decomposition, in the last simulation run.

\item{\vt time}\\
\index{rusage command!time}
This keyword will print the time used by the last simulation run.

\item{\vt tranlutime}\\
\index{rusage command!tranlutime}
The time spent LU factoring the matrix in the most recent transient
analysis, not including the dc operating point calculation.

\item{\vt tranouttime}\\
\index{rusage command!tranouttime}
Print the time spent saving output in the most recent transient
analysis.

\item{\vt transolvetime}\\
\index{rusage command!transolvetime}
This keyword prints the matrix solution time required by the last
transient analysis, not including the operating point calculation.

\item{\vt trantime}\\
\index{rusage command!trantime}
This keyword will print the total time spent in transient analysis
in the last transient analysis, not including the operating point
calculation.

\item{\vt trantstime}\\
\index{rusage command!trantstime}
Report the time spent computing the next timestep in the most recent
transient analysis.
\end{description}

\subsubsection{Integer Valued Database Entries}

\begin{description}
\item{\vt accept}\\
\index{rusage command!accept}
This keyword prints the number of accepted time points from the last
transient analysis.

\item{\vt equations}\\
\index{rusage command!equations}
Print the number of nodes in the current circuit, including internally
generated nodes.  This includes the ground node so is one larger than
the matrix size.

\item{\vt fillin}\\
\index{rusage command!fillin}
Print the number of fillins generated during matrix reordering and
factoring.  This is not available from KLU.

\item{\vt involcxswitch}\\
\index{rusage command!involcxswitch}
This provides the number of involuntary context switches seen during
the last analysis.  If multiple threads are being used, this is the
total for all threads.

\item{\vt loadthrds}\\
\index{rusage command!loadthrds}
Report the number of threads used for device evaluation and matrix
loading during the most recent dc (including operating point) or
transient analysis.  This would be at most the value of the {\et
loadthrds} option variable in effect during the analysis, but is the
number of threads actually used.

\item{\vt loopthrds}\\
\index{rusage command!loopthrds}
Report the number of threads in use for repetitive analysis in the
most recent analysis run.  This would be at most the value of the {\et
loopthrds} option variable in effect during the analysis, but is the
number of threads actually used.

\item{\vt matsize}\\
\index{rusage command!matsize}
Print the size of the circuit matrix.

\item{\vt nonzero}\\
\index{rusage command!nonzero}
Print the number of nonzero matrix elements.

\item{\vt pagefaults}\\
\index{rusage command!pagefaults}
Report the number of page faults seen during the most recent analysis.

\item{\vt rejected}\\
\index{rusage command!rejected}
This keyword prints the number of rejected time points in the last
transient analysis.

\item{runs}\\
In Monte Carlo, operating range, and sweep analysis, this returns    
the number of trial runs over which statistics have accumulated.

\item{\vt totiter}\\
\index{rusage command!totiter}
This keyword prints the total number of Newton iterations used in
the last analysis.

\item{\vt trancuriters}\\
\index{rusage command!trancuriters}
This prints the number of Newton iterations used in the most recent
transient analysis time point evaluation.

\item{\vt traniter}\\
\index{rusage command!traniter}
The {\vt traniter} keyword will print the number of iterations used in
the last transient analysis.  This does not include iterations used in
the operating point calculation, unlike {\vt totiter} which includes
these iterations.

\item{\vt tranitercut}\\
\index{rusage command!tranitercut}
The number if times that the most recent transient analysis had a time
step cut by iteration count.  If the {\et itl4} limit is reached when
attempting convergence at a transient time point, the timestep is cut
and convergence is reattempted.

\item{\vt tranpoints}\\
\index{rusage command!tranpoints}
This keyword prints the number of internal time steps used in the
last transient analysis.

\item{\vt trantrapcut}\\
\index{rusage command!trantrapcut}
This is the number of times in the most recent transient analysis that
a timestep was cut due to the trapcheck algorithm.  This may occur
when the {\et trapcheck} variable is set, which enables a test to
detect numerical problems in trapezoidal integration. 

\item{\vt volcxswitch}\\
\index{rusage command!volcxswitch}
This provides the number of voluntary context switches seen during the
last analysis.  If multiple threads are being used, this is the total
for all threads.
\end{description}


%SU-------------------------------------
\subsection{\spcmd{stats}}
\index{stats command}

% spRusage.hlp:stats 062515

The {\cb stats} command is basically identical to the {\cb rusage}
command, and accepts the same arguments as described for that command.

\begin{quote}\vt
stats [all] [{\it resource\/} ...]
\end{quote}

The difference is that when given without an argument, all run statistics
are printed.  This is the same as ``{\vt rusage all}'' with the {\vt
totaltime}, {\vt elapsed}, {\vt space}, and {\vt faults} fields
omitted.


%SU-------------------------------------
\subsection{\spcmd{version}}
\index{version command}

% spCommands.hlp:version 011909

The {\cb version} command is used to determine the version of {\WRspice}
running.
\begin{quote}\vt
version [{\it version\_name\/}]
\end{quote}
With no arguments, this command prints out the current version of
{\WRspice}.  If there are arguments, it compares the current version
with the given version and prints a warning if they differ.  A version
command is usually included in the rawfile.

\input{variables}

