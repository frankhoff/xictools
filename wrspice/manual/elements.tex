
%S-----------------------------------------------------------------------------
\section{Circuit Elements}

%spElements:elements 012509

Each element in the circuit is specified by an element line that
contains the element name, the circuit nodes to which the element is
connected, and the values of the parameters that determine the
electrical characteristics of the element.  The first letter of the
element name specifies the element type (case insensitive).  For
example, a resistor name must begin with the letter `{\vt R}' or `{\vt
r}' and can contain one or more characters.  Hence, {\vt R}, {\vt r1},
{\vt Rse}, {\vt ROUT}, and {\vt r3ac2zY} are valid resistor names.

\index{current flow convention}
In the descriptions that follow, data fields that are enclosed in
square brackets `{\vt [}', `{\vt ]}' are optional.  All indicated
punctuation (parentheses, equal signs, etc.) is optional and merely
indicates the presence of any delimiter.  A consistent style such as
that shown here will make the input easier to understand.  With
respect to branch voltages and currents, {\WRspice} uniformly uses the
associated reference convention (current flows in the direction of
voltage drop).

\index{uic keyword}
The circuit cannot contain a loop of voltage sources.  If a dc
operating point analysis is performed, which is true for all analysis
except for transient analysis with the {\vt uic} (use initial
conditions) flag set, the circuit can not contain a loop of voltage
sources and/or inductors and cannot contain a cutset of current
sources and/or capacitors.  In transient analysis with the {\vt uic}
flag set (which is always the case when Josephson junctions are
present), inductor/voltage source loops are allowed, as are
capacitor/current source cut sets.  However, parallel voltage sources
and series current sources are not accepted.  It is not strictly
necessary that each node in the circuit have a dc path to ground with
the {\vt uic} flag given, however convergence problems may result.  It
is sometimes necessary to add a large-valued resistor to ground in
these cases.  In general, nodes should have at least two connections.

\index{device library}
This and the following sections describe the devices available in the
standard device library linked into {\WRspice}.  The device library
contains the element and model code for each device, as well as the
parser for the element specification lines.

Most of the code for the device library (with the exception of
restricted third-party semiconductor models) is available upon
request from Whiteley Research Inc.  In theory, users can build
their own, customized device library for use with {\WRspice}.  In
this case, devices can be added to or deleted from the library, or
modified.  Contace Whiteley Research for more information.

This format for most device lines, including the key letters, number
of nodes, etc., is standard for the SPICE input language, but is set
entirely by the code in the device library, and hence can be
abridged in a custom device library.  The descriptions below pertain
to the standard library.

The following is a complete list of circuit elements available in
the standard {\WRspice} library, and the key letter (the first
letter of the device name).

\begin{tabular}{|l|l|}\hline
\multicolumn{2}{|c|}{Passive Elements}\\ \hline
\bf Capacitor & \vt c\\ \hline
\bf Inductor & \vt l\\ \hline
\bf Mutual Inductor & \vt k\\ \hline
\bf Resistor & \vt r\\ \hline
\bf Current-Controlled Switch & \vt w\\ \hline
\bf Voltage-Controlled Switch & \vt s\\ \hline
\bf General Transmission Line & \vt t\\ \hline
\bf Lossy Transmission Line & \vt o\\ \hline
\bf Uniform RC Line & \vt u\\ \hline
\multicolumn{2}{|c|}{Voltage and Current Sources}\\ \hline
\bf General Voltage Source & \vt v\\ \hline
\bf General Current Source & \vt i\\ \hline
\bf Arbitrary Source & \vt a\\ \hline
\bf Voltage-Controlled Current Source & \vt g\\ \hline
\bf Voltage-Controlled Voltage Source & \vt e\\ \hline
\bf Current-Controlled Current Source & \vt f\\ \hline
\bf Current-Controlled Voltage Source & \vt h\\ \hline
\multicolumn{2}{|c|}{Semiconductor Devices}\\ \hline
\bf Junction Diode & \vt d\\ \hline
\bf Bipolar Junction Transistor & \vt q\\ \hline
\bf Junction Field-Effect Transistor & \vt j\\ \hline
\bf MESFET & \vt z\\ \hline
\bf MOSFET & \vt m\\ \hline
\multicolumn{2}{|c|}{Superconductor Devices}\\ \hline
\bf Josephson Junction & \vt b\\ \hline
\end{tabular}

The models for the semiconductor and some other devices require many
parameter values.  Often, many devices in a circuit are defined by the
same set of device model parameters.  For these reasons, a set of
device model parameters is defined on a separate {\vt .model} line and
assigned a unique model name.  The device element lines in {\WRspice}
then refer to the model name.  This scheme alleviates the need to
specify all of the model parameters on each device element line.

The {\cb show} command with the {\vt -D} option is useful for
printing a list of the parameters names that can be used on a device
instance line.  Only the parameters not listed as ``{\vt RO}''
(read-only) can be specified on the line.

%S-----------------------------------------------------------------------------
\section{Device Models}
\label{dotmodel}

% spModels.hlp:.model 071918

Many devices reference models, which contain values for the numerous
parameters describing the device, which would be cumbersome to include
in each device reference.  Device models are specified on a {\vt .model}
line.  The model can be referenced by any number of devices of the
corresponding type.

\index{.model}
\index{device models}
\spgen{.model {\it modname type\/} ({\it pname1=pval1 pname2=pval2} ... )}
\spexamp{.model mod1 npn (bf=50 is=1e-13 vbf=50)\\
.model intercon ltra (r=0.2 l=9.13nh c=3.65pf len=5 rel=.002
 compactrel=1.0E-4)}

The {\vt .model} line specifies a set of model parameters that will be
used by one or more devices.  The {\it modname} is the model
name, which is case insensitive in matching references, and {\it
type} is one of the following types:
\begin{quote}
\begin{tabular}{|l|l|}\hline
\vt c & Capacitor model\\ \hline
\vt l & Inductor model\\ \hline
\vt r & Resistor model\\ \hline
\vt sw & Voltage-controlled switch model\\ \hline
\vt csw & Current-controlled switch model\\ \hline
\vt tra & General transmission line model\\ \hline
\vt ltra & Lossy transmission line model\\ \hline
\vt urc & Uniform RC line model\\ \hline
\vt d & Diode model\\ \hline
\vt npn & NPN BJT model\\ \hline
\vt pnp & PNP BJT model\\ \hline
\vt njf & N-channel JFET model\\ \hline
\vt pjf & P-channel JFET model\\ \hline
\vt nmf & N-channel MESFET model\\ \hline
\vt pmf & P-channel MESFET model\\ \hline
\vt nmos & N-channel MOSFET model\\ \hline
\vt pmos & P-channel MOSFET model\\ \hline
\vt jj & Josephson junction model\\ \hline
\end{tabular}
\end{quote}

Parameter values are defined by appending the parameter name, as given
for each model type, followed by an equal sign and the parameter
value.  Model parameters that are not given a value are generally
assigned default values.

The {\cb show} command with the {\vt -M} option is useful for
listing the parameters that can be specified to a model.  Only the
parameters not listed as ``{\vt RO}'' (read-only) can appear in a
{\vt .model} line.

In the tables that follow, the various model parameters are listed.
The ``units'' field of the tables provides the assumed units of measure
for the parameter, which is expressed using symbols from the following
table.

\begin{tabular}{|l|l|}\hline
$M$       &  meters\\ \hline
$cM$      &  centimeters\\ \hline
${\mu}M$  &  microns\\ \hline
$S$       &  seconds\\ \hline
$Hz$      &  hertz\\ \hline
$F$       &  farads\\ \hline
$H$       &  henries\\ \hline
$\Omega$  &  ohms\\ \hline
$C$       &  degrees Celsius\\ \hline
$\Box$    &  square\\ \hline
$A$       &  amperes\\ \hline
$V$       &  volts\\ \hline
$eV$      &  electron-volts\\ \hline
$deg$     &  degrees\\ \hline
\end{tabular}


%SU-------------------------------------
\subsection{Default Models}
\index {.defmod}
\index{default models}

% spModels.hlp:.model 072018

Some simple devices support a ``default model'' in {\WRspice}, meaning
that if no model name is given in an instance line, an internally
provided default model will be used.  Internally, all devices have a
model structure, which is a container for the instances of that device
type.  It is possible to access the default model used for various
devices with {\vt .defmod} lines.  This will affect all devices of the
corresponding type that are not explicitly given a model in the
instantiation line.

\spgen{.defmod {\it type\/} ({\it pname1=pval1 pname2=pval2} ... )}
\spexamp{.defmod r (m=1.2)\\
.model v (temp=300 tc1=.001}

The {\it type} is the name of the device model (the second name that
would be provided on a {\vt .model} line) such as {\vt R} (for
resistors), {\vt C} (for capacitors), and {\vt L} (for inductors).

The type name is followed by a list of parameter assignments,
optionally enclosed in parentheses.  These are precisely the same as
would appear in a {\vt .model} line for the device.  These provide the
values for the parameters to be used in the default model.

Not all devices support default models, meaning that lack of a model
name in an instance line is an error.  In particular devices that have
a variable terminal count (optional nodes) require a model name and
therefor don't support a default model.

It is probably also not possible to use a {\vt level} parameter in a
default model, and binning parameters will be ignored at best. 
Anything too fancy should be done through a normal model, or there may
be trouble.

The capability is very powerful, but might cause headaches, too, so
the user should beware.  For example, if the following line is added
to an existing deck
\begin{quote}\vt
.defmod R(M=1.2)
\end{quote}
all ``standard'' resistors in the deck will have their values reduced
by about twenty percent.  This can be useful for corner analysis, but
don't let the line get ``lost'' in a big file.


%SU-------------------------------------
\subsection{Analysis at Different Temperatures}

% spModels.hlp:temperature 091511

\index{temperature}
\index{tnom variable}
\index{temp variable}
All input data for {\WRspice} is assumed to have been measured at a
nominal temperature of 25C, which can be changed by use of the {\vt
tnom} parameter on the {\vt .options} control line.
Note that this is the same default temperature used in HSPICE, but is
not the same as in Berkeley SPICE3 or in {\WRspice} releases prior to
3.2.15, which was 27C.

This value can further be overridden for any device which models
temperature effects by specifying the {\vt tnom} parameter on the
model itself.  The circuit simulation is performed at a temperature of
25C unless overridden by a {\vt temp} parameter on the {\vt .options}
control line.  Individual device instances may further override the
circuit temperature through the specification of a {\vt temp}
parameter on the instance.

Temperature dependent support is provided for resistors and
semiconductor devices.  The details of the temperature adjustments can
be found in the description of the models.  For details of the BSIM
temperature adjustment, see \cite{park} (BSIM1), \cite{szeto} (BSIM2),
and \cite{bsim3} (BSIM3).

Temperature appears explicitly in the exponential terms of the BJT and
diode model equations.  In addition, saturation currents have a
built-in temperature dependence.  The temperature dependence of the
saturation current in the BJT models is determined by:
\begin{displaymath}
I_s(T_1) = I_s(T_0)\left(\frac{T_1}{T_0}\right)^{XTI} exp\left(
\frac{E_gq(T_1 - T_0)}{kT_1T_0}\right)
\end{displaymath}
where $k$ is Boltzmann's constant, $q$ is the electronic charge, $E_g$ is
the energy gap which is a model parameter, and $XTI$ is the saturation
current temperature exponent (also a model parameter, and usually
equal to 3).

The temperature dependence of forward and reverse beta is according to
the formula:
\begin{displaymath}
\beta(T_1) = \beta(T_0)\left(\frac{T_1}{T_0}\right)^{XTB}
\end{displaymath}
where $T_1$ and $T_0$ are in Kelvin, and $XTB$ is a user-supplied model
parameter.  Temperature effects on beta are carried out by appropriate
adjustment to the values of $\beta_F$, $I_{SE}$, $\beta_R$, and
$I_{SC}$ ({\WRspice} model parameters {\vt bf, ise, br,} and {\vt isc,}
respectively.

Temperature dependence of the saturation current in the junction diode
model is determined by:
\begin{displaymath}
I_S(T_1) = I_S(T_0)\left(\frac{T_1}{T_0}\right)^{\frac{XTI}{N}}
exp\left(\frac{E_gq(T_1 - T_0)}{NkT_1T_0}\right)
\end{displaymath}
where $N$ is the emission coefficient, which is a model parameter, and
the other symbols have the same meaning as above.  Note that for
Schottky barrier diodes, the value of the saturation current
temperature exponent, $XTI$, is usually 2.

Temperature appears explicitly in the value of junction potential,
$\phi$ (in {\WRspice}, {\vt phi}), for all device models.  The
temperature dependence is determined by:
\begin{displaymath}
\phi(T) = \frac{kT}{q}ln\left(\frac{N_aN_d}{N_i(T)^2}\right)
\end{displaymath}
where $k$ is Boltzmann's constant, $q$ is the electronic charge, $N_a$ is
the acceptor impurity density, $N_d$ is the donor impurity density, and
$N_i$ is the intrinsic carrier concentration.

Temperature appears explicitly in the value of surface mobility,
$\mu_0$ (or {\vt u0}, for the MOSFET models.  This temperature
dependence is determined by:
\begin{displaymath}
\mu_0(T) = \frac{\mu_0(T_0)}{\left(\frac{T}{T_0}\right)^{1.5}}
\end{displaymath}

The effects of temperature on resistors is modeled by the formula:
\begin{displaymath}
R(T) = R(T_0)[1 + TC_1(T-T_0) + TC_2(T-T_0)^2]
\end{displaymath}
where $T$ is the circuit temperature, $T_0$ is the nominal temperature,
and $TC_1$ and $TC_2$ are the first and second-order temperature coefficients.
\index{temperature!coefficient}


%S-----------------------------------------------------------------------------
\section{Passive Element Lines}

%SU-------------------------------------
\subsection{Capacitors}
\index{capacitor}
\index{poly keyword}

% spElements.hlp:cap 071918

\spgen{c{\it name} {\it n\/}+ {\it n\/}- [{\it value\/} | {\it modname\/}]
 [{\it options\/}]
 [c={\it expr\/} | {\vt poly} {\it c0} [{\it c1} ...]]\\
 \\{\it Options\/}:
 [m={\it mult\/}] [ic={\it val\/}] [temp={\it temp\/} [tc1={\it tcoeff1\/}]
 [tc2={\it tcoeff2\/}] [l={\it length\/}] [w={\it width\/}]}

\spexamp{cload 2 10 10p\\
cmod 3 7 cmodel l=10u w=1u}

The {\it n\/}{\vt +} and {\it n\/}{\vt -} are the positive and
negative element nodes, respectively, and {\it value\/} is the
capacitance for a constant valued capacitor.  Alternatively, a
capacitor model {\it modname\/} can be specified which allows for the
calculation of the actual capacitance value from strictly geometric
information and the specifications of the process.  If {\it value\/}
is specified, it defines the capacitance.  If {\it modname\/} is
specified, then the capacitance is calculated from the process
information in the model {\it modname} and the given {\it length} and
{\it width}.  If {\it value\/} is not specified, then {\it modname\/}
and {\it length\/} must be specified.  If {\it width\/} is not
specified, then it will be taken from the default width given in the
model.  Either {\it value\/} or {\it modname\/}, {\it length\/}, and
{\it width\/} may be specified, but not both sets.

The parameters accepted by the capacitor are:

\begin{description}
\item{\vt m=}{\it mult}\\
This is the parallel multiplier which is the number of devices
effectively in parallel.  The given capacitance is multiplied by this
value.  It overrides any `{\vt m}' multiplier found in the inductor
model.

\item{\vt ic=}{\it val}\\
The optional initial condition {\it val} is the initial (time zero)
voltage across the capacitor.  The initial condition (if any) applies
only when the {\vt uic} option is specified in transient analysis.

\item{\vt temp=}{\it temp}\\
The {\it temp} is the Celsius operating temperature of the capacitor,
for use by the temperature coefficient parameters.

\item{\vt tc1=}{\it tcoeff1}\\
The first-order temperature coefficient.  This will override the
first-order coefficient found in a model, if given.

\item{\vt tc2=}{\it tcoeff2}\\
The second-order temperature coefficient.  This will override the
second-order coefficient found in a model, if given.

\item{\vt l=}{\it length}\\
The length of the capacitor.  This applies only when a model is given,
which will compute the capacitance from geometry.

\item{\vt w=}{\it width}\\
The width of the capacitor.  This applies only when a model is given,
which will compute the capacitance from geometry.

\item{\vt c=}{\it expr}\\
This can also be given as ``{\vt cap=}{\it expr}'', or ``{\vt
capacitance=}{\it expr}'', where {\it expr} is an expression yielding
the capacitance in farads.  This is the partial derivative of charge
with respect to voltage, possibly as a function of other circuit
variables.  This form is applicable when the first token following the
node list is not a capacitance value or model name.  It also applies
when a model is given, it overrides the geometric capacitance value.

This is the default keyword, so actually the parameter name and equals
sign are optional, a bare expression is acceptable.

\item{\vt poly} {\it c0} [{\it c1} ...]\\
This form allows specification of a polynomial capacitance, which will
take the form
\begin{quote}
Capacitance = $c0 + c1{\cdot}v + c2{\cdot}v^2 ...$
\end{quote}
where $v$ is the voltage difference between the positive and negative
element nodes.  There is no built-in limit to the number of terms.
\end{description}


%SU-------------------------------------
\subsection{Capacitor Model}
\index{capacitor model}
\label{capmodel}

% spModels.hlp:capmodel 071918

{\cb Type Name:} {\vt c}

The capacitor model contains process information that may be
used to compute the capacitance from strictly geometric information.

\begin{quote}
\begin{tabular}{|l|l|l|l|l|}\hline
\multicolumn{5}{|c|}{\bf Capacitor Model Parameters}\\ \hline
\bf name & \bf parameter & \bf units & \bf default & \bf example
\\ \hline\hline
\vt m & \rr parallel multiplier & - & 1.0 & 1.2\\
\hline
\vt cj & \rr junction bottom capacitance & $F/M^2$ & - & 5e-5\\
\hline
\vt cjsw & \rr junction sidewall capacitance & $F/M$ & - & 2e-11\\
\hline
\vt defw & \rr default device width & $M$ & 1e-6 & 2e-6\\
\hline
\vt narrow & \rr narrowing due to side etching & $M$ & 0.0 & 1e-7\\
\hline
\vt tnom & \rr parameter measurement temperature & $C$ & 25 & 50\\
 \hline
\vt tc1 & \rr first order temperature coeff\. & $\Omega/C$
 & 0.0 & -\\ \hline
\vt tc2 & \rr second order temperature coeff\. & $\Omega/C^2$ &
 0.0 & -\\ \hline
\end{tabular}
\end{quote}

The capacitor has a nominal capacitance computed as below, where {\it
l} and {\it w} are parameters from the device line.
\begin{quote}
C = {\vt cj}$\cdot$({\it l\/}$-${\vt narrow})({\it w\/}$-${\vt narrow}) $+$
  2{\vt cjsw}$\cdot$({\it l\/}$+${\it w\/}$-$2$\cdot${\vt narrow})
\end{quote}

After the nominal capacitance is calculated, it is adjusted for
temperature by the formula:
\begin{quote}
C{\vt (temp)} = C{\vt (tnom)}$\cdot${\vt (1 $+$ tc1$\cdot$(temp$-$tnom) $+$
 tc2$\cdot$(temp$-$tnom)$^2$)}
\end{quote}

Finally, the capacitance is multiplied by the parallel 
multiplication factor ({\vt m}).

%SU-------------------------------------
\subsection{Inductors}
\index{inductor}
\index{poly keyword}

% spElements.hlp:ind 071918

\spgen{l{\it name\/} {\it n\/}+ {\it n\/}- [{\it value} | {\it modname\/}]
 [{\it options\/}] [{\vt ind=}{\it expr} | {\vt poly} {\it c0} [{\it c1} ...]]\\
 \\{\it Options\/}:
 [m={\it mult\/}] [ic={\it val\/}]}

\spexamp{llink 42 69 1uh\\
lshunt 23 51 10u ic=15.7ma}

The {\it n\/}{\vt +} and {\it n\/}{\vt -} are the positive and
negative element nodes, respectively, and {\it value} is the
inductance, for a constant value inductor.  An inductor model {\it
modname} can optionally be specified.  Presently the inductor model
holds only a parallel multiplier default, so an inductance must be
specified in addition to the model.

The parameters accepted for the inductor device are:

\begin{description}
\item{\vt m=}{\it mult}\\
This is the parallel multiplier which is the number of devices
effectively in parallel.  The given inductance is divided by this
value.  It overrides any `{\vt m}' multiplier found in the inductor
model.

\item{\vt ic=}{\it val}\\
The initial condition is the initial (time-zero) value of inductor
current (in Amps) that flows from {\it n\/}{\vt +}, through the
inductor, to {\it n\/}{\vt -}.  The initial condition (if any) applies
only when the {\vt uic} option is specified in transient analysis.

\item{\vt ind=}{\it expr}\\
The {\it expr} is an expression yielding the inductance in henries. 
This is the partial derivative of flux with respect to branch current,
possibly as a function of other circuit variables.  The keyword can
alse be given as ``{\vt inductance}'' or ``{\vt l}'', or may be
omitted since this is the default parameter.  Note that the expression
can depend on the branch current, in which case the device is
nonlinear.

\item{\vt poly} {\it c0} [{\it c1} ...]\\
This form allows specification of a polynomial inductance, which will
take the form
\begin{quote}
Inductance = $c0 + c1{\cdot}i + c2{\cdot}i^2 ...$
\end{quote}
where {\it i} is the current flowing through the device from the
positive to the negative element nodes.  There is no built-in limit to
the number of terms.
\end{description}


%SU-------------------------------------
\subsection{Inductor Model}
\index{inductor model}
\label{indmodel}

% spModels.hlp:indmodel 071918

{\cb Type Name:} {\vt l}

The inductor model currently contains only one parameter.  A geometric
model may be added in future.

\begin{quote}
\begin{tabular}{|l|l|l|l|l|}\hline
\multicolumn{5}{|c|}{\bf Inductor Model Parameters}\\ \hline
\bf name & \bf parameter & \bf units & \bf default & \bf example
\\ \hline\hline
\vt m & \rr parallel multiplier & - & 1.0 & 1.2\\ \hline
\end{tabular}
\end{quote}

The parallel multiplier acts on each inductor instance of the model,
dividing the inductance given by this value.


%SU-------------------------------------
\subsection{Coupled (Mutual) Inductors}
\index{mutual inductor}

% spElements.hlp:mut 011715

\spgen{k{\it name} {\it inductor1 inductor2 value}}
\spexamp{k43 laa lbb 0.999\\
kxfrmr l1 l2 0.87}

The {\it inductor1} and {\it inductor2} are the names of the two
coupled inductors found elsewhere in the circuit, and {\it value\/} is
the coefficient of coupling, K, which must be greater than 0 and less
than or equal to 1.  Using the ``dot'' convention, one would have a
dot on the first node of each inductor.

This formulation applies when the referenced inductors are linear. 
The model is probably not exactly correct in the case of nonlinear
inductors, but results may be close enough in some applications.  In
general, use of {\vt mut} with nonlinear inductors is not recommended
but allowed.


%SU-------------------------------------
\subsection{Resistors}
\index{resistor}
\index{poly keyword}

% spElements.hlp:res 071918

\spgen{r{\it name\/} {\it n1 n2} [{\it value} | {\it modname\/}]
 [{\it options\/}]
 [r={\it expr\/} | {\vt poly} {\it c0} [{\it c1} ...]]\\
 \\{\it Options\/}:
 [m={\it mult\/}] [temp={\it temp\/}] [tc1={\it tcoeff1\/}]
 [tc2={\it tcoeff2\/}] [l={\it length\/}] [w={\it width\/}]
 \newline
 [noise={\it mult\/}]}

\spexamp{rload 2 10 10k\\
rmod 3 7 rmodel l=10u w=1u}

The {\it n1} and {\it n2} are the two element nodes, and {\it value}
is the resistance, for a constant value resistor.  A resistor model
{\it modname} can alternatively be specified and allows the
calculation of the actual resistance value from strictly geometric
information and the specifications of the process.  If a resistance is
specified after {\it modname}, it overrides the geometric information
(if any) and defines the nominal-temperature resistance.  If {\it
modname} is specified, then the resistance may be calculated from the
process information in the model {\it modname} and the given {\it
length} and {\it width}.  In any case, the resulting value will be
adjusted for the operating temperature {\it temp} if that is
specified, using correction factors given.  If {\it value} is not
specified, then {\it modname} and {\it length} must be specified.  If
{\it width} is not specified, then it will be taken from the default
width given in the model.

If the resistance can not be determined from the provided parameters,
a fatal error results.  This behavior is different from traditional
Berkeley SPICE, which provides a default value of 1K.

The paramaters that are understood are:

\begin{description}
\item{\vt m=}{\it mult}\\
This is the parallel multiplication factor, that represents the number
of devices effectivly connected in parallel.  The effect is to
multiply the conductance by this factor, so that the given resistance
is divided by this value.  This overrides the `{\vt m}' multiplier
found in the resistor model, if any.

\item{\vt temp=}{\it temp}\\
The {\it temp} is the Celsius operating temperature of the resistor,
for use by the temperature coefficient parameters.

\item{\vt tc1=}{\it tcoeff1}\\
The first-order temperature coefficient.  This will override the
first-order coefficient found in a model, if given.  The keyword
``{\vt tc}'' is an alias for ``{\vt tc1}''.

\item{\vt tc2=}{\it tcoeff2}\\
The second-order temperature coefficient.  This will override the
second-order coefficient found in a model, if given.

\item{\vt l=}{\it length}\\
The length of the resistor.  This applies only when a model is given,
which will compute the resistance from geometry.

\item{\vt w=}{\it width}\\
The width of the resistor.  This applies only when a model is given,
which will compute the resistance from geometry.

\item{\vt noise=}{\it mult}\\
The {\it mult} is a real number which will multiply the linear
conductance used in the noise equations.  Probably the major use is to
give {\vt noise=0.0} to temporarily remove a resistor from a circuit
noise analysis.

\item{\vt r=}{\it expr}\\
This can also be given as ``{\vt res=}{\it expr\/}'' or ``{\vt
resistance=}{\it expr\/}'', where {\it expr} is an expression giving
the nominal-temperature device voltage divided by device current
(``large signal'' resistance) in ohms, possibly as a function of other
variables.  This form is applicable when the first token following the
node list is not a resistance value or model name.  It also applies
when a model is given, it overrides the geometric resistance value.

\item{\vt poly} {\it c0} [{\it c1} ...]\\
This form allows specification of a polynomial resistance, which will
take the form
\begin{quote}
Resistance = $c0 + c1{\cdot}v + c2{\cdot}v^2 ...$
\end{quote}
where {\it v} is the voltage difference between the positive and
negative element nodes.  There is no built-in limit to the number of
terms.
\end{description}


%SU-------------------------------------
\subsection{Resistor Model}
\index{resistor model}
\label{resmodel}

% spModels.hlp:resmodel 071918

{\cb Type Name:} {\vt r}

The resistor model consists of process-related device data that allow
the resistance to be calculated from geometric information and to be
corrected for temperature.  The parameters (multiple names are aliases)
available are:

\begin{quote}
\begin{tabular}{|l|l|l|l|l|}\hline
\multicolumn{5}{|c|}{\bf Resistor Model Parameters}\\ \hline
\bf name & \bf parameter & \bf units & \bf default & \bf example
\\ \hline\hline
\vt m & \rr parallel multiplier & - & 1.0 & 1.2\\ \hline
\vt tc1, tc, tc1r & \rr first order temperature coeff\. & $\Omega/C$
 & 0.0 & -\\ \hline
\vt tc2, tc2r & \rr second order temperature coeff\. & $\Omega/C^2$ &
 0.0 & -\\ \hline
\vt rsh & \rr sheet resistance & $\Omega/\Box$ & - & 50\\
 \hline
\vt defl, l & \rr default length & $M$ & 0 & 2e-6\\
 \hline
\vt defw, w & \rr default width & $M$ & 0 & 2e-6\\
 \hline
\vt dl, dlr & \rr length reduction due to etching & $M$ & 0 & 1e-7\\
 \hline
\vt narrow, dw & \rr narrowing due to side etching & $M$ & 0 & 1e-7\\
 \hline
\vt tnom, tref & \rr parameter measurement temperature & $C$ & 25 & 50\\
 \hline
\vt temp & \rr default instance temperature & $C$ & 25 & 50\\ \hline
\vt kf & \rr flicker noise coefficient &  & 0 & \\
 \hline
\vt af & \rr flicker noise exponent of current &  & 2 & \\
 \hline
\vt ef & \rr flicker noise exponent of frequency &  & 1 & \\
 \hline
\vt wf & \rr flicker noise exponent of width &  & 1 & \\
 \hline
\vt lf & \rr flicker noise exponent of length &  & 1 & \\
 \hline
\vt noise & \rr noise conductance multiplier &  & 1 & \\
 \hline
\end{tabular}
\end{quote}

The sheet resistance is used with the etch reduction parameters and {\it l}
and {\it w} from the resistor element line to determine the nominal
resistance by the formula
\begin{quote}
R = {\vt rsh}$\cdot$({\it l} - {\vt dl})/({\it w} - {\vt narrow}).
\end{quote}

The parameters {\vt defw} and {\vt defl} are used to supply default
values for element {\it w} and {\vt l} if not specified on the device
line.  A fatal error is produced if the resistance can't be determined
from given parameters.

After the nominal resistance is calculated, it is adjusted for
temperature by the formula:
\begin{quote}
R{\vt (temp)} = R{\vt (tnom)}$\cdot${\vt (1 $+$ tc1$\cdot$(temp$-$tnom) $+$
 tc2$\cdot$(temp$-$tnom)$^2$)}
\end{quote}

Finally, the resistance is divided by the parallel multiplier ({\vt
m}) value.

The flicker noise capability can be used in noise analysis.  This
requires that {\vt kf}, {\vt l}, and {\vt w} be specified.  To use,
the instance line must reference a model, but also can have a
resistance specified which will override model calculation of
resistance.

Flicker noise model:
\begin{quote}
    {\it Noise} $=$ $(KF \cdot I^AF) / (Leff^LF \cdot Weff^WF \cdot f^EF)$
\end{quote}

\begin{tabular}{|l|l|l|}\hline

\bf Param & \bf Description & \bf Units\\ \hline
$Noise$ & Noise spectrum density & $A^2$Hz\\ \hline
$I$ &    Current           &  A\\ \hline
$Leff$ & Eff length (L-DL) &  M\\ \hline
$Weff$ & Eff width  (W-DW) &  M\\ \hline
$f$ &    Frequency         &  Hz\\ \hline
\bf Param & \bf Description & \bf Default, Range\\ \hline
$KF$ &   Flicker noise coefficient & 0,  $>=$ 0\\ \hline
$AF$ &   Exponent of current & 2,  $>$ 0\\ \hline
$LF$ &   Exp. of eff. length & 1,  $>$ 0\\ \hline
$WF$ &   Exp. of eff. width & 1,  $>$ 0\\ \hline
$EF$ &   Exp. of frequency & 1,  $>$ 0\\ \hline
\end{tabular}

The {\vt noise} parameter will multiply the conductance used in the
noise equations.  It provides a default which is overridden by the
instance parameter of the same name.  This can be used to model
empirical excess noise, or to remove the devices from noise analysis
by setting the parameter to zero.


%SU-------------------------------------
\subsection{Switches}
\index{switch}

% spElements.hlp:sw 012509

\spgen{s{\it name} {\it n\/}+ {\it n\/}- {\it nc\/}+ {\it nc\/}-
 {\it model\/} [on | off]\\
w{\it name} {\it n\/}+ {\it n\/}- {\it vnam model\/} [on | off]}
\spexamp{s1 1 2 3 4 switch1 on\\
s2 5 6 3 0 sm2 off\\
switch1 1 2 10 0 smodel1\\
w1 1 2 vclock switchmod1\\
w2 3 0 vramp sm1 on\\
wreset 5 6 vclck lossyswitch off}

Nodes {\it n\/}{\vt +} and {\it n\/}{\vt -} are the nodes between
which the switch terminals are connected.  The {\vt model} name is
mandatory while the initial conditions are optional.  For the voltage
controlled switch, nodes {\it nc\/}{\vt +} and {\it nc\/}{\vt -} are
the positive and negative controlling nodes respectively.  For the
current controlled switch, the controlling current is that through the
voltage source or inductor {\it vnam}.  The direction of positive
controlling current flow is from the positive node, through the source
or inductor, to the negative node.

%SU-------------------------------------
\subsection{Switch Model}
\index{switch model}
\label{swmodel}

% spModels.hlp:sw 012609

{\cb Type Names:} {\vt csw}, {\vt sw}

The switch model allows an almost ideal switch to be described in
{\WRspice}.  The switch is not quite ideal, in that the resistance can
not change from 0 to infinity, but must always have a finite positive
resistance.  By proper selection of the on and off resistances, they
can be effectively zero and infinity in comparison to other circuit
elements.  There are two different types of switch devices;
current-controlled (keyed by {\vt w}), and voltage-controlled (keyed
by {\vt s}).  Both reference the model described below.  The
parameters available are:

\begin{quote}
\begin{tabular}{|l|l|l|l|l|}\hline
\multicolumn{5}{|c|}{\bf Switch Model Parameters}\\ \hline
\bf name & \bf parameter & \bf units & \bf default & \bf switch
\\ \hline\hline
\vt vt & threshold voltage & $V$ & 0.0 & S\\ \hline
\vt it & threshold current & $A$ & 0.0 & W\\ \hline
\vt vh & hysteresis voltage & $V$ & 0.0 & S\\ \hline
\vt ih & hysteresis current & $A$ & 0.0 & W\\ \hline
\vt ron & on resistance & $\Omega$ & 1.0 & both\\ \hline
\vt roff & off resistance & $\Omega$ & 1/{\vt gmin*} & both\\ \hline
\end{tabular}
\end{quote}
* The {\vt gmin} parameter, can be set on the {\vt .options} line. 
Its default value results is an off resistance of 1.0e+12 ohms.

The use of an ideal element that is highly nonlinear such as a switch
can cause large discontinuities to occur in the circuit node voltages.
A rapid change such as that associated with a switch changing state
can cause numerical roundoff or tolerance problems leading to
erroneous results or timestep difficulties.  The user of switches can
improve the situation by taking the following steps.

First of all it is wise to set ideal switch impedances only high and
low enough to be negligible with respect to other circuit elements.
Using switch impedances that are close to ``ideal'' in all cases will
aggravate the problem of discontinuities mentioned above.  Of course,
when modeling real devices such as MOSFETS, the on resistance should
be adjusted to a realistic level depending on the size of the device
being modeled.

If a wide range of on to off resistance must be used in the switches
(roff/ron $>$ 1e12), then the tolerance on errors allowed during
transient analysis should be decreased by using the {\vt .options}
line and specifying {\vt trtol} to be less than the default value of
7.0 (options can also be set from the prompt line from within
{\WRspice}).  When switches are placed around capacitors, then the
option {\vt chgtol} should also be reduced.  Suggested values for
these two options are 1.0 and 1e-16 respectively.  These changes
inform {\WRspice} to be more careful around the switch points so that
no errors are made due to the rapid change in the circuit.


%SU-------------------------------------
\subsection{Transmission Lines (General)}
\label{tline}
\index{transmission line}

% spElements.hlp:tra 101516

\spgen{t{\it name\/} {\it n1 n2 n3 n4} [{\it model\/}]
 [{\it param\/}={\it value} ...]\\
o{\it name\/} {\it n1 n2 n3 n4} [{\it model\/}]
 [{\it param\/}={\it value} ...]}
\spexamp{t1 1 0 2 0 z0=50 td=10ns\\
tw 1 0 2 0 z0=50 f=1ghz nl=.1\\
tx 1 0 4 0 l=9.13e-9 c=3.65e-12 len=24\\
oy 2 0 4 0 level=2 l=100pH c=5pf r=1.5 len=12\\
oz 2 0 4 0 level=2 tranmod len=12}

In {\WRspice}, the transmission line element represents a general
lossless or lossy transmission line.  There are actually three
historical models unified in the {\WRspice} model:  the SPICE3
lossless transmission line, the SPICE3 lossy (LTRA) transmission line
convolution approach of Roychowdhury and Pederson \cite{ltra}, and the
Pade approximation lossy line approach of Lin and Kuh \cite{lin}.

The device line is keyed by the letters `{\vt t}' and `{\vt o}'
equivalently, as above.  In SPICE3, `{\vt o}' calls the lossy
convolution model, but this is not necessarily the case in
{\WRspice}.  One can enforce use of the convolution model by using
``{\vt level=2}'' in the device or model line, the default (``{\vt
level=1}'') is the Pade approximation model.  In the lossless case,
the {\vt level} parameter has no effect.

Above, {\it n1\/} and {\it n2\/} are the nodes at port 1, {\it n3\/}
and {\it n4\/} are the nodes at port 2.  Note that this element
models only one propagating mode.  If all four nodes are distinct in
the actual circuit, then two modes may be excited.  To simulate such
a situation, two transmission line elements are required.

There is a fairly lengthly list of parameters which can be applied
in the device line, or in a model.  If a model is referenced in the
element line, the element defaults to the parameters specified in
the model, though any of these parameters can be overridden for the
element if given new values in the element line.

\subsubsection{Model Level}

\begin{description}
\item{\vt level}\\
This parameter can take values 1 (the default if not given) or 2.  The
level indicates the treatement of a lossy element, and has no effect
if the transmission line is lossless.

Level 1 handles arbitrary RLCG configurations using the Pade
approximation approach.  A Pade approximation is used as a rational
function approximation to the transfer function in the Laplace domain,
which has a trivial inverse transformation to the time domain. 
Further, separability avoids the need to perform a complex convolution
at each time point.  The model is very fast and accurate enough for
most purposes.

Level 2 handles RLC configurations using a full numerical convolution,
equivalent to the LTRA model.  It does not allow a G element, and is
much slower than the Pade approximation approach, however it may be
more accurate.  Level 2 supports the following types of lines:  RLC
(uniform transmission line with series loss only), RC (uniform RC
line), LC (lossless transmission line), and RG (distributed series
resistance and parallel conductance only).
\end{description}

\subsubsection{Electrical Characteristics}

\begin{description}
\item{\vt len}\\
This provides the physical length of the transmission line in
arbitrary units, though the units must match the per-length unit in
the element values discussed below.  If not given, the value is taken
as unity, unless it is implicitly defined by other parameters.

\item{\vt l}\\
This parameter provides the series inductance per unit length of the
line.  The default is 0.

\item{\vt c}\\
This parameter provides the shunt capacitance per unit length of the
line.  The default is 0.

\item{\vt r}\\
This parameter provides the series resistance per unit length of the
line.  The default is 0.

\item{\vt g}\\
This parameter provides the shunt conductance per unit length of the
line.  The default is 0.  With level 2, this cannot be nonzero if
{\vt l} or {\vt c} is given, i.e., only {\vt r} can be nonzero if
{\vt g} is nonzero for level = 2, as in the SPICE3 LTRA model.

\item{{\vt z0} or {\vt zo}}\\
This is the line (lossless) characteristic impedance in ohms, given by
\begin{displaymath}
Z_0 = \sqrt{L/C}
\end{displaymath}

\item{{\vt td} or {\vt delay}}\\
This is the (lossless) phase delay of the line in seconds, given by
\begin{displaymath}
T_d = Length\sqrt{LC}
\end{displaymath}

\item{\vt nl}\\
This is the normalized line length at a particular frequency {\it f},
which must also be specified (see below).  This is an alternative
means for setting the line delay, where
\begin{displaymath}
T_d = nl/f
\end{displaymath}
It is an error to give both {\it td} and {\it nl}.

\item{\vt f}\\
This is the frequency at which the normalized line length (above) is
representative.
\end{description}

To model a line with nonzero series inductance and shunt capacitance,
a complete but non-conflicting subset of the parameters {\vt l}, {\vt
c}, {\vt z0}, {\vt td}, {\vt len}, {\vt f}, and {\vt nl} must be
provided.  The {\vt td} parameter is the line delay in seconds, and
the {\vt z0} parameter is the impedance in ohms, for the lossless
case.  Specifying these two parameters is sufficient to completely
specify a lossless line, or the reactive elements of a lossy line. 
Alternatively, one could specify {\vt l} (inductance per length), {\vt
c} (capacitance per length) and {\vt len} (line length).  If {\vt len}
is not specified in either case, the length defaults to unity.  The
delay can also be specified through the {\vt f} (frequency) and {\vt
nl} (normalized length) parameters, where the delay would be set to
{\vt nl/f}.  It is an error to specify both {\vt td} and {\vt f}, {\vt
nl}.  If {\vt td} is specified, or both {\vt f} and {\vt nl} are
specified, along with parameters which yield internally the L and C
values, then the length is determined internally by
\begin{displaymath}
Length = T_d/\sqrt{LC}
\end{displaymath}

One can specify {\vt z0} and {\vt l}, for example, which determines C. 
Unlike the SPICE3 (and SPICE2) lossless line devices, the delay must
be specified through the parameters; there is no default.

\subsubsection{Initial Conditions}

\begin{description}
\item{{\vt v1}, {\vt i1}, {\vt v2}, {\vt i2}}\\
The (optional) initial condition specification consists of the voltage
and current at each of the transmission line ports.  The initial
conditions (if any) apply only when the {\vt uic} option is specified
in transient analysis.
\end{description}

\subsubsection{Timestep and Breakpoint Control}

Internally, the transmission line models store a table of past values
of the currents and voltages at the terminals, which become
excitations after the delay time.  As excitations, these signals can
cause errors or nonconvergence if their rate of change is too large. 
These errors are reduced or eliminated by two mechanisms:  time step
truncation and breakpoint setting.  Time step truncation occurs if the
excitation derivative exceeds a certain threshold.  A breakpoint which
occurs at this time will also be rescheduled to one delay-time later. 
Breakpoints are set by the independent voltage and current sources at
times where a slope change occurs, in piecewise linear outputs.  At a
breakpoint, the internal time step is cut and integration order
reduced to accommodate the change in input accurately.

\begin{description}
\item{\vt truncdontcut}\\
If this flag is given, no complicated timestep cutting will be done. 
In the {\vt level=1} (Pade) case for a lossy line, there is an initial
timestep limiting employed in all cases, to $slopetol{\cdot}tau$,
where $tau$ is an internal time constant of the model.  This limiting
is usually sufficient, and provides the fastest simulation, and
therefor {\vt truncdontcut} is the default in this case.

\item{\vt truncsl}\\
If this flag is given, the device will use a slope-test timestep
cutting algorithm.  This is the default in the lossless case, for any
level.

\item{\vt slopetol}\\
When using the slope-test timestep cutting algorithm, this is the
fraction used in the slope test.  The default is 0.1.  This parameter
is also used in the {\vt level=1} pre-cutting for lossy lines,
described above.

\item{\vt trunclte}\\
This applies to {\vt level=2} (full convolution) only.  When this flag
is given, a local truncation error method is used for timestep
control.  This is the default for lossy lines with {\vt level=2}.

\item{\vt truncnr}\\
This applies to {\vt level=2} only.  When this flag is given, a
Newton-Raphson iterative method is used for timestep control.
\end{description}

If no timestep control keywords are given, the defaults are the
following:

\begin{tabular}{ll}
Lossless case, any level & \vt truncsl\\
Level=1 (Pade) & \vt truncdontcut\\
Level=2 (convolution) & \vt trunclte\\
\end{tabular}

Only one of the trunc flags should be given.  The latter two apply
only to a lossy line with {\vt level=2}, and if given in a different
case the default timestep control is applied.

The slope algorithm computes the difference between the quadratic
extrapolation from the last three and the linear extrapolation from
the last two time points, and uses this difference formula to
determine the time when this error is equal to {\vt slopetol}
multiplied by the maximum absolute value of the signal at the
three time points.

When using {\vt level=2}, there are two alternative timestep control
options.  If the {\vt trunclte} flag is given, the timestep is reduced
by one half if the computed local truncation error is larger than an
error tolerance, which is given by
\begin{displaymath}
tol = trtol\cdot(reltol\cdot(abs(input1) + abs(input2)) + abstol
\end{displaymath}
where {\it trtol}, {\it reltol} and {\it abstol} are the values of the
SPICE options {\vt trtol}, {\vt reltol} and {\vt abstol}, and {\it
input1} and {\it input2} are the internally stored excitations.  If
the {\vt truncnr} flag is given, a timestep is computed based on
limiting the local truncation error to the tolerance given above. 

The handling of breakpoints is controlled by the following flags:

\begin{description}
\item{\vt nobreaks}\\
When this flag is given, there will be no breakpoint rescheduling.

\item{\vt allbreaks}\\
When this flag is give, all breakpoints are rescheduled.

\item{\vt testbreaks}\\
When this flag is given, which is the default, a test is applied and
only breakpoints that pass this test are rescheduled.

\item{\vt rel}\\
When testing breakpoints, this is the relative tolerance value.  The
default is .001.

\item{\vt abs}\\
When testing breakpoints, this is the absolute tolerance value.  The
default is 1e-12.
\end{description}

The breakpoint setting is controlled by the three flags {\vt
nobreaks}, {\vt allbreaks}, and {\vt testbreaks}.  Only one should be
given, and the default is {\vt testbreaks}.  If {\vt nobreaks} is set,
breakpoints will not be rescheduled.  If {\vt allbreaks} is set, all
breakpoints will be rescheduled to the break time plus the delay time. 
The default {\vt testbreaks} will reschedule a breakpoint if a slope
test is passed.  This slope test makes use of the {\vt rel} and {\vt
abs} parameters.  The slopes at the last two time points are computed. 
The breakpoint is rescheduled if
\begin{displaymath}
abs(d1-d2) > max(.01{\cdot}rel{\cdot}vmax, abs)/dt
\end{displaymath}
where {\it d1} and {\it d2} are the two slopes.  The parameters {\vt
rel} and {\vt abs} default to 1e-3 and 1e-12, respectively.  The {\it
dt} parameter is the sum of the last two time deltas, and {\it vmax}
is a running peak detect function representing the maximum voltage
applied to the line.  Note that these are different defaults (and a
different algorithm) from the parameters of the same name used in the
SPICE3 transmission line models.

In most cases, the defaults for the timestep and breakpoint controls
are sufficient.  Excessive setting of breakpoints and timestep
truncation increases execution time, while insufficient control can
produce errors.  An alternative approach is to limit the maximum
internal timestep used with the {\vt .tran} line, which can provide
highly accurate results for comparison when experimenting with the
control parameters.

See the description of the transmission line model (\ref{ltramodel})
for more information.

\subsubsection{History List}

\begin{description}
\item{\vt lininterp}\\
If this flag is set, linear interpolation is used to obtain the
present value of signals in the history list.

\item{\vt quadinterp}\\
If this flag is set, which is the default, quadratic interpolation is
used to obtain the present value of signals in the history list.

\item{\vt compactrel}\\
This is the relative tolerance used in history list compaction for
{\vt level=2}.  The default value is the same as the {\WRspice}
default relative tolerance ({\vt reltol} variable).

\item{\vt compactabs}\\
This is the absolute tolerance used in history list compaction for
{\vt level=2}.  The default value is the same as the {\WRspice} default
absolute tolerance ({\vt abstol} variable).
\end{description}

The flag {\vt lininterp}, when specified, will use linear
interpolation instead of the default quadratic interpolation for
calculating delayed signals.

The parameters {\vt compactrel} and {\vt compactabs} control the
compaction of the past history of values stored for convolution when
using {\vt level=2}.  Larger values of these lower accuracy but
usually increase simulation speed.  These are to be used with the {\vt
trytocompact} option, described in the {\vt .options} section.

%SU-------------------------------------
\subsection{Transmission Line Model}
\index{LTRA model}
\index{TRA model}
\label{ltramodel}

% spModels.hlp:tramodel 040410

{\cb Type Names:} {\vt ltra}, {\vt tra}

The general transmission line model may be used in conjunction with
transmission line devices, though the use is optional.  The parameters
that appear in the model are the same parameters that can be given on
the device line (with the exception of the initial conditions).  These
parameters are discussed in section \ref{tline} describing the
general transmission line. 

Transmission line models can have either of two type names:  {\vt tra}
or {\vt ltra}.  The {\vt ltra} name is required to support the SPICE3
LTRA lossy transmission line model.  If this name is used, the {\vt
level} will default to 2.  This will be overridden if the level is set
explicitly.  If the {\vt tra} keyword is used, then the level will
default to 1.  Otherwise, the two words are interchangeable.

The parameters provided in the model will serve as defaults to the
referencing device, but can be overridden if explicitly set on the
device line.


%SU-------------------------------------
\subsection{Uniform RC Line}
\index{transmission line, lumped}
\index{urc}

% spElements.hlp:urc 012509

\spgen{u{\it name\/} {\it n1 n2 n3 modname} l={\it len} [n={\it lumps\/}]}
\spexamp{u1 1 2 0 urcmod l=50u\\
urc2 1 12 2 umodl l=1mil n=6}

The {\it n1} and {\it n2} are the two element nodes the RC line
connects, while {\it n3} is the node to which the capacitances are
connected.  The {\it modname} is the model name, {\it len} is the
length of the RC line in meters, and {\it lumps}, if specified, is
the number of lumped segments to use in modeling the RC line.  If
not specified, the value will be computed as
\begin{displaymath}
N = \frac{log\left(2{\pi}{F_{max}}RC\cdot\left((k-1)/k\right)^2\right)}{log(k)}
\end{displaymath}
where {\it N} is the number of lumps, {\it k} is the proportionality
factor, {\it R} and {\it C} are the total values for the length, and
$F_{max}$ is the maximum frequency.

%SU-------------------------------------
\subsection{Uniform Distributed RC Model}
\index{URC model}
\label{urcmodel}

% spModels.hlp:urcmodel 012609

{\cb Type Name:} {\vt urc}

The urc model is derived from a model proposed by L.  Gertzberrg in
1974.  The model is generated by a subcircuit type expansion of the
urc line into a network of lumped RC segments with internally
generated nodes.  The RC segments are in a geometric progression,
increasing toward the middle of the urc line, with {\vt k} as a
proportionality constant.  The number of lumped segments used, if not
specified on the urc line, is determined by the following formula:

\begin{displaymath}
N = \frac{log\left(2{\pi}Fmax RC \left((k-1)/k\right)^2\right)}{log(k)}
\end{displaymath}

where {\it Fmax} is the maximum frequency, and {\it R} and {\it C} are
the total values for the given length.

The urc will be made up strictly of resistor and capacitor segments
unless the {\vt isperl} parameter is given a non-zero value, in which
case the capacitors are replaced with reverse biased diodes with a
zero-bias junction capacitance equivalent to the capacitance replaced,
and with a saturation current taking the value given {\vt isperl\/} in
amps per meter of transmission line, and with an optional series
resistance specified by {\vt rsperl} in ohms per meter.

\begin{quote}
\begin{tabular}{|l|l|l|l|l|}\hline
\multicolumn{5}{|c|}{\bf URC Model Parameters}\\ \hline
\bf name & \bf parameter & \bf units & \bf default & \bf example
\\ \hline\hline
\vt k & \rr propagation Constant & - & 1.5 & 1.2\\
\hline
\vt fmax & \rr maximum frequency of interest & $Hz$ & 1.0G & 6.5meg\\
\hline
\vt rperl & \rr resistance per unit length & $\Omega/M$ & 1000 & 10\\
\hline
\vt cperl & \rr capacitance per unit length & $F/M$ & 1.0e-12 & 2pf\\
\hline
\vt isperl & \rr saturation current per unit length & $A/M$ & 0 & -\\
\hline
\vt rsperl & \rr diode resistance per unit length & $\Omega/M$ & 0 & -\\
\hline
\end{tabular}
\end{quote}


%S-----------------------------------------------------------------------------
\section{Voltage and Current Sources}
\index{independent source}
\index{source}
\index{voltage source}
\index{current source}
\label{indepsrc}

% spSources.hlp:src 012509

\spgen{
v{\it name\/} {\it n\/}+ {\it n\/}- [{\it expr\/}]
 [[dc] {\it dcvalue\/}]
 [ac [{\it acmag\/} [{\it acphase\/}]] | table({\it name\/})]\\
 \hspace*{5mm} [distof1 [{\it f1mag\/} [{\it f1phase\/}]]]
 [distof2 [{\it f2mag\/} [{\it f2phase\/}]]]\\
i{\it name\/} {\it n\/}+ {\it n\/}- [{\it expr\/}]
 [[dc] {\it dcvalue\/}]
 [ac [{\it acmag\/} [{\it acphase\/}]] | table({\it name\/})]\\
 \hspace*{5mm} [distof1 [{\it f1mag\/} [{\it f1phase\/}]]]
 [distof2 [{\it f2mag\/} [{\it f2phase\/}]]]\\
a{\it name\/} {\it n\/}+ {\it n\/}- V|I = {\it expr\/}
 [[dc] {\it dcvalue\/}] [ac [{\it acmag\/}
 [{\it acphase\/}]] | table({\it name\/})]\\
 \hspace*{5mm} [distof1 [{\it f1mag\/} [{\it f1phase\/}]]]
 [distof2 [{\it f2mag\/} [{\it f2phase\/}]]]}
\spexamp{vcc 10 0 dc 6\\
vin 13 2 0.001 ac 1 sin(0 1 1meg)\\
v2 10 1 ac table(acvals)\\
isrc 23 21 ac 0.333 45.0 2*sffm(0 1 10k 5 1k)\\
vmeas 12 9\\
vin 1 0 2*v(2)+v(3)\\
azz 2 0 v=.5*exp(v(2))\\
ixx 2 4 pulse(0 1 1n 10n 10n) + pulse(0 1 40n 10n 10n)}

In {\WRspice}, the specification of an ``independent'' source is
completely general, as the output can be governed by an arbitrary
expression containing functions of other circuit variables.  The
syntax is a superset of the notation used in previous versions of
SPICE, which separately keyed independent and dependent sources.

The leading letter ``{\vt v}'' keys a voltage source, and ``{\vt i}''
keys a current source.  In addition, the ``arbitrary source'' used in
SPICE3 is retained, but is keyed by ``{\vt a}'', rather than ``{\vt
b}'' (``{\vt b}'' is used for Josephson junctions in {\WRspice}). 
This is a special case of the general source specification included
for backward compatibility.

The {\it n\/}{\vt +} and {\it n\/}{\vt -} are the positive and
negative nodes, respectively.  Note that voltage sources need not be
grounded.  Positive current is assumed to flow from the positive
node, through the source, to the negative node.  A current source of
positive value will force current to flow in to the {\it n\/}{\vt +}
node, through the source, and out of the {\it n\/}{\vt -} node. 
Voltage sources, in addition to being used for circuit excitation,
are often used as ``ammeters'' in {\WRspice}, that is, zero valued
voltage sources may be inserted into the circuit for the purpose of
measuring current (in {\WRspice}, an inductor can be used for this
purpose as well).  Zero-valued voltage sources will, of course, have
no effect on circuit operation since they represent short-circuits,
however they add complexity which might slightly affect simulation
speed.

In transient and dc analysis, sources can in general have complex
definitions which involve the dependent variable (e.g., time in
transient analysis) and other circuit variables.  There are built-in
functions ({\vt pulse}, {\vt pwl}, etc.) which can be included in the
{\it expr}.

Constant values associated with the source are specified by
the following option keywords:

\begin{description}
\item{{\vt dc} {\it dcvalue}}\\
This specifies a fixed dc analysis value for the source, and enables
the source to be used in a dc sweep if the {\it expr} is given.  If
the {\it expr} is not given, the source is available for use in a dc
sweep whether or not the {\vt dc} keyword is given.  If an {\it expr}
is present without ``{\vt dc} {\it dcvalue\/}'', the time=0 value of
the {\it expr} is used for dc analysis.  If the source value is zero
for both dc and transient analyses, this value and the {\it expr\/}
may be omitted.  If the source is the same constant value in dc and
transient analysis, the keyword ``{\vt dc}'' and the value can be
omitted.

\item{{\vt ac} [[{\it acmag} [{\it acphase}]] $|$ table({\it name\/})]}\\
The parameter {\it acmag} is the ac magnitude and {\it acphase} is the
ac phase.  The source is set to this value in ac analysis.  If {\it
acmag} is omitted following the keyword {\vt ac}, a value of unity is
assumed.  If {\it acphase} is omitted, a value of zero is assumed.  If
the source is not an ac small-signal input, the keyword {\vt ac} and
the ac values are omitted.  Alternatively, a table can be specified,
which contains complex values at different frequency points.  In ac
analysis the source value will be derived from the table.  The table
with the given {\it name} should be specified in a {\vt .table} line,
with the {\vt ac} keyword present.  The values in the table are the
real and imaginary components, and {\it not} magnitude and phase.

\item{{\vt distof1} and {\vt distof2}}\\
These are the keywords that specify that the independent source has
distortion inputs at the frequencies f1 and f2 respectively for
distortion analysis.  The keywords may be followed by an optional
magnitude and phase.  The default values of the magnitude and phase
are 1.0 and 0.0 respectively.
\end{description}

The {\it expr} is used to assign a time-dependent value for
transient analysis and to supply a functional dependence for dc
analysis.  If a source is assigned a time-dependent value, the
time-zero value is used for dc analysis, unless a dc value is also
provided.

%SU-------------------------------------
\subsection{Device Expressions}
\index{source expressions}
\index{device expressions}
\label{devexpr}

% spSources.hlp:devexpr 032120

{\WRspice} contains a separate expression handling system for
expressions found in device lines.  Voltage and current source lines
may contain expressions, as can resistor and capacitor device lines. 
These use the same syntax as is used in vector expressions in
{\WRspice} shell commands (see \ref{vecexpr}), and in single-quoted
expressions.

Although the syntax and most of the function names are equivalent to
vector expressions used in post-processing, the mathematics subsystems
are completely different.  There are three main differences from
ordinary vector expressions:

\begin{enumerate}
\item{The expressions always resolve as scalars.  Before evaluation,
all vectors in the current plot are ``scalarized'' so that they temporarily
have unit length with the current value as the data item.}

\item{All inputs and results are real values.}

\item{In theory, expressions should be differentiable with respect to
node voltages and branch current variables.  If not, lack of
convergence might be seen.  Previous versions of {\WRspice} were more
strict about this than the present version, which allows relational
and logic operators.  It is often very convenient to use these
operators, and in general it seems that their use does not prevent
convergence.  Your experience may be different, however.}
\end{enumerate}

The expression can contain vectors from the current plot
or the {\vt constants} plot, and circuit parameters accessed through
the {\vt @{\it device\/}[{\it param\/}]} construct.  In addition, the
variable ``{\vt x}'', which can appear explicitly in the expression,
is defined to be the controlling variable in dependent sources, or is
set to the scale variable in the analysis (e.g., {\et time} for
transient analysis).

The functions which are used in the device description should be
differentiable with respect to node voltages and branch currents to
promote convergence.  Internally, the expressions are symbolically
differentiated in order to calculate the Jacobian, which is used to
set up the matrix which is solved during analysis.  This would seem to
prevent use of the logical operators, modulus operator, relational
operators ({\vt <}, {\vt >}, etc.), and the tri-conditional operator
({\it a} {\vt ?} {\it b} {\vt :} {\it c\/}) in these expressions where
an operand depends on a node voltage or branch current.  However,
{\WRspice} currently supports relational and logic operators in source
expressions, by assuming identically zero derivatives for these
operators when differentiating.  We find, in practice, that this
rarely causes obvious convergence problems, at least if used in
moderation.

In addition to the built-in functions, expressions used in devices can
include user-defined functions, which must have been defined
previously with the {\cb define} command, or with a {\vt .param} line,
or in a parameter definition list in a subcircuit call or definition. 
These can be used with either math package.  Internally, they are
saved in a data structure known as a parse tree.  When a user-defined
function is called in the context of a device equation, checking is
performed on the user-defined function parse tree to see if any of the
non-differentiable operations are included.  If so, an error message
is generated, and the equation setup fails.

This being said, the situation is actually a bit more complicated.  As
the circuit is being set up, all device equations, after linking in
the user-defined functions if any, are ``simplified'' by evaluating
and collapsing all of the constant terms as far as possible.  This
evaluation allows {\bf all} of the operations.  In general, these
equations can be very complex, with lots of parameters and conditional
tests involving parameters.  However, after simplification, the
equation typically reduces to a much simpler form, and the
conditionals and other unsupported constructs will have disappeared.

The bottom line of all of this is that for equations that appear in a
device description, the circuit variables (node voltages and branch
currents) can't be used in tri-conditional and modulus
sub-expressions.  For example consider the following:

\begin{quote}\vt
.param myabs(a) = 'a < 0 ? -a : a'\\
.param mymax(x,y) = 'x > y ? x : y'\\
E2 2 0 function myabs(v(1))\\
E3 3 0 function mymax(v(1), 0)
\end{quote}

This will not work, as it specifically breaks the rules prohibiting
tri-conditionals.  However, it really should be possible to simulate a
circuit with behavior described as intended above, and it (usually)
is.  One needs to find ways of expressing the behavior by using
supported math.

For example, either of these alternatives would be an acceptable
alternative for {\vt myabs}.
\begin{quote}\vt
.param myabs(a) = abs(a)\\
.param myabs(a) = sqrt(a*a)
\end{quote}
For the special case of {\vt y = 0}, an acceptable substitute
for {\vt mymax} would be
\begin{quote}\vt
.param mymax(x,y) = 0.5*(abs(x) + x)
\end{quote}

Thus, the following lines are equivalent to the original
description, but will be accepted as {\WRspice} input.
\begin{quote}\vt
.param myabs(a) = abs(a)\\
.param mymax(x,y) = 0.5*(abs(x) + x)\\
E2 2 0 function myabs(v(1))\\
E3 3 0 function mymax(v(1), 0)
\end{quote}

Although the lists of math functions available in the two packages are
similar, the internal evaluation functions are different.  The shell
math functions must operate on vectors of complex values, whereas the
functions called in device expressions take scalar real values only. 
Furthermore, the device expressions must be differentiable with
respect to included node voltages and branch currents, as the
derivative of the expression is computed as part of the iterative
process of solving the circuit matrix equations.  We have seen that
this limits the operations available, and it likewise puts
restrictions on the functions.  The {\vt sgn} function grossly
violates the differentiability requirement, and many of the functions
and/or their derivatives have restricted ranges or singularities. 
These can easily lead to convergence problems unless some care is
exercised.

As for all expressions, if an expression is enclosed in single quotes,
it will be evaluated when the file is read, reducing to a constant. 
However, if the expression contains references to circuit variables
such as node voltages or branch currents, it will be left as an
expression, to be evaluated during the simulation.

The following math functions are available in device expressions
on most systems:

\begin{quote}
\begin{tabular}{|l|l|}\hline
{\vt abs}   & absolute value\\ \hline
{\vt acos}  & arc cosine\\ \hline
{\vt acosh} & arc hyperbolic cosine\\ \hline
{\vt asin}  & arc sine\\ \hline
{\vt asinh} & arc hyperbolic sine\\ \hline
{\vt atan}  & arc tangent\\ \hline
{\vt atanh} & arc hyperbolic tangent\\ \hline
{\vt cbrt}  & cube root\\ \hline
{\vt cos}   & cosine\\ \hline
{\vt cosh}  & hyperbolic cosine\\ \hline
{\vt deriv} & derivative\\ \hline
{\vt erf}   & error function\\ \hline
{\vt erfc}  & error function complement\\ \hline
{\vt exp}   & exponential (e raised to power)\\ \hline
{\vt j0}    & Bessel order 0\\ \hline
{\vt j1}    & Bessel order 1\\ \hline
{\vt jn}    & Bessel order {\it n\/}\\ \hline
{\vt ln}    & natural log\\ \hline
{\vt log}   & natural log\\ \hline
{\vt log10} & log base 10\\ \hline
{\vt pow}   & x to power y\\ \hline
{\vt pwr}   & x to power y\\ \hline
{\vt sgn}   & sign (+1,0,-1)\\ \hline
{\vt sin}   & sine\\ \hline
{\vt sinh}  & hyperbolic sine\\ \hline
{\vt sqrt}  & square root\\ \hline
{\vt tan}   & tangent\\ \hline
{\vt tanh}  & hyperbolic tangent\\ \hline
{\vt y0}    & Neumann order 0\\ \hline
{\vt y1}    & Neumann order 1\\ \hline
{\vt yn}    & Neumann order {\it n\/}\\ \hline
\end{tabular}
\end{quote}

Most functions take a single argument.  Exceptions are {\vt jn} and
{\vt yn}, which require two arguments.  The first argument is an
integer value for the order, and the second argument is the function
input.  The {\vt pow} and functionally identical {\vt pwr} functions
also require two arguments, the first argument being the base, and the
second being the exponent.  The {\vt deriv} function will
differentiate the parse tree of the argument with respect to the
``{\vt x}'' variable (whether implicit or explicit).  This is
completely unlike the {\vt deriv} function for vectors, which performs
a numerical differentiation with respect to some scale. 
Differentiating the parse tree gives an analytic result which is
generally more accurate.

In addition, there are special ``tran functions'' (see
\ref{tranfuncs}) which produce specified output in transient analysis. 
{\WRspice} recognizes by context functions and tran functions with the
same name ({\vt exp}, {\vt sin}, {\vt gauss}).  An unrecognized
function is assumed to be a table reference (specified with a {\vt
.table line}).

After simplification by collapsing all of the constant terms,
the following tokens are recognized in a device function.
\begin{quote}
\begin{tabular}{|l|l|}\hline
{\vt +,*,/} & binary: add, multiply, divide\\ \hline
{\vt -} & unary or binary: negate or subtract\\ \hline
{\vt \symbol{94}} & binary: exponentiation\\ \hline
{\vt ()} & association\\ \hline
{\vt ,} & argument separator\\ \hline
{\vt x} & independent variable\\ \hline
{\it number} & a floating point number\\ \hline
{\it string} & a library function, table, or circuit vector\\ \hline
\end{tabular}
\end{quote}

Additionally, the following relational and logical operators are
available.  Use of these operators may impede convergence.  The
operators evaluate to 1.0 when true, 0.0 otherwise.  Inputs to logical
operators are true if integer-converted values are nonzero.

\begin{quote}
\begin{tabular}{|l|l|}\hline
{\vt =,==,eq} & equality\\ \hline
{\vt !=,<>,><,ne} & inequality\\ \hline
{\vt >,gt} & greater than\\ \hline
{\vt <,lt} & less than\\ \hline
{\vt >=,ge} & greater than or equal\\ \hline
{\vt <=,le} & less than or equal\\ \hline
{\vt \&,\&\&,and} & logical and\\ \hline
{\vt $|$,$||$,or} & logical or\\ \hline
{\vt \symbol{126},!,not} & logical not\\ \hline
\end{tabular}
\end{quote}

The independent variable {\vt x} is context specific, and usually represents
a global input variable.  It is the running variable in the current
analysis (time in transient analysis, for example), or the input
variable in dependent source specifications (see \ref{depsrc}).

In a chained analysis, the {\vt x} variable will be that of core
analysis.  Thus, for a chained transient analysis, {\vt x} is time, as
in the unchained case.  Since the functional dependence is inoperable
in any kind of ac small-signal analysis (ac, noise, transfer function,
pz, distortion, ac sensitivity) {\vt x} is not set and never used.  In
``op'' analysis, {\vt x} is always numerically zero.  The same is true
in dc sensitivity analysis.

During a ``pure'' dc sweep analysis, for ``independent'' sources
(keyed by {\vt v}, {\vt i}, or {\vt a} and not {\vt e}, {\vt f}, {\vt
g}, or {\vt h}) other than the swept ones, if an expression is given,
the output of the source will be the result of the expression where
the input {\vt x} is the swept voltage (or the first sweep voltage if
there are two), rather than time as when in transient anslysis. 
However, if the source line has a ``dc'' keyword and optional
following constant value, during pure dc analysis the source will
output the fixed value, or zero, if the value is omitted.  However, in
pure dc analysis the tran functions generally return zero.  The
exceptions are {\vt pwl}, {\vt table} and table references, and {\vt
interp}.  These functions return values, but with the swept voltage
({\vt x}) as the input (in the case of {\vt table} the input may be
explicit anyway).  For ``dependent'' sources (keyed by {\vt e}, {\vt
f}, {\vt g}, or {\vt h}) the {\vt x} is the controlling voltage or
current as in transient analysis.  Again, if a ``dc'' keyword appears,
the output will be fixed at the given value, ignoring the controlling
variable.

Since circuit ``vector'' names used in device expressions must be
resolved before the actual vector is created, there is a potential for
error not present in normal vector expressions.  In particular, name
clashes between circuit node names and vectors in the {\vt constants}
plot can cause trouble.

In a device expressions, if a string token starts with a backslash
('$\backslash$') character, it will not be replaced with a value,
should the name happen to match one of the named constants, or other
potential substitution.  This will be needed, for example, if a node
name matches one of the predefined constant names, and one needs to
reference that node in a source expression.  The token should be
double quoted to ensure this interpretation by the parser.

For example, suppose there is a node named ``{\vt c}'', which is also
the name of a vector in the {\vt constants} plot.  Such a vector
existed in earlier {\WRspice} releases, as it was the speed of
light constant.  This constant is now named ``{\vt const\_c}'' so a
clash with this is unlikely.  However, the user can create a vector
named ``{\vt c}'' in the {\vt constants} plot, so the possibility of a
clash remains.

A source specification like
\begin{quote}\vt
vcon 1 2 5*v(c)
\end{quote}
will cause an error, possibly not until simulation time.  This
can be avoided by use of the form described above.
\begin{quote}\vt
vcon 1 2 5*v("$\backslash$c")
\end{quote}

%SU-------------------------------------
\subsection{POLY Expressions}
\index{poly specification}
\label{polyspec}

% spSources.hlp:polyexpr 012509

In SPICE2, nonlinear polynomial dependencies are specified using a
rather cumbersome syntax keyed by the word {\vt poly}.  For
compatibility, this syntax is recognized by the dependent sources in
{\WRspice}, making possible the use of the large number of behavioral
models developed for SPICE2.

There are three polynomial equations which can be specified through the
{\vt poly({\it N\/})} parameter.
\begin{description}
\item{\vt poly(1) \rm One-dimensional equation}
\item{\vt poly(2) \rm Two-dimensional equation}
\item{\vt poly(3) \rm Three-dimensional equation}
\end{description}
The dimensionality refers to the number of controlling variables; one,
two, or three.  These parameters must immediately follow the {\vt
poly({\it N\/})} token.  The inputs must correspond to the type of the
source, either pairs of nodes for voltage-controlled sources, or
voltage source or inductor names for current-controlled sources. 
Following the inputs is the list of polynomial coefficients which
define the equation.  These are constants, and may be in any format
recognized by {\WRspice}.

The simplest case is one dimension, where the coefficients {\vt c0, c1, ...}
evaluate to
\begin{displaymath}
c_0 + c_1x + c_2x^2 + c_3x^3 + ...
\end{displaymath}
The number of terms is arbitrary.  If the number of terms is exactly one,
it is assumed to be the linear term ({\vt c1}) and not the constant
term.  The following is an example of a voltage-controlled voltage source
which utilizes {\vt poly(1)}.
\begin{quote}\vt
epolysrc 1 0 poly(1) 3 2 0 2 0.25
\end{quote}
The source output appears at node 1 to ground (note that {\WRspice} can use
arbitrary strings as node specifiers).  The input is the voltage difference
between nodes 3 and 2.  The output voltage is twice the input voltage
plus .25 times the square of the input voltage.

In the two dimensional case, the coefficients are interpreted in the
following order.
\begin{displaymath}
c_0 + c_1x + c_2y + c_3x^2 + c_4xy + c_5y^2 + c_6x^3 + c_7x^2y +
c_8xy^2 + c_9y^3 + ...
\end{displaymath}
For example, to specify a source which produces
{\vt 3.5*v(3,4) + 1.29*v(8)*v(3,4)}, one has
\begin{quote}
exx 1 0 poly(2) 3 4 8 0 0 3.5 0 0 1.29
\end{quote}
Note that any coefficients that are unspecified are taken as zero.

The three dimensional case has a coefficient ordering interpretation
given by
\begin{displaymath}
c_0 + c_1x + c_2y + c_3z + c_4x^2 + c_5xy + c_6xz + c_7y^2 + c_8yz +
c_9z^2 + c_{10}x^3 + c_{11}x^2y + c_{12}x^2z +
\end{displaymath}
\begin{displaymath}
c_{13}xy^2 + c_{14}xyz + c_{15}xz^2 + c_{16}y^3 + c_{17}y^2z + c^{18}yz^2 +
c_{19}z^3 + ...
\end{displaymath}
which is rather complex but careful examination reveals the pattern.

%SU-------------------------------------
\subsection{Tran Functions}
\label{tranfuncs}
\index{tran functions}

% spSources.hlp:function 031516

There are several built-in source functions, which are based on and
extend the source specifications in SPICE2.  These generally produce
time-dependent output for use in transient analysis.  For brevity,
these functions are referred to as ``tran functions''.

The tran functions are listed in the table below.  If parameters other
than source amplitudes are omitted, default values will be assumed. 
The tran functions, which require multiple space or comma separated
arguments in a particular order, are:

\begin{quote}
\begin{tabular}{|l|l|}\hline
\vt exp    & exponential specification\\ \hline
\vt texp   & exponential specification\\ \hline
\vt gauss  & gaussian noise specification\\ \hline
\vt tgauss & gaussian noise specification\\ \hline
\vt interp & interpolation specification\\ \hline
\vt pulse  & pulse specification\\ \hline
\vt gpulse & gaussian pulse specification\\ \hline
\vt pwl    & piecewise-linear specification\\ \hline
\vt sffm   & single frequency fm specification\\ \hline
\vt am     & amplitude modulated specification\\ \hline
\vt sin    & sinusoidal specification\\ \hline
\vt tsin   & sinusoidal specification\\ \hline
\vt spulse & sinusoidal pulse specification\\ \hline
\vt table  & reference to a {\vt .table} specification\\ \hline
\end{tabular}
\end{quote}

The the {\vt texp}, {\vt tgauss}, and {\vt tsin} are aliases to {\vt
exp}, {\vt gauss}, and {\vt sin} tran functions that avoid possible
ambiguity with math functions of the same name.

Unlike the math functions, the tran functions have variable-length
argument lists.  If arguments are omitted, default values are assumed. 

The tran functions are most often used to specify voltage/current
source output, however in {\WRspice} these can be used in general
expressions.  The {\vt sin}, {\vt exp}, {\vt gauss} tran functions
have names that conflict with math functions.  There seems to be no
way to absolutely reliably distinguish the tran vs.  math functions by
context, nor is it possible to exclusively rename the functions
without causing huge compatibility problems.

Although the {\vt sin} and {\vt exp} functions are generally
distinguishable except for one unlikely case, with the additional
arguments to the {\vt gauss} function for HSPICE compatibility in
{\WRspice} release 3.0.0, the problem is more acute.

It may be necessary to edit legacy {\WRspice} input files to avoid
this problem.

That being said, new intelligence has been added to differentiate
between the two species.  As in older releases, the argument count
will in many cases resolve ambiguity.

First of all, to guarantee that the tran functions are used in an
expression, they can be called by the synonym names {\vt tsin}, {\vt
texp}, and {\vt tgauss}.

If {\vt sin}, {\vt exp}, or {\vt gauss} use white-space delimiting in
the argument list, then they will be called as tran functions.  The
math functions always use commas to separate arguments.  Commas are
also legal argument separators in tran functions, but (perhaps) are
not as frequently used.  If comma argument separators are used, the
math functions are assumed.

Note that almost all math functions (whith the exception of {\vt
gauss} and a few others) take a single complex vector argument.  It is
possible to give these functions multiple comma-separated
``arguments'', but in evaluation these are collapsed by evaluation of
the comma operator:
\begin{quote}\vt
a,b = (a + j*b)
\end{quote}
So, {\vt sin(1,1)} is equivalent to {\vt sin((1+j))}, which returns a
complex value.

In earlier {\WRspice} releases, {\vt sin(a,b)} was always interpreted
as the tran {\vt sin} function, which has a minimum of two arguments
(and similar for {\vt exp}).  Presently.
\begin{quote}
{\vt sin(a,b)}  comma delimiter implies math\\
{\vt sin(a b)}  space delimiter implies tran
\end{quote}

If ambiguity occurs in a function specification for a voltage or
current source, the tran function is favored if the specification is
ambiguous.

The tran functions implicitly use time as an independent variable, and
generally return 0 in dc analysis.  Exceptions are the {\vt pwl} and
{\vt interp} forms, which implicitly use the value of ``{\vt x}''
which is context-specific.  In dependent sources, this is the
controlling value of the source rather than time.  The {\vt table}
function takes its input directly from the second argument.

\index{tran functions, in expressions}
The tran functions can also be used in regular vector expressions. 
They generate a vector corresponding to the current scale, which must
exist, be real, and monotonically increasing.  The length of the
returned vector is equal to the length of the scale.
 
For example:
\begin{quote}
(do a tran analysis to establish a reasonable scale)\\
{\vt let a = pulse(0 1 10n 10n 10n 20n)}\\
{\vt plot a}\hspace{1cm}(plots a pulse waveform)\\
\end{quote}
The construct can be used like any other token in a regular vector
expression.

The tran functions (other than {\vt table} and {\vt interp}) take
constant expressions as arguments.  The argument list consists of
comma or space separated expressions.  Arguments are parsed as
follows:

\begin{enumerate}
\item{The outer parentheses, if these exist, are stripped from the list.
     {\WRspice} can recognize most instances where parentheses are not
     included, since these are optional in standard SPICE syntax for the
     tran functions.}
\item{Commas that are not enclosed in parentheses or square brackets are
     converted to spaces.}
\item{Minus signs (`{\vt -}') that are not enclosed in parentheses or square
      brackets, and are not followed by white space, and are preceded
      by white space, are assumed to be the start of a new token
      (argument).  An expression termination character (semicolon) is
      added to the end of the previous argument.}
\item{The string is parsed into individual expression units, which are
      the arguments.  The separation is determined by context.}
\end{enumerate}

There is no provision for a unary `{\vt +}', thus, {\vt func(a, +b)} is
taken as {\vt func(a+b)}.  Parenthesis can be added to enforce
precedence.  The minus sign handling implies that {\vt func(a, -b)} and
{\vt func(a -b)} are taken as {\vt func((a), (-b))}, whereas
{\vt f(a-b), f(a- b), f(a - b)}, etc are taken as {\vt func((a)-(b))}.

\index{user-defined functions}
In addition to the built-in functions, expressions used in sources can
include user defined functions, which must have been defined
previously with the {\cb define} command.  These may be useful for
encapsulating the tran functions.

\spexampo{
      define mypulse(delay, width) pulse(0 1 delay 1n 1n width)\\
      ...\\
      v1 1 0 mypulse(5n, 10n)}

Recall that a line in the deck starting with ``{\vt *@}" will be
executed before the deck is parsed.

\begin{quote}\vt
      title line\\
      {\vt *@} define mypulse(delay, width) pulse(0 1 delay 1n 1n width)\\
      v1 1 0 mypulse(5n, 10n)\\
      r1 1 0 100\\
      .end
\end{quote}

The following paragraphs describe the tran functions in detail.

\subsubsection{Exponential}
\index{exponential specification}
\index{exp tran function}

% spSources.hlp:texp 060119

\spgen{exp({\it v1 v2\/} [{\it td1 tau1 td2 tau2\/}])}
\spexampo{vin 3 0 exp(-4 -1 2ns 30ns 60ns 40ns)}

This function can be called as {\vt texp} to avoid possible conflict
with the {\vt exp} math function.

\begin{quote}
\begin{tabular}{|l|l|l|l|} \hline
{\bf parameter} & {\bf description} & {\bf default value} &
 {\bf units}\\ \hline\hline
{\it v1} & initial value & & volts or amps\\ \hline
{\it v2} & pulsed value & & volts or amps\\ \hline
{\it td1} & rise delay time & 0.0 & seconds\\ \hline
{\it tau1} & rise time constant & {\vt tstep} & seconds\\ \hline
{\it td2} & fall delay time & {\it td1} + {\vt tstep} & seconds\\ \hline
{\it tau2} & fall time constant & {\vt tstep} & seconds\\ \hline
\end{tabular}
\end{quote}

The shape of the waveform is described by the following table:

\begin{quote}
\begin{tabular}{ll}
{\bf time} & {\bf value}\\[0.5ex]
0 & {\it v1\/}\\
{\it td1\/} & {\it v1\/} $+$ ({\it v2\/}$-${\it v1\/})(1 $-$
 exp($-$(time$-${\it td1\/})/{\it tau1\/}))\\
{\it td2\/} & {\it v1\/} $+$ ({\it v2\/}$-${\it v1\/})(1 $-$
exp($-$(time$-${\it td1\/})/{\it tau1\/})) $+$\\
 & ({\it v1\/}$-${\it v2\/})(1 $-$ exp($-$(time$-${\it
 td2\/})/{\it tau2\/}))\\[2ex]
\end{tabular}
\end{quote}

This function applies only to transient analysis, where time is the
running variable.  When referring to default values, {\vt tstep} is
the printing increment and {\vt tstop} is the final time in transient
analysis, see \ref{tranline} for explanation.  The argument count is
used to distinguish this function from the math function of the same
name.

If this function is used bare and not part of an expression in a
voltage or current source, then the general source instance parameters
{\vt prm1} etc.  map as below.  It is possible to read and alter these
values using the special vector @{\it device}[{\it param\/}]
construct, or with the {\cb alter} and {\cb sweep} commands.  However,
there is no sanity checking so bad numbers can cause wild behavior or
worse.

\begin{quote}
\begin{tabular}{ll}
prm1 & v1\\
prm2 & v2\\
prm3 & td1\\
prm4 & tau1\\
prm5 & td2\\
prm6 & tau2\\
\end{tabular}
\end{quote}

\subsubsection{Gaussian Random}
\index{Gaussian random specification}
\index{gauss tran function}
\index{tgauss tran function}
\label{tgauss}

% spSources.hlp:tgauss 060119

\spgen{gauss({\it stddev\/} {\it mean\/} {\it lattice\/} [{\it interp\/}])}
\spexamp{v1 1 0 gauss(.5, 2, 100n, 1)\\
    v2 1 0 gauss(.1, 0, 0)}

This function can be called as {\vt tgauss} to avoid possible conflict
with the {\vt gauss} math function.

\begin{quote}
\begin{tabular}{|l|l|l|l|} \hline
{\bf parameter} & {\bf description} & {\bf default value} &
 {\bf units}\\ \hline\hline
{\it stddev\/} & standard deviation &  & none\\ \hline
{\it mean\/} & mean value &  & none\\ \hline
{\it lattice\/} & sample period &  & seconds\\ \hline
{\it interp\/} & interpolation & 0 & none\\ \hline
\end{tabular}
\end{quote}

The {\vt gauss} function can be used to generate correlated random
output.  This function takes three or four arguments.

The parameter {\it lattice} is for use in transient analysis.  A new
random value is computed at each time increment of {\it lattice}.  If
{\it lattice} is 0, then no lattice is used, and an uncorrelated
random value is returned for each call.  The {\it interp} parameter,
used when {\it lattice} is nonzero, can have value 1 or 0.  If {\it
interp} is nonzero, the value returned by the function is the (first
order) interpolation of the random values at the lattice points which
frame the time variable.  If {\it interp} is 0, the function returns
the lattice cell's value for any time within the lattice cell, i.e., a
random step with an amplitude change at every lattice point.

The first example above provides a random signal with standard
deviation of .5V and mean of 2V, based on random samples taken every
100nS.

The {\it lattice} value should be on the order of the user print
increment {\vt tstep} in the transient analysis.  It should not be
less than the maximum internal time step, since the past history is
not stored, and a rejected time point may back up the time across more
than one lattice cell, thus destroying the correlation.

This function applies only to transient analysis, where time is the
running variable.  The argument count is used to distinguish this
function from the math function of the same name.

If this function is used bare and not part of an expression in a
voltage or current source, then the general source instance parameters
{\vt prm1} etc.  map as below.  It is possible to read and alter these
values using the special vector @{\it device}[{\it param\/}]
construct, or with the {\cb alter} and {\cb sweep} commands.  However,
there is no sanity checking so bad numbers can cause wild behavior or
worse.

\begin{quote}
\begin{tabular}{ll}
prm1 & stddev\\
prm2 & mean\\
prm3 & lattice\\
prm4 & interp\\
\end{tabular}
\end{quote}

One important application of this function is to provide time-domain
noise generation for noise modeling\cite{jeffery}.  For example, below
is a circuit which simulates the thermal noise generated in a resistor
at 4.2K.
 
\begin{quote}\vt
*** noise demo\\
{\vt *@} define noise(r,t,dt,n) gauss(sqrt(2*boltz*t/(r*dt)), 0, dt, n)\\
r1 1 0 1.0\\
ir1 1 0 noise(1.0, 4.2, 0.5p, 1)\\
c1 1 0 1p\\
\\
.control\\
tran 1p 1n\\
plot v(1)\\
.endc\\
\end{quote}
 
The second line defines a function named ``noise'' that takes four
arguments:  the resistance, temperature in Kelvin, the lattice time
increment, and the interpolation method.  This is simply a wrapper
around a {\vt gauss} call, incorporating the standard noise equation
for current through a resistor at a given temperature, and taking the
inherent bandwidth to be one half of the reciprocal of the lattice
time increment (per Nyquist).  The noise function is used in the
specification for current source {\vt ir1}.  In a more complicated
case, each resistor in a circuit may have an associated noise current
source similarly defined.  It may be possible to demonstrate errors
due to thermal noise when simulating the circuit.

\subsubsection{Interpolation}
\index{interpolation specification}
\index{interp tran function}

% spSources.hlp:interp 012509

\spgen{interp({\it vector})}
\spexampo{vin 1 0 interp(tran1.v(1))}

The output is {\it vector} interpolated to the scale of the current plot. 
When used in a source, the output of the source is the interpolated
vector, or the initial or final value for points off the ends of the
original scale.

For example, say an amplifier produces vector {\vt v(1)} (an output)
in plot {\vt tran1}.  One desires to apply this as input to another
circuit.  This is achieved with a source specification like that shown
in the example above.  This works in ordinary vector expressions as
well.

\subsubsection{Pulse}
\index{pulse specification}
\index{pulse tran function}

% spSources.hlp:pulse 032220

\spgen{pulse({\it v1 v2} [{\it td tr tf pw per td1 td2} ...]
  [{\it pattern\_spec}])}
\spexamp{vin 3 0 pulse(-1 1 2ns 2ns 2ns 50ns 100ns)\\
vin1 1 0 pulse(0 1 2n .5n .5n 1n 0 6n 10n)\\
v2 4 0 v(1)*pulse(0 1 5n 10n)}

This function applies only to transient analysis, where time is the
running variable.  When referring to default values, {\vt tstep} is
the printing increment and {\vt tstop} is the final time in transient
analysis.

The following are the numerical parameters, the {\it pattern\_spec} is
used to specify a patterned pulse train and the syntax will be
described separately below.

\begin{quote}
\begin{tabular}{|l|l|l|l|} \hline
{\bf parameter} & {\bf description} & {\bf default value} &
  {\bf units}\\ \hline\hline
{\it v1} & initial value & & volts or amps\\ \hline
{\it v2} & pulsed value & & volts or amps\\ \hline
{\it td} & delay time & 0.0 & seconds\\ \hline
{\it tr} & rise time & {\vt tstep} & seconds\\ \hline
{\it tf} & fall time & {\vt tstep} & seconds\\ \hline
{\it pw} & pulse width & {\vt tstep} & seconds\\ \hline
{\it per} & period & {\vt tstop} & seconds\\ \hline
\end{tabular}
\end{quote}

The signal starts at value {\it v1} at {\vt time=0}.  At time {\it
td\/}, the pulse begins, the value arriving linearly at {\it v2} after
the rise time {\it tr\/}.  The value {\it v2} is maintained for the
pulse width time {\it pw\/}, then reverts linearly to value {\it v1}
over the fall time {\it tf\/}.  If a period {\it per} is given and
nonzero, a periodic train of pulses is produced, starting at {\it
td\/}, with the second pulse starting at {\it td\/}+{\it per\/}, etc. 
The minimum value for {\it per} is {\it tr\/}+{\it tf\/}+{\it pw\/},
which is silently enforced.

Numbers {\it td1\/}, {\it td2\/}, etc.  following {\it per} are taken
as additional delay values (similar to {\it td\/}) and a pulse will
start at each given value.  These will actually be superposed periodic
pulse trains if {\it per} is nonzero (it must be given in any case
when using the additional delays).

A single pulse so specified is described by the following table:
\begin{quote}
\begin{tabular}{ll}

{\bf time} & {\bf value}\\[0.5ex]
{\vt 0} & {\it v1}\\
{\it td} & {\it v1}\\
{\it td\/}+{\it tr} & {\it v2}\\
{\it td\/}+{\it tr\/}+{\it pw} & {\it v2}\\
{\it td\/}+{\it tr\/}+{\it pw\/}+{\it tf} & {\it v1\/}\\
{\vt tstop} & {\it v1}\\[2ex]
\end{tabular}
\end{quote}

Intermediate points are determined by linear interpolation.  It is not
an error to omit unused parameters, for example the specification
\begin{quote}
{\vt vxx 3 0 pulse(0 1 2n 2n)}
\end{quote}
describes a voltage which, starting from 0, begins rising at 2
nanoseconds, reaching 1 volt at 4 nanoseconds, and remains at that
value.

If this function is used bare and not part of an expression in a
voltage or current source, then the general source instance parameters
{\vt prm1} etc.  map as below.  It is possible to read and alter these
values using the special vector @{\it device}[{\it param\/}]
construct, or with the {\cb alter} and {\cb sweep} commands.  However,
there is no sanity checking so bad numbers can cause wild behavior or
worse.

\begin{quote}
\begin{tabular}{ll}
prm1 & v1\\
prm2 & v2\\
prm3 & td\\
prm4 & tr\\
prm5 & tf\\
prm6 & pw\\
prm7 & per\\
\end{tabular}
\end{quote}

\subsubsection{Pattern Generation}
\label{pattern}
\index{pattern specification}

The transient {\vt pulse} and {\vt gpulse} functions support a
pattern-specification language borrowed from the pattern source of
HSPICE.  This applies only when a period is given so that the source
would provide periodic output.  The {\it pattern\_spec} must appear
after the additional delay numbers, if any.  The patterning enables
the user to select in which periods a pulse is actually generated, and
applies to all periodic trains if additional delays are given.

The {\it pattern\_spec} consists of one or more ``bstrings'', each of
which can have modifying options.

\begin{quote}
{\vt b}{\it data} [{\vt r}[{\vt =}{\it rpt\/}]] [{\vt rb}{\vt =}{\it bit\/}] ...
\end{quote}

The first token is the bstring, which must start with the letter `{\vt
b}' (case insensitive) and continues for arbitrary length with 0 and 1
to indicate the presence or absence of a pulse in each period frame,
traversing left to right.  Actually, the characters {\vt 0,f,F,n,N}
are taken as `{\vt 0}', anything else is taken as '{\vt 1}'.  Note
that the HSPICE {\vt m} (intermediate value) and {\vt z}
(disconnected) are not currently supported.

A bstring can be followed by up to one each of two case-insensitive
options.
\begin{description}
\item{\vt r} [{\vt =} {\it rpt\/}]\\
This provides a repetition count.  If an integer follows the literal
`{\vt r}', it is taken as the repetition count.  White space and an
equal sign can be included, and will be ignored.  If no number is
given, 1 is assumed, i.e., the pattern will repeat once.  If {\vt r}
is not given, there will be no repetition.  If the number given is
negative, the pattern will continue repeating indefinitely.

\item{rb} {\vt =} {\it bit\/}\\
The {\it bit} is an integer ranging from 1 to the length of the
bstring pattern, and indicates the start point for repetitions, if
any.  If not given, the effective value is 1, indicating that the
entire pattern repeats.  An integer must follow {\vt rb}, white space
and an equal sign will be ignored.

\item{\vt bprbs}[{\it N\/}]\\
In {\WRspice}, the bstring can also specify pseudo-random sequences
through the syntax {\vt bprbs}[{\it N\/}].  The {\it N} is an unsigned
integer, defaulting to 6 if not given, and clipped to the range 6--12
if not in this range.  This is the degree of the pseudo-random
sequence, i.e., the sequence length is $2^N-1$.  This will accept the
{\vt r} and {\vt rb} modifiers, however {\vt rb} is treated a little
differently.  With this form, it rotates the bit sequence, giving
rotated output starting with the first pass.  The same degree with
different {\vt rb} values produces uncorrelated sequences.
\end{description}

An arbitrary number of bstrings with options can appear in the
specification, the result from each bstring with options will be
concatenated.  If indefinite repetition is specified for a bstring,
any bstrings that follow will be ignored.

Example:\\
{\vt b101101 r=1 rb=2 b000111}
\begin{quote}
\begin{itemize}
\item{emit 101101}
\item{repeat once starting at bit 2: 01101}
\item{emit 000111}
\end{itemize}
\end{quote}

\subsubsection{Gaussian Pulse}
\index{gaussian pulse specification}
\index{gpulse tran function}

% spSources.hlp:gpulse 060119

\spgen{gpulse([{\it v1 v2 td pw per td1 td2} ...]
 [{\it pattern\_spec\/}])}
\spexamp{vsfq 0 0 gpulse(0 0 20p 2p 0 40p 60p)\\
vpulse 1 0 gpulse(0 1 100p 5p 100p)}

This generates a gaussian pulse signal, and as a special case, as a
voltage source will generate single flux quantum (SFQ) pulses.  This
function applies only to transient analysis, where time is the running
variable.  The following are the numerical parameters, the {\it
pattern\_spec} is used to specify a patterned pulse train and the
syntax is described in \ref{pattern}.

\begin{quote}
\begin{tabular}{|l|l|l|l|} \hline
{\bf parameter} & {\bf description} & {\bf default value} &
  {\bf units}\\ \hline\hline
{\it v1} & base value & 0.0 & volts or amps\\ \hline
{\it v2} & pulse peak value & {\it v1} & volts or amps\\ \hline
{\it td} & delay time & 0.0 & seconds\\ \hline
{\it pw} & pulse width & see description & seconds\\ \hline
{\it per} & period & 0.0 & seconds\\ \hline
\end{tabular}
\end{quote}

{\bf Warning:} The pulse width is interpreted as the full-width
half-maximum in release 4.3.3 and later.  In earlier releases, this
was taken as the ``variance'' (width where amplitude is 1/e of the
peak).  Presently, this interpretation can be coerced by giving a {\bf
negative} pulse width, the absolute value will be used as the
variance.

The expression used to generate a pulse is\\
$pw > 0$:\\
\begin{quote}
{\it value} = $v1 + (v2 - v1){\cdot}exp(-(4\cdot\ln(2)\cdot(time-td)/pw)^2)$
\end{quote}
$pw < 0$:\\
\begin{quote}
{\it value} = $v1 + (v2 - v1){\cdot}exp(-((time-td)/-pw)^2)$
\end{quote}

The {\it td} delay value specifies the time of the initial pulse peak. 
The {\it pw} defines the pulse width, as described above.  If the {\it
per} is given a nonzero value larger than twice the {\it pw}, a train
of pulses will be generated, the first being at {\it td} and at time
increments of {\it per} thereafter.

Numbers found after the {\it per} are taken as additional delays,
similar to {\it td\/}.  The output is a superposition of pulses found
at each delay value (including {\it td\/}).  If the {\it per} is given
a value 0.0, only one pulse per delay value is emitted.  If the {\it
per} specifies a viable period, pulses are emitted at each delay value
and increments of {\it per\/}.

If this function is used bare and not part of an expression in a
voltage or current source, then the general source instance parameters
{\vt prm1} etc.  map as below.  It is possible to read and alter these
values using the special vector @{\it device}[{\it param\/}]
construct, or with the {\cb alter} and {\cb sweep} commands.  However,
there is no sanity checking so bad numbers can cause wild behavior or
worse.

\begin{quote}
\begin{tabular}{ll}
prm1 & v1\\
prm2 & v2\\
prm3 & td\\
prm4 & pw\\
prm5 & per\\
\end{tabular}
\end{quote}

Periodic pulses can be set to a pattern via the {\it pattern\_spec},
which can appear following all delay values, if any.  The syntax is
described in \ref{pattern}.

A single flux quantum (SFQ) pulse, as a voltage applied across an
inductor, will induce a single flux quantum of
\begin{quote}
 $\Phi_0$ = $h/(2e)$ = 2.06783fWb
\end{quote}
where {\it h} is Planck's constant, {\it e} is the electron charge. 
With superconductors, the flux that threads superconducting loops is
quantized in increments of this value, due to the requirement that the
superconducting wave function meet periodic boundary conditions around
the loop.

If the {\vt pw} is not given or given as zero, the source will be
configured to produce an SFQ pulse with the given amplitude.  Thus,
the actual pulse width will be computed internally, with amplitude not
zero, as
\begin{quote}
$pw = 2\sqrt{ln(2)}\Phi_0/(abs(v2-v1)\sqrt\pi)$
\end{quote}
where $\Phi_0$ is the flux quantum whose value is given above.

Similarly, if the amplitude is set to zero, i.e., {\it v2} = {\it
v1\/}, the amplitude will be computed from the pulse width to yield an
SFQ pulse.  The computed amplitude is
\begin{quote}
$v2 = v1 + 2\sqrt{ln(2)}\Phi_0/(pw\sqrt\pi)$
\end{quote}

If both amplitude and pulse width are set to zero or not given, the
full-width half-maximum SFQ pulse width is taken as the TSTEP
transient analysis parameter, and the amplitude is computed as above.

In superconducting electronics, single flux quantum pulses are
generated and received by logic circuits.  A generator of SFQ pulses
is therefor a useful item when working with this technology.

Example
\begin{quote}\vt
* gaussian pulse\\
\\
v1 1 0 gpulse(0 0 20p 2p 0 40p)\\
l1 1 2 10p\\
b1 2 0 100 jj3 area=.2\\
r2 2 0 2\\
.tran .1p 100p uic\\
.plot tran v(1) v(2) i(l1) ysep\\
\\
\vt * Nb 4500 A/cm2\\
.model jj3 jj(rtype=1, cct=1, icon=10m, vg=2.8m, delv=0.08m,\\
+ icrit=1m, r0=30, rn=1.7, cap=1.31p)
\end{quote}

In the example, the generator produces two SFQ pulses.  The second
pulse causes the Josephson junction to emit a flux quantum, the
second one from the source is therefor expelled.  The inductor
current shows the same value before and after the second pulse,
as expected.

\subsubsection{Piecewise Linear}
\index{PWL specification}
\index{pwl tran function}

% spSources.hlp:pwl 022117

\spgen{pwl({\it t1 v1\/} [{\it t2 v2 t3 v3 t4 v4 ...\/}]
 [{\vt r} [[=] {\it ti\/}]] [{\vt td} [=] {\it delay\/}]\\
pwl({\it vec1\/} [{\it vec2\/}]
 [{\vt r} [[=] {\it ti\/}]] [{\vt td} [=] {\it delay\/}]}
\spexampo{vclock 7 5 pwl(0 -7 10ns -7 11ns -3 17ns -3 18ns -7 50ns -7)\\
vin 2 0 pwl(times amplitudes td=1ns)}

Each pair of values ({\it ti\/}, {\it vi\/}) specifies that the value of the
source is {\it vi\/} (in volts or amps) at time = {\it ti\/}.  The
value of the source at intermediate values of time is determined by
using linear interpolation on the input values.  For times before the
initial time value, the return is the initial value, and for times
after the final time value, the return is the final value.

In the second form, the values are provided in the named vectors,
which must be in scope when the deck is parsed (which most often
happens just before a simulation is run, and not when the file is read
into {\WRspice}).  If a single vector name is given, its values are
expected to be the same as would be provided in the first form, i.e.,
an alternating sequence of times and amplitudes.  If two vector names
are given, the first vector is expected to contain time values only,
and the second vector contains the corresponding amplitudes.  If
vectors are used, all values are obtained from the vectors, as it is
presently not possible to mix vectors and explicit values.

In the example below, both voltage sources provide the same output. 
Note that if the vectors are saved in the {\vt constants} plot, they
will be resolved by name in any context.

Example
\begin{quote}\vt
* PWL Test\\
\\
.exec\\
compose constants.pwlvals values 0 0 10p 0 20p 1 40p 1 50p 0\\
compose constants.tvals values 0 10p 20p 40p 50p\\
compose constants.xvals values 0 0 1 1 0\\
.endc\\
\\
v1 1 0 pwl(pwlvals)\\
v2 2 0 pwl(tvals xvals)
\end{quote}

Use of vectors can simplify and make more efficient the handling of
very long PWL lists.  For example, suppose that one has just run a
long simulation of a circuit, and one would like to apply the output
of this circuit to another circuit.  Suppose that the output is in
vector {\vt v(1)}.  First, save this vector as a binary rawfile.  The
binary format is faster to read/write than the default ASCII.

\begin{quote}\vt
set filetype=binary\\
write myfile.raw v(1)
\end{quote}

Then, on a subsequent run, one can load the saved vectors (the vector
and its scale are both saved), and for convenience add them to the
{\vt constants} plot.

\begin{quote}\vt
load myfile.raw\\
let constants.tvals = time constants.xvals = v(1)
\end{quote}

This needs to be done once only per session.  If the circuit file
contains a line like

\begin{quote}\vt
vin 2 0 pwl(tvals xvals)
\end{quote}

Then one can run any number of simulations while avoiding the need to
repeatedly parse and recreate the long PWL list from an input file.

The {\vt pwl} function is currently the only tran function that takes
parameters.  These parameters belong to the {\vt pwl} function, and
must be included inside the parentheses when parentheses are used. 
The parameters are specified with an identifier, optionally followed
by an equal sign, and a number.  The parameters must appear following
the values list or vector names.

\begin{description}
\item{\vt r}\\
The {\vt r} (repeat) option forces the wave function to repeat
periodically.  A time value can optionally follow {\vt r}, which if
given must be one of the {\it ti} given but not the final time value,
or it can be zero.  If the time value is omitted, it is taken as zero. 
This time value is ``mapped'' to the final time value when the
sequence repeats.
 
For example, after the circuit time slightly exceeds the final time
value given, the next output value will be the value following the time
given with {\vt r}, and its time will be the final time plus the
difference between the {\vt r} point time and the point that follows.

\item{\vt td}\\
The {\vt td} parameter can be set to a delay time, that will be added
to all time values, including those generated with the {\vt r}
parameter.
\end{description}

The two parameters are intended to behave in the same manner as
similar parameters defined in HSPICE.  There is one difference between
{\WRspice} and HSPICE {\vt pwl} behavior:  if the first time value is
nonzero, in HSPICE the time zero value will be the source {\vt dc}
value, in {\WRspice} is will be the value at the first given time
point.
 
In dependent sources where the controlling input is specified, a {\vt
pwl} construct if used in the expression for the source will take as
input the value of the controlling input, and not time.  This is one
means by which a piecewise-linear transfer function can be
implemented.  A similar capability exists through the {\vt table}
function.

Example:
\begin{quote}
    {\vt e1 1 0 2 0 pwl(-1 1 0 0 1 1)}
\end{quote}

The example above implements a perfect rectifier (absolute value
generator) for voltages between -1 and 1V.  Outside this range, the
output is clipped to 1V.

The {\vt r} and {\vt td} parameters work in this case as well, doing
the same things, but with respect to the controlling input.  For
example:

\begin{quote}\vt
e1 1 0 2 0 pwl(0 0 .5 1 1 0 R)\\
v1 2 0 pwl(0 0 100p 5)
\end{quote}

The output of {\vt e1} is a periodic triangular wave, generated by
linearly sweeping the periodic transfer function.

\subsubsection{Single-Frequency FM}
\index{single frequency FM specification}
\index{sffm tran function}

% spSources.hlp:sffm 060119

\spgen{sffm({\it vo va\/} [{\it fc mdi fs\/}])}
\spexampo{v1 12 0 sffm(0 1m 20k 5 1k)}

\begin{quote}
\begin{tabular}{|l|l|l|l|} \hline
{\bf parameter} & {\bf description} & {\bf default value} &
 {\bf units}\\ \hline\hline
{\it vo} & offset & & volts or amps\\ \hline
{\it va} & amplitude & & volts or amps\\ \hline
{\it fc} & carrier frequency & 1/{\vt tstop} & hz\\ \hline
{\it mdi} & modulation index & 0 &\\ \hline
{\it fs} & signal frequency & 1/{\vt tstop} & hz\\ \hline
\end{tabular}
\end{quote}

The shape of the waveform is described by the following equation:
\begin{quote}
value = {\it vo\/} + {\it va\/}$\cdot$sin((2$\pi\cdot${\it
fc\/}$\cdot$time)
 $+$ {\it mdi\/}$\cdot$sin(2$\pi\cdot${\it fs\/}$\cdot$time))
\end{quote}

This function applies only to transient analysis, where time is the
running variable.  When referring to default values, {\vt tstep} is
the printing increment and {\vt tstop} is the final time in transient
analysis, see \ref{tranline} for explanation.

If this function is used bare and not part of an expression in a
voltage or current source, then the general source instance parameters
{\vt prm1} etc.  map as below.  It is possible to read and alter these
values using the special vector @{\it device}[{\it param\/}]
construct, or with the {\cb alter} and {\cb sweep} commands.  However,
there is no sanity checking so bad numbers can cause wild behavior or
worse.

\begin{quote}
\begin{tabular}{ll}
prm1 & vo\\
prm2 & va\\
prm3 & fc\\
prm4 & mdi\\
prm5 & fs\\
\end{tabular}
\end{quote}

\subsubsection{Amplitude Modulation}
\index{am specification}
\index{am tran function}

% spSources.hlp:am 060119

\spgen{am({\it sa oc fm fc td\/})}
\spexampo{vin 12 0 am(10 1 10meg 100meg 10n)}

\begin{quote}
\begin{tabular}{|l|l|l|l|} \hline
{\bf parameter} & {\bf description} & {\bf default value} &
 {\bf units}\\ \hline\hline
{\it sa} & signal amplitude & & volts or amps\\ \hline
{\it oc} & offset constant & & \\ \hline
{\it fm} & modulation frequency & 1/{\vt tstop} & hz\\ \hline
{\it rc} & carrier frequency & 0.0 & hz\\ \hline
{\it td} & signal delay & 0.0 & seconds\\ \hline
\end{tabular}
\end{quote}

The shape of the waveform is described by the following table:

\begin{quote}
\begin{tabular}{ll}
{\bf time} & {\bf value}\\[0.5ex]
0 to {\it td} & 0\\
{\it td} to {\vt tstop} & {\it sa\/} ${\cdot} \{oc +
 sin(2\pi{\cdot}fm{\cdot}(time-td))\}
 {\cdot} sin(2\pi{\cdot}fc{\cdot}(time-td))$\\
\end{tabular}
\end{quote}

This function applies only to transient analysis, where time is the
running variable.  When referring to default values, {\vt tstep} is
the printing increment and {\vt tstop} is the final time in transient
analysis</a>.  This function is a work-alike to the similar function
found in HSPICE.

If this function is used bare and not part of an expression in a
voltage or current source, then the general source instance parameters
{\vt prm1} etc.  map as below.  It is possible to read and alter these
values using the special vector @{\it device}[{\it param\/}]
construct, or with the {\cb alter} and {\cb sweep} commands.  However,
there is no sanity checking so bad numbers can cause wild behavior or
worse.

\begin{quote}
\begin{tabular}{ll}
prm1 & sa\\
prm2 & oc\\
prm3 & fm\\
prm4 & fc\\
prm5 & td\\
\end{tabular}
\end{quote}

\subsubsection{Sinusoidal}
\index{sine specification}
\index{sin tran function}

% spSources.hlp:tsin 060119

\spgen{sin({\it vo va\/} [{\it freq td theta phi\/}])}
\spexampo{vin 3 0 sin(0 1 100meg 1ns 1e10)}

This function can be called as {\vt tsin} to avoid possible conflict
with the {\vt sin} math function.

\begin{quote}
\begin{tabular}{|l|l|l|l|} \hline
{\bf parameter} & {\bf description} & {\bf default value} &
 {\bf units}\\ \hline\hline
{\it vo} & offset & & volts or amps\\ \hline
{\it va} & amplitude & & volts or amps\\ \hline
{\it freq} & frequency & 1/{\vt tstop} & hz\\ \hline
{\it td} & delay & 0.0 & seconds\\ \hline
{\it theta} & damping factor & 0.0 & 1/seconds\\ \hline
{\it phi} & phase delay & 0.0 & degrees\\ \hline
\end{tabular}
\end{quote}

The shape of the waveform is described by the following table:

\begin{quote}
\begin{tabular}{ll}
{\bf time} & {\bf value}\\[0.5ex]
0 to {\it td} & {\it vo\/} + {\it va}${\cdot}sin(\pi{\cdot}phi/180)$\\
{\it td} to {\vt tstop} & {\it vo\/} $+$ {\it va\/}$\cdot$exp($-$(time$-${\it
td\/})$\cdot${\it theta\/}) $\cdot$
 sin(2$\pi\cdot$({\it freq\/}$\cdot$(time$-${\it td\/}) +
 $\pi{\cdot}phi/360$))\\[2ex]
\end{tabular}
\end{quote}

This function applies only to transient analysis, where time is the
running variable.  When referring to default values, {\vt tstep} is
the printing increment and {\vt tstop} is the final time in transient
analysis, see \ref{tranline} for explanation.  The argument count is
used to distinguish this function from the math function of the same
name.

If this function is used bare and not part of an expression in a
voltage or current source, then the general source instance parameters
{\vt prm1} etc.  map as below.  It is possible to read and alter these
values using the special vector @{\it device}[{\it param\/}]
construct, or with the {\cb alter} and {\cb sweep} commands.  However,
there is no sanity checking so bad numbers can cause wild behavior or
worse.

\begin{quote}
\begin{tabular}{ll}
prm1 & vo\\
prm2 & va\\
prm3 & freq\\
prm4 & td\\
prm5 & theta\\
prm6 & phi\\
\end{tabular}
\end{quote}

\subsubsection{Sinusoidal Pulse}
\index{sine pulse specification}
\index{spulse tran function}

% spSources.hlp:spulse 060119

\spgen{spulse({\it vo vp\/} [{\it per td decay\/}])} 
\spexampo{vin 1 0 spulse(0 1 25ns 40ns 1e8)}

\begin{quote}
\begin{tabular}{|l|l|l|l|} \hline
{\bf parameter} & {\bf description} & {\bf default value} &
 {\bf units}\\ \hline\hline
{\it vo} & offset & & volts or amps\\ \hline
{\it vp} & peak amplitude & & volts or amps\\ \hline
{\it per} & period & {\vt tstop} & seconds\\ \hline
{\it td} & delay & 0.0 & seconds\\ \hline
{\it decay} & decay const & 0.0 & 1/seconds\\ \hline
\end{tabular}
\end{quote}

The shape of the waveform is described by the following table:

\begin{quote}
\begin{tabular}{ll}
{\bf time} & {\bf value}\\[0.5ex]
0 & {\it vo\/}\\
{\it td\/} & {\it vo\/} $+$ 0.5$\cdot$({\it vp\/}$-${\it vo\/})( 1 $-$
cos(2$\pi\cdot$(time$-${\it td\/})/{\it per\/})$\cdot$exp($-$(time$-${\it
td\/})
$\cdot${\it decay\/}) )\\[2ex]
\end{tabular}
\end{quote}

This function applies only to transient analysis, where time is the
running variable.  When referring to default values, {\vt tstep} is
the printing increment and {\vt tstop} is the final time in transient
analysis, see \ref{tranline} for explanation.

If this function is used bare and not part of an expression in a
voltage or current source, then the general source instance parameters
{\vt prm1} etc.  map as below.  It is possible to read and alter these
values using the special vector @{\it device}[{\it param\/}]
construct, or with the {\cb alter} and {\cb sweep} commands.  However,
there is no sanity checking so bad numbers can cause wild behavior or
worse.

\begin{quote}
\begin{tabular}{ll}
prm1 & vo\\
prm2 & vp\\
prm3 & per\\
prm4 & td\\
prm5 & decay\\
\end{tabular}
\end{quote}

\subsubsection{Table Reference}
\index{table reference specification}
\index{table tran function}

% spSources.hlp:table 012509

\spgen{table({\it table\_name expr\/})\\
    {\it table\_name\/}({\it expr\/})\hspace{1cm}(for sources only)}
\spexamp{vin 1 0 table(tab1, v(2))\\
    exx 1 0 2 0 table(tab2, x)\\
    exx 1 0 2 0 tab2(x)}

The table referenced must be specified in the input deck with a {\vt
.table} line.  The reference to a table is in the form of a {\vt
table} function, as above, which takes two arguments.  The first
argument is the name of a table defined elsewhere in the circuit file
with a {\vt .table} line.  The second argument is an expression which
provides input to the table.  The return value is the interpolated
value from the table.

Tables can also be referenced as part of the ac specification for a
dependent or independent source.  These references are used in ac
analysis, and have a different referencing syntax.

In the expression used in voltage and current sources, dependent and
independent, the second form can be used and is equivalent.  The {\it
table\_name} must not conflict with another internal or user-defined
function name.

The {\vt table} reference provides one means of implementing a
piecewise-linear transfer function.  This can also be accomplished by
use of the {\vt pwl} function in dependent sources.

%SU-------------------------------------
\subsection{Dependent Sources}
\index{dependent source}
\label{depsrc}

% spSources.hlp:depsource 012509

{\WRspice} source specifications are completely general in that they
allow arbitrary functional dependence upon circuit variables.
However, for compatibility with previous versions of SPICE, the
separate keying of independent and dependent sources is retained.
{\WRspice} allows circuits to contain dependent sources characterized by
any of the four equations in the table below.

\begin{tabular}{|l|l|l|}\hline
\vt VCCS & \vt i = g(v) & Voltage-Controlled Current Source\\ \hline
\vt VCVS & \vt v = e(v) & Voltage-Controlled Voltage Source\\ \hline
\vt CCCS & \vt i = f(i) & Current-Controlled Current Source\\ \hline
\vt CCVS & \vt v = h(i) & Current-Controlled Voltage Source\\ \hline
\end{tabular}

The functions {\vt g}, {\vt e}, {\vt f}, and {\vt h} represent
transconductance, voltage gain, current gain, and transresistance,
respectively.

\subsubsection{Voltage-Controlled Current Sources}
\index{VCCS}

% spSources.hlp:vccs 030412

This is a special case of the general source specification included
for backward compatibility.

\spgen{g{\it name n\/}+ {\it n\/}- {\it nc\/}+ {\it nc\/}- [{\it expr}]
  {\it srcargs}\\
g{\it name n\/}+ {\it n\/}- function | cur [{\vt =}] {\it expr}
  {\it srcargs}\\
g{\it name n\/}+ {\it n\/}- poly {\it poly\_spec}
  {\it srcargs}\\
{\rm where} {\it srcargs} = [{\vt ac table}({\it name\/})]}
\spexamp{g1 2 0 5 0 0.1mmho\\
g2 2 0 5 0 log10(x)\\
g3 2 0 function log10(v(5))}

The {\it n\/}{\vt +} and {\it n\/}{\vt -} are the positive and
negative nodes, respectively.  Current flow is from the positive node,
through the source, to the negative node.  The parameters {\it
nc\/}{\vt +} and {\it nc\/}{\vt -} are the positive and negative
controlling nodes, respectively.

In the first form, if the {\it expr} is a constant, it represents the
transconductance in siemens.  If no expression is given, a unit
constant value is assumed.  Otherwise, the {\it expr} computes the
source current, where the variable ``{\vt x}'' if used in the {\it
expr} is taken to be the controlling voltage (v({\it nc\/}{\vt
+},{\it nc\/}{\vt -})).  In this case only, the {\vt pwl} construct
if used in the {\it expr} takes as its input variable the value of
``{\vt x}'' rather than time, thus a piecewise linear transfer
function can be implemented using a {\vt pwl} statement.  The second
form is similar, but ``{\vt x}'' is not defined.  The keywords ``{\vt
function}'' and ``{\vt cur}'' are equivalent.  The third form allows
use of the SPICE2 {\vt poly} construct.

More information on the function specification can be found in
\ref{indepsrc}, and the {\vt poly} specification is described in
\ref{polyspec}.

If the {\vt ac} parameter is given and the {\vt table} keyword
follows, then the named table is taken to contain complex {\it
transfer} coefficient data, which will be used in ac analysis (and
possibly elsewhere, see below).  For each frequency, the source output
will be the interpolated transfer coefficient from the table
multiplied by the input.  The table must be specified with a {\vt
.table} line, and must have the {\vt ac} keyword given.

If an ac table is specified, and no dc/transient transfer function or
coefficient is given, then in transient analysis, the source transfer
will be obtained through Fourier analysis of the table data.  This is
somewhat experimental, and may be prone to numerical errors.

In ac analysis, the transfer coefficient can be real or complex.  If
complex, the imaginary value follows the real value.  Only constants
or constant expressions are valid in this case.  If the source
function is specified in this way, the real component is used in dc
and transient analysis.  This will also override a table, if given.

\subsubsection{Voltage-Controlled Voltage Sources}
\index{VCVS}

% spSources.hlp:vcvs 030412

This is a special case of the general source specification included
for backward compatibility.

\spgen{e{\it name n\/}+ {\it n\/}- {\it nc\/}+ {\it nc\/}- [{\it expr}]
  {\it srcargs}\\
e{\it name n\/}+ {\it n\/}- function | vol [{\vt =}] {\it expr}
  {\it srcargs}\\
e{\it name n\/}+ {\it n\/}- poly {\it poly\_spec}
  {\it srcargs}\\
{\rm where} {\it srcargs} = [{\vt ac table}({\it name\/})]}
\spexamp{e1 2 3 14 1 2.0\\
e2 2 3 14 1 x+.015*x*x\\
e3 2 3 function v(14,1)+.015*v(14,1)*v(14,1)}

The {\it n\/}{\vt +} is the positive node, and {\it n\/}{\vt -} is the
negative node.  {\it nc\/}{\vt +} and {\it nc\/}{\vt -} are the
positive and negative controlling nodes, respectively.

In the first form, if the {\it expr} is a constant, it represents the
linear voltage gain.  If no expression is given, a unit constant
value is assumed.  Otherwise, the {\it expr} computes the source
voltage, where the variable ``{\vt x}'' if used in the {\it expr} is
taken to be the controlling voltage (v({\it nc\/}{\vt +},{\it
nc\/}{\vt -})).  In this case only, the {\vt pwl} construct if used
in the {\it expr} takes as its input variable the value of ``{\vt
x}'' rather than time, thus a piecewise linear transfer function can
be implemented using a {\vt pwl} statement.  The second form is
similar, but ``{\vt x}'' is not defined.  The keywords ``{\vt
function}'' and ``{\vt vol}'' are equivalent.  The third form allows
use of the SPICE2 {\vt poly} construct.

More information of the function specification can be found in
\ref{indepsrc}, and the {\vt poly} specification is described in
\ref{polyspec}.

If the {\vt ac} parameter is given and the {\vt table} keyword
follows, then the named table is taken to contain complex {\it
transfer} coefficient data, which will be used in ac analysis (and
possibly elsewhere, see below).  For each frequency, the source output
will be the interpolated transfer coefficient from the table
multiplied by the input.  The table must be specified with a {\vt
.table} line, and must have the {\vt ac} keyword given.

If an ac table is specified, and no dc/transient transfer function or
coefficient is given, then in transient analysis, the source transfer
will be obtained through Fourier analysis of the table data.  This is
somewhat experimental, and may be prone to numerical errors.

In ac analysis, the transfer coefficient can be real or complex.  If
complex, the imaginary value follows the real value.  Only constants
or constant expressions are valid in this case.  If the source
function is specified in this way, the real component is used in dc
and transient analysis.  This will also override a table, if given.

\subsubsection{Current-Controlled Current Sources}
\index{CCCS}

% spSources.hlp:cccs 030815

This is a special case of the general source specification included
for backward compatibility.

\spgen{f{\it name n\/}+ {\it n\/}- {\it vnam expr} {\it srcargs}\\
f{\it name n\/}+ {\it n\/}- function | cur [{\vt =}] {\it expr\/}
 {\it srcargs}\\
f{\it name n\/}+ {\it n\/}- poly {\it poly\_spec} {\it srcargs}\\
{\rm where} {\it srcargs} = [{\vt ac table}({\it name\/})]}
\spexamp{f1 13 5 vsens 5\\
f2 13 5 1-x*x ac table(acdata)\\
f3 13 5 function 1-i(vsens)*i(vsens)} 

The {\it n\/}{\vt +} and {\it n\/}{\vt -} are the positive and
negative nodes, respectively.  Current flow is from the positive node,
through the source, to the negative node.  The parameter {\it vnam\/}
is the name of a voltage source or inductor through which the
controlling current flows.  If {\it vnam} refers to a voltage source,
the direction of positive controlling current flow is from the
positive node, through the source, to the negative node.  If {\it
vnam} names an inductor, the current flow is from the first node
specified for the inductor, through the inductor, to the second node. 

In the first form, if the {\it expr} is a constant, it represents the
linear current gain.  If no expression is given, a unit constant
value is assumed.  Otherwise, the {\it expr} computes the source
current, where the variable ``{\vt x}'' if used in the {\it expr} is
taken to be the controlling current (i({\it vnam\/})).  In this case
only, the {\vt pwl} construct if used in the {\it expr} takes as its
input variable the value of ``{\vt x}'' rather than time, thus a
piecewise linear transfer function can be implemented using a {\vt
pwl} statement.  The second form is similar, but ``{\vt x}'' is not
defined.  The keywords ``{\vt function}'' and ``{\vt cur}'' are
equivalent.  The third form allows use of the SPICE2 {\vt poly}
construct.

More information of the function specification can be found in
\ref{indepsrc}, and the {\vt poly} specification is described in
\ref{polyspec}.

If the {\vt ac} parameter is given and the {\vt table} keyword
follows, then the named table is taken to contain complex {\it
transfer} coefficient data, which will be used in ac analysis (and
possibly elsewhere, see below).  For each frequency, the source output
will be the interpolated transfer coefficient from the table
multiplied by the input.  The table must be specified with a {\vt
.table} line, and must have the {\vt ac} keyword given.

If an ac table is specified, and no dc/transient transfer function or
coefficient is given, then in transient analysis, the source transfer
will be obtained through Fourier analysis of the table data.  This is
somewhat experimental, and may be prone to numerical errors.

In ac analysis, the transfer coefficient can be real or complex.  If
complex, the imaginary value follows the real value.  Only constants
or constant expressions are valid in this case.  If the source
function is specified in this way, the real component is used in dc
and transient analysis.  This will also override a table, if given.

\subsubsection{Current-Controlled Voltage Sources}
\index{CCVS}

% spSources.hlp:ccvs 030815

This is a special case of the general source specification included
for backward compatibility.

\spgen{h{\it name n\/}+ {\it n\/}- {\it vnam expr} {\it srcargs}\\
h{\it name n\/}+ {\it n\/}- function | vol [{\vt =}] {\it expr\/}
 {\it srcargs}\\
h{\it name n\/}+ {\it n\/}- poly {\it poly\_spec} {\it srcargs}\\
{\rm where} {\it srcargs} = [{\vt ac table}({\it name\/})]}
\spexamp{h1 5 17 vz 0.5k\\
h2 5 17 0.71,0.71\\
h3 5 17 vz 2.5*exp(x/2.5) ac table(myvals)\\
h2 5 17 function 2.5*exp(i(vz)/2.5)}

Above, {\it n\/}{\vt +} and {\it n\/}{\vt -} are the positive and
negative nodes, respectively.  The parameter {\it vnam} is the name
of a voltage source or inductor through which the controlling current
flows.  If {\it nam} references a voltage source, the direction of
positive controlling current flow is from the positive node, through
the source, to the negative node.  If {\it vnam\/} references an
inductor, the controlling current flows from the first node specified
for the inductor, through the inductor, to the second node.

{\bf Note}:  In releases earlier than 4.1.15 the output for a constant
transfer value case was the reverse polarity of the description here.

In the first form, if the {\it expr} is a constant, it represents the
transresistance in ohms.  If no expression is given, a unit constant
value is assumed.  Otherwise, the {\it expr} computes the source
voltage, where the variable ``{\vt x}'' if used in the {\it expr} is
taken to be the controlling current (i({\it vnam\/})).  In this case
only, the {\vt pwl} construct if used in the {\it expr} takes as its
input variable the value of ``{\vt x}'' rather than time, thus a
piecewise linear transfer function can be implemented using a {\vt
pwl} statement.  The second form is similar, but ``{\vt x}'' is not
defined.  The keywords ``{\vt function}'' and ``{\vt vol}'' are
equivalent.  The third form allows use of the SPICE2 {\vt poly}
construct.

More information of the function specification can be found in
\ref{indepsrc}, and the {\vt poly} specification is described in
\ref{polyspec}.

If the {\vt ac} parameter is given and the {\vt table} keyword
follows, then the named table is taken to contain complex {\it
transfer} coefficient data, which will be used in ac analysis (and
possibly elsewhere, see below).  For each frequency, the source output
will be the interpolated transfer coefficient from the table
multiplied by the input.  The table must be specified with a {\vt
.table} line, and must have the {\vt ac} keyword given.

If an ac table is specified, and no dc/transient transfer function or
coefficient is given, then in transient analysis, the source transfer
will be obtained through Fourier analysis of the table data.  This is
somewhat experimental, and may be prone to numerical errors.

In ac analysis, the transfer coefficient can be real or complex.  If
complex, the imaginary value follows the real value.  Only constants
or constant expressions are valid in this case.  If the source
function is specified in this way, the real component is used in dc
and transient analysis.  This will also override a table, if given.


%S-----------------------------------------------------------------------------
\section{Semiconductor Devices}

% spSemicond.hlp:semicond 012609

The standard {\WRspice} device library contains models for the
semiconductor devices listed in the table below.  Each of these
devices references a corresponding model supplied on a {\vt .model}
line (see \ref{dotmodel}).  The model supplies most of the parameters
that specify device behavior.  If a corresponding model is not found,
usually a warning is issued and a default model is used.

\begin{tabular}{|l|l|l|}\hline
\bf Device & \bf Name & \bf Key\\ \hline
Junction Diode & \vt dio & \vt d\\ \hline
Bipolar Junction Transistor & \vt bjt & \vt q\\ \hline
Junction Field-Effect Transistor & \vt jfet & \vt j\\ \hline
MESFET & \vt mes & \vt z\\ \hline
MOSFET & \vt mos & \vt m\\ \hline
\end{tabular}

Each device element line contains the device name, the nodes to which
the device is connected, and the device model name.  In addition,
other optional parameters may be specified for some devices: geometric
factors and an initial condition.

\index{area parameter}
The area factor used on the device lines determines the number of
equivalent parallel devices of a specified model.  The affected
parameters are marked with an asterisk under the heading ``area'' in
the model descriptions.  Several geometric factors associated with the
channel and the drain and source diffusions can be specified on the
MOSFET device line.

\index{off parameter}
Two different forms of initial conditions may be specified for some
devices.  The first form is included to improve the dc convergence for
circuits that contain more than one stable state.  If a device is
specified {\vt off}, the dc operating point is determined with the
device internal terminal voltages (not external node voltages!) for
that device set to zero.  This effectively makes the device an open
circuit.  After convergence is obtained, the program continues to
iterate to obtain the exact value for the terminal voltages.  If a
circuit has more than one dc stable state, the {\vt off} option can be
used to force the solution to correspond to a desired state.  If a
device is specified {\vt off} when in reality the device is
conducting, the program will still obtain the correct solution
(assuming the solutions converge) but more iterations will be required
since the program must independently converge to two separate
solutions.  The {\vt .nodeset} line serves a similar purpose as the
{\vt off} option.  The {\vt .nodeset} directive is easier to apply and
is the preferred means to aid convergence in this situation.

The second form of initial condition is specified for use with
transient analysis.  These are true initial conditions as opposed to
the convergence aids above.  See the description of the {\vt .ic} line
and the {\vt .tran} line for a detailed explanation of initial
conditions.

%SU-------------------------------------
\subsection{Junction Diodes}
\index{diode instance}

% spSemicond.hlp:dio 012609

\spgen{d{\it name} {\it n\/}+ {\it n\/}- {\it modname} [{\it parameters} ...]}

\begin{tabular}{|l|p{4.5in}|}\hline
\bf Parameter Name & \bf Description\\ \hline\hline
\vt off & Device is initially nonconducting, for circuit convergence
  assistance.\\ \hline
{\vt ic}={\it vj} & The initial junction voltage (initial condition) for
  transient analysis.\\ \hline
{\vt area}={\it val} & Scale factor that multiplies all currents and other
  values, effectively modifying the diode area.\\ \hline
{\vt m}={\it val} & Device multiplicity factor, similar to {\vt area}.\\ \hline
{\vt pj}={\it val} & Perimeter scale factor for sidewell.\\ \hline
{\vt temp}={\it val} & Device operating temperature, degrees celsius.\\ \hline
{\vt dtemp}={\it val} & Device operating temperature difference from circuit
  operating temperature.  This is overruled if {\vt temp} is also
  given.\\ \hline
\end{tabular}

\spexamp{dbridge 2 10 diode1\\
dclmp 3 7 dmod 3.0 ic=0.2}

The {\it n\/}{\vt +} and {\it n\/}{\vt -} are the positive and
negative nodes, respectively.  The parameter {\it modname} is the
model name, {\vt area} specifies the area factor, {\vt temp}
specifies the operating temperature, and {\vt off} indicates an
(optional) starting condition of the device for dc analysis.  If the
area factor is omitted, a value of 1.0 is assumed.  The (optional)
initial voltage specification using {\vt ic}={\it vd\/} is intended
for use with the {\vt uic} option in transient analysis, when a
transient analysis is desired starting from other than the quiescent
operating point.  The {\vt .ic} line provides another way to set
transient initial conditions.

%SU-------------------------------------
\subsection{Diode Model}
\index{diode model}
\label{diomodel}

% spModels.hlp:diomodel 100311

{\cb Type Name:} {\vt d}

The dc characteristics of the diode are determined by the parameters
{\vt is} and {\vt n}.  An ohmic resistance, {\vt rs}, is included.
Charge storage effects are modeled by a transit time, {\vt tt}, and a
nonlinear depletion layer capacitance which is determined by the
parameters {\vt cjo}, {\vt vj}, and {\vt m}.  The temperature
dependence of the saturation current is defined by the parameters {\vt
eg}, the energy, and {\vt xti}, the saturation current temperature
exponent.  The nominal temperature at which these parameters were
measured is {\vt tnom}, which defaults to the value
specified on the {\vt .options} control line.  Reverse breakdown is
modeled by an exponential increase in the reverse diode current and is
determined by the parameters {\vt bv} and {\vt ibv} (both of which are
positive numbers).

The diode model is an enhanced version of the SPICE3 diode model, as
used in NGspice, but with additional support for HSPICE model
parameters.

The parameters marked with an asterisk in the {\bf area} column scale
with the {\vt area} and/or the {\vt m} (multiplicity) parameters given
in the device line.  The parameters marked with two asterisks scale
with the {\vt pj} (perimeter factor) parameter given in the device
line.

\begin{quote}
\begin{tabular}{|l|c|p{2in}|l|l|p{1in}|}\hline
\multicolumn{6}{|c|}{\bf Diode Model Parameters}\\ \hline
\bf name & \bf area & \bf parameter & \bf units & \bf default &
 \bf example\\ \hline\hline
\vt is, js & $*$ & saturation current & $A$ & 1.0e-14 & 1.0e-14\\ \hline
\vt jsw & $**$ & sidewall saturation current & $A$ & 0 & \\ \hline
\vt rs & $*$ & ohmic resistance & $\Omega$ & 0 & 10\\ \hline
\vt trs, trs1 & & ohmic resistance 1st order temp coeff & - & 0 & \\ \hline
\vt trs2 & & ohmic resistance 2nd order temp coeff & - & 0 & \\ \hline
\vt n & & emission coefficient & - & 1 & 1.0\\ \hline
\vt tt & & transit-time & $S$ & 0 & 0.1ns\\ \hline
\vt tt1 & & transit-time 1st order temp coeff & - & 0 & \\ \hline
\vt tt2 & & transit-time 2nd order temp coeff & - & 0 & \\ \hline
\vt cjo, cj0, cj & $*$ & \rr zero-bias junction capacitance & $F$ & 0 &
 2PF\\ \hline
\vt vj, pb & & junction potential & $V$ & 1 & 0.6\\ \hline
\vt m, mj & & grading coefficient & - & 0.5 & 0.5\\ \hline
\vt tm1 & & grading coefficient 1st temp coeff & - & 0 & \\ \hline
\vt tm2 & & grading coefficient 1nd temp coeff & - & 0 & \\ \hline
\vt cjp, cjsw & $**$ & sidewall junction capacitance & $F$ & 0 & \\ \hline
\vt php & & sidewall junction potential & $V$ & 0 & \\ \hline
\vt mjsw & & sidewall grading coefficient & - & 0.33 & \\ \hline
\vt ikf, ik & $*$ & forward knee current & $A$ & 1e-3 & \\ \hline
\vt ikr & & reverse knee current & $A$ & 1e-3 & \\ \hline
\vt eg & & activation energy & $eV$ & 1.11 &
 {\rr 1.11 Si,\newline 0.69 Sbd,\newline 0.67 Ge}\\ \hline
\vt xti & & \rr saturation-current temperature exponent & - & 3.0 &
 {\rr 3.0 junc,\newline 2.0 Sbd}\\ \hline
\vt kf & & flicker noise coefficient & - & 0 & -\\ \hline
\vt af & & flicker noise exponent & - & 1 & -\\ \hline
\vt fc & & \rr forward-bias junction fit parameter & - & 0.5 & \\ \hline
\vt fcs & & forward-bias sidewall junction fit parameter & - & 0.5 & \\ \hline
\vt bv & & reverse breakdown voltage & $V$ & infinite & 40.0\\ \hline
\vt ibv & & \rr current at breakdown voltage & $A$ & 1.0e-3 & 2.0e-3\\ \hline
\vt tnom, tref & & \rr parameter measurement temperature & $C$ & 25 & 50\\
 \hline\hline
\multicolumn{6}{|c|}{\bf HSPICE Compatibility}\\ \hline
\vt level & & \rr device type selector & & & \\ \hline
\vt tlev & & \rr equation set selector & & & \\ \hline
\vt tlevc & & \rr equation set selector & & & \\ \hline
\vt area & & \rr area default & & & \\ \hline
\vt pj & & \rr sidewall perimeter factor default & & & \\ \hline
\vt cta & & \rr junction capacitance temp. coeff. & & & \\ \hline
\vt ctp & & \rr sidewall capacitance temp. coeff. & & & \\ \hline
\vt tcv & & \rr breakdown voltage temp. coeff. & & & \\ \hline
\vt tcv & & \rr junction potential temp. coeff. & & & \\ \hline
\vt tcv & & \rr sidewall potential temp. coeff. & & & \\ \hline
\end{tabular}
\end{quote}

The HSPICE compatibility parameters provide some minimal compatibility
with the HSPICE diode model.  The {\vt level} parameter, if present,
can take values of 1 and 3, corresponding to the HSPICE junction and
geometric junction models.  There is presently no support for the {\vt
level=2} Fowler-Nordheim model.  The {\vt tlev} and {\vt tlevc}
parameters switch equation sets.  Both take values of 0 and 1, and if
set to any other value will assume a value of 1, i.e., higher values
are not supported.  The remaining parameters are as defined in the
HSPICE documentation.

%SU-------------------------------------
\subsection{Bipolar Junction Transistors (BJTs)}
\index{bipolar transistor instance}

% spSemicond.hlp:bjt 012609

\spgen{q{\it name} {\it nc nb ne} [{\it ns\/}] {\it modname}
 [{\it parameters} ...]}

\begin{tabular}{|l|p{4.5in}|}\hline
\bf Parameter Name & \bf Description\\ \hline\hline
\vt off & Device is initially nonconducting, for circuit convergence
  assistance.\\ \hline
{\vt area=}{\it val} & Scale factor that multiplies all currents and
  other values, effectively modifying the BJT area.\\ \hline
{\vt ic=}{\it vbe\/},{\it vce} & The initial voltages (initial condition)
  for transient analysis.\\ \hline
{\vt icvbe=}{\it vbe} & The initial {\vt vbe} (initial condition) for
  transient analysis.\\ \hline
{\vt icvce=}{\it vce} & The initial {\vt vce} (initial condition) for
  transient analysis.\\ \hline
{\vt temp=}{\it val} & Device operating temperature, degrees celsius.\\ \hline
\end{tabular}

\spexamp{q23 10 24 13 qmod ic=0.6,5.0\\
q50a 11 26 4 20 mod1}

The {\it nc\/}, {\it nb\/}, and {\it ne} are the collector, base,
and emitter nodes, respectively, and {\it ns} is the (optional)
substrate node.  If unspecified, ground is used.  The {\it
modname\/} is the model name, {\vt area} specifies the area factor,
{\vt temp} specifies the operating temperature, and {\vt off}
indicates an initial condition of the device for the dc analysis. 
If the area factor is omitted, a value of 1.0 is assumed.  The
initial conditions specified using {\vt ic} or alternatively {\vt
icvbe} and {\vt icvce} are intended for use with the {\vt uic}
option in transient analysis, when a transient analysis is desired
starting from other than the quiescent operating point.  The {\vt
.ic} line provides another way to set transient initial conditions. 

%SU-------------------------------------
\subsection{BJT Models (both NPN and PNP)}
\index{bipolar transistor model}
\label{bjtmodel}

% spModels.hlp:bjtmodel 091511

{\cb Type Names:} {\vt npn}, {\vt pnp}

The bipolar junction transistor model in {\WRspice} is an adaptation of
the integral charge control model of Gummel and Poon.  This modified
Gummel-Poon model extends the original model to include several
effects at high bias levels.  The model will automatically simplify to
the simpler Ebers-Moll model when certain parameters are not
specified.  The parameter names used in the modified Gummel-Poon model
have been chosen to be more easily understood by the program user, and
to reflect better both physical and circuit design thinking.

The dc model is defined by the parameters {\vt is}, {\vt bf}, {\vt
nf}, {\vt ise}, {\vt ikf}, and {\vt ne} which determine the forward
current gain characteristics, {\vt is}, {\vt br}, {\vt nr}, {\vt isc},
{\vt ikr}, and {\vt nc} which determine the reverse current gain
characteristics, and {\vt vaf} and {\vt var} which determine the
output conductance for forward and reverse regions.  Three ohmic
resistances {\vt rb}, {\vt rc}, and {\vt re} are included, where {\vt
rb} can be high current dependent.  Base charge storage is modeled by
forward and reverse transit times, {\vt tf} and {\vt tr}, the forward
transit time {\vt tf} being bias dependent if desired, and nonlinear
depletion layer capacitances which are determined by {\vt cje}, {\vt
vje}, and {\vt mje} for the B-E junction, {\vt cjc}, {\vt vjc}, and
{\vt mjc} for the B-C junction, and {\vt cjs}, {\vt vjs}, and {\vt
mjs} for the C-S (Collector-Substrate) junction.  The temperature
dependence of the saturation current, {\vt is}, is determined by the
energy gap, {\vt eg}, and the saturation current temperature exponent,
{\vt xti}.  Additionally base current temperature dependence is
modeled by the beta temperature exponent {\vt xtb} in the new model.
The values specified are assumed to have been measured at the
temperature {\vt tnom}, which can be specified on the {\vt .options}
line or overridden by a specification on the {\vt .model} line.

The BJT parameters used in the modified Gummel-Poon model are listed
below.  The parameter names used in earlier versions of SPICE2 are
still accepted.  The parameters marked with an asterisk in the {\bf
area} column scale with the {\vt area} parameter given in the device
line.

There is also a level=4 BJT model which uses the VBIC equation set, as
used in the NGspice-17 simulator.  This model is documented elsewhere.

\begin{quote}
\begin{longtable}{|l|c|p{2in}|l|l|l|}\hline
\multicolumn{6}{|c|}{\bf BJT Model Parameters}\\ \hline
\bf name & \bf area & \bf parameter & \bf units & \bf default &
 \bf example\\ \hline\hline
\vt is & $*$ & \rr transport saturation current & $A$ & 1.0e-16 & 1.0e-15\\
\hline
\vt bf & & \rr ideal maximum forward beta & - & 100 & 100\\ \hline
\vt nf & & \rr forward current emission coefficient & - & 1.0 & 1\\ \hline
\vt vaf & & \rr forward Early voltage & $V$ & infinite & 200\\ \hline
\vt ikf & $*$ & \rr corner for forward beta high current roll-off &
 $A$ & infinite & 0.01\\ \hline
\vt ise & $*$ & \rr B-E leakage saturation current & $A$ & 0 & 1.0e-13\\
\hline
\vt ne & & \rr B-E leakage emission coefficient & - & 1.5 & 2\\ \hline
\vt br & & \rr ideal maximum reverse beta & - & 1 & 0.1\\ \hline
\vt nr & & \rr reverse current emission coefficient & - & 1 & 1\\ \hline
\vt var & & \rr reverse Early voltage & $V$ & infinite & 200\\ \hline
\vt ikr & $*$ & \rr corner for reverse beta high current roll-off &
 $A$ & infinite & 0.01\\ \hline
\vt isc & $*$ & \rr B-C leakage saturation current & $A$ & 0 & 1.0e-13\\
\hline
\vt nc & & \rr B-C leakage emission coefficient & - & 2 & 1.5\\ \hline
\vt rb & $*$ & \rr zero bias base resistance & $\Omega$ & 0 & 100\\ \hline
\vt ikb & $*$ & \rr current where base resistance falls halfway to
 its min value & $A$ & infinite & 0.1\\ \hline
\vt rbm & $*$ & \rr minimum base resistance at high currents &
 $\Omega$ & {\vt rb} & 10\\ \hline
\vt re & $*$ & \rr emitter resistance & $\Omega$ & 0 & 1\\ \hline
\vt rc & $*$ & \rr collector resistance & $\Omega$ & 0 & 10\\ \hline
\vt cje & $*$ & \rr B-E zero-bias depletion capacitance & $F$ & 0 & 2pf\\
\hline
\vt vje & & \rr B-E built-in potential & $V$ & 0.75 & 0.6\\ \hline
\vt mje & & \rr B-E junction exponential factor & - & 0.33 & 0.33\\ \hline
\vt tf & & \rr ideal forward transit time & $S$ & 0 & 0.1ns\\ \hline
\vt xtf & & \rr coefficient for bias dependence of {\vt tf} & - & 0 & -\\
\hline
\vt vtf & & \rr voltage describing VBC dependence of {\vt tf}
& $V$ & infinite & -\\ \hline
\vt itf & $*$ & \rr high-current parameter for effect on {\vt
tf} & $A$ & 0 & -\\ \hline
\vt ptf & & \rr excess phase at freq=1.0/({\vt tf}$\cdot 2\pi$) Hz &
$deg$ & 0 & -\\ \hline
\vt cjc & $*$ & \rr B-C zero-bias depletion capacitance & $F$ & 0 & 2pf\\
\hline
\vt vjc & & \rr B-C built-in potential & $V$ & 0.75 & 0.5\\ \hline
\vt mjc & & \rr B-C junction exponential factor & - & 0.33 & 0.5\\ \hline
\vt xcjc & & \rr fraction of B-C depletion capacitance connected to
internal base node & - & 1 & -\\ \hline
\vt tr & & \rr ideal reverse transit time & $S$ & 0 & 10ns\\ \hline
\vt cjs & $*$ & \rr zero-bias collector-substrate capacitance &
 $F$ & 0 & 2pf\\ \hline
\vt vjs & & \rr substrate junction built-in potential & $V$ & 0.75 & -\\
\hline
\vt mjs & & \rr substrate junction exponential factor & - & 0 & 0.5\\
\hline
\vt xtb & & \rr forward and reverse beta temperature exponent
& - & 0 & -\\ \hline
\vt eg & & \rr energy gap for temperature effect on {\vt is}
& $eV$ & 1.11 & -\\ \hline
\vt xti & & \rr temperature exponent for effect on {\vt is} & - & 3 & -\\
\hline
\vt kf & & \rr flicker-noise coefficient & - & 0 & -\\ \hline
\vt af & & \rr flicker-noise exponent & - & 1 & -\\ \hline
\vt fc & & \rr coefficient for forward-bias depletion capacitance
 formula & - & 0.5 & -\\ \hline
\vt tnom & & \rr parameter measurement temperature & $C$ & 25 & 50\\ \hline
\end{longtable}
\end{quote}


%SU-------------------------------------
\subsection{Junction Field-Effect Transistors (JFETs)}
\index{JFET instance}

% spSemicond.hlp:jfet 012609

\spgen{j{\it name} {\it nd ng ns modname} [{\it parameters} ...]}

\begin{tabular}{|l|p{4.5in}|}\hline
\bf Parameter Name & \bf Description\\ \hline\hline
\vt off & Device is initially nonconducting, for circuit convergence
  assistance.\\ \hline
{\vt area=}{\it val} & Scale factor that multiplies all currents and
  other values, effectively modifying the JFET area.\\ \hline
{\vt ic=}{\it vds\/},{\it vgs} & The initial voltages (initial condition)
  for transient analysis.\\ \hline
{\vt icvds=}{\it vds} & The initial {\vt vds} (initial condition) for
  transient analysis.\\ \hline
{\vt icvgs=}{\it vgs} & The initial {\vt vgs} (initial condition) for
  transient analysis.\\ \hline
{\vt temp=}{\it val} & Device operating temperature, degrees celsius.\\ \hline
\end{tabular}

\spexamp{j1 7 2 3 jm1 off\\
j43 10 4 1 jmod2 area=2}

The {\it nd\/}, {\it ng\/}, and {\it ns} are the drain, gate, and
source nodes, respectively.  The {\it modname} is the model name,
{\vt area} specifies the area factor, {\vt temp} specifies the
operating temperature, and {\vt off} indicates an (optional) initial
condition of the device for dc analysis.  If the area factor is
omitted, a value of 1.0 is assumed.  The initial conditions
specified using {\vt ic} or alternatively {\vt icvds} and {\vt
icvgs} are intended for use with the {\vt uic} option in transient
analysis, when a transient analysis is desired starting from other
than the quiescent operating point.  The {\vt .ic} line provides
another way to set initial conditions.

%SU-------------------------------------
\subsection{JFET Models (both N and P Channel)}
\index{JFET model}
\label{jfetmodel}

% spModels.hlp:jfetmodel 091511

{\cb Type Names:} {\vt njf}, {\vt pjf}

There are two JFET models available, selectable with the {\vt level}
parameter given in the list of model parameters.  If {\vt level=2} is
given, the Parker-Skellern JFET model from Macquarie University in
Sydney, Australia will be used.  Parameters given must apply to that
model.  Documentation for this model is available from the Whiteley
Research web site, or from\\
{\vt http://www.elec.mq.edu.au/cnerf/spice/spice.html}.

If no {\vt level} parameter is given, or is set to something
other than 2, the standard SPICE3 JFET model will be used.
This JFET model is derived from the FET model of Shichman and Hodges.
The dc characteristics are defined by the parameters {\vt vto} and
{\vt beta}, which determine the variation of drain current with gate
voltage, {\vt lambda}, which determines the output
conductance, and {\vt is}, the saturation current of the
two gate junctions.  Two ohmic resistances, {\vt rd} and {\vt rs}, are
included.  Charge storage is modeled by nonlinear depletion layer
capacitances for both gate junctions which vary as the -1/2 power of
junction voltage and are defined by the parameters {\vt cgs}, {\vt
cgd}, and {\vt pb}.  The fitting parameter {\vt b} is a new addition,
see\cite{parker}.

The parameters marked with an asterisk in the {\bf area} column
scale with the {\vt area} parameter given in the device line.

\begin{quote}
\begin{tabular}{|l|c|p{2in}|l|l|l|}\hline
\multicolumn{6}{|c|}{\bf JFET Model Parameters}\\ \hline
\bf name & \bf area & \bf parameter & \bf units & \bf default &
 \bf example\\ \hline\hline
\vt vto & & \rr threshold voltage & $V$ & -2.0 & -2.0\\ \hline
\vt beta & $*$ & \rr transconductance parameter & $A/V^2$ & 1.0e-4 & 1.0e-3\\
\hline
\vt lambda & & \rr channel length modulation parameter & $1/V$ & 0 &
 1.0e-4\\ \hline
\vt rd & $*$ & \rr drain ohmic resistance & $\Omega$ & 0 & 100\\ \hline
\vt rs & $*$ & \rr source ohmic resistance & $\Omega$ & 0 & 100\\ \hline
\vt cgs & $*$ & \rr zero-bias G-S junction capacitance & $F$ & 0 & 5pf\\
\hline
\vt cgd & $*$ & \rr zero-bias G-D junction capacitance & $F$ & 0 & 1pf\\
\hline
\vt pb & & \rr gate junction potential & $V$ & 1 & 0.6\\ \hline
\vt is & $*$ & \rr gate junction saturation current & $A$ & 1.0e-14 &
 1.0e-14\\ \hline
\vt b & & \rr doping tail parameter & - & 1 & 1.1\\ \hline
\vt kf & & \rr flicker noise coefficient & - & 0 & -\\ \hline
\vt af & & \rr flicker noise exponent & - & 1 & -\\ \hline
\vt fc & & \rr coefficient for forward-bias depletion capacitance formula
 & - & 0.5 & -\\ \hline
\vt tnom & & \rr parameter measurement temperature & $C$ & 25 & 50\\ \hline
\end{tabular}
\end{quote}


%SU-------------------------------------
\subsection{MESFETs}
\index{MESFET instance}

% spSemicond.hlp:mes 012609

\spgen{z{\it name} {\it nd ng ns modname} [{\it parameters} ...]}

\begin{tabular}{|l|p{4.5in}|}\hline
\bf Parameter Name & \bf Description\\ \hline\hline
\vt off & Device is initially nonconducting, for circuit convergence
  assistance.\\ \hline
{\vt area=}{\it val} & Scale factor that multiplies all currents and
  other values, effectively modifying the MESFET area.\\ \hline
{\vt ic=}{\it vds\/},{\it vgs} & The initial voltages (initial condition)
  for transient analysis.\\ \hline
{\vt icvds=}{\it vds} & The initial {\vt vds} (initial condition) for
  transient analysis.\\ \hline
{\vt icvgs=}{\it vgs} & The initial {\vt vgs} (initial condition) for
  transient analysis.\\ \hline
\end{tabular}

\spexamp{z1 7 2 3 zm1 off\\
zout 21 4 16 zmod1 area=5}

The {\it nd\/}, {\it ng\/}, and {\it ns} are the drain, gate, and
source nodes, respectively.  The {\it modname\/} is the model name,
{\it area} specifies the area factor, and {\vt off} indicates an
initial condition of the device for dc analysis.  If the area factor
is omitted, a value of 1.0 is assumed.  The initial condition
specified using {\vt ic} or alternatively {\vt icvds} and {\vt
icvgs} are intended for use with the {\vt uic} option in transient
analysis, when a transient analysis is desired starting from other
than the quiescent operating point.  The {\vt .ic} line provides
another way to set initial conditions.

%SU-------------------------------------
\subsection{MESFET Models (both N and P Channel)}
\index{MESFET model}
\label{mesmodel}

% spModels.hlp:mesmodel 012609

{\cb Type Names:} {\vt nmf}, {\vt pmf}

The MESFET model is derived from the GaAs FET model of Statz et al. as
described in\cite{statz}.  The dc characteristics are defined by the
parameters {\vt vto}, {\vt b}, and {\vt beta}, which determine the
variation of drain current with gate voltage, {\vt alpha}, which
determines saturation voltage, and {\vt lambda}, which determines the
output conductance.  The formula are given by
\begin{displaymath}
Id = \frac{\beta(V_{gs}-V_T)^2}{1+b(V_{gs}-V_T)}\left(1-\left(1-\alpha
\frac{V_{ds}}{3}\right)^3\right)(1+\lambda V_{ds})\quad\mbox{for}\quad
 0 < V_{ds} < 3/\alpha
\end{displaymath}
\begin{displaymath}
Id = \frac{\beta(V_{gs}-V_T)^2}{1+b(V_{gs}-V_T)}(1+\lambda V_{ds})\quad
\mbox{for}\quad V_{ds} > 3/\alpha
\end{displaymath}

Two ohmic resistances, {\vt rd} and {\vt rs}, are included.  Charge
storage is modeled by total gate charge as a function of gate-drain
and gate-source voltages and is defined by the parameters {\vt cgs},
{\vt cgd}, and {\vt pb}.

The parameters marked with an asterisk in the {\bf area} column
scale with the {\vt area} parameter given in the device line.
\begin{quote}
\begin{tabular}{|l|c|p{2in}|l|l|l|}\hline
\multicolumn{6}{|c|}{\bf MES Model Parameters}\\ \hline
\bf name & \bf area & \bf parameter & \bf units & \bf default &
 \bf example\\ \hline\hline
\vt vto & & \rr pinch-off voltage & $V$ & -2.0 & -2.0\\ \hline
\vt beta & $*$ & \rr transconductance parameter & $A/V^2$ & 1.0e-4 & 1.0e-3\\
 \hline
\vt b & $*$ & \rr doping tail extending parameter & $1/V$ & 0.3 & 0.3\\ \hline
\vt alpha & $*$ & \rr saturation voltage parameter & $1/V$ & 2 & 2\\ \hline
\vt lambda & & \rr channel length modulation parameter & $1/V$ & 0 &
 1.0e-4\\ \hline
\vt rd & $*$ & \rr drain ohmic resistance & $\Omega$ & 0 & 100\\ \hline
\vt rs & $*$ & \rr source ohmic resistance & $\Omega$ & 0 & 100\\ \hline
\vt cgs & $*$ & \rr zero-bias G-S junction capacitance & $F$ & 0 & 5pf\\
 \hline
\vt cgd & $*$ & \rr zero-bias G-D junction capacitance & $F$ & 0 & 1pf\\
 \hline
\vt pb & & \rr gate junction potential & $V$ & 1 & 0.6\\ \hline
\vt kf & & \rr flicker noise coefficient & - & 0 & -\\ \hline
\vt af & & \rr flicker noise exponent & - & 1 & -\\ \hline
\vt fc & & \rr coefficient for forward-bias depletion capacitance
 formula & - & 0.5 & -\\ \hline
\end{tabular}
\end{quote}


%SU-------------------------------------
\subsection{MOSFETs}
\index{MOSFET instance}

% spSemicond.hlp:mos 012609

\spgen{m{\it name} {\it nd ng ns nb modname} [{\it parameters} ...]}

\begin{tabular}{|l|p{4.5in}|}\hline
\bf Parameter Name & \bf Description\\ \hline\hline
\vt off & Device is initially nonconducting, for circuit convergence
  assistance.\\ \hline
{\vt m}={\it val} & Device multiplicity factor.\\ \hline
{\vt l=}{\it val} &
  Channel length in meters.\\ \hline
{\vt w=}{\it val} &
  Channel width in meters.\\ \hline
{\vt ad=}{\it val} &
  Drain diffusion area in square meters.\\ \hline
{\vt as=}{\it val} &
  Source diffusion area in square meters.\\ \hline
{\vt pd=}{\it val} &
  Drain junction perimeter in meters.\\ \hline
{\vt ps=}{\it val} &
  Source junction perimeter in meters.\\ \hline
{\vt nrd=}{\it val} &
  Drain equivalent squares for resistance.\\ \hline
{\vt nrs=}{\it val} &
  Source equivalent squares for resistance.\\ \hline
{\vt ic=}{\it vds\/},{\it vgs\/},{\it vbs} & The initial voltages
  (initial condition) for transient analysis.\\ \hline
{\vt icvds=}{\it vds} & The initial {\vt vds} (initial condition) for
  transient analysis.\\ \hline
{\vt icvgs=}{\it vgs} & The initial {\vt vgs} (initial condition) for
  transient analysis.\\ \hline
{\vt icvbs=}{\it vbs} & The initial {\vt vbs} (initial condition) for
  transient analysis.\\ \hline
{\vt temp=}{\it val} & Device operating temperature, degrees celsius.\\ \hline
\end{tabular}

\spexamp{m1 24 2 0 20 type1\\
m31 2 17 6 10 modm l=5u w=2u\\
m1 2 9 3 0 mod1 l=10u w=5u ad=100p as=100p pd=40u ps=40u}

The parameters listed above are representative of the SPICE3 MOS
models, but except for `{\vt m}' are fairly universal.  Some
third-party MOS models may have additional nodes and parameters. 
Consult the model documentation for the full listing.

The {\it nd\/}, {\it ng\/}, {\it ns\/}, and {\it nb} are the drain,
gate, source, and bulk (substrate) nodes, respectively.  The {\it
modname\/} is the model name, {\vt l} and {\vt w} specify the
channel length and width in meters, and {\vt ad} and {\vt as}
specify the areas of the drain and source diffusions in sq-meters. 
Note that the suffix `u' specifies microns (1E-6 m) and `p'
sq-microns (1E-12 sq-m).  If any of {\vt l}, {\vt w}, {\vt ad}, or
{\vt as} are not specified, default values are used.  The use of
defaults simplifies input file preparation, as well as the editing
required if device geometries are to be changed.  The {\vt pd} and
{\vt ps} specify the perimeters of the drain and source junctions in
meters, {\vt nrd} and {\vt nrs} designate the equivalent number of
squares of the drain and source diffusions; these values multiply
the sheet resistance {\vt rsh} specified on the {\vt .model} line
for an accurate representation of the parasitic series drain and
source resistance of each transistor.  The {\vt pd} and {\vt ps}
default to 0.0 while {\vt nrd} and {\vt nrs} default to 1.0.  The
parameter {\vt off} indicates an initial condition of the device for
dc analysis.  The initial conditions specified using {\vt ic} or
alternatively {\vt icvds}, {\vt icvgs} amd {\vt icvbs} are intended
for use with the {\vt uic} option in transient analysis, when a
transient analysis is desired starting from other than the quiescent
operating point.  operating point.  The {\vt .ic} line provides
another way to set initial conditions.

MOS devices using model levels 1--3 accept a real parameter ``{\vt m}''
which scales all the instance capacitances, areas, and currents by the
given {\vt factor}.  This can be used as a short-cut for modeling
multiple devices, e.g., {\vt m = 2} is equivalent to two identical
devices in parallel.  This is not available for most of the more
complicated and third-party models.

%SU-------------------------------------
\subsection{MOSFET Models (both N and P channel)}
\index{MOSFET model}
\label{mosmodel}

% spModels.hlp:mosmodel 091511

{\cb Type Names:} {\vt nmos}, {\vt pmos}

{\WRspice} provides the basic MOS models provided in SPICE2/3, plus
third-party models from various development groups.  A complete
listing of the MOS models supported in the current {\WRspice} release
is provided below.  Documentation for the third-party models is
available on the Whiteley Research web site.  This section will
describe the features common to all MOS models.

The {\vt level} parameter in the MOS model description specifies the
model to be used.  Where possible, the level chosen for the imported
models will match the level used in Synopsys HSPICE.

\subsubsection{MOS Default Values}
\index{MOSFET defaults}

The MOS device length, width, source area and drain area will default
to common values if not specified for a device.  These values are set
by the following variables:

\begin{tabular}{|l|l|l|}\hline
\bf Variable & \bf Purpose & \bf Default\\ \hline\hline
\et defad & drain area & 0 $M^2$\\ \hline
\et defas & source area & 0 $M^2$\\ \hline
\et defl & gate length & 1 $uM$\\ \hline
\et defw & gate width & 1 $uM$\\ \hline
\end{tabular}

\subsubsection{MOS Model Binning}
\index{MOSFET binning}

{\WRspice} supports MOS model selection by the {\vt L} and {\vt W} MOS
element line.  This facility is used to automatically select the
proper model for a specific device dimension, from among several
models which are nominally similar but optimized for a particular
device size.  This facility works with any of the MOS model levels.

\index{MOSFET L/W selection}
The MOS models for the specified ranges should use the same ``base''
name plus an arbitrary but unique extension separated from the base
name with a period.  The element line should refer to the model by the
base name.  Each of the different models with the same base name
should have ranges specified with the model parameters {\vt LMIN},
{\vt LMAX}, {\vt WMIN}, {\vt WMAX}.  The model associated with an
instance is the first model found such that the base name matches, and
{\vt LMIN <= L <= LMAX} and {\vt WMIN <= W <= WMAX}.  If the MIN/MAX
parameters are not found in a model line, the test is always true,
i.e., if no MIN/MAX parameters are specified in a model, that model
would match any {\vt L}, {\vt W}.

Example:
\begin{quote}\vt
    m1 1 2 3 4 nm l=1.5u w=1u\\
    m2 a b c d nm l=3u w=5u\\
    ...\\
    .model nm.1 nmos(level=8 lmin=1u lmax=2u wmin=1u wmax=2u ...)\\
    .model nm.2 nmos(level=8 lmin=2u lmax=4u wmin=1u wmax=2u ...)\\
    .model nm.3 nmos(level=8 lmin=1u lmax=2u wmin=2u wmax=5u ...)\\
    .model nm.4 nmos(level=8 lmin=2u lmax=4u wmin=2u wmax=5u ...)\\
    .model nm.5 nmos(level=8 ...)\\
\end{quote}

In this example {\vt m1} would use model {\vt nm.1}, and {\vt m2}
would use {\vt nm.4}.  The model {\vt nm.5} is a ``catch all'' for
elements that don't match the other models.  The extension can be
omitted in one of the model names.

If a model that uses selection cannot be resolved, the circuit run
will be aborted.

\subsubsection{SPICE2/3 Legacy Models}

This section describes the basic SPICE2/3 models.  The level 1--3 and
6 models can be used for quick analysis and examples, but are probably
not suitable for serious design work using modern deep-submicron
devices.  The BSIM1 and BSIM2 models are for compatibility only, and
are not likely to be useful except for analysis of legacy projects.

The dc characteristics of the level 1 through level 3 MOSFETs are
defined by the device parameters {\vt vto}, {\vt kp}, {\vt lambda},
{\vt phi} and {\vt gamma}.  These parameters are computed by
{\WRspice} if process parameters ({\vt nsub}, {\vt tox}, ...) are
given, but user-specified values always override.  The parameter {\vt
vto} is positive (negative) for enhancement mode and negative
(positive) for depletion mode N-channel (P-channel) devices.  Charge
storage is modeled by three constant capacitors, {\vt cgso}, {\vt
cgdo}, and {\vt cgbo} which represent overlap capacitances, by the
nonlinear thin-oxide capacitance which is distributed among the gate,
source, drain, and bulk regions, and by the nonlinear depletion-layer
capacitances for both substrate junctions divided into bottom and
periphery, which vary as the {\vt mj} and {\vt mjsw} power of junction
voltage respectively, and are determined by the parameters {\vt cbd},
{\vt cbs}, {\vt cj}, {\vt cjsw}, {\vt mj}, {\vt mjsw} and {\vt pb}. 
Charge storage effects are modeled by the piecewise linear voltage
dependent capacitance model proposed by Meyer.  The thin-oxide charge
storage effects are treated slightly differently for the level 1
model.  These voltage-dependent capacitances are included only if {\vt
tox} is specified in the input description and they are represented
using Meyer's formulation.

There is some overlap among the parameters describing the junctions,
e.g., the reverse current can be input either as {\vt is} (in Amps) or
as {\vt js} (in Amps/m$^2$).  Whereas the first is an absolute value,
the second is multiplied by {\vt ad} and {\vt as} to give the reverse
current of the drain and source junctions respectively.  This
methodology has been chosen to avoid always relating junction
characteristics with {\vt ad} and {\vt as} entered on the device line;
the areas can be defaulted.  The same idea applies also to the
zero-bias junction capacitances {\vt cbd} and {\vt cbs} (in Farads) on
one hand, and {\vt cj} (in F/m$^2$) on the other.  The parasitic drain
and source series resistance can be expressed as either {\vt rd} and
{\vt rs} (in ohms) or {\vt rsh} (in ohms/sq.), the latter being
multiplied by the number of squares {\vt nrd} and {\vt nrs} input on
the device line.

\begin{quote}
\begin{longtable}{|l|p{2in}|p{0.6in}|p{1in}|l|}\hline
\multicolumn{5}{|c|}{\bf MOS Level 1 to Level 3 Parameters}\\ \hline
\bf name & \bf parameter & \bf units & \bf default &
 \bf example\\ \hline\hline
\vt level & \rr Model index & - & 1&\\ \hline
\vt vto & \rr zero-bias threshold voltage & $V$ & 0.0 & 1.0\\ \hline
\vt kp & \rr transconductance parameter & $A/V^2$ & 2.0e-5 & 3.1e-5\\ \hline
\vt gamma & \rr bulk threshold parameter & $V^{1/2}$ & 0.0 & 0.37\\ \hline
\vt phi & \rr surface potential & $V$ & 0.6 & 0.65\\ \hline
\vt lambda & \rr channel-length modulation (MOS1 and MOS2 only) &
 $1/V$ & 0.0 & 0.02\\ \hline
\vt rd & \rr drain ohmic resistance & $\Omega$ & 0.0 & 1.0\\ \hline
\vt rs & \rr source ohmic resistance & $\Omega$ & 0.0 & 1.0\\ \hline
\vt cbd & \rr zero-bias B-D junction capacitance & $F$ & 0.0 & 20fF\\
 \hline
\vt cbs & \rr zero-bias B-S junction capacitance & $F$ & 0.0 & 20fF\\
 \hline
\vt is & \rr bulk junction saturation current & $A$ & 1.0e-14 & 1.0e-15\\
 \hline
\vt pb & \rr bulk junction potential & $A$ & 0.8 & 0.87\\ \hline
\vt cgso & \rr gate-source overlap capacitance per channel width &
 $F/M$ & 0.0 & 4.0e-11\\ \hline
\vt cgdo & \rr gate-drain overlap capacitance per channel width &
 $F/M$ & 0.0 & 4.0e-11\\ \hline
\vt cgbo & \rr gate-bulk overlap capacitance per channel length &
 $F/M$ & 0.0 & 2.0e-10\\ \hline
\vt rsh & \rr drain and source diffusion sheet resistance &
 $\Omega/\Box$ & 0.0 & 10.0\\ \hline
\vt cj & \rr zero-bias bulk junction bottom capacitance per junction area
 & $F/M^2$ & 0.0 & 2.0e-4\\ \hline
\vt mj & \rr bulk junction bottom grading coeff & - & 0.5 & 0.5\\ \hline
\vt cjsw & \rr zero-bias bulk junction sidewall capacitance per
 junction perimeter & $F/M$ & 0.0 & 1.0e-9\\ \hline
\vt mjsw & \rr bulk junction sidewall grading coeff. & - &
 \rr\small 0.50 (level 1),\newline 0.33 (level 2,3) & -\\ \hline
\vt js & \rr bulk junction saturation current per junction area &
 $A/M^2$ & 1.0e-8 & -\\ \hline
\vt tox & \rr oxide thickness & $M$ & 1.0e-7 & 1.0e-7\\ \hline
\vt nsub & \rr substrate doping & $1/cM^3$ & 0.0 & 4.0e15\\ \hline
\vt nss & \rr surface state density & $1/cM^2$ & 0.0 & 1.0e10\\ \hline
\vt nfs & \rr fast surface state density & $1/cM^2$ & 0.0 & 1.0e10\\ \hline
\vt tpg & \rr type of gate material: +1 opp. to substrate, -1 same as
 substrate, 0 Al gate & - & 1.0 & -\\ \hline
\vt xj & \rr metallurgical junction depth & $M$ & 0.0 & 1u\\ \hline
\vt ld & \rr lateral diffusion & $M$ & 0.0 & 0.8u\\ \hline
\vt uo & \rr surface mobility & $cM^2/VS$ & 600 & 700\\ \hline
\vt ucrit & \rr critical field for mobility degradation (MOS2 only) &
 $V/cM$ & 1.0e4 & 1.0e4\\ \hline
\vt uexp & \rr critical field exponent in mobility degradation
 (MOS2 only) & - & 0.0 & 0.1\\ \hline
\vt utra & \rr transverse field coeff (mobility) (deleted for
 MOS2) & - & 0.0 & 0.3\\ \hline
\vt vmax & \rr maximum drift velocity of carriers & $M/S$ & 0.0 & 5.0e4\\
 \hline
\vt neff & \rr total channel charge (fixed and mobile) coefficient
 (MOS2 only) & - & 1.0 & 5.0\\ \hline
\vt kf & \rr flicker noise coefficient & - & 0.0 & 1.0e-26\\ \hline
\vt af & \rr flicker noise exponent & - & 1.0 & 1.2\\ \hline
\vt fc & \rr coefficient for forward-bias depletion capacitance
 formula & - & 0.5 & -\\ \hline
\vt delta & \rr width effect on threshold voltage (MOS2 and MOS3) &
 - & 0.0 & 1.0\\ \hline
\vt theta & \rr mobility modulation (MOS3 only) & $1/V$ & 0.0 & 0.1\\ \hline
\vt eta & \rr static feedback (MOS3 only) & - & 0.0 & 1.0\\ \hline
\vt kappa & \rr saturation field factor (MOS3 only) & - & 0.2 & 0.5\\ \hline
\vt tnom & \rr parameter measurement temperature & $C$ & 25 & 50\\ \hline
\end{longtable}
\end{quote}

The level 4 (BSIM1) parameters are all values obtained from process
characterization, and can be generated automatically.
J. Pierret\cite{pierret} describes a means of generating a ``process''
file, and the program {\vt proc2mod} provided with {\WRspice} will convert this
file into a sequence of {\vt .model} lines suitable for inclusion in
{\WRspice} input.  Parameters marked below with an * in the l/w column
also have corresponding parameters with a length and width dependency.
For example, {\vt vfb} is the basic parameter with units of volts, and
{\vt lvfb} and {\vt wvfb} also exist and have units of
volt-$\mu$meter.  The formula
\begin{displaymath}
P = P_0 + \frac{P_L}{L_{effective}} + \frac{P_W}{W_{effective}}
\end{displaymath}
is used to evaluate the parameter for the actual device specified with
\begin{displaymath}
L_{effective} = L_{input} - dl
\end{displaymath}
and
\begin{displaymath}
W_{effective} = W_{input} - dw .
\end{displaymath}

Note that unlike the other models in {\WRspice}, the BSIM model is
designed for use with a process characterization system that provides
all the parameters, thus there are no defaults for the parameters, and
leaving one out is considered an error.  For an example set of
parameters and the format of a process file, see the SPICE2
implementation notes\cite{sheu}.
\begin{quote}
\begin{longtable}{|l|c|p{3in}|l|}\hline
\multicolumn{4}{|c|}{\bf BSIM (Level 4) Parameters}\\ \hline
\bf name & \bf l/w & \bf parameter & \bf units\\ \hline\hline
\vt vfb & $*$ & \rr flat-band voltage & $V$\\ \hline
\vt phi & $*$ & \rr surface inversion potential & $V$\\ \hline
\vt k1 & $*$ & \rr body effect coefficient & $V^{1/2}$\\ \hline
\vt k2 & $*$ & \rr drain/source depletion charge sharing coefficient & -\\
 \hline
\vt eta & $*$ & \rr zero-bias drain-induced barrier lowering coefficient &
 -\\ \hline
\vt muz & & \rr zero-bias mobility & $cM^2/VS$\\ \hline
\vt dl & & \rr shortening of channel & ${\mu}M$\\ \hline
\vt dw & & \rr narrowing of channel & ${\mu}M$\\ \hline
\vt u0 & $*$ & \rr zero-bias transverse-field mobility degradation
 coefficient & $V^{-1}$\\ \hline
\vt u1 & $*$ & \rr zero-bias velocity saturation coefficient & ${\mu}M/V$\\
 \hline
\vt x2mz & $*$ & \rr sens. of mobility to substrate bias at Vds = 0 &
 $cM^2/V^2S$\\ \hline
\vt x2e & $*$ & \rr sens. of drain-induced barrier lowering to substrate
 bias & $V^{-1}$\\ \hline
\vt x3e & $*$ & \rr sens. of drain-induced barrier lowering to drain bias at
 Vds = Vdd & $V^{-1}$\\ \hline
\vt x2u0 & $*$ & \rr sens. of transverse field mobility degradation to
 substrate bias & V$^{-2}$\\ \hline
\vt x2u1 & $*$ & \rr sens. of velocity saturation effect to substrate
 bias & ${\mu}MV^{-2}$\\ \hline
\vt mus & & \rr mobility at zero substrate bias and at Vds = Vdd &
 $cM^2/V^2S$\\ \hline
\vt x2ms & $*$ & \rr sens. of mobility to substrate bias at Vds = Vdd &
 $cM^2/V^2S$\\ \hline
\vt x3ms & $*$ & \rr sens. of mobility to drain bias at Vds = Vdd &
 $cM^2/V^2S$\\ \hline
\vt x3u1 & $*$ & \rr sens. of velocity saturation effect on drain bias
 at Vds = Vdd & ${\mu}MV^{-2}$\\ \hline
\vt tox & & \rr gate oxide thickness & ${\mu}M$\\ \hline
\vt temp & & \rr temperature at which parameters were measured & $C$\\ \hline
\vt vdd & & \rr measurement bias range & $V$\\ \hline
\vt cgdo & & \rr gate-drain overlap capacitance per channel width & $F/M$\\
 \hline
\vt cgso & & \rr gate-source overlap capacitance per channel
 width & $F/M$\\ \hline
\vt cgbo & & \rr gate-bulk overlap capacitance per channel length & $F/M$\\
 \hline
\vt xpart & & \rr gate-oxide capacitance charge model flag & -\\ \hline
\vt n0 & $*$ & \rr zero-bias subthreshold slope coefficient & -\\ \hline
\vt nb & $*$ & \rr sens. of subthreshold slope to substrate bias & -\\
 \hline
\vt nd & $*$ & \rr sens. of subthreshold slope to drain bias & -\\ \hline
\vt rsh & & \rr drain and source diffusion sheet resistance &
 $\Omega/\Box$\\ \hline
\vt js & & \rr source drain junction current density & $A/M^2$\\ \hline
\vt pb & & \rr built in potential of source drain junction & $V$\\ \hline
\vt mj & & \rr grading coefficient of source drain junction & -\\ \hline
\vt pbsw & & \rr built in potential of source,drain junction sidewall &
 $V$\\ \hline
\vt mjsw & & \rr grading coefficient of source drain junction sidewall &
 -\\ \hline
\vt cj & & \rr source drain junction capacitance per unit area & $F/M^2$\\
 \hline
\vt cjsw & & \rr source drain junction sidewall capacitance per unit
 length & $F/M$\\ \hline
\vt wdf & & \rr source drain junction default width & $M$\\ \hline
\vt dell & & \rr source drain junction length reduction & $M$\\ \hline
\end{longtable}
\end{quote}

The parameter {\vt xpart = 0} selects a 40/60 drain/source charge
partition in saturation, while {\vt xpart = 1} selects a 0/100
drain/source charge partition.

\subsubsection{Imported MOS Models}
\index{MOSFET levels}
% spModels.hlp:moslevel 022514

The device library supplied with {\WRspice} contains a number of MOS
models supplied by various development groups.  The models that are
currently provided in the device library are listed below.  Specific
models are selected through the {\vt level} parameter.  Other
parameters are specific to that model, and there is not in general a
great deal of commonality of parameter names between the various
models.  Only the simple models provided in SPICE3 will be
documented.  Documentation for the third-party models is available
from the Whiteley Research web site.

The user should see the help system for the most recent list of
available models, since the list may have changed after the manual was
printed.

The {\cb devmod} command can be used to change the model levels of
these devices, with the exception of the MOS device (levels 1--3 and
6) whose level numbers are fixed.  Alternatively, the {\vt .mosmap}
keyword can be used in SPICE input to map the level number of a
foreign simulator into the number expected by {\WRspice}.  The {\vt
.mosmap} line, which must be read before the corresponding {\vt
.model} line, is followed by two integers.  The first integer is the
level number found in the file, the second is the {\WRspice} level
number appropriate for the model parameter set.  Both of these methods
avoid the need to copy the model file and edit the level number. 

The table below lists all of the MOS levels recognized in {\WRspice}.

\begin{quote}
\begin{tabular}{|l|l|l|}\hline
\bf Level & \bf Name & \bf Description\\ \hline\hline
\bf 1 & MOS & The SPICE3 mos1 (Shichman-Hodges) model\\ \hline
\bf 2 & MOS & The SPICE3 mos2 model described in \cite{vlad}\\ \hline
\bf 3 & MOS & The SPICE3 mos3 semi-empirical model (see\cite{vlad})\\ \hline
\bf 4 & BSIM1 & The SPICE3 bsim1 empirical model described in \cite{sheu}\\ \hline
\bf 5 & BSIM2 & The SPICE3 bsimw model, successor to bsim1\\ \hline
\bf 6 & MOS & The SPICE3 mos6 model\\ \hline
\bf 7, 49 & BSIM3.2.0 & U.C. Berkeley bsim-3.2.0 model\\ \hline
\bf 8, 47 & BSIM3.2.4 & U.C. Berkeley bsim-3.2.4 model\\ \hline
\bf 9, 53 & BSIM3.3.0 & U.C. Berkeley bsim-3.3.0 model\\ \hline
\bf 12 & BSIM4.2.1 & U.C. Berkeley bsim-4.2.1 model\\ \hline
\bf 13 & BSIM4.3.0 & U.C. Berkeley bsim-4.3.0 model\\ \hline
\bf 14 & BSIM4.4.0 & U.C. Berkeley bsim-4.4.0 model\\ \hline
\bf 15, 54 & BSIM4.6.5 & U.C. Berkeley bsim-4.6.5 model\\ \hline
\bf 16, 56 & BSIM4.7.0 & U.C. Berkeley bsim-4.7.0 model\\ \hline
\bf 17, 59 & BSIM4.8.0 & U.C. Berkeley bsim-4.8.0 model\\ \hline
\bf 20 & BSIMSOI-3.0 & U.C. Berkeley bsimsoi-3.0 SOI model\\ \hline
\bf 21 & BSIMSOI-3.2 & U.C. Berkeley bsimsoi-3.2 SOI model\\ \hline
\bf 22, 57 & BSIMSOI-4.0 & U.C. Berkeley bsimsoi-4.0 SOI model\\ \hline
\bf 23, 70 & BSIMSOI-4.3 & U.C. Berkeley bsimsoi-4.3 SOI model\\ \hline
\bf 24, 71 & BSIMSOI-4.4 & U.C. Berkeley bsimsoi-4.4 SOI model\\ \hline
\bf 25, 55 & EKV-2.6 & EPFL (Switzerland) MOS model release 2.6\\ \hline
\bf 30 & HISIM-1.1.0 & Hiroshima University hisim-1.1.0 model\\ \hline
\bf 31, 64 & HISIM-1.2.0 & Hiroshima University hisim-1.2.0 model\\ \hline
\bf 33 & Soi3 & Southampton Thermal Analogue (STAG-2.6) SOI model\\ \hline
\bf 36, 58 & UFSOI-7.5 & U. Florida SOI model release 7.5\\ \hline
\end{tabular}
\end{quote}

Notes:\\
\begin{description}
\item{BSIM models}\\
The home page for the Berkeley BSIM models is
{\vt http://www-device.eecs.berkeley.edu/~bsim3}.
The home page for the Berkeley BSIMSOI models is
{\vt http://www-device.eecs.berkeley.edu/~bsimsoi}.

In {\WRspice} release 3.2.5, MOS level 54 was changed to point to the
BSIM-4.6.5 model, which replaced the BSIM-4.6.1 model.  In earlier
releases, level 54 pointed to BSIM-4.3.0.  Going forward, level 54
will point to the ``latest and greatest'' BSIM4 model available.

\item{EKV-2.6}\\
The level EKV-2.6 model installation has not been validated by EPFL,
and by agreement until such validation is performed there is no claim
that this is {\it THE} EKV model.  The EKV home page is {\vt
http://legwww.epfl.ch/ekv}.

\item{STAG}\\
The STAG (Southampton Thermal Analogue Model) does not appear to be
available from or supported by the author anymore.  This model will
likely be removed in a future release.

\item{HiSIM}\\
The HiSIM model source code is no longer generally available, and is
behind a Comapct Modeling Council firewall.  It is unlikely that newer
HiSIM models will be added unless there is a specific customer
request.

\item{UFSOI-7.5}\\
The home page for the U. Florida modes is
{\vt http://www.soi.tec.ufl.edu}.
\end{description}

Manuals for the BSIM3/4 and third-party MOS models are available on the
Whiteley Research web site.

If you need a specific device model, please send a note to
Whiteley Research.  It is possible that the model can be added.

\subsubsection{HSPICE MOS Level 49 Compatibility in {\WRspice}}

In {\WRspice}, level 49 is equivalent to level 7, which is the
BSIM3v3.2 model from Berkeley.  However, there are differences in the
parameter sets between this model and the level 49 model of HSPICE,
which is based on BSIM3 and customized for HSPICE.  In particular, the
HSPICE extensions are not supported in {\WRspice}.

This document lists the parameters that are accepted in HSPICE level
49 model parameter sets that are not supported in the Berkeley model,
or have different interpretation.  The parameters are listed in
alphabetical order, by category.  This list is possibly incomplete.

This list also applies to the level 8 (BSIM3v3.2.4) model in
{\WRspice}.  In {\WRspice} release 2.2.50 and earlier, level 49 was
mapped to level 8.  However, the {\vt VERSION} parameter in level 8
{\it must} be ``3.2.4'' if given, which is not generally true in
imported files.  The level 7 model handles earlier versions, notably
3.1, without complaint.

\paragraph{General parameters}

\begin{description}
\item{\vt BINFLAG}\\
 This is not used for {\WRspice}.
\item{{\vt SCALM}, {\vt SCALE}}\\
 In HSPICE these are the ``model scaling factor'' and ``element scaling
 factor''.  There are no {\WRspice} equivalents.
\item{\vt TREF}\\
 Temperature at which parameters are extracted.  This is taken as an
 alias for the BSIM3 {\vt TNOM} parameter in {\WRspice}.
\item{\vt NQSMOD}\\
 This is accepted by {\WRspice} as an extension to BSIM3, and serves as
 the default for devices that use the model.  If also given on the
 device line, that value will override.
\end{description}

\paragraph{Length and Width}

\begin{description}
\item{{\vt LREF}, {\vt WREF}}\\
 In HSPICE these are ``channel length reference'' and ``channel width
 reference''.  There are no {\WRspice} equivalents.
\item{{\vt XW}, {\vt XL}}\\
 In HSPICE these account for masking and etching effects.  In release
 3.1.5 and later, the {\vt XW} and {\vt XL} parameters are handled by
 the BSIM3 bulk-mos models (levels 7, 8, 9, 47, 49, and 53)
 implementing the formula below.  With earlier releases, one must
 modify {\vt WINT} and {\vt LINT}.
\begin{quote}
  $WINT_{new}$ = $WINT_{old}$ - $XW$/2\\
  $LINT_{new}$ = $LINT_{old}$ - $XL$/2
\end{quote}
\end{description}

\paragraph{MOS Diode Model Parameters}

\begin{description}
\item{\vt ACM}\\
 In HSPICE this selects the area calculation method.  {\WRspice} uses
 only one model for the bulk-to-source and bulk-to-drain diodes.  It
 corresponds to the HSPICE equivalent of {\vt ACM}=0.  Do not use this
 parameter for {\WRspice}.  {\vt ACM} is not needed if {\vt AS}, {\vt
 AD}, {\vt PS}, and {\vt PD} are specified explicitly.
\item{\vt CJGATE}\\
 In HSPICE this is the zero-bias gate-edge sidewall bulk junction
 capacitance used with {\vt ACM}=3 only.  There is no {\WRspice}
 equivalent.
\item{{\vt HDIF}, {\vt LDIF}}\\
 In HSPICE this is the ``length of heavily doped diffusion'' and
 ``length of lightly doped diffusion''.  They are used with the HSPICE
 {\vt ACM}=2 MOS diode models, and there are no {\WRspice} equivalents. 
 {\vt HDIF} and {\vt LDIF} are not needed if {\vt AS}, {\vt AD}, {\vt
 PS}, and {\vt PD} are specified explicitly.
\item{\vt N}\\
 In HSPICE this is the ``emission coefficient'', and is taken as an
 alias for the BSIM3 {\vt NJ} parameter.
\item{\vt RDC}\\
 In HSPICE this is additional drain resistance due to contact
 resistance.  If {\vt RD} is specified, use
\begin{quote}
 $RD_{new}$ = $RD_{old}$ + $RDC$
\end{quote}
 If {\vt RSH} is specified, then {\vt RDC} should be added to {\vt
 RD}={\vt NRD}*{\vt RSH}.  Since {\vt NRD} is a device parameter and
 not a model parameter, a typical {\vt NRD} value must be used.
\item{\vt RSC}\\
 In HSPICE this is additional source resistance due to contact
 resistance.  If {\vt RS} is specified, use
\begin{quote}
 $RS_{new}$ = $RS_{old}$ + $RSC$
\end{quote}
 If {\vt RSH} is specified, then {\vt RSC} should be added to {\vt
 RS}={\vt NRS}*{\vt RSH}.  Since {\vt NRS} is a device parameter and
 not a model parameter, a typical {\vt NRS} value must be used.
\item{{\vt WMLT}, {\vt LMLT}}\\
 In HSPICE these are ``length of heavily doped diffusion'' and ``length
 of lightly doped diffusion'' used in the {\vt ACM}=1--3 models.  There
 are no {\WRspice} equivalents.  {\vt WMLT} and {\vt LMLT} are not
 needed if {\vt AS}, {\vt AD} {\vt PS}, and {\vt PD} are specified
 explicitly.
\end{description}

\paragraph{Capacitance Parameters}

\begin{description}
\item{\vt CAPOP}\\
 Do not use {\vt CAPOP} for {\WRspice}.  {\vt CAPMOD} is included in
 the BSIM3 model.  {\vt CAPOP} is HSPICE specific, and not included in
 the BSIM3 parameter set.  The default BSIM3 capacitance model is {\vt
 CAPMOD=3}.
\item{\vt CJM}\\
 This is taken as an alias for the BSIM3 {\vt CJ} parameter in
 {\WRspice}.
\item{\vt MJ0}\\
 This is taken as an alias for the BSIM3 {\vt MJ} parameter in
 {\WRspice}.
\item{\vt PJ}\\
 This is taken as an alias for the BSIM3 {\vt PB} parameter in
 {\WRspice}.
\item{{\vt CTA}, {\vt CTP}}\\
 In HSPICE these are the ``junction capacitance CJ temp.  coeff.'' and
 ``junction sidewall capacitance CJSW temp.  coeff'', used with {\vt
 TLEVC=1}.  There are no {\WRspice} equivalents.
\item{{\vt PTA}, {\vt PTP}}\\
 In HSPICE these are the ``junction potential PB temp.  coeff.'' and
 ``fermi potential PHI temp.  coeff'', used with {\vt TLEVC=}1 or 2. 
 There are no {\WRspice} equivalents.
\item{\vt PHP}\\
 This is taken as an alias for the BSIM3 {\vt PBSW} parameter in
 {\WRspice}
\item{{\vt TLEV}, {\vt TLEVC}}\\
 In HSPICE this is the ``temperature equation level selector'' and
 ``temperature equation level selector for junction capacitances and
 potentials''.  Do not use these parameters for {\WRspice}.
\end{description}

\paragraph{Impact Ionization}

\begin{description}
\item{{\vt ALPHA}, {\vt LALPHA}, {\vt WALPHA}, {\vt VCR}, {\vt LVCR},
 {\vt WVCR}, and {\vt IIRAT}}\\
 These are impact ionization parameters in HSPICE.  There are no
 {\WRspice} equivalents.  BSIM3 has its own impact ionization model
 which is instead used in most cases.
\end{description}

\paragraph{V3.2 parameters}

Level 49 parameter sets in {\WRspice} may include BSIM3v3.2
parameters, though historically HSPICE level 49 was based on
BSIM3v3.1.  The following parameters are new for v3.2:

\begin{description}
\item{{\vt ALPHA1}, {\vt ACDE}, {\vt MOIN}, {\vt NOFF}, {\vt VOFFCV}}\\
 All except {\vt ALPHA1} are used in a new capacitance model ({\vt
 CAPMOD=3}).  {\vt ALPHA1} modifies the substrate current equation as
 follows:
\begin{quote}
 {\vt Isub \symbol{126} (ALPHA0 + ALPHA1*Leff) / Leff}
\end{quote}
\end{description}


\newpage
%S-----------------------------------------------------------------------------
\section{Superconductor Devices}

%SU-------------------------------------
\subsection{Josephson Junctions}
\index{Josephson junction instance}

% spElements.hlp:jj 072020

\spgen{b{\it name} {\it n\/}+ {\it n\/}- [{\it np\/}] [{\it modname\/}]
 [{\it parameters} ...]}

\begin{tabular}{|l|p{4.5in}|}\hline
\bf Parameter Name & \bf Description\\ \hline\hline
{\vt pijj=1|0} & Whether the device is a ``pi'' junction.\\ \hline
{\vt area=}{\it val} & Scale factor that multiplies all currents and
  other values, effectively modifying the junction area.\\ \hline
{\vt ics=}{\it val} & Instantiated critical current, used as scale factor
  for capacitance, conductances.\\ \hline
{\vt temp\_k=}{\it val} & Device temperature, Kelvin.\\ \hline
{\vt lser=}{\it val} & Junction series parasitic inductance. \\ \hline
{\vt lsh=}{\it val} & Shunt resistor series parasitic inductance. \\ \hline
{\vt ic=}{\it vj\/},{\it phi} & The initial junction voltage and phase
  (initial condition) for transient analysis.\\ \hline
{\vt vj=}{\it vj} & The initial junction voltage (initial condition) for
  transient analysis, alias {\vt ic\_v}.\\ \hline
{\vt phi=}{\it phi} & The initial junction phase (initial condition) for
  transient analysis, alias {\vt ic\_phase}.\\ \hline
{\vt control=}{\it name} & Controlling voltage source or inductor
  name.\\ \hline
{\vt n} & SFQ emission count (read only).\\ \hline
{\vt phase} & Junction phase (read only).\\ \hline
{\vt phsf} & True if SFQ count change at chrrent time point (read only).\\
 \hline
{\vt phst} & Time of last SFQ emission (read only).\\ \hline
\end{tabular}

\spexamp{b1 1 0 10 jj1 ics=200uA\\
bxx 2 0 type1 control=l3\\
b2 4 5 ybco phi=1.57}

Unless stated otherwise, information presented here applies to the
standard RSJ model, the Verilog-A Josephson junction model provided
with {\WRspice} in the Verilog-A examples, and the microscopic model.
These are referred to as levels 1, 2, and 3 respectively.

The {\it n+} and {\it n-} are the positive and negative element nodes,
respectively.  These are followed by an optional phase node.  The
phase node, if specified, generally should have no other connections
in the circuit, but the voltage of this node gives the phase of the
junction in radians.  The {\it modname} is the name of the Josephson
junction model.  If no model is specified, then a default model is
used (see the description of the Josephson model for the default
values).  Other (optional) parameters follow in any order.

\begin{description}
\item{\vt pijj}\\
{\bf Levels 1 and 2 only.}\\
If the {\vt pijj} parameter is given and set to a nonzero integer
value, the device instance will behave as a ``pi'' junction.  This
type of junction has a ground state with phase $\pi$ rather than 0. 
The value given on the device line (if any) overrides the value given
in the model.  This parameter may not be recognized in the Verilog-A
model.

\item{\vt area}\\
{\bf range:} 0.05 -- 20.0\\
{\bf Deprecated, do not use in new files.}\\
Histrorically, this parameter has been used to set the actual critical
current of a Josephson junction instance.  It is not a physical area,
but rather a scale factor, representing the ratio of the instance
critical current to the reference critical current.  The parameter is
retained for backwards compatibility, but should not be used in new
circuit descrfiptions.  The {\vt ics} parameter (below) should be used
instead.  By using {\vt ics}, one can change the critical current of
the reference junction without changing the instance critical
currents, which is not the case for {\vt area}.  In the new paradigm,
the reference junction critical current corresponds to a ``typical''
mid-sized junction, with a not necessarily convenient critical current
value.  Use of {\vt area} assumes that the reference critical current
is something nice, like the historical 1mA, and unchanging.  If not
specified and {\vt ics} is not given, the effective value is 1.0.

\item{\vt ics}\\
{\bf range:} 0.02*{\vt icrit} -- 50.0*{\vt icrit}\\
This gives the actual critical current of the instantiated junction,
and in addition scales all conductance and capacitance values from the
reference junction appropriately.  This is equivalent to giving the
{\vt area} parameter with a value of {\vt ics}/{\vt icrit}.  The
default is {\vt icrit}, the reference junction critical current.

\item{\vt temp\_k}\\
{\bf range:} 0.0 -- 0.95*{\vt tc}\\
This is the assumed operating temperature of the device, in Kelvin. 
The default is the model {\vt deftemp} value.  See the model description
for more information about temperature modeling.

\item{\vt lser}\\
{\bf range:} 0.0 -- 10.0pH\\
This models series inductance of the physical Josephson junction
structure, caused by constriction of current through the junction
orifice.  This inductance might typically be in the range of 0.1 to
0.3 picohenries.  If nonzero, an internal node is added to the model,
providing the connection point of the inductance and the Josephson
junction.  The default value is 0.0, meaning that no parasitic
inductance is assumed.  Nonzero given values less than 0.01pH revert
to zero.

\item{\vt lsh}\\
{\bf range:} 0.0 -- 100.0pH\\
This parameter specifies the series inductance of the external shunt
resistance.  The {\vt vshunt} model parameter must be specified such
that a positive external shunt conductance is applied, otherwise this
parameter is ignored.  Ordinarily, the {\vt lsh0}/{\vt lsh1} model
parameters would be used to specify the inductance, this parameter can
be used to override these values on a per-instance basis if desired.

\item{\vt ic}\\
{\bf Levels 1 and 3 only.}\\
The keyword is expected to be followed by two numbers, giving the
initial junction voltage and phase in radians.  These apply in
transient analysis when the ``{\vt uic}'' option is included in the
transient analysis specification.  The initial junction voltage and
phase both default to 0.0.

\item{{\vt vj} or {\vt ic\_v}}\\
This provides the initial voltage of the junction when the ``{\vt
uic}'' option is included in the transient analysis specification. 
The initial junction voltage defaults to 0.0.

\item{{\vt phi} or {\vt ic\_phase}}\\
This provides the initial junction phase in radians when the ``{\vt
uic}'' option is included in the transient analysis specification.

\item{\vt control}\\
{\bf evel 1 only.}\\
The {\vt control} parameter is only needed if critical current
modulation is part of the circuit operation, and is only relevant to
Josephson junction model types that support critical current
modulation, that is, the model parameter {\vt cct} is given a value
larger than 1.  The {\it name} in the {\vt control} specification is
the name of either a voltage source or inductor which appears
somewhere in the circuit.  The current flowing through the indicated
device is taken as the junction control current.

\item{\vt n} (read only)\\
This integer value is incremented whenever the junction phase changes
by $2\pi$.  It is intended for pass/fail testing of SFQ circuit
operation.
 
\item{\vt phase} (read only)\\
This is set to the junction phase, and reading this is an alternative
to using a third node to obtain the phase.
 
\item{\vt phsf} (read only)\\
This flag is set true at the time point when the SFQ emission count
changes.  This is intended to facilitate pass/fail testing of SFQ
circuits.

\item{\vt phst} (read only)\\
This read-only parameter contains the last time that the SFQ emission
count changed, intended for use in SFQ pass/fail testing.
\end{description}

The Josephson junction device has unique behavior which complicates
simulation with a SPICE-type simulator.  Central is the idea of phase,
which is a quantum-mechanical concept and is generally invisible in
the non-quantum world.  However with superconductivity, and with
Josephson junctions in particular, phase becomes not only observable,
but a critical parameter describing these devices and the circuits
that contain them.

Without going into the detailed physics, one can accept that phase is
an angle which applies to any superconductor.  The angle is a fixed
value anywhere on the superconductor, unless current is flowing. 
Flowing current produces magnetic flux, and magnetic flux produces a
change in phase.  One can express this as follows:

\begin{quote}
$LI = flux = \Phi_0(\phi/2\pi)$
\end{quote}

Here, $L$ is the inductance, $\Phi_0$ is the magnetic flux quantum
(Planck's constant divided by twice the electron charge) and $\phi$ is
the phase difference across the inductor.  The supercurrent flowing in
a Josephson junction is given by

\begin{quote}
$I = I_c sin(\phi)$
\end{quote}

where $I_c$ is the junction critical current, and $\phi$ is the phase
difference across the junction.  The junction phase is proportional to
the time integral of junction voltage:

\begin{quote}
$\phi = (2\pi/\Phi_0)\int^t_{-\infty} V(t)dt$
\end{quote}

The important consequence is that the sum of the phase differences
around any loop consisting of Josephson junctions and inductors must
be a multiple of $2\pi$.  This is due to the requirement that the
superconducting wave function be continuous around the loop.  Further,
if the loop phase is not zero, it implies that a persistent current is
flowing around the loop, and that the magnetic fluc through the loop
is a multiple of the flux quantum $\Phi_0$.

We therefor observe that in a circuit containing loops of Josephson
junctions and inductors, which includes about all useful circuits:

\begin{enumerate}
\item{The DC voltage across each Junction or inductor is zero.}
\item{The DC current applied to the circuit splits in such a manner
as to satisfy the phase relations above.}
\end{enumerate}

Without any built-in concept of phase, it would appear to be
impossible to find the DC operating point of a circuit containing
Josephson junctions and inductors with a SPICE simulator.  However,
there are ways to accomplish this.

The time-honored approach, used successfully for many years, is to
skip DC analysis entirely.  One generally is interested only in
transient analysis, describing the time evolution of the circuit under
stimulus, and a DC analysis would only be necessary to find the
initial values of circuit voltages and currents.  Instead of a DC
analysis, what is done is every voltage and current source starts at
zero voltage or current, and ramps to the final value in a few
picoseconds.  The transient analysis is performed using the ``use
initial conditions'' (``{\vt uic}'') option, where there is no DC
operating point analysis, and transient analysis starts immediately
with any supplied initial condicions (which are not generally given in
this case).  By ramping up from zero, the phase condition around
junction/inductor loops is satisfied via Kirchhoff's voltage law. 
Actually, this ensures that the loop phase is constant, but it is zero
as we started from zero.  Initially, there is no ``trapped flux'' in
the inductor/junction loops, so assumption of zero phase is correct. 
Thus the prescription is to ramp up all sources from zero, use the
{\vt uic} option of transient analysis, and wait for any transients
caused by the ramping sources to die away before starting the ``real''
simulation.  The ramping-up effectively replaces the DC operating
point analysis.

{\WRspice} after release 4.3.3 offers a DC analysis capability which
uses phase-mode for circuits containing Josephson junctions.  Unlike
strictly phase-mode simulators, {\WRspice} allows a mixture of phase
(inductors and Josephson junctions) and voltage mode components.

Within {\WRspice}, every node connected to a Josephson junction,
inductor, or lossless transmission line (treated as an inductor in DC
analysis) has a ``Phase'' flag set.  This indicates that the computed
value is phase, not voltage, for these nodes.  We have to special-case
the matrix loading functions for inductors, mutual inductors, lossless
transmission lines, and resistors.  Other devices are treated
normally.

A Josephson junction can be modeled by the basic formula

\begin{quote}
$I = I_c sin(V(i,j))$
\end{quote}

where $V(i,j)$ is the ``voltage'' difference between nodes i and j
(across the junction) which is actually the phase.  Inductors look
like resistors:

\begin{quote}
$I = \Phi_0 V(i,j)/2{\pi}L$
\end{quote}

Where $V(i,j)$ is the phase difference across the inductor.  Mutual
inductance adds similar cross terms.

Capacitors are completely ignored as in normal DC analysis.  The
treatment of resistors is slightly complicated.  The connected nodes
can be ``Ground'', ``Phase'', or ``Voltage'' type.  If both nodes are
Voltage or Ground, the resistor is loaded normally.  If both nodes are
Phase or Ground, the resistor is not loaded at all.  The interresting
case is when one node is Phase, the other Voltage.  In this case, we
load the resistor as if the phase node is actually ground (node number
0).  In addition we load a voltage-controlled current source template
that injects current into the phase node of value
$V(voltage\_node)/Resistance$.

Resistors are the bridge between normal voltage-mode devices and phase
nodes.  Some circuits may require introduction of resistors to get
correct results.  For example, assume a Josephson junction logic gate
driving a CMOS comparator circuit.  If the input MOS gate is connected
directly to the junction, the DC operating point will be incorrect, as
the comparator will see phase as input.  However, if a resistor
separates the MOS gate from the junction, the comparator input will be
zero, as it should be.

There is (at present) a topological requirement that all phase nodes
must be at ground potential.  This means that for a network of
Josephson junctions and inductors, there must be a ground connection
to one of these devices.  A nonzero voltage source connected to an
inductor, which is connected to a resistor to ground, although a
perfectly valid circuit, will fail.  One must use the equivalent
consisting of the voltage source connected to a resistor, connected to
the inductor which is grounded.  This satisfies the two topological
requirements:

\begin{description}
\item{Rule 1}\\
There must be a resistor between a voltage-mode device and a
phase-mode device, no direct connections allowed.

\item{Rule 2}\\
Every phase-node subnet must have a connection to ground, so all phase
nodes are at ground potential.
\end{description}

With this bit of information, and the warning that controlled sources
can cause unexpected behavior, the DC analysis using thes technique
can apply to general circuits containing Josephson junctions.

Of course, for this to work, no Josephson junction can be biased above
its critical current or nonconvergence results.  Both DC operating
point and DC sweep are available, as is AC analysis.  Noise analysis
is available with the internal Josephson junction model.  This new
hybrid technique appears to be an important advance, which should
avoid the long-standing need to use ``{\vt uic}'' and ramp sources up
from zero, and makes available DC sweep analysis, and for the first
time in any simulator AC small-signal analysis.

See the Josephson junction model description for more information.


%SU-------------------------------------
\subsection{Josephson Junction Model}
\index{Josephson junction model}
\label{jjmodel}

% spModels.hlp:jjmodel 011821

{\cb Type Name:} {\vt jj}

The default Josephson junction model is an extended version of the RSJ
model as used by Jewett\cite{jewett}.  For level=3, a microscopic
tunnel junction ``Werthamer'' model is provided.  This is based on the
open-source MitMoJCo project on {\vt
https://github.com/drgulevich/mitmojco}. 

The parameters marked with an asterisk in the {\bf area} column scale
with the {\vt ics} parameter given in the device line, not necessarily
linearly.  The present model paradigm assumes that the model
parameters apply to a ``reference'' junction, which is a typical
mid-critical current device as produced by the fouhdry. 
Instantiations derive from the reference device for a desired critical
current.  Appropriate scaling, not necessarily linear, will be applied
when formulating instance capacitance and conductances.

\begin{quote}
\begin{tabular}{|l|c|l|l|l|}\hline
\multicolumn{5}{|c|}{\bf JJ Model Parameters}\\ \hline
\bf name & \bf area & \bf parameter & \bf units & \bf default\\ \hline\hline
\vt level & & \rr model type & - & 1\\ \hline
\vt coeffset & & \rr coefficient set name & - &\\ \hline
\vt pijj & & \rr pi junction & - & 0\\ \hline
\vt rtype & & \rr Quasiparticle branch model & - & 1\\
\hline
\vt cct & & \rr Critical current model & - & 1\\
\hline
\vt icon & & \rr Critical current first zero & $A$ & 1.0e-2\\
\hline
\vt icrit & $*$ & \rr Reference junction critical current & $A$ & 1.0e-3\\
\hline
{\vt vg} or {\vt vgap} & & \rr Gap voltage & $V$ & 2.6e-3\\
\hline
\vt delv & & \rr Gap voltage spread & $V$ & 80.0e-6\\
\hline
\vt cap & $*$ & \rr Reference junction capacitance & $F$ & 0.7e-12\\
\hline
\vt cpic & & \rr Reference junction capacitance per critical current & $F/A$ &
 0.7e-9\\ \hline
\vt cmu & & \rr Capacitance area/edge scaling & & 0.0\\
\hline
\vt vm & & \rr Reference icrit*rsub & $V$ & 16.5e-3\\
\hline
{\vt rsub} or {\vt r0} & $*$ & \rr Reference subgap resistance & $\Omega$ & vm/icrit\\
\hline
\vt icrn & & \rr Reference icrit*rnorm & $V$ & 1.65e-3\\
\hline
{\vt rnorm} or {\vt rn} & $*$ & \rr Reference normal state resistance & $\Omega$ &
 icrn/icrit\\
\hline
\vt gmu & & \rr Conductance area/edge scaling & & 0.0\\
\hline
{\vt icfct} or {\vt icfact} & & \rr Ratio of critical to gap currents & - & ${\pi}/4$\\
\hline
\vt force & & \rr Don't check conductances & & 0\\
\hline
\vt vshunt & & \rr Voltage to specify fixed shunt resistance & $V$ & 0.0\\
\hline
\vt lsh0 & & \rr Shunt resistor series inductance, constant part & $H$ & 0.0\\
\hline
\vt lsh1 & & \rr Shunt resistor series inductance, proportional part & $H/\Omega$ & 0.0\\
\hline
\vt tsfactor & & \rr Time step phase change limit & & ${\vt dphimax}/2\pi$\\
\hline
\vt tsaccel & & \rr time step accelerator & & 1.0\\
\hline
\vt tc & & \rr superconducting transition temperature & $K$ & 9.26\\
\hline
\vt tnom & & \rr model reference temperature & $K$ & 4.2\\
\hline
\vt deftemp & & \rr operating temperature & $K$ & \vt tnom\\
\hline
\vt tcfct & & \rr temperature dependence fitting parameter & & 1.74\\
\hline
\vt vdbpak & & \rr dropback voltage (read only) & &\\
\hline
\end{tabular}
\end{quote}

Detailed information about these parameters is presented below. 
Unless stated otherwise, this information also applies to the
Verilog-A Josephson junction model provided with {\WRspice} in the
Verilog-A examples, and the microscopic model.

\begin{description}
\item{\vt level}\\
This specifies the model to use.  There are three choices provided in
{\WRspice}.  Level 1 (the default) is the internal RSJ model, and
level 2 indicates the Verilog-A example RSJ model, which is available
if it has been loaded.  The third choice is level 3, which is an
internal microscopic tunnel junction model, based on the open-source
MitMoJCo project on {\vt https://github.com/drgulevich/mitmojco}. 

\item{\vt coeffset}\\
{\bf Level 3 only.}\\
This provides the name of the table of tunnel current amplitudes to
use in the model.  These are provided as files as produced from the
{\it mmjco} utility provided with {\WRspice}, and can also be produced
with the Python program supplied with MitMoJCo.  The files are
searched for along a path provided by setting the {\et tjm\_path}
variable, or a path can be provided directly.  The default is to
search the current directory and {\vt \$HOME/.mmjco} if that directory
exists.

There are two built-in coefficient sets, ``tjm1'' (the default) and
``tjm2''.  These are the MitMoJCo NbNb\_4k2\_008 and NbNb\_4K2\_001
parameter sets, respectively.  Both assume niobium at temperature 4.2K
and differ in the level of smoothing applied to mitigate the Riedel
singularity.

\item{\vt pijj}\\
{\bf Levels 1 and 2 only.}\\
If this flag is given a nonzero integer value, the junctions will be
modeled as a ``pi junction'' meaning that the zero-current phase is
$\pi$ rather than zero.  Such devices have been fabricated using
ferromagnetic barrier materials.  Although these devices have some
interesting behavior, they are not at this point available or used
with any frequency.

\item{\vt rtype}\\
{\bf Levels 1 and 2 only.}\\
The {\vt rtype} parameter determines the type of quasiparticle branch
modeling employed.  Legal values for level 1 are listed below, only 0
and 1 are supported in level 2.
\begin{quote}
\begin{tabular}{ll}
\bf 0 & The junction is completely unshunted, all shunt conductances
 set to zero.\\
\bf 1 & Standard piecewise-linear model.\\
\bf 2 & Analytic exponentially-derived approximation.\\
\bf 3 & Fifth order polynomial expansion model.\\
\bf 4 & ``Temperature'' variation, allow modulation of the gap parameter.\\
\end{tabular}
\end{quote}

Values for {\vt rtype} larger than 1 are not currently supported in
the Verilog-A model supplied with {\WRspice} in the Verilog-A
examples.

The default is {\vt rtype=1}.  Setting {\vt rtype=0} will disable
modeling of the quasiparticle current, effectively setting the RSJ
shunt resistance to infinity.  Conditions with {\vt rtype=1} and {\vt
2} are as described by Jewett, however it is not assumed that the
normal resistance projects through the origin.  The {\vt icfact}
parameter can be set to a value lower than the default BCS theoretical
value to reflect the behavior of most real junctions.  The
quasiparticle resistance is approximated with a fifth order polynomial
if {\vt rtype=3}, which seems to give good results for the modeling of
some NbN junctions (which tend to have gently sloping quasiparticle
curves).

{\vt Rtype=4} uses a piecewise-linear quasiparticle characteristic
identical to {\vt rtype=1}, however the gap voltage and critical
current are now proportional to the absolute value of the control
current set with a {\vt control=}{\it src\_name} entry in the device
line.  This is to facilitate modeling of temperature changes or
nonequilibrium effects.  For control current of 1 (Amp) or greater,
the full gap and critical current are used, otherwise they decrease
linearly to zero.  If no device control source is specified, the
algorithm reverts to {\vt rtype=1}.  It is expected that a nonlinear
transfer function will be implemented with a controlled source, which
will in turn provide the controlling current to the junction in this
mode.  For example, the controlling current can be translated from a
circuit voltage representing temperature with an external nonlinear
source.  The functional dependence is in general a complicated
function, but a reasonable approximation is $1 - (T/T_c)^4$.  See the
examples (\ref{examples}) for an example input file ({\vt ex10.cir})
which illustrates {\vt rtype=4}.

It is currently not possible to use other than the piecewise linear
model with temperature variation.  If {\vt rtype=4}, then legal values
for the critical current parameter are {\vt cct=0} (no critical
current) and {\vt cct=1} (fixed critical current).  If another value
is specified for {\vt cct}, {\vt cct} reverts to 0.  Thus, magnetic
coupling and quasiparticle injection are not simultaneously available.

\item{\vt cct}\\
{\bf Levels 1 and 2 only.}\\
The {\vt cct} parameter can take one of the following values in level
1, only 0 and 1 are supported in level 2.
\begin{quote}
\begin{tabular}{ll}
\bf 0 & No critical current.\\
\bf 1 & Fixed critical current.\\
\bf 2 & Sin(x)/x modulated supercurrent.\\
\bf 3 & Symmetric linear reduction modulation.\\
\bf 4 & Asymmetric linear reduction modulation.\\
\end{tabular}
\end{quote}

Values for {\vt cct} larger than 1 are not currently supported in the
Verilog-A model supplied with {\WRspice} in the Verilog-A examples.

The {\vt control} instance parameter should be used with devices using
{\vt cct} 2,3, or 4.  With {\vt cct=2}, the first zero is equal to the
value of the model parameter {\vt icon}.  For {\vt cct=3}, the maximum
critical current is at control current zero, and it reduces linearly
to zero at control current = $\pm icon$.  Junctions with {\vt cct=4}
have maximum critical current at control current = $-${\vt icon}, and
linear reduction to zero at control current = $+${\vt icon}.  If {\vt
cct} is specified as 2, 3, or 4, the area parameter, if given, is set
to unity.  Otherwise, the model parameters are scaled appropriately by
the area before use.

\item{\vt icon}\\
{\bf range:} 1e-4 -- 1.0\\
{\bf Level 1 only.}\\
This parameter applies when the {\vt cct} parameter is set to one of
the choices larger the 1, where critical current modulation is
modeled.  The value of {\vt icon} is the first value for (assumed)
full suppression of critical current.

The parameter is not currently recognized by the Verilog-A Josephson
junction model provided with {\WRspice}, as that model does not
currently support values of {\vt cct} larger than 1.

\item{\vt icrit}\\
{\bf range:} 1nA -- 0.1A\\
This is the critical current of the reference junction, which defaults
to 1.0mA if not given.  This parameter is not used if {\vt cct} is 0.
the superconducting current through a Josepjson junctions is
\begin{quote}
$I = I_c sin(\phi)$
\end{quote}
where $I_c$ is the critical current. and the junction ``phase'' is
\begin{quote}
$\phi = (2\pi/\Phi_0)\int^t_{-\infty} V(t)dt$ .
\end{quote}
The {\it V(t)} is the junction voltage, and $\Phi_0$ is the magnetic
flux quantum.

The {\vt icrit} parameter should not be confused with the
{\vt ics} instance parameter.  The latter is actually a scale
factor which specifies the instantiated device critical current as
well as appropriately scaling conductances and capacitance, from
the model reference current which is {\vt icrit}.

\item{{\vt vgap} or {\vt vg}}\\
{\bf range:} 0.1mV -- 10.0mV\\
This parameter specifies the gap voltage, which in a hysteretic
Josephson junction is a voltage at which there is a large and abrupt
increase in conductivity.  This parameter is material dependent, the
default 2.6mV is appropriate for niobium junctions.

\item{\vt delv}\\
{\bf range:} $0.001{\vt vgap}$ -- $0.2{\vt vgap}$\\
{\bf Levels 1 and 2 only.}\\
This specifies the assumed width, in voltage, of the quasiparticle
step region, or gap.  In this region, current increases sharply with
increasing voltage.  The default value of 80uV is reasonable for
high-quality niobium/aluminum oxide Josephson junctions independent of
foundry.

\item{\vt cap}\\
{\bf range:} 0.0 -- 1nF\\
This is the capacitance of the reference junction, in farads.  This
will override the {\vt cpic} parameter if given, setting a fixed value
for reference junction capacitance, invariant with {\vt icrit}.  If
not given, junction specific capacitance is set via the {\vt cpic}
parameter, see below.

\item{\vt cpic}\\
{\bf range:} 0.0 -- 1e-9\\
This supplies the default capacitance per critical current in F/A. 
This defaults to the MIT Lincoln Laboratory SFQ5EE process <a
href="tolpygo">[Tolpygo]</a> value (0.7pF for 1.0 mA), and will set
the junction capacitance if <tt>cap</tt> is not given.  With
<tt>cap</tt> not given, changing <tt>icrit</tt> will change the
assumed capacitance of the reference junction.

\item{\vt cmu}\\
{\bf range:} 0.0 -- 1.0\\
This is a new parameter in the current model, which is intended to
account for nonlinearity in scaling of capacitance with area (or
critical current, we actually define ``area'' as the actual over the
reference critical current).  It is anticipated that the actual
junction capacitance consists of two components:  a physical area
dependent ``bulk'' term, and a perimeter-dependent fringing term.  The
{\vt cmu} is a real number between 0 and 1 where if 0 we assume no
perimeter dependence, and if 1 we assume that all variation scales
with the perimeter.  The default value is 0.  The capacitance of an
instantiated junctions is as follows:
\begin{quote}
$C = cap (A(1-cmu) + \sqrt{A} cmu)$
\end{quote}
Here, $A$ is the ``area'' scaling factor, which is the ratio of the
junction critical current to the reference critical current.

\item{\vt vm}\\
{\bf range:} 8mV -- 100mV\\
This is the product of the reference subgap resistance and the
reference device critical current.  This parameter is commonly
provided by foundries, and is a standard indicator for junction
quality (higher is better).  Values tend to decrease with increasing
critical current density.  This defaults to the value for the MIT
Lincoln Laboratory SFQ5EE process\cite{tolpygo}, which is 16.5mV, The
reference junction subgap resistance is obtained from the value of
this parameter and the critical current, unless given explicitly.

\item{{\vt rsub} or {\vt r0}}\\
{\bf range:} 8mV/{\vt icrit} -- 100mV/{\vt icrit}\\
The reference junction subgap resistance can be given directly
with this parameter, and a given value will override the
{\vt vm} value if also given.

\item{\vt icrn}\\
{\bf range:} 1.5mV -- 1.9mV\\
{\bf Levels 1 and 2 only.}\\
This is the product of the reference junction ``normal state''
resistance and the critical current, where the normal state resistance
is the differential resistance measured well above the gap.  The
default value is that provided for the MIT Lincoln Laboratory SFQ5EE
process\cite{tolpygo} which is 1.65mV.  This too is a commonly given
parameter from Josephson foundries for characterizing junctions.  If
not specified explicitly, this provides the reference junction normal
state resistance from the critical current.

\item{{\vt rnorm} or {\vt rn}}\\
{\bf range:} 1.5mV/{\vt icrit} -- 1.9mV/{\vt icrit}\\
{\bf Levels 1 and 2 only.}\\
The reference junction normal state resistance can be given explicitly
with this parameter, which will override {\vt icrn} if this is also
given.

\item{\vt gmu}\\
{\bf range:} 0.0 -- 1.0\\
This is analogous to {\vt cmu}, and applies to the subgap and normal
conductances.  The {\vt vm}, in particular, may vary with junction
physical size, with small junctions having lower {\vt vm} than larger
ones.  This parameter should capture this effect.  It is taken that a
significant part of the conductivity is due to defects or
imperfections around the periphery of the junction area, and the
contribution would therefor scale with the perimeter.  The scaling for
conductivity is as follows:
\begin{quote}
$G_x = G_{x0} (A(1-gmu) + \sqrt{A} gmu)$
\end{quote}
Here, $G_x$ refers to either the subgap or normal conductance,
$G_{x0}$ is the same parameter for the reference junction.  The $A$ is
the scaling parameter, that is, the ratio of instance to reference
critical currents.  The default value is 0, meaning that scaling is
assumed purely linear, which will be the case until a number is
provided through additional data analysis.  It may prove necessary to
have separate scaling parameters for subgap and above gap condutance,
at which time a new model parameter may be added.

\item{{\vt icfct} or {\vt icfact}}\\
{\bf range:} 0.5 -- ${\pi}/4$\\
This parameter sets the ratio of the critical current to the
quasiparticle step height.  Theory provides the default value of
$\pi/4$ which is usually adequately close.  Characterization of
fabricated junctions would provide an improved number.

\item{\vt force}\\
{\bf range:} 0 or 1\\
If this flag is set, then the only range test applied to subgap and
above gap resistance values is that they be larger than zero.  This
affects the parameters that set the quasiparticle branch conductance
values, any input other than a short circuit is allowed.

\item{\vt vshunt}\\
{\bf range:} 0.0 -- 2.0mV\\
This parameter is unique in that it does not describe an as-fabricated
junction characteristic.  Rather, it is for convenience in specifying
a shunt resistance to use globally in SFQ circuits, If given (in
volts) conductance will be added automatically so that the product of
the total subgap conductance and the critical current will equal {\vt
vshunt}.  This avoids having to calculate the value of and add an
explicit resistor across each Josephson junction, as used for damping
in these circuits.  The designer should choose a value consistent with
the process parameters and the amount of damping required.  Higher
values will provide less damping, usually critical damping is desired. 
This parameter defaults to 0, meaning that no additional demping is
supplied by default.

\item{\vt lsh0}\\
{\bf range:} 0.0 -- 2.0pH
\item{\vt lsh1}\\
{\bf range:} 0.0 -- 10.0pH/${\Omega}$\\
These parameters specify series parasitic inductance in the external
shunt resistor.  the {\vt vshunt} parameter must be given a value such
that the added external conductance is positive, or these parameters
are ignored.  The inductance consists of a constant part ({\vt lsh0})
assumed to come from resistor contacts, plus a value ({\vt lsh1})
proportional to the resistance in ohms, intended to capture the length
dependence.

\item{\vt tsfactor}\\
{\bf range:} 0.001 -- 1.0\\
This is mainly for compatibility with the Verilog-A Josephson junction
model provided with {\WRspice} in the Verilog-A examples.  This is
equivalent to the {\WRspice} {\vt dphimax} parameter, but is
normalized to $2\pi$.  If not given, it defaults to ${\vt dphimax}/2\pi$
in {\WRspice}, or 0.1 in the Verilog-A model not used in {\WRspice}. 
This is the maximum phase change allowed between internal time points. 

\item{\vt tsaccel}\\
{\bf range:} 1.0 -- 100.0\\
Time step limiting is performed relative to the Josephson frequency of
the instantaneous absolute junction voltage or the dropback voltage,
whichever is larger.  The phase change is limited by {\vt tsfactor},
thus corresponding to a maximum time step relative to the period of
the frequency corresponding to the voltage.  Note that in SFQ
circuits, where the junctions are critically damped, the junction
voltage is unlikely to exceed the dropback voltage, which is
numerically equal to the critical current times the shunt resistance
({\vt vshunt}).  This implies that the maximum time step is a fixed
value by default.

When simulating SFQ circuits, between SFQ pulses there is often
significant time where signals are quiescent and one could probably
take larger time steps, speeding simulation.  This appears true to an
extent, however one can see signs of instability if steps are too
large.

The {\vt tsaccel} parameter is the ratio of the longest time step
allowed to that allowed at the dropback voltage.  In computing the
time step, the low voltage threshold is reduced to the dropback
voltage divided by {\vt tsaccel}, so time steps will be inversely
proportional to voltages above this value.

Experimentation suggests that a value of 2.5 is a good choice for RSFQ
circuits, your results may vary.

\item{\vt tc}\\
{\bf range:} 0.1K -- 280K\\
This is the transition temperature of the material used in the
Josephson junction.  We assume that both junction electrodes use the
same material.  The default value is 9.26K, the transition temperature
of niobium.

\item{\vt tnom}\\
{\bf range:} 0.0K -- 0.95*{\vt tc}\\
This is the temperature at which all model parameters are measured. 
The default is 4.2K, the boiling point of liquid helium.

\item{\vt temp}\\
{\bf range:} 0.0K -- 0.95*{\vt tc}\\
This is the default operating temperature of instances of the model,
which can be overridden on a per-instance basis by specifying the
instance parameter of the same name.  The default is the {\vt tnom}
value.

\item{\vt tcfct}\\
{\bf range:} 1.5 -- 2.5\\
The model utilizes a BCS interpolation formula to represent
temperature variation of the gap parameter of the superconductor, with
the current restriction that the same superconductor (and gap
parameter) appears on either side of the barrier.

\begin{quote}
$\Delta = \Delta_0 tanh(tcfct\sqrt(tc/T-1))$
\end{quote}
Reference: {\vt https://physics.stackexchange.com/questions/192416/\\
interpolation-formula-for-bcs-superconducting-gap}

Here, $\Delta$ is the gap parameter, with the subscript indicating the
value at temperature T=0.  The {\vt tcfct} parameter is
semi-empirical, commonly cited as 1.74, which is the default value. 
It is taken that the junction gap voltage and critical current are
directly proportional to the gap parameter.  The quasiparticle
resistance is assumed invariant with temperature, which should be true
for the low temperatures of interest.

In order to apply temperature correction one takes the assumption that
parameters for the reference junction are measured at nominal
temperature {\vt tnom}, and we therefor have

\begin{quote}
$\Delta_{nom} = \Delta_0 tanh(tcfct\sqrt(tc/tnom-1))$
\end{quote}

The correction factor, which will multiply device critical current and
gap voltage, is the ratio $\Delta/\Delta_{nom}$.  This is applied, in
addition to area scaling, when extrapolating device parameters from
reference junction parameters.

\item{\vt vdpbak} (read only)\\
This parameter returns the computed value of the dropback voltage,
which is the voltage at which the return trace of a hysteretic
Josephson junction i-v curve snaps back to the zero-voltage state.  If
is also the voltage equivalent of the plasma resonance, and the
product of critical current and shunt resistance for critical damping.
\end{description}

